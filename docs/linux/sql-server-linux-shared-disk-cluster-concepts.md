---
title: Экземпляры отказоустойчивого кластера — SQL Server на базе Linux
description: Основные понятия для экземпляров отказоустойчивого кластера SQL Server в Linux включают уровень кластеризации, число экземпляров, IP-адрес, имя и общее хранилище.
author: VanMSFT
ms.author: vanto
ms.reviewer: vanto
ms.date: 08/28/2017
ms.topic: conceptual
ms.prod: sql
ms.technology: linux
ms.openlocfilehash: 1b2b852a1c1acecefa3b702bb140d9128d04a212
ms.sourcegitcommit: 610e3ebe21ac6575850a29641a32f275e71557e3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/07/2020
ms.locfileid: "91784638"
---
# <a name="failover-cluster-instances---sql-server-on-linux"></a>Экземпляры отказоустойчивого кластера — SQL Server на базе Linux

[!INCLUDE [SQL Server - Linux](../includes/applies-to-version/sql-linux.md)]

В этой статье описаны основные понятия, связанные с экземплярами отказоустойчивого кластера (FCI) SQL Server на Linux. 

Чтобы создать экземпляр отказоустойчивого кластера SQL Server в Linux, см. статью [Настройка экземпляра отказоустойчивого кластера SQL Server в Linux](sql-server-linux-shared-disk-cluster-configure.md).

## <a name="the-clustering-layer"></a>Уровень кластеризации

* В RHEL уровень кластеризации основан на [надстройке высокой доступности (HA)](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/pdf/High_Availability_Add-On_Overview/Red_Hat_Enterprise_Linux-6-High_Availability_Add-On_Overview-en-US.pdf) Red Hat Enterprise Linux (RHEL). 

    > [!NOTE] 
    > Для доступа к надстройке высокого уровня доступности и документации по Red Hat требуется подписка. 

* В SLES уровень кластеризации основан на [расширении высокой доступности (HAE)](https://www.suse.com/products/highavailability) SUSE Linux Enterprise.

    Дополнительные сведения о конфигурации кластера, параметрах агента ресурсов, управлении и рекомендациях см. в статье [Расширение высокого уровня доступности для SUSE Linux Enterprise 12 с пакетом обновления 2 (SP2)](https://www.suse.com/documentation/sle-ha-12/index.html).

Надстройка HA RHEL и расширение HAE SUSE основаны на [Pacemaker](https://clusterlabs.org/).

Как показано на схеме ниже, хранилище представляется двум серверам. Компоненты кластеризации — Corosync и Pacemaker — координируют обмен данными и управление ресурсами. Один из серверов имеет активное подключение к ресурсам хранилища и SQL Server. Когда Pacemaker обнаруживает сбой, компоненты кластеризации управляют перемещением ресурсов в другой узел.  

![Red Hat Enterprise Linux 7, общий диск, кластер SQL](./media/sql-server-linux-shared-disk-cluster-red-hat-7-configure/LinuxCluster.png) 


> [!NOTE]
> На этом этапе интеграция SQL Server с Pacemaker в Linux реализована не на таком уровне, как с WSFC в Windows. Внутри SQL сведения о наличии кластера отсутствуют, вся оркестрация осуществляется снаружи, а сама служба управляется Pacemaker как автономный экземпляр. Кроме того, имя виртуальной сети относится только к WSFC. В Pacemaker его эквивалент отсутствует. Ожидается, что @@servername и sys.servers возвратят имя узла, а динамические административные представления sys.dm_os_cluster_nodes и sys.dm_os_cluster_properties кластера не будУт иметь записи. Чтобы использовать строку подключения, указывающую на строковое имя сервера, а не IP-адрес, им потребуется зарегистрировать на DNS-сервере IP-адрес, использованный для создания ресурса виртуального IP-адреса (как описано в следующих разделах) с выбранным именем сервера.

## <a name="number-of-instances-and-nodes"></a>Число экземпляров и узлов

Одним из ключевых отличий SQL Server на Linux является то, что разрешена всего одна установка SQL Server на каждый сервер Linux. Такая установка называется экземпляром. Это означает, что в отличие от Windows Server где поддерживается до 25 экземпляров отказоустойчивого кластера на каждый отказоустойчивый кластер Windows Server (WSFC), экземпляр отказоустойчивого кластера на Linux будет иметь всего один экземпляр. Этот единственный экземпляр также является экземпляром по умолчанию, в Linux концепция именованного экземпляра отсутствует. 

Кластер Pacemaker может содержать до 16 узлов при использовании Corosync, поэтому один экземпляр отказоустойчивого кластера может охватывать до 16 серверов. Экземпляр отказоустойчивого кластера, реализованный на базе выпуска SQL Server Standard, поддерживает до двух узлов кластера, даже если кластер Pacemaker содержит максимум 16 узлов.

В экземпляре отказоустойчивого кластера SQL Server экземпляр SQL Server активен либо на одном, либо на другом узле.

## <a name="ip-address-and-name"></a>IP-адрес и имя
В кластере Pacemaker на Linux каждому экземпляру отказоустойчивого кластера SQL Server требуется собственный уникальный IP-адрес и имя. Если конфигурация экземпляра отказоустойчивого кластера охватывает несколько подсетей, для каждой из них потребуется один IP-адрес. Уникальные имя и IP-адреса используются для доступа к экземпляру отказоустойчивого кластера, чтобы приложениям и конечным пользователям не требовалось знать, какой базовый сервер используется для кластера Pacemaker.

Имя экземпляра отказоустойчивого кластера в DNS должно совпадать с именем ресурса экземпляра отказоустойчивого кластера, созданного в кластере Pacemaker.
Имя и IP-адрес должны быть зарегистрированы в DNS.

## <a name="shared-storage"></a>Общее хранилище
Все экземпляры отказоустойчивого кластера, основанные как на Linux, так и на Windows Server, должны иметь определенную форму общего хранилища. Это хранилище предоставляется всем серверам, где может размещаться экземпляр отказоустойчивого кластера, но только один сервер может использовать хранилище для экземпляра отказоустойчивого кластера в любой конкретный момент времени. Ниже перечислены функции, доступные для общего хранилища в Linux:

- iSCSI
- Файловая система NFS
- Протокол SMB. В Windows Server доступные параметры немного отличаются. Одной из функций, которая сейчас не поддерживается для экземпляров отказоустойчивого кластера на базе Linux, является возможность использовать диск, являющийся локальным по отношению к узлу для TempDB, который является временной рабочей областью SQL Server.

В конфигурации, охватывающей несколько расположений, содержимое, хранящееся в одном центре обработки данных, нужно синхронизировать с другим центром. В случае отработки отказа экземпляр отказоустойчивого кластера сможет включиться, при этом видимые изменения в хранилище отсутствуют. Для этого потребуется внешний метод для репликации хранилища, независимо от того, используется ли для этого базовое оборудование хранилища или какая-либо служебная программа. 

>[!NOTE]
>Для SQL Server развертывания на базе Linux с использованием дисков, предоставленных непосредственно серверу, необходимо форматировать с использованием XFS или EXT4. Другие файловые системы сейчас не поддерживаются. Все изменения будут отражены здесь.

Процесс представления общего хранилища одинаков для различных поддерживаемых методов.

- Настройте общее хранилище.
- Подключите хранилище в качестве папки к серверам, которые будут выступать в качестве узлов кластера Pacemaker для экземпляра отказоустойчивого кластера.
- При необходимости переместите системные базы данных SQL Server в общее хранилище.
- Проверьте работу SQL Server с каждого сервера, подключенного к общему хранилищу.

Одно из основных отличий SQL Server на базе Linux заключается в том, что, хотя вы можете настроить расположение по умолчанию для пользовательских данных и файлов журналов, системные базы данных должны всегда находиться в `/var/opt/mssql/data`. В Windows Server существует возможность переместить системные базы данных, включая TempDB. Этот факт влияет на настройку общего хранилища для экземпляра отказоустойчивого кластера.

Пути по умолчанию для баз данных, не являющихся системными, можно изменить с помощью служебной программы `mssql-conf`. Сведения об изменении значений по умолчанию см. в статье [Изменение каталога по умолчанию для данных или журналов](sql-server-linux-configure-mssql-conf.md#datadir). Можно также хранить транзакции и данные SQL Server в других местах, если они обеспечивают необходимый уровень безопасности, даже если это не расположение по умолчанию. Такое расположение должно быть указано.

В следующих разделах описано, как настроить поддерживаемые типы хранилищ для экземпляра отказоустойчивого кластера CI SQL Server на основе Linux.

- [Настройка экземпляра отказоустойчивого кластера (iSCSI) — SQL Server на Linux](sql-server-linux-shared-disk-cluster-configure-iscsi.md)
- [Настройка экземпляра отказоустойчивого кластера (NFS) — SQL Server на Linux](sql-server-linux-shared-disk-cluster-configure-nfs.md)
- [Настройка экземпляра отказоустойчивого кластера (SMB) — SQL Server на Linux](sql-server-linux-shared-disk-cluster-configure-smb.md)
