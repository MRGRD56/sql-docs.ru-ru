---
description: Обработка транзакций
title: Обработка транзакций | Документация Майкрософт
ms.prod: sql
ms.prod_service: connectivity
ms.technology: ado
ms.custom: ''
ms.date: 01/19/2017
ms.reviewer: ''
ms.topic: conceptual
helpviewer_keywords:
- transactions [ADO]
- data updates [ADO], transaction processing
- updating data [ADO], transaction processing
- nested transactions [ADO]
ms.assetid: 74ab6706-e2dc-42cb-af77-dbc58a9cf4ce
author: rothja
ms.author: jroth
ms.openlocfilehash: f534d38ea52e942a00e2e95f837b096ed6fef0f1
ms.sourcegitcommit: 917df4ffd22e4a229af7dc481dcce3ebba0aa4d7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/10/2021
ms.locfileid: "100032386"
---
# <a name="transaction-processing"></a>Обработка транзакций
*Транзакция* разделяет начало и конец последовательности операций доступа к данным, выполняемых по соединению. В соответствии с транзакционными возможностями источника данных объект **Connection** также позволяет создавать транзакции и управлять ими. Например, используя поставщик OLE DB Майкрософт для SQL Server для доступа к базе данных на Microsoft SQL Server, можно создать несколько вложенных транзакций для выполняемых команд.  
  
 Объекты ADO гарантируют, что изменения в источнике данных, получаемые операциями в транзакции, выполняются успешно или вообще.  
  
 Если отменить транзакцию или одна из ее операций завершится ошибкой, результат будет таким же, как если бы ни одна из операций в транзакции не была выполнена. Источник данных останется в том виде, в котором он находился до начала транзакции.  
  
 ADO предоставляет следующие методы управления транзакциями: **примеры BeginTrans**, **CommitTrans** и **RollbackTrans**. Используйте эти методы с объектом **Connection** , если нужно сохранить или отменить ряд изменений, внесенных в исходные данные в виде одного элемента. Например, чтобы переносить деньги между учетными записями, можно вычесть сумму из единицы и добавить ту же сумму в другую. В случае сбоя одного из обновлений учетные записи больше не будут сбалансированы. Внесение этих изменений в открытой транзакции гарантирует, что все изменения не проходят.  
  
> [!NOTE]
>  Не все поставщики поддерживают транзакции. Убедитесь, что определяемое поставщиком свойство "**Transaction DDL**" отображается в коллекции [свойств](../../../ado/reference/ado-api/properties-collection-ado.md) объекта **Connection** , указывая, что поставщик поддерживает транзакции. Если поставщик не поддерживает транзакции, вызов одного из этих методов возвратит ошибку.  
  
 После вызова метода **примеры BeginTrans** поставщик больше не будет мгновенно фиксировать внесенные изменения, пока вы не вызовите **CommitTrans** или **RollbackTrans** , чтобы завершить транзакцию.  
  
 Вызов метода **CommitTrans** сохраняет изменения, сделанные в открытой транзакции в соединении, и завершает транзакцию. Вызов метода **RollbackTrans** изменяет все изменения, сделанные в открытой транзакции, и завершает транзакцию. Вызов любого из методов при отсутствии открытой транзакции приводит к ошибке.  
  
 В зависимости [от свойства объекта](../../../ado/reference/ado-api/attributes-property-ado.md) **соединения** , вызов метода **CommitTrans** или **RollbackTrans** может автоматически начать новую транзакцию. Если свойство **Attributes** имеет значение **адксакткоммитретаининг**, то поставщик автоматически запускает новую транзакцию после вызова **CommitTrans** . Если свойство **Attributes** имеет значение **адксактабортретаининг**, то поставщик автоматически запускает новую транзакцию после вызова **RollbackTrans** .  
  
## <a name="transaction-isolation-level"></a>Уровень изоляции транзакции  
 Используйте свойство **IsolationLevel** , чтобы установить уровень изоляции транзакции для объекта **соединения** . Параметр не вступит в силу до следующего вызова метода [примеры BeginTrans](../../../ado/reference/ado-api/begintrans-committrans-and-rollbacktrans-methods-ado.md) . Если запрошенный уровень изоляции недоступен, поставщик может вернуть следующий более высокий уровень изоляции. Дополнительные сведения о допустимых значениях см. в описании свойства **IsolationLevel** в справочнике программиста по ADO.  
  
## <a name="nested-transactions"></a>Вложенные транзакции  
 Для поставщиков, поддерживающих вложенные транзакции, вызов метода **примеры BeginTrans** в открытой транзакции запускает новую вложенную транзакцию. Возвращаемое значение указывает уровень вложенности: возвращаемое значение "1" указывает, что вы открыли транзакцию верхнего уровня (то есть транзакция не вложена в другую транзакцию), "2" означает, что вы открыли транзакцию второго уровня (транзакцию, вложенную в транзакцию верхнего уровня) и т. д. Вызов **CommitTrans** или **RollbackTrans** влияет только на последнюю открытую транзакцию. перед разрешением любых транзакций более высокого уровня необходимо закрыть или откатить текущую транзакцию.
