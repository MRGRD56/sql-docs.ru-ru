---
description: Предложение COMPUTE для формирования данных
title: Предложение вычислений Shape | Документация Майкрософт
ms.prod: sql
ms.prod_service: connectivity
ms.technology: ado
ms.custom: ''
ms.date: 01/19/2017
ms.reviewer: ''
ms.topic: conceptual
helpviewer_keywords:
- shape commands [ADO]
- compute clause [ADO]
- data shaping [ADO], COMPUTE clause
ms.assetid: 3fdfead2-b5ab-4163-9b1d-3d2143a5db8c
author: rothja
ms.author: jroth
ms.openlocfilehash: b246b1e70f18836455008f8d9e3c1b972e71f183
ms.sourcegitcommit: 917df4ffd22e4a229af7dc481dcce3ebba0aa4d7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/10/2021
ms.locfileid: "100037004"
---
# <a name="shape-compute-clause"></a>Предложение COMPUTE для формирования данных
Предложение Shape COMPUTE создает родительский **набор записей**, столбцы которого состоят из ссылки на дочерний **набор записей**. необязательные столбцы, содержимое которых содержит главу, новый или вычисляемый столбец, или результат выполнения агрегатных функций в дочернем **наборе записей** или ранее сформированном **наборе записей**. и любые столбцы из дочернего **набора записей** , перечисленные в необязательном предложении by.  
  
## <a name="syntax"></a>Синтаксис  
  
```  
SHAPE child-command [AS] child-alias  
   COMPUTE child-alias [[AS] name], [appended-column-list]  
   [BY grp-field-list]  
```  
  
## <a name="description"></a>Описание  
 Ниже приведены части этого предложения.  
  
 *Дочерняя команда*  
 Состоит из одного из следующих элементов:  
  
-   Команда запроса в фигурных скобках (" {} "), которая возвращает дочерний объект **Recordset** . Команда выдается базовому поставщику данных, и его синтаксис зависит от требований этого поставщика. Как правило, это будет язык SQL, хотя для ADO не требуется какой бы то ни было определенного языка запросов.  
  
-   Имя существующего **набора записей** в форме.  
  
-   Другая команда Shape.  
  
-   Ключевое слово TABLE, за которым следует имя таблицы в поставщике данных.  
  
 *дочерний псевдоним*  
 Псевдоним, используемый для ссылки на **набор записей** , возвращаемый *дочерней командой.* В списке столбцов в предложении COMPUTE требуется *дочерний псевдоним* , определяющий связь между родительским и дочерним объектами **Recordset** .  
  
 *список добавленных столбцов*  
 Список, в котором каждый элемент определяет столбец в созданном родительском объекте. Каждый элемент содержит либо столбец раздела, либо новый столбец, вычисляемый столбец, либо значение, полученное в результате агрегатной функции в дочернем **наборе записей**.  
  
 *grp-field-list*  
 Список столбцов в родительских и дочерних объектах **набора записей** , который указывает, как строки должны быть сгруппированы в дочернем объекте.  
  
 Для каждого столбца в *списке GRP-Field* имеется соответствующий столбец в дочерних и родительских объектах **Recordset** . Для каждой строки в родительском **наборе записей** столбцы с *перечнем полей* имеют уникальные значения, а дочерний **набор записей** , на который ссылается родительская строка, состоит только из дочерних строк *, столбцы которых* имеют те же значения, что и родительская строка.  
  
 Если включено предложение BY, то строки дочернего **набора записей** будут сгруппированы на основе столбцов в предложении COMPUTE. Родительский **набор записей** будет содержать по одной строке для каждой группы строк в дочернем **наборе записей**.  
  
 Если предложение BY пропущено, весь дочерний **набор записей** обрабатывается как единственная группа, а родительский **набор записей** будет содержать ровно одну строку. Эта строка будет ссылаться на весь дочерний **набор записей**. Пропуск предложения BY позволяет вычислять статистические выражения "общие итоги" по всему дочернему **набору записей**.  
  
 Пример:  
  
```  
SHAPE {select * from Orders} AS orders             COMPUTE orders, SUM(orders.OrderAmount) as TotalSales         
```  
  
 Независимо от способа формирования родительского **набора записей** (с помощью COMPUTE или Append) он будет содержать столбец глав, который используется для связи его с дочерним **набором записей**. При желании родительский **набор записей** может также содержать столбцы, содержащие статистические выражения (SUM, min, Max и т. д.) над дочерними строками. Как родительский, так и дочерний **набор записей** могут содержать столбцы, содержащие выражение в строке **набора записей**, а также столбцы, которые являются новыми и изначально пустыми.  
  
## <a name="operation"></a>Операция  
 *Дочерняя команда* выдается поставщику, который возвращает дочерний **набор записей**.  
  
 Предложение COMPUTE указывает столбцы родительского **набора записей**, которые могут быть ссылками на дочерний **набор записей**, одно или несколько агрегатов, вычисляемых выражений или новых столбцов. Если имеется предложение BY, то столбцы, которые он определяет, также добавляются к родительскому **набору записей**. Предложение BY указывает, как группируются строки дочернего **набора записей** .  
  
 Например, предположим, что имеется таблица с именем демографические данные, которая состоит из полей штат, город и заполнение. (Данные о заполнении в таблице представлены исключительно в качестве примера).  
  
|Область|City|Заполнение|  
|-----------|----------|----------------|  
|WA|Сиэтл|700 000|  
|ИЛИ|медфорд|200 000|  
|ИЛИ|Портленд|400 000|  
|Целостности и доступности|Лос-Анджелес|800 000|  
|Целостности и доступности|San Diego|600 000|  
|WA|Такома|500 000|  
|ИЛИ|корваллис|300 000|  
  
 Теперь выполните следующую команду Shape:  
  
```  
rst.Open  "SHAPE {select * from demographics} AS rs "  & _  
          "COMPUTE rs, SUM(rs.population) BY state", _  
           objConnection  
```  
  
 Эта команда открывает **набор записей** в форме с двумя уровнями. Родительский уровень — это созданный **набор записей** со столбцом со статистическими данными ( `SUM(rs.population)` ), столбцом, ссылающимся на дочерний **набор записей** ( `rs` ), и столбцом для группирования дочернего **набора записей** ( `state` ). Дочерний уровень — это **набор записей** , возвращаемый командой запроса ( `select * from demographics` ).  
  
 Строки сведений о дочернем **наборе записей** будут сгруппированы по состоянию, но в противном случае — нет. Это значит, что группы не будут в алфавитном или числовом порядке. Если необходимо упорядочить родительский **набор** записей, можно использовать метод **сортировки набора записей** для упорядочивания родительского **набора записей**.  
  
 Теперь можно перемещаться по открытому родительскому **набору записей** и обращаться к объектам **набора записей** дочернего элемента. Дополнительные сведения см. [в разделе доступ к строкам в иерархическом наборе записей](../../../ado/guide/data/accessing-rows-in-a-hierarchical-recordset.md).  
  
## <a name="resultant-parent-and-child-detail-recordsets"></a>Результирующие наборы записей сведений о родительском и дочернем элементах  
  
### <a name="parent"></a>Parent  
  
|SUM (RS. Повтор|rs|Область|  
|---------------------------|--------|-----------|  
|1 300 000|Ссылка на child1|Целостности и доступности|  
|1 200 000|Ссылка на Child2|WA|  
|1 100 000|Ссылка на child3|ИЛИ|  
  
## <a name="child1"></a>Child1  
  
|Область|City|Заполнение|  
|-----------|----------|----------------|  
|Целостности и доступности|Лос-Анджелес|800 000|  
|Целостности и доступности|San Diego|600 000|  
  
## <a name="child2"></a>Child2  
  
|Область|City|Заполнение|  
|-----------|----------|----------------|  
|WA|Сиэтл|700 000|  
|WA|Такома|500 000|  
  
## <a name="child3"></a>Child3  
  
|Область|City|Заполнение|  
|-----------|----------|----------------|  
|ИЛИ|медфорд|200 000|  
|ИЛИ|Портленд|400 000|  
|ИЛИ|корваллис|300 000|  
  
## <a name="see-also"></a>См. также:  
 [Доступ к строкам в иерархическом наборе записей](../../../ado/guide/data/accessing-rows-in-a-hierarchical-recordset.md)   
 [Общие сведения о формировании данных](../../../ado/guide/data/data-shaping-overview.md)   
 [Объект Field](../../../ado/reference/ado-api/field-object.md)   
 [Грамматика формальной фигуры](../../../ado/guide/data/formal-shape-grammar.md)   
 [Объект Recordset (ADO)](../../../ado/reference/ado-api/recordset-object-ado.md)   
 [Необходимые поставщики для формирования данных](../../../ado/guide/data/required-providers-for-data-shaping.md)   
 [Предложение APPEND для фигур](../../../ado/guide/data/shape-append-clause.md)   
 [Общие команды формы](../../../ado/guide/data/shape-commands-in-general.md)   
 [Свойство Value (ADO)](../../../ado/reference/ado-api/value-property-ado.md)   
 [Функции Visual Basic для приложений](../../../ado/guide/data/visual-basic-for-applications-functions.md)
