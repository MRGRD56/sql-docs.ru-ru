---
description: Комментарии к HelloData
title: Комментарии в HelloData | Документация Майкрософт
ms.prod: sql
ms.prod_service: connectivity
ms.technology: ado
ms.custom: ''
ms.date: 01/19/2017
ms.reviewer: ''
ms.topic: conceptual
helpviewer_keywords:
- hellodata sample application [ADO]
ms.assetid: a2831d77-7040-4b73-bbae-fe0bf78107ed
author: rothja
ms.author: jroth
ms.openlocfilehash: e0510d75c69caadd52a595d58900662cc8ef7ad4
ms.sourcegitcommit: 917df4ffd22e4a229af7dc481dcce3ebba0aa4d7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/10/2021
ms.locfileid: "100037714"
---
# <a name="comments-on-hellodata"></a>Комментарии к HelloData
Приложение HelloData проходит через основные операции обычного приложения ADO: получение, изучение, редактирование и обновление данных. При запуске приложения нажмите первую кнопку, чтобы **получить данные**. Будет выполнена подпрограммы **GetData** .  
  
## <a name="getdata"></a>GetData  
 Метод **GetData** помещает допустимую строку подключения в переменную уровня модуля *m_sConnStr*. Дополнительные сведения о строках подключения см. [в разделе Создание строки подключения](./creating-a-connection-string.md).  
  
 Назначьте обработчик ошибок с помощью Visual Basic инструкции **OnError** . Дополнительные сведения об обработке ошибок в ADO см. в разделе [Обработка ошибок](./error-handling.md). Создается новый объект **соединения** , а свойству **CursorLocation** присваивается значение **адусеклиент** , так как в примере HelloData создается *несвязанный набор записей*. Это означает, что, как только данные будут получены из источника данных, физическое подключение к источнику данных будет разорвано, но вы по-прежнему сможете работать с данными, кэшированными локально в объекте **набора записей** .  
  
 После открытия соединения назначьте строку SQL переменной (sSQL). Затем создайте экземпляр нового объекта **набора записей** , `m_oRecordset1` . В следующей строке кода откройте **набор записей** для существующего **соединения**, передав его в `sSQL` качестве источника **набора записей**. С помощью ADO можно определить, что строка SQL, которую вы передали как источник для **набора записей** , является текстовым определением команды, передав **адкмдтекст** в последнем аргументе в метод **Open набора записей** . В этой строке также задаются **LockType** и **примеры CursorType** , связанные с **набором записей**.  
  
 Следующая строка кода задает свойство **MarshalOptions** равным **адмаршалмодифиедонли**. **MarshalOptions** указывает, какие записи должны быть упакованы на средний уровень (или на веб-сервер). Дополнительные сведения о маршалировании см. в документации по COM. При использовании **адмаршалмодифиедонли** с курсором на стороне клиента ([CursorLocation](../../reference/ado-api/cursorlocation-property-ado.md)  =  **адусеклиент**) только записи, которые были изменены на клиенте, записываются обратно на средний уровень. Установка параметра **MarshalOptions** в значение **адмаршалмодифиедонли** может повысить производительность, поскольку число упакованных строк будет меньше.  
  
 Затем отключите **набор записей** , установив свойство **ActiveConnection** равным **Nothing**. Дополнительные сведения см. в разделе «Отключение и повторное подключение набора записей» раздела [обновление и сохранение данных](./updating-and-persisting-data.md).  
  
 Закройте соединение с источником данных и удалите существующий объект **соединения** . При этом освобождаются используемые ресурсы.  
  
 Последним шагом является установка набора **записей** в качестве **источника данных** для элемента управления Microsoft DataGrid в форме, чтобы можно было легко отобразить данные из **набора записей** в форме.  
  
 Нажмите вторую кнопку, **Проверьте данные**. При этом выполняется подпрограммы **ексаминедата** .  
  
## <a name="examinedata"></a>ексаминедата  
 Ексаминедата использует различные методы и свойства объекта **Recordset** для вывода сведений о данных в **наборе записей**. Он сообщает количество записей с помощью свойства **RecordCount** . Он выполняет цикл по **набору записей** и выводит значение свойства **примеры AbsolutePosition** в текстовом поле, отображаемом в форме. Кроме того, в цикле значение свойства **Bookmark** для третьей записи помещается в переменную Variant *вбукмарк* для последующего использования.  
  
 Подпрограмма переходит непосредственно к третьей записи, используя переменную закладки, которая была сохранена ранее. Подподпрограмма вызывает подпрограммы **валкфиелдс** , которая просматривает коллекцию **полей** **набора записей** и отображает подробные сведения о каждом **поле** в коллекции.  
  
 Наконец, **ексаминедата** использует свойство **Filter** **набора записей** для отображения только тех записей с **CategoryID** , равным 2. Результат применения этого фильтра сразу же отображается в сетке отображения в форме.  
  
 Дополнительные сведения о функциональных возможностях, приведенных в подподпрограмме **ексаминедата** , см. в разделе [анализ данных](./examining-data.md).  
  
 Затем нажмите третью кнопку, **измените данные**. Будет выполнена подподпрограмма **едитдата** .  
  
## <a name="editdata"></a>едитдата  
 Когда код входит в подпрограмму **едитдата** , **набор записей** по-прежнему фильтруется по **CategoryID** , равному 2, поэтому видимы только те элементы, которые соответствуют условиям фильтра. Сначала он просматривает **набор записей** и увеличивает цену каждого видимого элемента в **наборе записей** на 10 процентов. Значение поля **Price** изменяется путем задания для этого поля свойства **значение** , равного новому, допустимому значению.  
  
 Помните, что **набор записей** отключен от источника данных. Изменения, внесенные в **едитдата** , вносятся только в локально кэшированную копию данных. Дополнительные сведения см. в разделе [изменение данных](./editing-data.md).  
  
 Изменения не будут внесены в источник данных до нажатия четвертой кнопки, **обновления данных**. Будет выполнена подподпрограмма **упдатедата** .  
  
## <a name="updatedata"></a>упдатедата  
 Сначала Упдатедата удаляет фильтр, примененный к **набору записей**. Код удаляет и сбрасывает в `m_oRecordset1` качестве **источника данных** для привязанного к Microsoft DataGrid в форме, чтобы в сетке появился нефильтрованный **набор записей** .  
  
 Затем код проверяет, можно ли переместить назад в **наборе записей** с помощью метода **поддержки** с аргументом **адмовепревиаус** .  
  
 Подпрограммы переходят к первой записи с помощью метода **MoveFirst** и отображают исходное и текущее значения поля с помощью свойств **originalValue** и **value** объекта **field** . Эти свойства вместе со свойством **UnderlyingValue** (не используется здесь) обсуждаются при [обновлении и сохранении данных](./updating-and-persisting-data.md).  
  
 Затем создается новый объект **Connection** , который используется для повторного установления соединения с источником данных. Вы повторно подключаете **набор записей** к источнику данных, настроив новое **соединение** в качестве **ActiveConnection** для **набора записей**. Чтобы отправить обновления на сервер, код вызывает **UpdateBatch** для **набора записей**.  
  
 Если пакетное обновление выполняется, переменная флага уровня модуля `m_flgPriceUpdated` имеет значение true. Это поможет вам позже очистить все изменения, внесенные в базу данных.  
  
 Наконец, код перемещается обратно к первой записи в **наборе записей** и отображает исходное и текущее значения. Значения совпадают после вызова **UpdateBatch**.  
  
 Дополнительные сведения об обновлении данных, включая действия, выполняемые при изменении данных на сервере во время отключения **набора записей** , см. в разделе [обновление и сохранение данных](./updating-and-persisting-data.md).  
  
## <a name="form_unload"></a>Form_Unload  
 Подпрограммы **Form_Unload** важны по нескольким причинам. Во-первых, поскольку это пример приложения, Form_Unload очищает изменения, внесенные в базу данных до выхода из приложения. Во-вторых, в коде показано, как можно выполнить команду непосредственно из открытого объекта **соединения** с помощью метода **EXECUTE** . Наконец, в нем показан пример выполнения запроса, не возвращающего строки (запрос на обновление), к источнику данных.