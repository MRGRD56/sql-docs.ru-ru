  Изменяет существующую конфигурацию группы рабочей нагрузки Resource Governor и при необходимости назначает ее пулу ресурсов Resource Governor.  
  
 ![Значок ссылки на раздел](../database-engine/configure-windows/media/topic-link.gif "Значок ссылки на раздел") [Синтаксические обозначения в Transact-SQL](../t-sql/language-elements/transact-sql-syntax-conventions-transact-sql.md).  
  
## <a name="syntax"></a>Синтаксис  
  
```syntaxsql
ALTER WORKLOAD GROUP { group_name | "default" }  
[ WITH  
    ([ IMPORTANCE = { LOW | MEDIUM | HIGH } ]  
      [ [ , ] REQUEST_MAX_MEMORY_GRANT_PERCENT = value ]  
      [ [ , ] REQUEST_MAX_CPU_TIME_SEC = value ]  
      [ [ , ] REQUEST_MEMORY_GRANT_TIMEOUT_SEC = value ]   
      [ [ , ] MAX_DOP = value ]  
      [ [ , ] GROUP_MAX_REQUESTS = value ] )  
 ]  
[ USING { pool_name | "default" } ]  
[ ; ]  
```  
  
## <a name="arguments"></a>Аргументы

 *group_name* | "**default**"       
 Имя существующей, определяемой пользователем или заданной по умолчанию группы рабочей нагрузки регулятора ресурсов.  
  
> [!NOTE]  
> При установке [!INCLUDE[ssNoVersion](ssnoversion-md.md)] регулятор ресурсов создает внутренние группы и группы «по умолчанию».  
  
 Параметр "default" должен заключаться в кавычки ("") или квадратные скобки ([]), если используется с инструкцией ALTER WORKLOAD GROUP (во избежание конфликта с системным зарезервированным словом DEFAULT). Дополнительные сведения см. в разделе [Идентификаторы баз данных](../relational-databases/databases/database-identifiers.md).  
  
> [!NOTE]  
> В стандартных группах рабочей нагрузки и пулах ресурсов используются имена со строчными буквами, такие как «default». Это необходимо учитывать при работе с серверами, где параметры сортировки учитывают регистр символов. Серверы, параметры сортировки которых не учитывают регистр (например, SQL_Latin1_General_CP1_CI_AS), будут рассматривать строки «default» и «Default» как одинаковые.  
  
 IMPORTANCE = { LOW | **MEDIUM** | HIGH }       
 Указывает относительную важность запроса в группе рабочей нагрузки. Важность принимает одно из следующих значений:  
  
-   LOW  
-   MEDIUM (по умолчанию);  
-   HIGH.  
  
> [!NOTE]  
> Внутри системы каждое значение важности хранится в виде числа, используемого для вычислений.  
  
 Значение IMPORTANCE локально для пула ресурсов; группы рабочей нагрузки разной важности внутри одного пула ресурсов влияют друг на друга, но не влияют на рабочие группы в других пулов ресурсов.  
  
 REQUEST_MAX_MEMORY_GRANT_PERCENT = *value*     
 Указывает максимальное количество памяти, которое может понадобиться одному запросу из пула. *value* — это процентное соотношение относительно размера пула ресурсов, указанное в MAX_MEMORY_PERCENT.  

*value* является целым числом в версиях до [!INCLUDE[ssSQL17](sssql17-md.md)] и числом с плавающей точкой начиная с [!INCLUDE[sql-server-2019](sssqlv15-md.md)]. Значение по умолчанию равно 25. Диапазон допустимых значений для *value* — от 1 до 100.
  
> [!NOTE]  
> Указанное значение ссылается только на доступную для выполнения запроса память.  
  
> [!IMPORTANT]
> Установка параметра *value* в значение 0 блокирует выполнение запросов с операциями SORT и HASH JOIN в определяемых пользователем группах рабочей нагрузки.     
>
> Не рекомендуется устанавливать значение *value* более 70, так как возможно, что серверу не удастся зарезервировать достаточно памяти, если выполняются другие параллельные запросы. Со временем это может привести к ошибке 8645 (истечение времени ожидания запроса).      
  
> [!NOTE]  
> Если требования к памяти запроса превышают ограничение, заданное этим параметром, сервер выполняет следующие действия.  
>   
> -  Для определяемых пользователем групп рабочей нагрузки сервер пытается снизить степень параллелизма для запроса, пока требования к памяти не снизятся до ограничения, либо пока степень параллелизма не станет равной 1. Если в этом случае требования к запросам памяти по-прежнему превышают ограничение, возникает ошибка 8657.  
>   
> -  Для внутренних групп рабочей нагрузки и группы по умолчанию сервер разрешает запросу получить необходимый объем памяти.  
>   
> Учтите, что в обоих случаях может возникнуть ошибка 8645 (истечение времени ожидания), если на сервере недостаточно физической памяти.  
  
 REQUEST_MAX_CPU_TIME_SEC = *value*       
 Указывает максимальное количество времени ЦП в секундах, которое может использоваться запросом. *value* должно быть 0 или положительным целым числом. Значение *value* по умолчанию равно 0, что означает неограниченное время.  
  
> [!NOTE]  
> По умолчанию по истечении лимита времени Resource Governor не прекращает выполнение запроса. Однако будет сформировано событие. Дополнительные сведения см. в разделе [Класс событий CPU Threshold Exceeded](../relational-databases/event-classes/cpu-threshold-exceeded-event-class.md). 

> [!IMPORTANT]
> Начиная с [!INCLUDE[ssSQL15](sssql16-md.md)] с пакетом обновления 2 (SP2) и [!INCLUDE[ssSQL17](sssql17-md.md)] с накопительным пакетом обновления 3 и в случае использования [флага трассировки 2422](../t-sql/database-console-commands/dbcc-traceon-trace-flags-transact-sql.md) при превышении максимального значения времени Resource Governor прервет запрос.
  
 REQUEST_MEMORY_GRANT_TIMEOUT_SEC =*value*  
 Задает максимальное время (в секундах), которое запрос может ожидать предоставления памяти (памяти рабочего буфера).  
  
> [!NOTE]  
> При истечении времени ожидания предоставления памяти запрос не всегда завершается ошибкой. Запрос завершится ошибкой только в случае, если одновременно запущено слишком много запросов. В остальных случаях запрос может получить лишь минимальный объем памяти, что приведет к снижению его производительности.  
  
 *value* должно быть положительным целым числом. Значение *value* по умолчанию равно 0 и использует внутренние вычисления, основанные на затратах запроса, для определения максимального времени.  
  
 MAX_DOP =*value*       
 Указывает максимальную степень параллелизма (DOP) для параллельных запросов. Значение *value* должно быть равно 0 или положительному целому числу в диапазоне от 1 до 255. Если значение *value* равно 0, то сервер выбирает максимальную степень параллелизма. Это значение по умолчанию, которое рекомендуется использовать.  
  
> [!NOTE]  
> Фактическое значение, задаваемое компонентом [!INCLUDE[ssDE](ssde-md.md)] для MAX_DOP может быть меньше указанного значения. Конечное значение определяется по формуле min(255, *количество ЦП)* .  
  
> [!CAUTION]  
> Изменение MAX_DOP может неблагоприятно сказаться на производительности сервера. Если необходимо изменить MAX_DOP, то рекомендуется задать для него значение, меньшее или равное максимальному количеству планировщиков оборудования, имеющихся на одном узле NUMA. Рекомендуется не устанавливать для MAX_DOP значение больше 8.  
  
 MAX_DOP обрабатывается следующим образом.  
  
-   Использование MAX_DOP в качестве указания запроса эффективно до тех пор, пока его значение не превышает значения MAX_DOP группы рабочей нагрузки.  
  
-   MAX_DOP в качестве указания запроса всегда переопределяет вызов хранимой процедуры sp_configure 'max degree of parallelism'.  
  
-   Группа рабочей нагрузки MAX_DOP переопределяет вызов хранимой процедуры sp_configure 'max degree of parallelism'.  
  
-   Если запрос помечен как последовательный (MAX_DOP = 1) во время компиляции, изменить его статус на параллельный во время выполнения невозможно независимо от параметров группы рабочей нагрузки или хранимой процедуры sp_configure.  
  
 После того как DOP настроен, он может быть только снижен при нехватке доступной памяти. Перенастройка группы рабочей нагрузки невидима при ожидании в очереди на предоставление памяти.  
  
 GROUP_MAX_REQUESTS = *value*      
 Указывает максимальное число одновременных запросов, разрешенных для выполнения в группе рабочей нагрузки. *value* должно быть 0 или положительным целым числом. Значение *value* по умолчанию равно 0, что разрешает неограниченные запросы. Если достигнуто максимальное количество параллельных запросов, пользователь из этой группы сможет войти в систему, но переводится в состоянии ожидания до тех пор, пока количество параллельных запросов не станет меньше указанного значения.  
  
 USING { *pool_name* | "**default**" }      
 Связывает группу рабочей нагрузки с определяемым пользователем пулом ресурсов, идентифицируемым по значению *pool_name*, в результате чего группа рабочей нагрузки помещается в пул ресурсов. Если значение *pool_name* не предоставлено либо если не использован аргумент USING, группа рабочей нагрузки помещается в стандартный пул по умолчанию в Resource Governor.  
  
 Параметр "default" должен заключаться в кавычки ("") или квадратные скобки ([]), если используется с инструкцией ALTER WORKLOAD GROUP (во избежание конфликта с системным зарезервированным словом DEFAULT). Дополнительные сведения см. в разделе [Идентификаторы баз данных](../relational-databases/databases/database-identifiers.md).  
  
> [!NOTE]  
> В параметре "default" учитывается регистр.  
  
## <a name="remarks"></a>Remarks  
 Использование инструкции ALTER WORKLOAD GROUP допустимо для группы по умолчанию.  
  
 Изменения конфигурации группы рабочей нагрузки не вступают в силу до тех пор, пока не будет выполнена инструкция ALTER RESOURCE GOVERNOR RECONFIGURE. При изменении параметра, влияющего на план, новый параметр вступит в силу в ранее кэшированных планах только после выполнения инструкции DBCC FREEPROCCACHE (*pool_name*), где *pool_name* — это имя пула ресурсов Resource Governor, с которым связана группа рабочей нагрузки.  
  
-   Если значение MAX_DOP изменяется на 1, необязательно выполнять инструкцию DBCC FREEPROCCACHE, так как параллельные планы могут выполняться в последовательном режиме. Однако это будет не так эффективно, как компилирование последовательного плана.  
  
-   Если значение MAX_DOP изменяется с 1 на 0 или на значение больше 1, выполнение инструкции DBCC FREEPROCCACHE не требуется. Однако последовательные планы не могут выполняться параллельно, поэтому очистка соответствующего кэша позволит новым планам потенциально компилироваться с помощью параллелизма.  
  
> [!CAUTION]  
> Удаление кэшированных планов из пула ресурсов, который связан с несколькими группами рабочей нагрузки, повлияет на все группы рабочей нагрузки в определяемом пользователем пуле ресурсов *pool_name*.  
  
 При выполнении инструкций DDL рекомендуется иметь представление о состояниях Resource Governor. Дополнительные сведения см. в разделе [Resource Governor](../relational-databases/resource-governor/resource-governor.md) (Регулятор ресурсов).  
  
 REQUEST_MEMORY_GRANT_PERCENT: в [!INCLUDE[ssVersion2005](ssversion2005-md.md)] при создании индексов разрешено использовать больший объем памяти рабочего пространства, чем было предоставлено изначально, в целях повышения быстродействия. Эта специальная обработка поддерживается регулятором ресурсов в более поздних версиях, однако изначально предоставленная память и любая дополнительная выделенная память ограничены настройками группы рабочей нагрузки и пула ресурсов.  
  
 **Создание индексов для секционированной таблицы**  
  
 Объем памяти, затрачиваемой на создание индекса в невыровненной секционированной таблице, пропорционален количеству секций, охватываемых индексом.  Если общий объем необходимой памяти превышает предел на запрос (REQUEST_MAX_MEMORY_GRANT_PERCENT), устанавливаемый регулятором ресурсов для группы рабочей нагрузки, создание такого индекса может завершиться ошибкой. Настройки группы рабочей нагрузки по умолчанию позволяют запросу превосходить установленный для запросов лимит памяти, нужной при запуске (для совместимости с версией [!INCLUDE[ssVersion2005](ssversion2005-md.md)]). Поэтому пользователь может запустить тот же процесс создания индекса в группе рабочей нагрузки по умолчанию, если в пуле ресурсов по умолчанию достаточно памяти, настроенной для выполнения такого запроса.  
  
## <a name="permissions"></a>Разрешения  
 Требуется разрешение `CONTROL SERVER`.  
  
## <a name="examples"></a>Примеры  
 В следующем примере демонстрируется, как изменить важность запросов в группе по умолчанию с `MEDIUM` на `LOW`.  
  
```sql  
ALTER WORKLOAD GROUP "default"  
WITH (IMPORTANCE = LOW);  
GO  
ALTER RESOURCE GOVERNOR RECONFIGURE;  
GO  
```  
  
 В приведенном ниже примере демонстрируется, как переместить группу рабочей нагрузки из пула, где она расположена, в пул по умолчанию.  
  
```sql  
ALTER WORKLOAD GROUP adHoc  
USING [default];  
GO  
ALTER RESOURCE GOVERNOR RECONFIGURE;  
GO  
```  
  
## <a name="see-also"></a>См. также:  
 [регулятор ресурсов](../relational-databases/resource-governor/resource-governor.md)   
 [CREATE WORKLOAD GROUP (Transact-SQL)](../t-sql/statements/create-workload-group-transact-sql.md)   
 [DROP WORKLOAD GROUP (Transact-SQL)](../t-sql/statements/drop-workload-group-transact-sql.md)   
 [CREATE RESOURCE POOL (Transact-SQL)](../t-sql/statements/create-resource-pool-transact-sql.md)   
 [ALTER RESOURCE POOL (Transact-SQL)](../t-sql/statements/alter-resource-pool-transact-sql.md)   
 [DROP RESOURCE POOL (Transact-SQL)](../t-sql/statements/drop-resource-pool-transact-sql.md)   
 [ALTER RESOURCE GOVERNOR (Transact-SQL)](../t-sql/statements/alter-resource-governor-transact-sql.md)  
