---
description: Message Queue Task
title: Задача "Очередь сообщений" | Документы Майкрософт
ms.custom: ''
ms.date: 03/14/2017
ms.prod: sql
ms.prod_service: integration-services
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
f1_keywords:
- sql13.dts.designer.messagequeuetask.f1
- sql13.dts.designer.msgqueuetask.general.f1
- sql13.dts.designer.msgqueuetask.send.f1
- sql13.dts.designer.msgqueuetask.receive.f1
- sql13.dts.designer.selectvariables.f1
helpviewer_keywords:
- Message Queue task [Integration Services]
- receiving messages
- messages [Integration Services]
- sending messages
ms.assetid: ae1d8fad-6649-4e93-b589-14a32d07da33
author: chugugrace
ms.author: chugu
ms.openlocfilehash: e39187e32afbcf72bf1eb950f18d5f21cef38211
ms.sourcegitcommit: 917df4ffd22e4a229af7dc481dcce3ebba0aa4d7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/10/2021
ms.locfileid: "100348306"
---
# <a name="message-queue-task"></a>Message Queue Task

[!INCLUDE[sqlserver-ssis](../../includes/applies-to-version/sqlserver-ssis.md)]


  Задача "Очередь сообщений" позволяет использовать службу очередей сообщений Майкрософт для отправки и получения сообщений между пакетами служб [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] или для отправления сообщений в очередь приложений, которая обрабатывается пользовательским приложением. Эти сообщения могут принимать форму простого текста, файлов или переменных и их значений.  
  
 Используя задачу «Очередь сообщений», можно координировать операции по всему предприятию. Сообщения могут быть поставлены в очередь и доставляться позже, если назначение недоступно или занято; например, задача может ставить в очередь сообщения для работающих в режиме «вне сети» переносных компьютеров торговых представителей, которые получают сообщения при подключении к сети. Можно использовать задачу очереди сообщений для следующих целей:  
  
-   Отсрочка выполнения задачи до тех пор, пока не будут возвращены другие пакеты. Например, после проведения ночного обслуживания в каждой точке продаж задача «Очередь сообщений» отправляет сообщение на корпоративный компьютер. Пакет, запущенный на корпоративном компьютере, содержит задачи «Очередь сообщений», каждая из которых ожидает сообщения от конкретного сайта продаж. Когда сообщение от сайта получено, задача передает данные из этого сайта. После получения сообщений от всех сайтов пакет вычисляет сводные итоги.  
  
-   Отправка файлов данных на компьютер, который их обрабатывает. Например, данные кассы ресторана могут быть отосланы в корпоративную платежную систему, где вычисляются данные о чаевых каждого официанта.  
  
-   Распределение файлов по предприятию. Например, пакет может использовать задачу «Очередь сообщений» для отправки файла пакета на другой компьютер. Пакет, запущенный на целевом компьютере, использует задачу очереди сообщений для получения и сохранения пакета локально.  
  
 При получении или отправке сообщений задача "Очередь сообщений" использует один из следующих типов сообщений: файл данных, строка, строковое сообщение в переменную или переменная. Тип сообщений строковое сообщение в переменную может использоваться только при получении сообщений.  
  
 Задача использует диспетчер соединений MSMQ для подключения к очереди сообщений. Дополнительные сведения см. в статье [Диспетчер соединений MSMQ](../../integration-services/connection-manager/msmq-connection-manager.md). Дополнительные сведения о службе очередей сообщений см. в [библиотеке MSDN](../../sql-server/index.yml).  
  
 Задача «Очередь сообщений» требует установки служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] . Некоторые компоненты [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , выбранные для установки на странице **Компоненты для установки** и **Выбор компонентов** мастера установки [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , производят установку не всех компонентов служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] . Эти компоненты полезны для определенных задач, но функциональные возможности служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] будут ограничены. Например, параметр среды [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)] устанавливает компоненты служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] , необходимые для разработки пакета, но службы [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] не будут установлены, следовательно, задача «Очередь сообщений» не будет работать. Для обеспечения полной установки служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)]необходимо выбрать службы [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] на странице **Компоненты для установки** . Дополнительные сведения об установке и запуске задачи "Очередь сообщений" см. в разделе [Установка служб Integration Services](../../integration-services/install-windows/install-integration-services.md).  
  
> [!NOTE]  
>  Задача «Очередь сообщений» завершается неудачно при выполнении федерального стандарта обработки данных (FIPS) 140-2, если операционная система компьютера настроена в режим FIPS и задача использует шифрование. Если задача «Очередь сообщений» не использует шифрование, то задача выполняется успешно.  
  
## <a name="message-types"></a>Типы сообщений  
 Типы сообщений, предоставляемых задачей «Очередь сообщений», можно настроить следующими способами:  
  
-   Сообщение **Data file** указывает, что файл содержит сообщение. При получении сообщений можно настроить задачу для сохранения файла, замены существующего файла и указания пакета, из которого задача может получать сообщения.  
  
-   Сообщение **String** указывает, что сообщение является строкой. Можно настроить задачу так, чтобы при получении сообщений сравнивать полученную строку с пользовательской строкой и выполнять операции в зависимости от результатов сравнения. Сравнение строк может быть точным, учитывать или не учитывать регистр либо использовать подстроку.  
  
-   Сообщение **String message to variable** указывает исходное сообщение как строку, которая отправляется в целевую переменную. Можно настроить задачу для сравнения полученной строки с пользовательской строкой, используя точное сравнение с без учета регистра или сравнение подстроки. Тип сообщений доступен, только если задача получает сообщения.  
  
-   Сообщение **Variable** содержит одну или несколько переменных. Можно настроить задачу, указав имена переменных, включенных в сообщение. При получении сообщений можно настроить задачу, указав и пакет, откуда она может получать сообщения, и переменную, которая является назначением сообщения.  
  
## <a name="sending-messages"></a>отправка сообщений  
 При настройке задачи «Очередь сообщений» на отправку сообщений для шифрования сообщений можно использовать один из алгоритмов шифрования, которые в данный момент поддерживаются службой очередей сообщений (алгоритмы RC2 и RC4). Оба этих алгоритма шифрования считаются сегодня криптографически слабыми по сравнению с более новыми алгоритмами, которые служба очередей сообщений еще не поддерживает. Поэтому при отправке сообщений с помощью задачи «Очередь сообщений» необходимо тщательно учитывать требования криптографии.  
  
## <a name="receiving-messages"></a>получение сообщений  
 При получении сообщений задача «Очередь сообщений» может быть настроена следующими способами:  
  
-   Пропуск сообщения или удаление сообщения из очереди.  
  
-   Указание периода ожидания.  
  
-   Завершение со сбоем по истечении периода ожидания.  
  
-   Замена существующего файла, если сообщение хранится в **Data file**.  
  
-   Сохранение файла сообщения под другим именем, если сообщение использует тип **Data file message** .  
  
## <a name="custom-logging-messages-available-on-the-message-queue-task"></a>Пользовательские сообщения для ведения журнала, доступные в задаче «Очередь сообщений»  
 В следующей таблице перечислены пользовательские записи в журнале для задачи «Очередь сообщений». Дополнительные сведения см. в разделе [Ведение журналов в службах Integration Services (SSIS)](../../integration-services/performance/integration-services-ssis-logging.md).  
  
|Запись журнала|Описание|  
|---------------|-----------------|  
|**MSMQAfterOpen**|Указывает, что задача завершила открытие очереди сообщений.|  
|**MSMQBeforeOpen**|Указывает, что задача приступила к открытию очереди сообщений.|  
|**MSMQBeginReceive**|Указывает, что задача приступила к получению сообщения.|  
|**MSMQBeginSend**|Указывает, что задача приступила к отправке сообщения.|  
|**MSMQEndReceive**|Указывает, что задача завершила прием сообщения.|  
|**MSMQEndSend**|Указывает, что задача завершила отправку сообщения.|  
|**MSMQTaskInfo**|Выводит описательные сведения об этой задаче.|  
|**MSMQTaskTimeOut**|Указывает, что время ожидания выполнения задачи истекло.|  
  
## <a name="configuration-of-the-message-queue-task"></a>Настройка задачи «Очередь сообщений»  
 Значения свойств можно задавать с помощью конструктора [!INCLUDE[ssIS](../../includes/ssis-md.md)] или программными средствами. Дополнительные сведения о свойствах, которые можно задать в конструкторе служб [!INCLUDE[ssIS](../../includes/ssis-md.md)] , см. в следующих разделах:  
  
-   [Страница «Выражения»](../../integration-services/expressions/expressions-page.md)  
  
 Дополнительные сведения о задании этих свойств программными средствами см. в документации по классу **Microsoft.SqlServer.Dts.Tasks.MessageQueueTask.MessageQueueTask** в руководстве для разработчиков.  
  
## <a name="related-tasks"></a>Связанные задачи  
 Дополнительные сведения о настройке свойств этих свойств в конструкторе [!INCLUDE[ssIS](../../includes/ssis-md.md)] см. в разделе [Задание свойств задач или контейнеров](./add-or-delete-a-task-or-a-container-in-a-control-flow.md).  
  
## <a name="message-queue-task-editor-general-page"></a>Редактор задачи «Очередь сообщений» (страница «Общие»)
  **Страница «Общие»** диалогового окна **Редактор задачи «Очередь сообщений»** позволяет задавать имя и описывать задачу «Очередь сообщений», определять формат сообщений, а также указывать, будет ли задача отправлять или получать сообщения.  
  
### <a name="options"></a>Параметры  
 **имя**;  
 Задайте уникальное имя задаче «Очередь сообщений». Это имя используется в качестве метки для значка задачи.  
  
> [!NOTE]  
>  Имена задач в пределах пакета должны быть уникальными.  
  
 **Описание**  
 Введите описание задачи «Очередь сообщений».  
  
 **Use2000Format**  
 Укажите, нужно ли использовать формат 2000 службы очередей сообщений (MSMQ). По умолчанию **False**.  
  
 **MSMQConnection**  
 Выберите существующий диспетчер подключений MSMQ или создайте новый, щелкнув пункт \<**New connection...**>.  
  
 **См. также**: [Диспетчер FTP-соединений](../../integration-services/connection-manager/msmq-connection-manager.md), [Редактор диспетчера FTP-соединений](../connection-manager/msmq-connection-manager.md).  
  
 **Сообщение**  
 Указывает, будет ли задача «Очередь сообщений» отправлять или получать сообщения. При выборе режима **Отправить сообщение** на левой панели диалогового окна появляется страница «Отправка», при выборе режима **Получить сообщение** появляется страница «Получение». По умолчанию, устанавливается режим **Отправить сообщение**.  
  
## <a name="message-queue-task-editor-send-page"></a>Редактор задачи «Очередь сообщений» (страница «Отправка»)
  Используйте страницу **Отправить** диалогового окна **Редактор задачи "Очередь сообщений"** , чтобы настроить задачу "Очередь сообщений" для отправки сообщений от пакета служб [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)].  
  
### <a name="options"></a>Параметры  
 **UseEncryption**  
 Укажите, необходимо ли шифровать сообщение. По умолчанию **False**.  
  
 **EncryptionAlgorithm**  
 При выборе шифрования задайте имя алгоритма шифрования для использования. Задача «Очередь сообщений» поддерживает алгоритмы RC2 и RC4. По умолчанию, используется алгоритм **RC2**.  
  
> [!NOTE]  
>  Алгоритм RC4 поддерживается только в целях обратной совместимости. Когда база данных имеет уровень совместимости 90 или 100, новые материалы могут шифроваться только с помощью алгоритмов RC4 или RC4_128. (Не рекомендуется.) Используйте вместо этого более новые алгоритмы, например AES. В текущем выпуске [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] материалы, зашифрованные с помощью алгоритмов RC4 или RC4_128, могут быть расшифрованы на любом уровне совместимости.  
  
> [!IMPORTANT]  
>  Здесь приведены алгоритмы шифрования, поддерживаемые технологией очередей сообщений (MSMQ). Оба этих алгоритма шифрования считаются сегодня криптографически слабыми по сравнению с новыми алгоритмами, которые служба очередей сообщений еще не поддерживает. Поэтому при отправке сообщений с помощью задачи «Очередь сообщений» необходимо тщательно учитывать требования криптографии.  
  
 **MessageType**  
 Выбор типа сообщения. Это свойство имеет параметры, указанные в следующей таблице.  
  
|Значение|Описание|  
|-----------|-----------------|  
|**Сообщение файла данных**|Сообщение хранится в файле. При выборе этого значения отображается динамический параметр **DataFileMessage**.|  
|**Сообщение переменной**|Сообщение хранится в переменной. При выборе этого значения отображается динамический параметр **VariableMessage**.|  
|**Строковое сообщение**|Сообщение сохраняется в задаче «Очередь сообщений». При выборе этого значения отображается динамический параметр **StringMessage**.|  
  
### <a name="messagetype-dynamic-options"></a>Динамические параметры MessageType  
  
#### <a name="messagetype--data-file-message"></a>MessageType = Сообщение файла данных  
 **DataFileMessage**  
 Введите путь к файлу данных или нажмите кнопку с многоточием **(…)** , а затем найдите файл.  
  
#### <a name="messagetype--variable-message"></a>MessageType = Сообщение с переменными  
 **VariableMessage**  
 Введите имена переменных или нажмите кнопку с многоточием **(…)** , а затем выберите переменные. Переменные разделяются запятыми.  
  
 **См. также:** Выбор переменных  
  
#### <a name="messagetype--string-message"></a>MessageType = Строковое сообщение  
 **StringMessage**  
 Введите строковое сообщение или нажмите кнопку с многоточием **(…)** , а затем введите сообщение в диалоговом окне **Введите строковое сообщение**.  
  
## <a name="message-queue-task-editor-receive-page"></a>Редактор задачи «Очередь сообщений» (страница «Получение»)
  Используйте страницу **Получение** диалогового окна **Редактор задачи "Очередь сообщений"** , чтобы настроить задачу "Очередь сообщений" для получения сообщений [!INCLUDE[msCoName](../../includes/msconame-md.md)] Message Queuing (MSMQ).  
  
### <a name="options"></a>Параметры  
 **RemoveFromMessageQueue**  
 Указывает, следует ли удалять сообщение из очереди после того, как оно было получено. По умолчанию, этому параметру присваивается значение **False**.  
  
 **ErrorIfMessageTimeOut**  
 Указывает, следует ли считать выполнение задачи завершенным неудачно по истечении лимита времени и отображать сообщение об ошибке. По умолчанию **False**.  
  
 **TimeoutAfter**  
 Если будет выбрано отображение сообщения об ошибке в случае неудачного завершения задачи, то следует указать количество секунд для ожидания перед отображением сообщения об истечении лимита времени.  
  
 **MessageType**  
 Выбор типа сообщения. Это свойство имеет параметры, указанные в следующей таблице.  
  
|Значение|Описание|  
|-----------|-----------------|  
|**Сообщение файла данных**|Сообщение хранится в файле. При выборе этого значения отображается динамический параметр **DataFileMessage**.|  
|**Сообщение переменной**|Сообщение хранится в переменной. При выборе этого значения отображается динамический параметр **VariableMessage**.|  
|**Строковое сообщение**|Сообщение сохраняется в задаче «Очередь сообщений». При выборе этого значения отображается динамический параметр **StringMessage**.|  
|**Строковое сообщение в переменную**|Сообщение<br /><br /> При выборе этого значения отображается динамический параметр **StringMessage**.|  
  
### <a name="messagetype-dynamic-options"></a>Динамические параметры MessageType  
  
#### <a name="messagetype--data-file-message"></a>MessageType = Сообщение файла данных  
 **SaveFileAs**  
 Введите путь к используемому файлу или нажмите кнопку с многоточием **(…)** , а затем найдите файл.  
  
 **Overwrite**  
 Укажите, необходимо ли перезаписать данные в существующем файле при сохранении содержимого сообщения файлов данных. По умолчанию **False**.  
  
 **Filter**  
 Укажите, следует ли применять фильтр к сообщениям. Это свойство имеет параметры, указанные в следующей таблице.  
  
|Значение|Описание|  
|-----------|-----------------|  
|**Нет фильтра**|Эта задача не фильтрует сообщения. Выбор этого значения отображает динамический параметр **IdentifierReadOnly**.|  
|**Из пакета**|Сообщение получает только сообщения из указанного пакета. Выбор этого значения отображает динамический параметр **Идентификатор**.|  
  
#### <a name="filter-dynamic-options"></a>Динамические параметры фильтра  
  
##### <a name="filter--no-filter"></a>Filter = Не фильтровать  
 **IdentifierReadOnly**  
 Этот параметр доступен только для чтения. Он может быть пустым или содержать идентификатор GUID пакета в случае, если свойство «Фильтр» было установлено ранее.  
  
##### <a name="filter--from-package"></a>Filter = Из пакета  
 **Идентификатор**  
 Если выбрано применение фильтра, следует ввести уникальный идентификатор пакета, из которого могут быть получены сообщения, или нажать кнопку с многоточием **(…)** и указать пакет.  
  
 **См. также:** [Выбор пакета](../../integration-services/control-flow/select-a-package.md)  
  
#### <a name="messagetype--variable-message"></a>MessageType = Сообщение с переменными  
 **Filter**  
 Укажите, следует ли применять фильтр к сообщениям. Это свойство имеет параметры, указанные в следующей таблице.  
  
|Значение|Описание|  
|-----------|-----------------|  
|**Нет фильтра**|Эта задача не фильтрует сообщения. Выбор этого значения отображает динамический параметр **IdentifierReadOnly**.|  
|**Из пакета**|Сообщение получает только сообщения из указанного пакета. Выбор этого значения отображает динамический параметр **Идентификатор**.|  
  
 **Переменная**  
 Введите имя переменной либо выберите пункт \<**New variable...**> и затем настройте новую переменную.  
  
 **См. также:** [Добавить переменную](../integration-services-ssis-variables.md)  
  
#### <a name="filter-dynamic-options"></a>Динамические параметры фильтра  
  
##### <a name="filter--no-filter"></a>Filter = Не фильтровать  
 **IdentifierReadOnly**  
 Этот параметр пуст.  
  
##### <a name="filter--from-package"></a>Filter = Из пакета  
 **Идентификатор**  
 Если выбрано применение фильтра, следует ввести уникальный идентификатор пакета, из которого могут быть получены сообщения, или нажать кнопку с многоточием **(…)** и указать пакет.  
  
 **См. также:** [Выбор пакета](../../integration-services/control-flow/select-a-package.md)  
  
#### <a name="messagetype--string-message"></a>MessageType = Строковое сообщение  
 **Сравнить**  
 Укажите, следует ли применять фильтр к сообщениям. Это свойство имеет параметры, указанные в следующей таблице.  
  
|Значение|Описание|  
|-----------|-----------------|  
|**None**|Сообщения не сравниваются.|  
|**Точное совпадение**|Сообщения должны точно совпадать со строкой, указанной в параметре **CompareString** .|  
|**Игнорировать регистр**|Сообщение должно совпадать со строкой, указанной в параметре **CompareString** , но регистр при этом не имеет значения.|  
|**Содержит**|Сообщения должны содержать строку, указанную в параметре **CompareString** .|  
  
 **CompareString**  
 Если в качестве значения параметра **Сравнить** установлено **Нет**, укажите строку, с которой должно сравниваться сообщение.  
  
#### <a name="messagetype--string-message-to-variable"></a>MessageType = String message to variable  
 **Сравнить**  
 Укажите, следует ли применять фильтр к сообщениям. Это свойство имеет параметры, указанные в следующей таблице.  
  
|Значение|Описание|  
|-----------|-----------------|  
|**None**|Сообщения не сравниваются.|  
|**Точное совпадение**|Сообщения должны точно совпадать со строкой, указанной в параметре **CompareString** .|  
|**Игнорировать регистр**|Сообщение должно совпадать со строкой, указанной в параметре **CompareString** , но регистр при этом не имеет значения.|  
|**Содержит**|Сообщение должно содержать строку, указанную в параметре **CompareString** .|  
  
 **CompareString**  
 Если в качестве значения параметра **Сравнить** установлено **Нет**, укажите строку, с которой должно сравниваться сообщение.  
  
 **Переменная**  
 Введите имя переменной, в которой должно храниться полученное сообщение, либо выберите пункт \<**New variable...**> и затем настройте новую переменную.  
  
 **См. также:** [Добавить переменную](../integration-services-ssis-variables.md)  
  
## <a name="select-variables"></a>Выбор переменных
  Используйте диалоговое окно **Выбор переменных** для указания переменных, которые следует использовать при выполнении операции отправки сообщения в задаче «Очередь сообщений». Список **Доступные переменные** включает системные и пользовательские переменные, находящиеся в области действия задачи "Очередь сообщений" или ее родительского контейнера. Задача использует переменные, перечисленные в списке **Выбранные переменные** .  
  
### <a name="options"></a>Параметры  
 **Доступные переменные**  
 Выберите одну или несколько переменных.  
  
 **Выбранные переменные**  
 Выберите одну или несколько переменных.  
  
 **Стрелки вправо**  
 Переместить выбранные переменные в список **Выбранные переменные** .  
  
 **Стрелки влево**  
 Переместить выбранные переменные обратно в список **Доступные переменные** .  
  
 **Создать переменную**  
 Создать новую переменную.  
  
 **См. также:** [Добавить переменную](../integration-services-ssis-variables.md)  
## <a name="see-also"></a>См. также:  
 [Задачи служб Integration Services](../../integration-services/control-flow/integration-services-tasks.md)   
 [Поток управления](../../integration-services/control-flow/control-flow.md)  
  
