---
description: Задача управления CDC
title: Задача управления CDC | Документы Майкрософт
ms.custom: ''
ms.date: 03/01/2017
ms.prod: sql
ms.prod_service: integration-services
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
f1_keywords:
- sql13.ssis.designer.cdccontroltask.f1
- sql13.ssis.designer.cdccontroltask.config.f1
ms.assetid: 6404dc7f-550c-47cc-b901-c072742f430a
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 492a0cd4b510b91d1f5f17ad04de54b005502bba
ms.sourcegitcommit: 04d101fa6a85618b8bc56c68b9c006b12147dbb5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2021
ms.locfileid: "99049119"
---
# <a name="cdc-control-task"></a>Задача управления CDC

[!INCLUDE[sqlserver-ssis](../../includes/applies-to-version/sqlserver-ssis.md)]


  Задача «Управление CDC» используется для управления жизненным циклом пакетов системы отслеживания изменений данных (CDC). Эта задача обеспечивает синхронизацию пакета CDC с пакетом начальной загрузки и управление диапазонами регистрационных номеров транзакций в журнале (номеров LSN), которые обрабатываются в прогоне пакета CDC. Дополнительно задача «Управление CDC» связана со сценариями обработки ошибок и с восстановлением.  
  
 Задача «Управление CDC» поддерживает информацию состояния пакета CDC в переменной пакета служб SSIS и может также сохранить ее в таблице базы данных, что позволяет поддерживать состояние от одной активации пакета к другой, а также между несколькими пакетами, которые вместе выполняют общий процесс CDC (например, одна задача может отвечать за начальную загрузку, а другая — за обновления тонкого канала).  
  
 Задача «Управление CDC» поддерживает две группы операций. Одна группа обеспечивает синхронизацию начальной нагрузки и обработки изменений, а другая группа управляет диапазоном номеров LSN, связанных с обработкой изменений, для прогона пакета CDC, а также следит за тем, какая часть обработки была выполнена успешно.  
  
 Для синхронизации начальной нагрузки и обработки изменений применяются следующие операции.  
  
|Операция|Описание|  
|---------------|-----------------|  
|ResetCdcState|Эта операция используется для сброса хранимого состояния CDC, связанного с текущим контекстом CDC. После выполнения этой операции текущий максимальный номер LSN из таблицы LSN-timestamp `sys.fn_cdc_get_max_lsn` становится началом следующего диапазона обработки. Эта операция требует создания соединения с базой данных-источником.|  
|MarkInitialLoadStart|Операция используется в начале пакета начальной загрузки для записи текущего номера LSN в базу данных-источник перед тем как пакет начальной загрузки начинает читать исходные таблицы. Для этого требуется соединение с базой данных-источником для вызова `sys.fn_cdc_get_max_lsn`.<br /><br /> Если будет выбрано MarkInitialLoadStart при работе с CDC [!INCLUDE[ssnoversion](../../includes/ssnoversion-md.md)] (т. е. отличной от Oracle), то пользователем, указанным в диспетчере соединений, должен быть db_owner или sysadmin.|  
|MarkInitialLoadEnd|Эта операция используется в конце пакета начальной загрузки для записи текущего номера LSN в базу данных-источник после того, как пакет начальной нагрузки завершит чтение исходных таблиц. Номер LSN определяется путем записи текущего времени при осуществлении данной операции и последующего запроса таблицы сопоставления `cdc.lsn_time_`в базе данных CDC для поиска любого изменения, которое произошло в последующее время.<br /><br /> Если будет выбрано MarkInitialLoadEnd при работе с CDC [!INCLUDE[ssnoversion](../../includes/ssnoversion-md.md)] (т. е. отличной от Oracle), то пользователем, указанным в диспетчере соединений, должен быть db_owner или sysadmin.|  
|MarkCdcStart|Эта операция используется, если начальная загрузка выполняется из базы данных моментальных снимков. В таком случае обработка изменений должна начаться с номера, который непосредственно следует за номером LSN моментального снимка. Можно указать имя используемой базы данных моментальных снимков, и задача «Управление CDC» запросит в [!INCLUDE[ssnoversion](../../includes/ssnoversion-md.md)] номер LSN моментального снимка. Предусмотрена также возможность непосредственно указать номер LSN моментального снимка.<br /><br /> Если будет выбрано MarkCdcStart при работе с CDC [!INCLUDE[ssnoversion](../../includes/ssnoversion-md.md)] (т. е. отличной от Oracle), то пользователем, указанным в диспетчере соединений, должен быть db_owner или sysadmin.|  
  
 Для управления диапазоном обработки предназначены следующие операции:  
  
|Операция|Описание|  
|---------------|-----------------|  
|GetProcessingRange|Эта операция используется перед вызовом потока данных, в котором применяется поток исходных данных CDC. Операция устанавливает диапазон номеров LSN, считываемый потоком исходных данных CDC при вызове. Этот диапазон хранится в переменной пакета служб SSIS, которая используется источником CDC во время обработки потока данных.<br /><br /> Дополнительные сведения о сохраненных состояниях см. в разделе [Определение переменной состояния](../../integration-services/data-flow/define-a-state-variable.md).|  
|MarkProcessedRange|Эта операция выполняется после каждого прогона CDC (после успешного завершения потока данных CDC) для записи последнего номера LSN, который был полностью обработан в прогоне CDC. При следующем вызове GetProcessingRange на выполнение эта позиция становится началом диапазона обработки.|  
  
## <a name="handling-cdc-state-persistency"></a>Обработка сохраняемого состояния CDC  
 Задача «Управление CDC» поддерживает сохраняемое состояние от одной активации к другой. Информация, сохраняемая в состоянии CDC, используется в целях определения и сопровождения диапазона обработки для пакета CDC, а также в целях обнаружения условий возникновения ошибок. Информация о сохраняемом состоянии представлена в виде строки. Дополнительные сведения см. в статье [Определение переменной состояния](../../integration-services/data-flow/define-a-state-variable.md).  
  
 Задача «Управление CDC» поддерживает два типа сохранения состояния  
  
-   Сохранение состояния вручную. В этом случае задача управления CDC управляет состоянием, сохраненным в переменной пакета, но разработчик пакета должен считывать переменную из постоянного хранилища перед вызовом запроса управления CDC, а затем снова записывать ее назад в постоянное хранилище после последнего вызова запроса управления CDC и завершения прогона CDC.  
  
-   Автоматическое сохранение состояния. Информация о состоянии CDC хранится в таблице в базе данных. Информация о состоянии хранится под именем, предоставленным в свойстве **StateName** в таблице, указанной в свойстве **Таблица для хранения состояния** , которую можно найти в диспетчере соединений, выбранном для сохранения состояния. По умолчанию применяется диспетчер соединений с источником, но чаще всего используется диспетчер соединений с назначением. Задача «Управление CDC» обновляет значение состояния в таблице состояний, и это значение фиксируется в составе включающей транзакции.  
  
## <a name="error-handling"></a>Обработка ошибок  
 Задача «Управление CDC» может сообщать об ошибках в следующих случаях.  
  
-   В задаче не удается считать хранимое состояние CDC, или обновление сохраняемого состояния оканчивается неудачей.  
  
-   В задаче не удается считать информацию о текущем номере LSN из базы данных-источника.  
  
-   Операция чтения состояния CDC не согласована.  
  
 Во всех этих случаях задача «Управление CDC» сообщает об ошибке, которая может быть обработана стандартным способом, применяемым в службе SSIS для обработки ошибок потока управления.  
  
 Задача «Управление CDC» может также выдать предупреждение, если операция «Получить диапазон обработки» вызывается непосредственно после другой операции «Получить диапазон обработки» без вызова операции «Отметить обработанный диапазон». Такая ситуация указывает на то, что предыдущий прогон окончился неудачей или что, возможно, выполняется еще один пакет CDC, в котором используется то же имя состояния CDC.  
  
## <a name="configuring-the-cdc-control-task"></a>Настройка задачи «Управление CDC»  
 Свойства могут быть заданы с помощью конструктора SSIS или программным путем.  
  
## <a name="in-this-section"></a>В этом разделе  
  
-   [Пользовательские свойства задач управления CDC](../../integration-services/control-flow/cdc-control-task-custom-properties.md)  
  
## <a name="related-tasks"></a>Связанные задачи  
 [Определение переменной состояния](../../integration-services/data-flow/define-a-state-variable.md)  
  
## <a name="related-content"></a>См. также  
  
-   Техническую статью [Установка системы отслеживания измененных данных Microsoft SQL Server 2012 для Oracle компании Attunity](https://go.microsoft.com/fwlink/?LinkId=252958)см. на сайте social.technet.microsoft.com.  
  
-   Техническую статью [Устранение неполадок в конфигурации системы отслеживания измененных данных Майкрософт для Oracle компании Attunity](https://go.microsoft.com/fwlink/?LinkId=252960)см. на сайте social.technet.microsoft.com.  
  
-   Техническую статью [Устранение неполадок в конфигурации системы отслеживания измененных данных Майкрософт для Oracle компании Attunity](https://go.microsoft.com/fwlink/?LinkId=252961)см. на сайте social.technet.microsoft.com.  
  
## <a name="cdc-control-task-editor"></a>Редактор задачи «Выполнение CDC»
  Диалоговое окно **Редактор задачи «Управление CDC»** служит для настройки задачи «Управление CDC». В процессе настройки задачи «Управление CDC» определяется соединение с базой данных CDC, операция задачи CDC и сведения об управлении состояниями.  
  
 Дополнительные сведения о задаче «Управление CDC» см. в разделе [CDC Control Task](../../integration-services/control-flow/cdc-control-task.md).  
  
 **Открытие редактора задачи «Управление CDC»**  
  
1.  В среде [!INCLUDE[ssBIDevStudio](../../includes/ssbidevstudio-md.md)]откройте пакет служб [!INCLUDE[ssISCurrent](../../includes/ssiscurrent-md.md)] , содержащий задачу «Управление CDC».  
  
2.  На вкладке **Поток управления** дважды щелкните задачу "Управление CDC".  
  
### <a name="options"></a>Варианты  
 **Диспетчер соединений ADO.NET базы данных SQL Server CDC**  
 Выберите из списка существующий диспетчер соединений или нажмите кнопку **Создать** , чтобы создать новое соединение. Соединение должно быть установлено с базой данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , которая включена для CDC и в которой находится выбранная таблица изменений.  
  
 **Операция управления CDC**  
 Выберите операцию для выполнения этой задачи. Все операции используют переменную состояния, которая хранится в переменной пакета служб SSIS и содержит состояние, которое передается между различными компонентами пакета.  
  
-   **Отметить начало начальной загрузки**. Эта операция используется при выполнении начальной загрузки из активной базы данных без моментального снимка. Он вызывается в начале пакета начальной загрузки для записи текущего номера LSN в базу данных-источник перед тем, как пакет начальной загрузки начинает читать исходные таблицы. Для этого необходимо соединение с базой данных-источником.  
  
     Если выбрать операцию **Отметить начало начальной загрузки** при работе в [!INCLUDE[ssnoversion](../../includes/ssnoversion-md.md)] CDC (не Oracle), то пользователь, указанный в диспетчере соединений, должен входить в роль  **db_owner** или **sysadmin**.  
  
-   **Отметить конец начальной загрузки**. Эта операция используется при выполнении начальной загрузки из активной базы данных без моментального снимка. Она вызывается в конце пакета начальной загрузки для записи текущего номера LSN в базу данных-источник после того, как пакет начальной нагрузки завершит чтение исходных таблиц. Номер LSN определяется путем записи текущего времени при осуществлении данной операции и последующего запроса таблицы сопоставления `cdc.lsn_time_`в базе данных CDC для поиска любого изменения, которое произошло в последующее время.  
  
     Если выбрать операцию **Отметить конец начальной загрузки** при работе в [!INCLUDE[ssnoversion](../../includes/ssnoversion-md.md)] CDC (не Oracle), то пользователь, указанный в диспетчере соединений, должен входить в роль  **db_owner** или **sysadmin**.  
  
-   **Отменить начало CDC**. Эта операция используется, если затем выполняется начальная загрузка из базы данных моментальных снимков или из замороженной базы данных. Она вызывается в любом месте в пакете начальной загрузки. Операция принимает параметр, которым может быть номер LSN моментального снимка или имя базы данных моментальных снимков (из которого автоматически получается номер LSN моментального снимка). Параметр также можно оставить пустым, и тогда текущий номер LSN базы данных будет служить начальным номером LSN для пакета обработки изменений.  
  
     Эта операция используется вместо операций «Отметить начало/конец начальной загрузки».  
  
     Если выбрать операцию **Отметить начало CDC** при работе в [!INCLUDE[ssnoversion](../../includes/ssnoversion-md.md)] CDC (не Oracle), то пользователь, указанный в диспетчере соединений, должен входить в роль  **db_owner** или **sysadmin**.  
  
-   **Получить диапазон обработки**. Эта операция используется в пакете обработки изменений перед вызовом потока данных, в котором применяется поток исходных данных CDC. Операция устанавливает диапазон номеров LSN, считываемый потоком исходных данных CDC при вызове. Этот диапазон хранится в переменной пакета служб SSIS, которая используется источником CDC во время обработки потока данных.  
  
     Дополнительные сведения о возможных состояниях CDC, которые хранятся, см. в разделе [Определение переменной состояния](../../integration-services/data-flow/define-a-state-variable.md).  
  
-   **Отметить обработанный диапазон**. Эта операция выполняется в пакете обработки изменений после каждого запуска CDC (после успешного завершения потока данных CDC) для записи последнего номера LSN, который был полностью обработан в текущем запуске CDC. При следующем вызове `GetProcessingRange` на выполнение эта позиция определяет начало следующего диапазона обработки.  
  
-   **Сбросить состояние CDC**. Эта операция используется для сброса хранимого состояния CDC, связанного с текущим контекстом CDC. После выполнения этой операции текущий максимальный номер LSN из таблицы LSN-timestamp `sys.fn_cdc_get_max_lsn` становится началом следующего диапазона обработки. Эта операция требует создания соединения с базой данных-источником.  
  
     Примером использования этой операции является случай, когда нужно обработать только недавно созданные записи об изменениях, пропуская все старые записи об изменениях.  
  
 **Переменная, содержащая состояние CDC**  
 Выберите переменную пакета служб SSIS, в которой хранятся сведения о состоянии для операции задачи. Переменную необходимо определить перед началом работы. Если выбрать параметр **Автоматическое сохранение состояния**, то переменная состояния загружается и сохраняется автоматически.  
  
 Дополнительные сведения об определении переменной состояния см. в разделе [Определение переменной состояния](../../integration-services/data-flow/define-a-state-variable.md).  
  
 **Номер LSN SQL Server для начала CDC/имя моментального снимка:**  
 введите текущий номер LSN базы данных-источника или имя базы данных моментальных снимков, из которой выполняется начальная загрузка, чтобы определить начало CDC. Этот параметр доступен только в том случае, если параметр **Операция управления CDC** имеет значение **Отметить начало CDC**.  
  
 Дополнительные сведения об этих операциях см. в разделе [CDC Control Task](../../integration-services/control-flow/cdc-control-task.md).  
  
 **Автоматически сохранять состояние в таблице базы данных**  
 Установите этот флажок для задачи «Управление CDC», чтобы автоматически обрабатывать загрузку и сохранение состояния CDC в таблице состояния, содержащейся в указанной базе данных. Если этот флажок не установлен, то разработчик должен загружать состояние CDC при запуске пакета и сохранять его при изменении состояния CDC.  
  
 **Диспетчер соединений для базы данных, где хранится состояние**  
 Выберите из списка существующий диспетчер соединений ADO.NET или нажмите кнопку «Создать», чтобы создать новое соединение. Это соединение с базой данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , содержащей таблицу состояния. Таблица состояния содержит сведения о состоянии.  
  
 Этот параметр доступен только в том случае, если выбран параметр **Автоматическое сохранение состояния** , и является обязательным.  
  
 **Таблица для хранения состояния**  
 Введите имя таблицы состояния, используемой для хранения состояния CDC. Указанная таблица должна содержать два столбца с именами **name** и **state** . Оба столбца должны иметь тип данных **varchar (256)**.  
  
 Также можно выбрать вариант **Создать** , чтобы получить скрипт SQL, выполняющий построение новой таблицы состояния с необходимыми столбцами (необязательно). Если выбран параметр **Автоматическое сохранение состояния** , то разработчик должен создать таблицу состояния, соответствующую указанным выше требованиям.  
  
 Этот параметр доступен только в том случае, если выбран параметр **Автоматическое сохранение состояния** , и является обязательным.  
  
 **Имя состояния**  
 Введите имя, связанное с сохраняемым состоянием CDC. В пакетах полной загрузки и пакетах CDC, работающих в одном контексте CDC, будет указываться общее имя состояния. Это имя используется для подстановки строки состояния в таблице состояния  
  
