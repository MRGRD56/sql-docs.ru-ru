---
description: Извлечение информации об изменениях данных с помощью источника CDC
title: Извлечение информации об изменениях данных с помощью источника CDC | Документы Майкрософт
ms.custom: ''
ms.date: 03/14/2017
ms.prod: sql
ms.prod_service: integration-services
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
ms.assetid: 604fbafb-15fa-4d11-8487-77d7b626eed8
author: chugugrace
ms.author: chugu
ms.openlocfilehash: fb1fc17be92259e0fe642c90f760c375e5eacb0f
ms.sourcegitcommit: cfa04a73b26312bf18d8f6296891679166e2754d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/19/2020
ms.locfileid: "92192756"
---
# <a name="extract-change-data-using-the-cdc-source"></a>Извлечение информации об изменениях данных с помощью источника CDC

[!INCLUDE[sqlserver-ssis](../../includes/applies-to-version/sqlserver-ssis.md)]


  Чтобы можно было добавить и настроить источник CDC, пакет уже должен включать по крайней мере одну задачу «Поток данных» и задачу «Управление CDC».  
  
 Дополнительные сведения о задаче «Управление CDC» см. в разделе [CDC Control Task](../../integration-services/control-flow/cdc-control-task.md).  
  
 Дополнительные сведения об источнике CDC см. в разделе [CDC Source](../../integration-services/data-flow/cdc-source.md).  
  
### <a name="to-extract-change-data-using-a-cdc-source"></a>Извлечение информации об изменениях с использованием источника CDC  
  
1.  В среде [!INCLUDE[ssBIDevStudio](../../includes/ssbidevstudio-md.md)]откройте проект служб [!INCLUDE[ssISCurrent](../../includes/ssiscurrent-md.md)] , содержащий необходимый пакет.  
  
2.  В Обозревателе решений дважды щелкните пакет, чтобы его открыть.  
  
3.  Щелкните вкладку **Поток данных** , а затем **Панель элементов**и перетащите источник CDC в область конструктора.  
  
4.  Дважды щелкните источник CDC.  
  
5.  В диалоговом окне **Редактор источников CDC** , на странице **Диспетчер соединений** выберите существующий диспетчер соединений ADO.NET из списка или щелкните **Создать** , чтобы создать новое соединение. Соединение должно быть установлено с базой данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , содержащей таблицы изменений, которые должны быть считаны.  
  
6.  Выберите **таблицу CDC** , в которой необходимо обработать изменения.  
  
7.  Выберите или введите имя **экземпляра отслеживания CDC** в сочетании с таблицей CDC, которая должна быть считана.  
  
     Отслеживаемая исходная таблица может иметь один или два отслеживаемых экземпляра для обеспечения возможности беспрепятственных переходов определения таблицы во время изменений схемы. Если для исходной таблицы отслеживания определено больше одного экземпляра отслеживания, выберите экземпляр отслеживания, который должен здесь использоваться. По умолчанию экземпляр отслеживания для таблицы [схема].[таблица] имеет имя \<schema>_\<table>, но фактически используемые экземпляры отслеживания могут иметь другие имена. Таблицей, откуда фактически считываются данные, является таблица CDC **cdc .\<capture-instance>_CT**.  
  
8.  Выберите режим обработки, который в наилучшей степени соответствует конкретным потребностям обработки. Возможными вариантами являются следующие.  
  
    -   **Все**: возвращает изменения в текущем диапазоне CDC без значений **перед обновлением** .  
  
    -   **Все со старыми значениями**: возвращает изменения в текущем диапазоне обработки CDC, включая старые значения (**перед обновлением**). С каждой операции Update связаны две строки: одна со значениями перед обновлением и еще одна со значениями после обновления.  
  
    -   **Суммарные**: возвращает только по одной строке изменения в расчете на каждую исходную строку, измененную в текущем диапазоне обработки CDC. Если исходная строка была обновлена несколько раз, вырабатывается комбинированное изменение (например, результат операций insert и update формируется как единственное обновление, а результат операций update и delete — как единственное удаление). При работе в режиме обработки изменений «Суммарные» обеспечивается возможность разбивать изменения на выводы Delete, Insert и Update и обрабатывать их параллельно, поскольку единственная исходная строка появляется более чем в одном выводе.  
  
    -   **Суммарные с маской обновления**: этот режим аналогичен обычному режиму "Суммарные", но также добавляет столбцы логических значений, имена которым присваиваются по шаблону **__$\<column-name>\__Changed**, указывающие на измененные столбцы в текущей строке изменения.  
  
    -   **Суммарные со слиянием**: этот режим аналогичен обычному режиму "Суммарные", но с операциями Insert и Update, объединенными в одной операции Merge (UPSERT).  
  
9. Выберите строковую переменную пакета службы SSIS, в которой хранится состояние CDC для текущего контекста CDC. Дополнительные сведения о переменной состояния CDC см. в разделе [Определение переменной состояния](../../integration-services/data-flow/define-a-state-variable.md).  
  
10. Установите флажок **Включить столбец индикатора повторной обработки** , чтобы создать специальный выходной столбец с именем **__$reprocessing**. Этот столбец имеет значение **true** , если диапазон обработки CDC перекрывается с начальным диапазоном обработки (с диапазоном номеров LSN, соответствующих периоду начальной загрузки) или если диапазон обработки CDC подвергается повторной обработке вследствие ошибки в предыдущем прогоне. Этот столбец индикатора позволяет разработчику служб SSIS трактовать ошибки иначе при повторной обработке изменений (например, пропускать действия наподобие удаления несуществующей строки или вставки, которая окончилась неудачей из-за дублирующегося ключа).  
  
     Дополнительные сведения см. в статье [CDC Source Custom Properties](../../integration-services/data-flow/cdc-source-custom-properties.md).  
  
11. Чтобы обновить сопоставление между внешними и выходными столбцами, щелкните **Столбцы** и выберите другие столбцы в списке **Внешний столбец** .  
  
12. Можно также обновить значения выходных столбцов, удаляя значения в списке **Выходной столбец** .  
  
13. Чтобы настроить выход ошибок, щелкните **Вывод ошибок**.  
  
14. Можно щелкнуть **Предварительный просмотр** , чтобы рассмотреть до 200 строк данных, извлеченных источником CDC.  
  
15. Нажмите кнопку **ОК**.  
  
## <a name="see-also"></a>См. также:  
 [Редактор источника "CDC" (страница "Диспетчер соединений")](./cdc-source.md)   
 [Редактор источника "CDC" (страница "Столбцы")](./cdc-source.md)   
 [Редактор источника "CDC" (страница "Вывод ошибок")](./cdc-source.md)  
  
