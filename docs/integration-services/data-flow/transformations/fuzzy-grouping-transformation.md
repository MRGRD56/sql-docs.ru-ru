---
description: преобразование «Нечеткое группирование»
title: Преобразование "Нечеткое группирование" | Документы Майкрософт
ms.custom: ''
ms.date: 03/14/2017
ms.prod: sql
ms.prod_service: integration-services
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
f1_keywords:
- sql13.dts.designer.fuzzygroupingtrans.f1
- sql13.dts.designer.fuzzygroupingtransformation.connection.f1
- sql13.dts.designer.fuzzygroupingtransformation.columns.f1
- sql13.dts.designer.fuzzygroupingtransformation.advanced.f1
helpviewer_keywords:
- cleaning data
- comparing data
- token delimiters [Integration Services]
- temporary indexes [Integration Services]
- Fuzzy Grouping transformation
- temporary tables [Integration Services]
- grouping data
- standardizing data [Integration Services]
- columns [Integration Services], standardizing
- similarity thresholds [Integration Services]
- data cleaning [Integration Services]
- duplicate data [Integration Services]
ms.assetid: e43f17bd-9d13-4a8f-9f29-cce44cac1025
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 6ce27ef50da9b1c72bc3b620dda61e6c1c925d14
ms.sourcegitcommit: c5078791a07330a87a92abb19b791e950672e198
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/26/2020
ms.locfileid: "92195966"
---
# <a name="fuzzy-grouping-transformation"></a>преобразование «Нечеткое группирование»

[!INCLUDE[sqlserver-ssis](../../../includes/applies-to-version/sqlserver-ssis.md)]


  Преобразование «Нечеткое группирование» выполняет задачи очистки данных путем идентификации строк данных, которые похожи на дубликаты, и выбора канонической строки данных для использования в стандартизации данных.  
  
> [!NOTE]  
>   Дополнительные сведения о преобразовании «Нечеткое группирование», в том числе сведения об ограничениях производительности и памяти, см. в техническом документе [Преобразования «Нечеткий уточняющий запрос» и «Нечеткое группирование» в службах SQL Server Integration Services 2005](/previous-versions/sql/sql-server-2005/administrator/ms345128(v=sql.90)).  
  
 Преобразованию «Нечеткое группирование» необходимо соединение с экземпляром [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , чтобы создать временные таблицы [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , необходимые алгоритму преобразования для выполнения этой работы. Соединение должно преобразоваться в пользователя, имеющего разрешение создавать таблицы в базе данных.  
  
 Чтобы настроить преобразование, необходимо выбрать входные столбцы для поиска дубликатов, а также выбрать тип соответствия — нечеткое или точное — для каждого столбца. Точное совпадение гарантирует, что только строки, имеющие идентичные значения в этом столбце, будут сгруппированы. Точное соответствие может быть применено к столбцам любых типов данных служб [!INCLUDE[ssISnoversion](../../../includes/ssisnoversion-md.md)] , кроме DT_TEXT, DT_NTEXT и DT_IMAGE. Нечеткое соответствие группирует строки, имеющие приблизительно похожие значения. Метод приблизительного совпадения данных основан на указанном пользователем показателе подобия. В нечетком соответствии могут использоваться только столбцы с типами данных DT_WSTR и DT_STR. Дополнительные сведения см. в разделе [Integration Services Data Types](../../../integration-services/data-flow/integration-services-data-types.md).  
  
 Выход преобразования включает все входные столбцы, один или больше столбцов со стандартизованными данными и столбец, содержащий показатель подобия. Показатель является десятичным значением между 0 и 1. Каноническая строка имеет показатель 1. Другие строки в нечеткой группе имеют показатели, отображающие, насколько строка соответствует канонической строке. Чем ближе к 1 коэффициент, тем более строка соответствует канонической. Если в нечеткое группирование включаются строки, которые являются точными дубликатами канонической строки, эти строки также имеют показатель 1. Преобразование не удаляет дублирующиеся строки; оно группирует их, создавая ключ, связывающий каноническую строку со сходной строкой.  
  
 Преобразование формирует одну выходную строку для каждой входной строки со следующими дополнительными столбцами:  
  
-   **_key_in**— столбец, который уникально идентифицирует каждую строку.  
  
-   **_key_out**— столбец, который идентифицирует группу дублирующихся строк. Столбец **_key_out** имеет значение столбца **_key_in** в канонической строке данных. Строки с одинаковым значением в **_key_out** — члены одной и той же группы. Значение **_key_out** для группы соответствует значению **_key_in** в канонической строке данных.  
  
-   **_score**— значение между 0 и 1, отображающее подобие входной строки по отношению к канонической строке.  
  
 Эти названия столбцов заданы по умолчанию. Можно настроить преобразование «Нечеткое группирование» для использования других названий. Выход также обеспечивает показатель подобия для каждого столбца, участвующего в нечетком группировании.  
  
 Преобразование «Нечеткое группирование» предоставляет два параметра для настройки выполняемого группирования: разделители токенов и порог подобия. Преобразование обеспечивает заданный по умолчанию набор разделителей, используемых для разметки данных, но можно добавить новые разделители, которые улучшат разметку данных.  
  
 Порог подобия отображает, как строго преобразование идентифицирует дубликаты. Пороги подобия могут быть установлены на уровнях компонента и столбца. Порог подобия столбца доступен только для столбцов, участвующих в нечетком соответствии. Диапазон подобия охватывает значения от 0 до 1. Чем ближе порог к 1, тем более сходными должны быть строки и столбцы, чтобы называться дубликатами. Порог подобия среди строк и столбцов указывается установкой свойства MinSimilarity на уровнях компонента и столбца. Для соответствия подобию, которое указано на уровне компонента, все строки должны иметь подобие во всех столбцах, которое больше порога подобия, определенного на уровне компонента, или равно ему.  
  
 Преобразование "Нечеткое группирование" вычисляет внутреннюю меру подобия и не группирует строки с меньшим значением подобия, чем определено в MinSimilarity.  
  
 Чтобы определить порог подобия, который будет работать для реальных данных, возможно, придется применить преобразование «Нечеткое группирование» несколько раз, используя различные минимальные пороги подобия. Во время выполнения столбцы показателя на выходе преобразования содержат показатели подобия для каждой строки в группе. Можно использовать эти значения, чтобы определить порог подобия, который соответствует этим данным. Если необходимо увеличить подобие, нужно присвоить свойству MinSimilarity значение больше, чем значение в столбцах показателей.  
  
 Можно настроить группирование, выполняемое преобразованием, устанавливая свойства столбцов на входе преобразования «Нечеткое группирование». Например, свойство FuzzyComparisonFlags определяет, как преобразование сравнивает строковые данные в столбце, а свойство ExactFuzzy определяет, выполняет ли преобразование нечеткое или точное соответствие.  
  
 Объем памяти, используемой преобразованием "Нечеткое группирование", можно задать в пользовательском свойстве MaxMemoryUsage. Можно указать число мегабайтов (МБ) или значение 0, которое позволяет преобразованию использовать динамический объем памяти в зависимости от своих потребностей и наличия доступной физической памяти. Пользовательское свойство MaxMemoryUsage можно обновить с помощью выражения свойства при загрузке пакета. Дополнительные сведения см. в разделах [Выражения служб Integration Services (SSIS)](../../../integration-services/expressions/integration-services-ssis-expressions.md), [Использование выражений свойств в пакетах](../../../integration-services/expressions/use-property-expressions-in-packages.md) и [Пользовательские свойства преобразований](../../../integration-services/data-flow/transformations/transformation-custom-properties.md).  
  
 Это преобразование имеет один вход и один выход. Вывод ошибок не поддерживается.  
  
## <a name="row-comparison"></a>Сравнение строк  
 При настройке преобразования «Нечеткое группирование» можно определить алгоритм сравнения, который преобразование применяет для сравнения строк на входе преобразования. Если свойству Exhaustive присвоено значение **true**, преобразование будет сравнивать каждую строку на входе с каждой другой строкой на входе. Этот алгоритм сравнения может выдать более точные результаты, но это может сделаеть работу преобразования более медленной при большом количестве строк на входе. Чтобы избежать проблем с производительностью, желательно установить свойство Exhaustive в значение **true** только на время развертывания пакета.  
  
## <a name="temporary-tables-and-indexes"></a>Временные таблицы и индексы  
 Во время выполнения преобразование «Нечеткое группирование» создает временные объекты, такие как таблицы и индексы, потенциально существенного размера в базе данных [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , к которой преобразование подключается. Размер таблиц и индексов пропорционален количеству строк на входе преобразования и количеству разделителей токенов, созданных преобразованием «Нечеткое группирование».  
  
 Преобразование также делает запросы к временным таблицам. Поэтому необходимо рассмотреть подключение преобразования "Нечеткое группирование" к непроизводственному экземпляру [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], особенно если рабочий сервер имеет ограничения по доступному месту на диске.  
  
 Производительность этого преобразования может повышаться путем размещения используемых им таблиц и индексов на локальном компьютере.  
  
## <a name="configuration-of-the-fuzzy-grouping-transformation"></a>Настройка преобразования «Нечеткое группирование»  
 Значения свойств можно задавать с помощью конструктора [!INCLUDE[ssIS](../../../includes/ssis-md.md)] или программными средствами.  
  
 Дополнительные сведения о свойствах, которые вы можете задать в диалоговом окне **Расширенный редактор** или программными средствами, см. в следующих разделах.  
  
-   [Общие свойства](../set-the-properties-of-a-data-flow-component.md)  
  
-   [Пользовательские свойства преобразований](../../../integration-services/data-flow/transformations/transformation-custom-properties.md)  
  
## <a name="related-tasks"></a>Связанные задачи  
 Дополнительные сведения об установке свойств этой задачи см. в следующих разделах:  
  
-   [Определение подобных строк данных с помощью преобразования «Нечеткое группирование»](../../../integration-services/data-flow/transformations/identify-similar-data-rows-by-using-the-fuzzy-grouping-transformation.md)  
  
-   [Установление свойств компонента потока данных](../../../integration-services/data-flow/set-the-properties-of-a-data-flow-component.md)  
  
## <a name="fuzzy-grouping-transformation-editor-connection-manager-tab"></a>Редактор преобразования «Нечеткое группирование» (вкладка «Диспетчер соединений»)
  Вкладка **Диспетчер соединений** в диалоговом окне **Редактор преобразования «Нечеткое группирование»** используется для выбора существующего соединения или для создания нового.  
  
> [!NOTE]  
>  Сервер, указанный в соединении, должен работать под управлением [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]. Преобразование "Нечеткое группирование" создает временные объекты в базе данных tempdb, размер которой может соответствовать полному вводу для преобразования. При выполнении преобразования запросы сервера выполняются в зависимости от этих временных объектов. Это может повлиять на общую производительность сервера.  
  
### <a name="options"></a>Параметры  
 **Диспетчер соединений OLE DB**  
 Выберите в списке существующий диспетчер соединения OLE DB или создайте новое соединение с помощью кнопки **Создать** .  
  
 **Создать**  
 Создайте новое соединение с помощью диалогового окна **Настройка диспетчера соединений OLE DB** .  
  
## <a name="fuzzy-grouping-transformation-editor-columns-tab"></a>Редактор преобразования «Нечеткое группирование» (вкладка «Столбцы»)
  Используйте вкладку **Столбцы** диалогового окна **Редактор преобразования «Нечеткое группирование»** для задания столбцов, используемых при группировке строк с повторяющимися значениями.  
  
### <a name="options"></a>Параметры  
 **Доступные входные столбцы**  
 Выберите из списка входные столбцы, используемые для группировки строк с повторяющимися значениями.  
  
 **имя**;  
 Просмотрите имена доступных входных столбцов.  
  
 **Передать**  
 Выберите, следует ли включить входной столбец в вывод преобразования. Все используемые для группирования столбцы автоматически копируются в выход. Дополнительные столбцы можно включать с помощью установки флажка.  
  
 **Входной столбец**  
 Выберите один из входных столбцов, указанных ранее в списке **Доступные входные столбцы** .  
  
 **Псевдоним вывода**  
 Введите описательное имя соответствующего выходного столбца. По умолчанию, имя выходного столбца совпадает с именем входного столбца.  
  
 **Псевдоним группы выхода**  
 Введите описательное имя столбца, содержащего каноническое значение сгруппированных повторяющихся значений. По умолчанию, именем этого выходного столбца является имя входного столбца с добавлением в конце _clean.  
  
 **Тип соответствия**  
 Выберите нечеткое или четкое соответствие. Строки считаются повторяющимися, если они подобны по всем столбцам в случае нечеткого соответствия. Если также задано четкое соответствие по определенным столбцам в качестве вероятно повторяющихся, рассматриваются только строки, которые содержат одинаковые значения в столбцах четкого соответствия. Таким образом, если известно, что определенный столбец не содержит ошибок или несоответствий, по нему можно задать четкое соответствие для повышения точности нечеткого соответствия по другим столбцам.  
  
 **Минимальное подобие**  
 Задайте порог подобия на уровне соединения с помощью ползунка. Чем ближе значение к 1, тем ближе к искомому должно быть значение строки уточняющего запроса. Увеличение порогового значения может увеличить скорость соответствия, так как при этом будет рассматриваться меньшее количество предполагаемых совпадений.  
  
 **Псевдоним выхода подобия**  
 Задайте имя нового выходного столбца, который содержит метки подобия для выбранного соединения. Если оставить это значение пустым, то выходной столбец не будет создан.  
  
 **Цифры**  
 Задайте значимость начальных и конечных цифр при сравнении данных столбцов. Например, если начальные цифры являются значимыми, группировка строк «123 Main Street» и «456 Main Street» не выполняется.  
  
|Значение|Описание|  
|-----------|-----------------|  
|**Нет**|Начальные и конечные цифры не являются значимыми.|  
|**Начальные**|Значимыми являются только начальные цифры.|  
|**Конечные**|Значимыми являются только конечные цифры.|  
|**Начальные и конечные**|Значимыми являются и начальные, и конечные цифры.|  
  
 **Флаги сравнения**  
 Дополнительные сведения о параметрах сравнения строк см. в разделе [Сравнение строковых данных](../../../integration-services/data-flow/comparing-string-data.md).  
  
## <a name="fuzzy-grouping-transformation-editor-advanced-tab"></a>Редактор преобразования «Нечеткое группирование» (вкладка «Дополнительно»)
  На вкладке **Дополнительно** диалогового окна **Редактор преобразования «Нечеткое группирование»** можно определить входные и выходные столбцы, пороги подобия и разделители токенов.  
  
> [!NOTE]  
>  Свойства **Exhaustive** и **MaxMemoryUsage** преобразования «Нечеткое группирование» недоступны в **Редакторе преобразования «Нечеткое группирование»**, однако они могут быть заданы при помощи **расширенного редактора**. Дополнительные сведения об этих свойствах см. в подразделе «Преобразование "Нечеткое группирование"» раздела [Transformation Custom Properties](../../../integration-services/data-flow/transformations/transformation-custom-properties.md).  
  
### <a name="options"></a>Параметры  
 **Имя входного ключевого столбца**  
 Укажите имя выходного столбца, содержащего уникальный идентификатор для каждой входной строки. Столбец **_key_in** содержит значение, уникально идентифицирующее каждую строку.  
  
 **Имя выходного ключевого столбца**  
 Укажите имя выходного столбца, содержащего уникальный идентификатор для канонической строки группы повторяющихся строк. Столбец **_key_out** соответствует значению **_key_in** канонической строки данных.  
  
 **Имя столбца порога подобия**  
 Укажите имя столбца, содержащего показатель подобия. Показатель подобия — значение от 0 до 1, представляющее собой степень подобия входной строки относительно канонической. Чем ближе к 1 коэффициент, тем более строка соответствует канонической.  
  
 **Порог подобия**  
 Установите порог подобия с помощью ползунка. Чем ближе порог к 1, тем большее сходство между собой должны иметь строки, считающиеся повторяющимися. Увеличение этого порога может повысить скорость нахождения совпадений, так как количество рассматриваемых потенциальных записей будет меньше.  
  
 **Разделители токенов**  
 В преобразовании имеется набор разделителей по умолчанию для разделения данных на лексемы. При необходимости можно добавить или удалить разделители в списке.  
  
## <a name="see-also"></a>См. также  
 [Преобразование «Нечеткий уточняющий запрос»](../../../integration-services/data-flow/transformations/fuzzy-lookup-transformation.md)   
 [Преобразования служб Integration Services](../../../integration-services/data-flow/transformations/integration-services-transformations.md)  
  
