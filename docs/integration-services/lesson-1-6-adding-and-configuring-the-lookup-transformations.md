---
description: Занятие 1-6. Добавление и настройка преобразований "Уточняющий запрос"
title: Шаг 6. Добавление и настройка преобразований "Уточняющий запрос" | Документация Майкрософт
ms.custom: ''
ms.date: 03/19/2019
ms.prod: sql
ms.technology: integration-services
ms.topic: tutorial
ms.assetid: 5c59f723-9707-4407-80ae-f05f483cf65f
author: chugugrace
ms.author: chugu
ms.reviewer: ''
ms.openlocfilehash: 7c88bd5e8abafdb15eba50fa7cdea22f29910bc4
ms.sourcegitcommit: 917df4ffd22e4a229af7dc481dcce3ebba0aa4d7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/10/2021
ms.locfileid: "100354320"
---
# <a name="lesson-1-6-add-and-configure-the-lookup-transformations"></a>Занятие 1-6. Добавление и настройка преобразований "Уточняющий запрос"

[!INCLUDE[sqlserver-ssis](../includes/applies-to-version/sqlserver-ssis.md)]



После того как источник неструктурированных файлов настроен для извлечения данных из исходного файла, следует определить преобразования "Уточняющий запрос", необходимые для получения значений **CurrencyKey** и **DateKey**. Преобразование «Уточняющий запрос» выполняет поиск, соединяя данные указанного входного столбца со столбцом эталонного набора данных. Эталонным набором данных может быть таблица или представление, новая таблица или результат инструкции SQL. В этом учебнике преобразование "Уточняющий запрос" использует диспетчер подключений OLE DB, чтобы подключиться к базе данных с исходными данными эталонного набора данных.  
  
> [!NOTE]  
> Можно также настроить преобразование «Уточняющий запрос» для подключения к кэшу, который содержит эталонный набор данных. Дополнительные сведения см. в разделе [Преобразование "Уточняющий запрос"](../integration-services/data-flow/transformations/lookup-transformation.md).  
  
В этой задаче добавляются в пакет и настраиваются следующие два компонента преобразования "Уточняющий запрос":  
  
-   первое преобразование для уточняющего запроса значений в столбце **CurrencyKey** таблицы измерения **DimCurrency**, сопоставленных со значениями в столбце **CurrencyID** неструктурированного файла;  
  
-   второе преобразование для уточняющего запроса значений в столбце **DateKey** таблицы измерения **DimDate**, сопоставленных со значениями в столбце **CurrencyDate** неструктурированного файла.  
  
В обоих случаях в преобразовании "Уточняющий запрос" используется созданный ранее диспетчер подключений OLE DB.  
  
## <a name="add-and-configure-the-lookup-currency-key-transformation"></a>Добавление и настройка преобразования "Уточняющий запрос ключа валюты"  
  
1.  На панели **Область элементов служб SSIS** разверните узел **Общие** и перетащите элемент **Уточняющий запрос** в область конструктора на вкладку **Поток данных** . Поместите **Уточняющий запрос** прямо под источником **Извлечь образец данных валют**.  
  
2.  Выберите источник неструктурированного файла **Извлечь образец данных валют** и перетащите синюю стрелку на добавленное преобразование **Уточняющий запрос**, соединив эти два компонента.  
  
3.  В области конструктора **Поток данных** выберите элемент **Уточняющий запрос** в преобразовании **Уточняющий запрос** и измените имя на **Уточняющий запрос ключа валюты**.  
  
4.  Дважды щелкните преобразование **Уточняющий запрос ключа валюты**, чтобы открыть **редактор преобразования "Уточняющий запрос"**.  
  
5.  На вкладке **Общие** задайте следующие параметры.  
  
    1.  Выберите **Полное кэширование**.  
  
    2.  В области **Тип соединения** выберите **Диспетчер соединений OLE DB**.  
  
6.  На вкладке **Соединение** задайте следующие параметры.  
  
    1.  Убедитесь, что в диалоговом окне **Диспетчер соединений OLE DB** отображается **localhost.AdventureWorksDW2012** .  
  
    2.  Выберите **Использовать результаты SQL-запроса** и введите или вставьте следующую инструкцию SQL:  
  
        ```sql
        SELECT * FROM [Sales].[Currency]
        WHERE [CurrencyCode]
        IN ('ARS', 'AUD', 'BRL', 'CAD', 'CNY',
            'DEM', 'EUR', 'FRF', 'GBP', 'JPY',
            'MXN', 'SAR', 'USD', 'VEB')
        ```  
    3.  Чтобы проверить результаты запроса, нажмите **Предварительный просмотр**.
  
7.  На вкладке **Столбцы** задайте следующие параметры.  
  
    1.  На панели **Доступные входные столбцы** перетащите **CurrencyID** на панель **Доступные столбцы подстановки** и поместите его на элемент **CurrencyAlternateKey**.  
  
    2.  В списке **Доступные столбцы подстановки** установите флажок слева от столбца **CurrencyKey**.  
  
8.  Нажмите кнопку **ОК**, чтобы вернуться в область конструктора **Поток данных**.  
  
9. Щелкните правой кнопкой мыши преобразование "Уточняющий запрос ключа валюты" и выберите пункт **Свойства**.  
  
10. В окне **Свойства** убедитесь в том, что свойство **LocaleID** установлено в значение **Английский (США)**, а свойство **DefaultCodePage** — в значение **1252**.  
  
## <a name="add-and-configure-the-lookup-date-key-transformation"></a>Добавление и настройка преобразования "Уточняющий запрос ключа даты"  
  
1.  В окне **Область элементов служб SSIS** перетащите **Уточняющий запрос** в область конструктора **Поток данных** . Поместите **Уточняющий запрос** прямо под преобразование **Уточняющий запрос ключа валюты**.  
  
2.  Выберите преобразование **Уточняющий запрос ключа валюты** и перетащите синюю стрелку на новое преобразование **Уточняющий запрос**, соединив эти два компонента.  
  
3.  В диалоговом окне **Выбор входов и выходов** в списке **Вывод** выберите пункт **Вывод совпадений преобразования "Уточняющий запрос"** и нажмите кнопку **ОК**.  
  
4.  В области конструктора **Поток данных** выберите имя **Уточняющий запрос** в только что добавленном преобразовании **Уточняющий запрос** и измените его на **Уточняющий запрос ключа даты**.  
  
5.  Дважды щелкните преобразование **Уточняющий запрос ключа даты** .  
  
6.  На вкладке **Общие** выберите **Частичное кэширование**.  
  
7.  На вкладке **Соединение** задайте следующие параметры.  
  
    1.  Убедитесь в том, что в диалоговом окне **Диспетчер подключений OLE DB** отображается значение **localhost.AdventureWorksDW2012**.  
  
    2.  В поле **Использовать таблицу или представление** введите или выберите значение **[dbo].[DimDate]**.  
  
8.  На вкладке **Столбцы** задайте следующие параметры.  
  
    1.  На панели **Доступные входные столбцы** перетяните **CurrencyDate** на панель **Доступные столбцы подстановки** и поместите его на элемент **FullDateAlternateKey**.  Если отобразится сообщение о несоответствии типов данных, измените тип данных для CurrencyDate на [DT_DBDATE].
  
    2.  В списке **Доступные столбцы подстановки** установите флажок слева от столбца **DateKey**.  
  
9. На странице **Дополнительно** просмотрите параметры кэширования.  
  
10. Нажмите кнопку **ОК**, чтобы вернуться в область конструктора **Поток данных**.  
  
11. Щелкните правой кнопкой мыши преобразование **Уточняющий запрос ключа даты** и выберите пункт **Свойства**.
  
12. В окне **Свойства** убедитесь в том, что свойство **LocaleID** установлено в значение **Английский (США)**, а свойство **DefaultCodePage** — в значение **1252**.  
  
## <a name="go-to-next-task"></a>Переход к следующей задаче
[Шаг 7. Добавление и настройка назначения OLE DB](../integration-services/lesson-1-7-adding-and-configuring-the-ole-db-destination.md)  
  
## <a name="see-also"></a>См. также  
[Преобразование "Уточняющий запрос"](../integration-services/data-flow/transformations/lookup-transformation.md)  
