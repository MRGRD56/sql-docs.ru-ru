---
title: Поддержка горизонтального увеличения масштаба для обеспечения высокой доступности | Документация Майкрософт
description: Узнайте, как обеспечить высокий уровень доступности посредством конфигурации на стороне SQL Server Integration Services (SSIS) Scale Out Master.
ms.custom: performance
ms.date: 05/23/2018
ms.prod: sql
ms.prod_service: integration-services
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
author: haoqian
ms.author: haoqian
ms.openlocfilehash: dd53bf6f045687f7d79f6c0e836490adb60cda44
ms.sourcegitcommit: 917df4ffd22e4a229af7dc481dcce3ebba0aa4d7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/10/2021
ms.locfileid: "100348860"
---
# <a name="scale-out-support-for-high-availability"></a>Поддержка горизонтального увеличения масштаба для обеспечения высокого уровня доступности

[!INCLUDE[sqlserver-ssis](../../includes/applies-to-version/sqlserver-ssis.md)]



В развертывании SSIS с горизонтальным увеличением масштаба высокий уровень доступности на стороне рабочей роли обеспечивается за счет выполнения пакетов с использованием нескольких рабочих ролей горизонтального увеличения масштаба.

Высокий уровень доступности на стороне мастера горизонтального увеличения масштаба достигается за счет применения функций [AlwaysOn для каталога служб SSIS](../catalog/ssis-catalog.md#always-on-for-ssis-catalog-ssisdb) и отказоустойчивого кластера Windows. В этом решении несколько экземпляров мастера горизонтального увеличения масштаба размещаются в отказоустойчивом кластере Windows. Если служба мастера горизонтального увеличения масштаба или SSISDB на основном узле отключены, служба или SSISDB на вторичном узле продолжают принимать запросы пользователей и взаимодействовать с рабочими ролями горизонтального увеличения масштаба.

Кроме того, высокий уровень доступности на стороне мастера горизонтального увеличения масштаба может быть достигнут с использованием экземпляра отказоустойчивого кластера SQL Server. См. раздел [Поддержка горизонтального увеличения масштаба для обеспечения высокой доступности с помощью экземпляра отказоустойчивого кластера SQL Server](scale-out-failover-cluster-instance.md).

Чтобы настроить высокий уровень доступности на стороне мастера горизонтального увеличения масштаба с использованием функций AlwaysOn для каталога служб SSIS, выполните указанные ниже действия:

## <a name="1-prerequisites"></a>1. Предварительные требования
Настроить отказоустойчивый кластер Windows. Инструкции см. в записи блога [Установка компонента и средств отказоустойчивого кластера для Windows Server 2012](https://techcommunity.microsoft.com/t5/failover-clustering/installing-the-failover-cluster-feature-and-tools-in-windows/ba-p/371733). Установите компоненты и средства на всех узлах кластера.

## <a name="2-install-scale-out-master-on-the-primary-node"></a>2. Установка мастера горизонтального увеличения масштаба в основном узле
Установите службы ядра СУБД SQL Server, службы Integration Services и мастер горизонтального увеличения масштаба в основном узле для мастера горизонтального увеличения масштаба. 

Во время установки выполните указанные ниже действия.

### <a name="21-set-the-account-running-scale-out-master-service-to-a-domain-account"></a>2.1. Настройте учетную запись, с помощью которой выполняется служба мастера горизонтального увеличения масштаба, в качестве учетной записи домена.
Эта учетная запись должна впоследствии иметь доступ к SSISDB во вторичном узле в отказоустойчивом кластере Windows. Так как служба мастера горизонтального увеличения масштаба и SSISDB реализуют отдельную отработку отказа, они не могут находиться на одном узле после отработки отказа.

![Конфигурация сервера высокой доступности](media/ha-server-config.PNG)

### <a name="22-include-the-dns-host-name-for-the-scale-out-master-service-in-the-cns-of-the-scale-out-master-certificate"></a>2.2. Включите имя узла DNS для службы мастера горизонтального увеличения масштаба в список CN для сертификата мастера горизонтального увеличения масштаба.

Это имя узла — конечная точка мастера горизонтального увеличения масштаба, которая создается как кластеризованная универсальная служба в отказоустойчивом кластере (см. шаг 7).   (Необходимо указать имя узла DNS, а не имя сервера.)

![Конфигурация мастера высокой доступности](media/ha-master-config.PNG)

## <a name="3-install-scale-out-master-on-the-secondary-node"></a>3. Установка мастера горизонтального увеличения масштаба во вторичном узле
Установите службы ядра СУБД SQL Server, службы Integration Services и мастер горизонтального увеличения масштаба во вторичном узле для мастера горизонтального увеличения масштаба. 

Используйте тот же сертификат мастера горизонтального увеличения масштаба, что и в основном узле. Экспортируйте TLS/SSL-сертификат мастера горизонтального увеличения масштаба в основном узле с закрытым ключом и установите его в корневое хранилище сертификатов локального компьютера во вторичном узле. Выберите этот сертификат при установке мастера горизонтального увеличения масштаба во вторичном узле.

![Конфигурация мастера высокой доступности 2](media/ha-master-config2.PNG)

> [!NOTE]
> Вы можете настроить несколько резервных мастеров горизонтального увеличения масштаба, повторив эти действия для мастера горизонтального увеличения масштаба в других вторичных узлах.

## <a name="4-set-up-and-configure-ssisdb-support-for-always-on"></a>4. Настройка поддержки SSISDB для AlwaysOn

Выполните инструкции по настройке поддержки SSISDB для AlwaysOn, приведенные в статье об [AlwaysOn для каталога служб SSIS (SSISDB)](../catalog/ssis-catalog.md#always-on-for-ssis-catalog-ssisdb).

Кроме того, необходимо создать прослушиватель группы доступности для группы доступности, в которую добавляется SSISDB. См. раздел [Создание или настройка прослушивателя группы доступности](../../database-engine/availability-groups/windows/create-or-configure-an-availability-group-listener-sql-server.md).

## <a name="5-update-the-scale-out-master-service-configuration-file"></a>5. Обновление файла конфигурации для службы мастера горизонтального увеличения масштаба
Обновите файл конфигурации для службы мастера горизонтального увеличения масштаба (`\<drive\>:\Program Files\Microsoft SQL Server\140\DTS\Binn\MasterSettings.config`) в основном и вторичном узлах. Присвойте атрибуту **SqlServerName** значение *[имя DNS прослушивателя группы доступности],[порт]* .

## <a name="6-enable-package-execution-logging"></a>6. Включение ведения журнала выполнения пакетов

Ведение журналов в SSISDB реализуется посредством имени входа **##MS_SSISLogDBWorkerAgentLogin##** , пароль для которого формируется автоматически. Чтобы настроить ведение журналов для всех реплик SSISDB, выполните указанные ниже действия.

### <a name="61-change-the-password-of-ms_ssislogdbworkeragentlogin-on-the-primary-sql-server"></a>6.1. Смените пароль для **##MS_SSISLogDBWorkerAgentLogin##** в основном экземпляре SQL Server.

### <a name="62-add-the-login-to-the-secondary-sql-server"></a>6.2. Добавьте имя входа для вторичного экземпляра SQL Server.

### <a name="63-update-the-connection-string-used-for-logging"></a>6.3. Обновите строку подключения, используемую для ведения журналов.
Вызовите хранимую процедуру `[catalog].[update_logdb_info]` со следующими значениями параметров:

-   `@server_name = '[Availability Group Listener DNS name],[Port]'`

-   `@connection_string = 'Data Source=[Availability Group Listener DNS name],[Port];Initial Catalog=SSISDB;User Id=##MS_SSISLogDBWorkerAgentLogin##;Password=[Password]];'`

## <a name="7-configure-the-scale-out-master-service-role-of-the-windows-server-failover-cluster"></a>7. Настройка роли службы мастера горизонтального увеличения масштаба для отказоустойчивого кластера Windows Server

1.  В диспетчере отказоустойчивости кластеров установите подключение к кластеру для горизонтального увеличения масштаба. Выберите кластер. Выберите в меню пункт **Действие**, после чего выберите **Настроить роль**.

2.  В диалоговом окне **Мастер высокой доступности** выберите **Универсальная служба** на странице **Выбор роли**. На странице **Выбор службы** выберите "Главная служба развертывания SQL Server Integration Services 14.0".

3.  На странице **Точка доступа клиента** введите имя узла DNS службы мастера горизонтального увеличения масштаба.

    ![Мастер высокой доступности 1](media/ha-wizard1.PNG)

4.  Завершите работу мастера.

Для этого шага на виртуальных машинах Azure нужны дополнительные действия. Полное описание этих основных понятий и шагов выходит за рамки данной статьи.

1.  Необходимо настроить домен Azure. Для работы отказоустойчивой кластеризации Windows Server нужно, чтобы все компьютеры в кластере входили в состав одного домена. Дополнительные сведения см. в статье [Включение доменных служб Azure Active Directory с помощью портала Azure](/azure/active-directory-domain-services/create-instance).

2. Необходимо настроить балансировщик нагрузки Azure. Это требование для прослушивателя группы доступности. Дополнительные сведения см. в статье [Руководство по балансировке нагрузки внутреннего трафика на виртуальных машинах с помощью балансировщика нагрузки уровня "Базовый" на портале Azure](/azure/load-balancer/tutorial-load-balancer-basic-internal-portal).

## <a name="8-update-the-scale-out-master-address-in-ssisdb"></a>8. Обновление адреса мастера горизонтального увеличения масштаба в SSISDB

На основном сервере SQL Server выполните хранимую процедуру `[catalog].[update_master_address]` со значением параметра `@MasterAddress = N'https://[Scale Out Master service DNS host name]:[Master Port]'`. 

## <a name="9-add-the-scale-out-workers"></a>9. Добавление рабочих ролей горизонтального увеличения масштаба

Теперь можно добавить рабочие роли горизонтального увеличения масштаба с помощью [диспетчера горизонтального увеличения масштаба Integration Services](integration-services-ssis-scale-out-manager.md). Введите `[SQL Server Availability Group Listener DNS name],[Port]` на странице подключения.

## <a name="upgrade-scale-out-in-high-availability-environment"></a>Обновление развертывания с горизонтальным увеличением масштаба в среде высокого уровня доступности
Чтобы обновить развертывание с горизонтальным увеличением масштаба в среде высокого уровня доступности, выполните [инструкции по обновлению из AlwaysOn для каталога служб SSIS](../catalog/ssis-catalog.md#Upgrade), обновите развертывание с горизонтальным увеличением масштаба и рабочие роли горизонтального увеличения масштаба на каждом компьютере, а также повторно создайте роль отказоустойчивого кластера Windows Server в шаге 7 выше с помощью новой версии службы мастера горизонтального увеличения масштаба.

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения см. в следующих статьях:
-   [Мастер горизонтального увеличения масштаба служб Integration Services (SSIS)](integration-services-ssis-scale-out-master.md)
-   [Рабочая роль горизонтального увеличения масштаба служб Integration Services (SSIS)](integration-services-ssis-scale-out-worker.md)