---
title: Развертывание в Active Directory в службах Azure Kubernetes (AKS)
titleSuffix: SQL Server Big Data Cluster
description: В этой статье описываются основные понятия и принципы планирования при развертывании кластеров больших данных SQL Server в режиме AD в службах Azure Kubernetes (AKS).
author: cloudmelon
ms.author: melqin
ms.reviewer: mikeray
ms.date: 11/12/2020
ms.topic: conceptual
ms.prod: sql
ms.technology: big-data-cluster
ms.openlocfilehash: 4b11cef91203a9c7939d4d044220283db378e296
ms.sourcegitcommit: d8cdbb719916805037a9167ac4e964abb89c3909
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/20/2021
ms.locfileid: "98595635"
---
# <a name="deploy-sql-server-big-data-clusters-in-ad-mode-on-azure-kubernetes-services-aks"></a>Развертывание кластеров больших данных SQL Server в режиме AD в службах Azure Kubernetes (AKS)

Кластеры больших данных SQL Server поддерживают [режим развертывания Active Directory (AD)](./active-directory-prerequisites.md) для **системы управления удостоверениями и доступом (IAM)** . Управление удостоверениями и доступом для **служб Azure Kubernetes (AKS)** было сопряжено с определенными проблемами, поскольку SQL Server не поддерживает стандартные отраслевые протоколы, такие как OAuth 2.0 и OpenID Connect, которые широко используются на платформе управления удостоверениями Майкрософт.  

В этой статье объясняется, как развернуть кластер больших данных SQL Server в режиме AD при развертывании в [службах Azure Kubernetes (AKS)](/azure/aks/intro-kubernetes). 

## <a name="architecture-topologies"></a>Топологии архитектуры

**Доменные службы Active Directory (AD DS)** работают на виртуальной машине Azure [так же](/windows-server/identity/ad-ds/deploy/virtual-dc/adds-on-azure-vm), как и на множестве других локальных экземпляров.  После повышения уровня новых контроллеров домена в Azure и настройки основного и дополнительного DNS-сервера для виртуальной сети все локальные DNS-серверы будут понижены до третьего или более низкого уровня. С помощью проверки подлинности AD присоединенные к домену клиенты с [Linux могут проходить проверку подлинности в SQL Server](../linux/sql-server-linux-active-directory-auth-overview.md), используя свои учетные данные домена и протокол Kerberos.

Кластер больших данных можно развернуть в режиме AD в AKS несколькими способами.  В этой статье описываются два способа, которые проще реализовать и интегрировать с существующими корпоративными архитектурами:

* **Как расширить локальный домен Active Directory в Azure.** Этот способ позволяет [использовать среду Active Directory](/azure/architecture/reference-architectures/identity/adds-extend-domain) для предоставления распределенных служб проверки подлинности с помощью доменных служб Active Directory (AD DS) в Azure. Реплицируя локальные доменные службы Active Directory (AD DS), вы уменьшаете задержку, связанную с отправкой запросов на проверку подлинности из облака обратно в локальные службы AD DS. Как правило, это решение применяется в тех случаях, когда приложение размещается частично в локальной среде и частично в Azure, а запросы проверки подлинности передаются в обоих направлениях.

   Пошаговые инструкции по развертыванию этого решения см. в описании [этой эталонной архитектуры](https://github.com/mspnp/identity-reference-architectures/tree/master/adds-extend-domain).

* **Расширение леса ресурсов доменных служб Active Directory (AD DS) в Azure.** В этой архитектуре создается новый домен в Azure, который является доверенным для локального леса AD. В этой архитектуре демонстрируется [одностороннее отношение доверия между доменом в Azure и локальным лесом](/azure/architecture/reference-architectures/identity/adds-forest).

   Благодаря наличию доверия локальные пользователи могут получать доступ к ресурсам в домене в Azure. Пошаговые инструкции по развертыванию этого решения см. в описании [этой эталонной архитектуры](https://github.com/mspnp/identity-reference-architectures/tree/master/adds-forest).

Описываемые выше эталонные архитектуры позволяют создать целевую зону, которая содержит все ресурсы для развертывания с нуля, или любое обходное решение, основанное на существующей архитектуре. В дополнение к этим эталонным архитектурам необходимо развернуть кластер больших данных в кластере AKS в отдельной подсети, которая принадлежит вашей целевой или одноранговой виртуальной сети.

Типовая архитектура представлена на следующем рисунке:

:::image type="content" source="media/active-directory-deployment-aks/ad-in-aks-diagram.png" alt-text="Кластер AKS с AD и кластер больших данных SQL Server":::

## <a name="recommendations"></a>Рекомендации

Приведенные здесь рекомендации относятся к большинству развертываний кластеров больших данных в режиме AD в AKS. Для каждого компонента будут указаны доступные варианты, что позволяет добиться лучшей интеграции с корпоративной архитектурой.

### <a name="networking-recommendations"></a>Рекомендации по сети

Для подключения локальной среды к Azure можно использовать несколько основных компонентов:

* **VPN-шлюз Azure**. VPN-шлюз — это особый тип шлюза виртуальной сети, используемый для отправки зашифрованного трафика между виртуальной сетью Azure и локальным расположением через общедоступный Интернет. Вы будете использовать и шлюз виртуальной сети Azure, и локальный шлюз виртуальной сети. Сведения об их настройке см. в разделе [Что такое VPN-шлюз](/azure/vpn-gateway/vpn-gateway-about-vpngateways).
* **Azure ExpressRoute**. Подключения ExpressRoute не осуществляются через общедоступный Интернет и обеспечивают повышенный уровень безопасности, надежности и быстродействия с низким уровнем задержки по сравнению с обычными подключениями через Интернет. Выбор варианта подключения будет влиять на задержку, производительность и уровень соглашения об уровне обслуживания для вашего решения в зависимости от номеров SKU. Подробные сведения см. в статье [Сведения о шлюзах виртуальных сетей ExpressRoute](/azure/expressroute/expressroute-about-virtual-network-gateways).

Большинство клиентов используют для доступа к другой инфраструктуре Azure переходную среду или [Бастион Azure](/azure/bastion/bastion-overview). **Приватный канал Azure** обеспечивает безопасный доступ к службам Azure PaaS, включая AKS в этом сценарии, а также к другим размещенным в Azure службам, через частную конечную точку в вашей виртуальной сети. Трафик между вашей виртуальной сетью и службой проходит через магистральную сеть Майкрософт, что позволяет избежать рисков общедоступного Интернета. Кроме того, вы можете создать в своей виртуальной сети собственную службу "Приватный канал" и предоставлять ее клиентам в частном порядке.

### <a name="active-directory-and-azure-recommendation"></a>Рекомендации для Active Directory и Azure

Локальные службы AD DS хранят информацию об учетных записях пользователей и предоставляют другим авторизованным пользователям из этой сети доступ к этой информации с использованием прошедших проверку подлинности удостоверений, которые связаны с пользователями, компьютерами, приложениями или другими ресурсами, входящими в границы безопасности. В большинстве гибридных сценариев проверка подлинности пользователей происходит через VPN-шлюз или канал ExpressRoute, связанные с локальными службами AD DS.  

Для развертывания кластера больших данных в режиме AD посредством [интеграции локальных служб Active Directory с Azure](/azure/architecture/reference-architectures/identity/) должны выполняться следующие предварительные требования:

* [Учетная запись AD с определенными разрешениями](active-directory-prerequisites.md) на создание учетных записей компьютеров, пользователей и групп внутри указанного подразделения в локальном каталоге Active.
* DNS-сервер для [разрешения внутренних DNS-имен](active-directory-dns-reconciliation.md). Он должен содержать записи типа **A (прямой просмотр)** и **PTR (обратный просмотр)** на DNS-сервере с именами в этом домене. Настройка параметров DNS домена в профиле развертывания кластера больших данных.  

## <a name="next-steps"></a>Следующие шаги

[Учебник. Развертывание кластеров больших данных SQL Server в режиме AD в службах Azure Kubernetes (AKS)](active-directory-deployment-aks-tutorial.md)