---
title: Виртуализация данных CSV из пула носителей
subtitle: Кластеры больших данных SQL Server
description: Шаги, описывающие создание внешней таблицы для виртуализации CSV-файла в кластере больших данных
author: MikeRayMSFT
ms.author: mikeray
ms.reviewer: mikeray
ms.date: 04/24/2020
ms.topic: conceptual
ms.prod: sql
ms.technology: polybase
monikerRange: '>= sql-server-ver15'
ms.metadata: seo-lt-2019
ms.openlocfilehash: a524b238e980ee4b8972a4a8f7b976a34ca17c3e
ms.sourcegitcommit: 1a544cf4dd2720b124c3697d1e62ae7741db757c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/14/2020
ms.locfileid: "97420126"
---
# <a name="virtualize-csv-data-from-storage-pool-big-data-clusters"></a>Виртуализация данных CSV-файла из пула носителей (кластеры больших данных)

Кластеры больших данных SQL Server могут виртуализировать данные из CSV-файлов в HDFS. Этот процесс позволяет сохранять данные в исходном расположении, но их можно запрашивать из экземпляра SQL Server, как любую таблицу. Эта функция использует соединители PolyBase и уменьшает потребность в процессах извлечения, преобразования и загрузки. Дополнительные сведения о виртуализации данных см. в разделе [Что такое PolyBase?](../relational-databases/polybase/polybase-guide.md).

## <a name="prerequisites"></a>Предварительные требования

- [Развернутый кластер больших данных](deployment-guidance.md)
- [Azure Data Studio](../azure-data-studio/download-azure-data-studio.md)

## <a name="select-or-upload-a-csv-file-for-data-virtualization"></a>Выбор или отправка CSV-файла для виртуализации данных 

В Azure Data Studio (ADS) [установите подключение к главному экземпляру SQL Server](connect-to-big-data-cluster.md#master) в кластере больших данных. После подключения разверните элементы HDFS в обозревателе объектов, чтобы указать CSV-файлы, которые необходимо виртуализировать. 

В рамках этого учебника мы создадим каталог с именем **Data**.

1. Щелкните правой кнопкой мыши контекстное меню корневого каталога HDFS.
2. Щелкните **Создать каталог**.
3. Назовите новый каталог *Data*.

Отправьте пример данных. Для упрощения работы используйте образец CSV-файла данных. В этой статье используются данные о причинах задержек рейсов авиакомпаний по сведениям [Министерства транспорта США](https://www.transtats.bts.gov/OT_Delay/OT_DelayCause1.asp?pn=1). Скачайте необработанные данные и извлеките их на компьютер. Присвойте файлу имя *airline_delay_causes.csv*.

Чтобы отправить пример файла после его извлечения, сделайте следующее.

1. В Azure Data Studio *щелкните правой кнопкой мыши* созданный каталог. 
2. Щелкните **Отправить файлы**.

![пример csv-файла в HDFS](media/data-virtualization/100-csv-sample-file-hdfs.png)

Azure Data Studio передает файлы в HDFS в кластере больших данных.

## <a name="create-the-storage-pool-external-data-source-in-your-target-database"></a>Создание внешнего источника данных пула носителей в целевой базе данных

Внешний источник данных пула носителей не создается по умолчанию в базе данных в кластере больших данных. Перед тем как создать внешнюю таблицу, создайте внешний источник данных по умолчанию **SqlStoragePool** в целевой базе данных с помощью приведенного ниже запроса Transact-SQL. Предварительно необходимо переключить контекст запроса на целевую базу данных.

```sql
-- Create the default storage pool source for SQL Big Data Cluster
IF NOT EXISTS(SELECT * FROM sys.external_data_sources WHERE name = 'SqlStoragePool')
    CREATE EXTERNAL DATA SOURCE SqlStoragePool
    WITH (LOCATION = 'sqlhdfs://controller-svc/default');
```

## <a name="create-the-external-table"></a>Создание внешней таблицы

В ADS щелкните CSV-файл правой кнопкой мыши и выберите пункт **Создать внешнюю таблицу из CSV-файла** в контекстном меню. Вы также можете создавать внешние таблицы из CSV-файлов, используя каталог в файловой системе HDFS, если файлы в каталоге имеют ту же схему. Это делает возможной виртуализацию данных на уровне каталога без обработки отдельных файлов и получения объединенных результирующих наборов для объединенных данных. Azure Data Studio предоставит инструкции по созданию внешней таблицы.

Укажите базу данных, источник данных, имя таблицы, схему и имя для формата внешнего файла таблицы.

Щелкните **Далее**.

## <a name="preview-data"></a>Просмотр данных

Azure Data Studio обеспечивает предварительный просмотр импортированных данных.

![Снимок экрана: окно "Создать внешнюю таблицу из CSV-файла" с результатами предварительного просмотра импортированных данных.](media/data-virtualization/130-csv-preview-data.png)

По окончании просмотра нажмите кнопку **Далее** для продолжения.

## <a name="modify-columns"></a>Изменение столбцов

В следующем окне можно изменить столбцы внешней таблицы, которую вы хотите создать. Вы можете изменить имя столбца и тип данных, а также разрешить для строк значение NULL. 

![Снимок экрана: окно "Создать внешнюю таблицу из CSV-файла", в котором отображается шаг 3 "Изменение столбцов".](media/data-virtualization/140-csv-modify-columns.png)

После проверки целевых столбцов нажмите кнопку **Далее**.

## <a name="summary"></a>Сводка

На этом шаге предоставляется сводка выбранных значений. Он предоставляет имя SQL Server, имя базы данных, имя таблицы, схему таблицы и сведения о внешней таблице. На этом шаге можно создать скрипт или создать таблицу. **Создать скрипт** — создание скрипта в T-SQL для создания внешнего источника данных. **Создать таблицу** — создание внешнего источника данных.

![Экран сводки](media/data-virtualization/150-csv-virtualize-data-summary.png)

После нажатия кнопки **Создать таблицу** SQL Server создаст внешнюю таблицу в целевой базе данных.

Если щелкнуть **Создать скрипт**, Azure Data Studio создаст запрос T-SQL для создания внешней таблицы.

После создания таблицу можно запрашивать напрямую с помощью T-SQL из экземпляра SQL Server.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о кластерах больших данных SQL Server и связанных сценариях см. в [этой статье](big-data-cluster-overview.md).
