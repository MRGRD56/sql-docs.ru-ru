---
title: Непривилегированные контейнеры кластеров больших данных
titleSuffix: SQL Server big data clusters
description: В этой статье описывается развертывание непривилегированных контейнеров в кластерах больших данных SQL Server.
author: mihaelablendea
ms.author: mihaelab
ms.reviewer: mikeray
ms.date: 06/22/2020
ms.topic: conceptual
ms.prod: sql
ms.technology: big-data-cluster
ms.openlocfilehash: e74e08146ea4c92f23ba17816738122147150e7b
ms.sourcegitcommit: ae474d21db4f724523e419622ce79f611e956a22
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/20/2020
ms.locfileid: "92257124"
---
# <a name="non-root-big-data-clusters-containers"></a>Непривилегированные контейнеры кластеров больших данных

В SQL Server 2019 с накопительным пакетом обновления (CU5) появилась поддержка непривилегированных контейнеров. Благодаря тому, что все приложения-контейнеры запускаются по умолчанию в кластерах больших данных на всех поддерживаемых платформах от имени непривилегированных пользователей, повышается безопасность реализации. Эта возможность доступна для всех новых развертываний, использующих тег образа, соответствующий SQL Server 2019 CU5. На существующие развертывания кластеров больших данных версий более ранних, чем CU5, это изменение не влияет. Приложения в таких кластерах будут по-прежнему выполняться от имени привилегированного пользователя. 

## <a name="technical-background"></a>Базовые технические сведения

Ознакомьтесь с [этим техническим документом](https://aka.ms/sql-bdc-openshift-security), в котором представлены сведения о проектировании системы безопасности при выполнении развертываний с непривилегированными пользователями. В нем также раскрывается, почему в некоторых случаях кластеры больших данных временно повышают уровень разрешений. Этот технический документ был создан в сотрудничестве с экспертами по безопасности из команд разработчиков SQL Server и Red Hat. Основное внимание в нем уделяется контекстам безопасности и возможностям OpenShift, но основные принципы безопасности кластеров больших данных применимы ко всем поддерживаемым платформам.

> [!NOTE]
> На момент выпуска CU5 установка приложений, развертываемых с помощью интерфейсов [развертывания приложений](concept-application-deployment.md), по-прежнему производилась от имени *привилегированного* пользователя. Это обусловлено тем, что во время установки также устанавливаются дополнительные пакеты, используемые приложением. Другой пользовательский код, развертываемый в составе приложения, выполняется от имени пользователя с низким уровнем привилегий. 

> [!NOTE]
> Рекомендуется использовать способ запуска кластера по умолчанию, то есть от имени непривилегированного пользователя. Чтобы восстановить прежнее поведение (принятое до выпуска CU5) и запускать контейнеры в кластерах больших данных от имени пользователя `root`, можно отключить поведение по умолчанию с помощью нового переключателя функций `allowRunAsRoot`. Это можно сделать только во время развертывания. Чтобы настроить поведение, укажите параметр в разделе `security` в файле конфигурации развертывания `control.json`:

```json
 "security": {
  …
    "allowRunAsRoot": true,
  …
}
```

> [!IMPORTANT]
> Изменение этого параметра в средах OpenShift не поддерживается.

В результате того, что службы в кластерах больших данных запускаются от имени непривилегированных пользователей, в учетных данных, используемых для подключения к службам через конечную точку шлюза, не используется имя пользователя `root`. Если приложение, применяемое для подключения к конечной точке шлюза, использует неверные учетные данные, выводится ошибка проверки подлинности. Новое имя пользователя для конечной точки шлюза основано на значении, передаваемом через переменную среды `AZDATA_USERNAME`. Это то же имя пользователя, которое используется для контроллера и конечных точек SQL Server. Это изменение влияет только на новые развертывания. Существующие кластеры больших данных предыдущих выпусков по-прежнему используют `root`. При развертывании кластера, использующего проверку подлинности на основе Active Directory, учетные данные остаются прежними. 

## <a name="use-the-latest-azure-data-studio"></a>Использование последней версии Azure Data Studio

Azure Data Studio автоматически обрабатывает изменение учетных данных для подключения через шлюз, чтобы обеспечить возможность просмотра системы HDFS в обозревателе объектов или отправку заданий Spark через записные книжки. Установите [последнюю сборку Azure Data Studio для участников программы предварительной оценки](../azure-data-studio/download-azure-data-studio.md#download-insiders-build-of-azure-data-studio). Она включает в себя необходимые изменения для этого варианта использования.

Для других сценариев, в которых необходимо предоставлять учетные данные для доступа к службе через шлюз (например, для входа с помощью [!INCLUDE [azure-data-cli-azdata](../includes/azure-data-cli-azdata.md)] и доступа к веб-панелям мониторинга Spark), используйте правильные учетные данные. В существующем кластере, развернутом до выпуска CU5, вы продолжите использовать имя пользователя `root` для подключения к шлюзу даже после обновления кластера до CU5. При развертывании нового кластера с использованием сборки CU5 для входа необходимо предоставить имя пользователя, соответствующее переменной среды `AZDATA_USERNAME`.

## <a name="configuration-file-switches"></a>Параметры файла конфигурации

Начиная с выпуска CU5 были добавлены два новых параметра для управления сбором метрик модулей pod и узлов. Если вы используете различные решения для мониторинга инфраструктуры Kubernetes, вы можете отключить встроенный сбор метрик для модулей pod и узлов, присвоив параметрам `allowNodeMetricsCollection` и `allowPodMetricsCollection`* значения `false` в файле конфигурации развертывания `control.json`. 

Например. 

```json
"security": {
  ...
  "allowPodMetricsCollection": true,
  "allowNodeMetricsCollection": true,
  ...
}
```

> [!NOTE]
> Для сред OpenShift для этих параметров по умолчанию задано значение false во встроенных профилях развертывания. Сбор метрик для модулей pod и узлов требовал привилегированных возможностей, а рекомендуемый контекст безопасности для OpenShift основан на *ограниченных возможностях*.

Начиная с выпуска накопительного пакета обновления 5 (CU5) для всех новых развертываний кластеров больших данных, помимо непривилегированных, контейнеры работают как пользователи, не являющиеся корневыми по умолчанию на всех поддерживаемых платформах. Эта возможность доступна для всех новых развертываний, использующих тег образа, соответствующий SQL Server 2019 CU5. На существующие развертывания кластеров больших данных версий более ранних, чем CU5, это изменение не влияет. Приложения в таких кластерах будут по-прежнему выполняться от имени привилегированного пользователя.

## <a name="next-steps"></a>Дальнейшие действия
[Развертывание [!INCLUDE[big-data-clusters-2019](../includes/ssbigdataclusters-ss-nover.md)] в Kubernetes](deployment-guidance.md)

[Развертывание [!INCLUDE[big-data-clusters-2019](../includes/ssbigdataclusters-ss-nover.md)] в OpenShift](deploy-openshift.md)

[Технический документ по обеспечению безопасности](https://aka.ms/sql-bdc-openshift-security)
