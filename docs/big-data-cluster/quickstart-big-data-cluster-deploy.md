---
title: Развертывание с помощью скрипта Python
titleSuffix: SQL Server Big Data Clusters
description: Узнайте, как развертывать кластеры больших данных SQL Server (предварительная версия) в Службе Azure Kubernetes (AKS) с помощью скрипта развертывания.
author: MikeRayMSFT
ms.author: mikeray
ms.reviewer: mihaelab
ms.date: 06/22/2020
ms.topic: conceptual
ms.prod: sql
ms.technology: big-data-cluster
ms.openlocfilehash: d547dc374de8171097ceda77afb234d4e5dfa451
ms.sourcegitcommit: 7345e4f05d6c06e1bcd73747a4a47873b3f3251f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/24/2020
ms.locfileid: "88772393"
---
# <a name="use-a-python-script-to-deploy-a-sql-server-big-data-cluster-on-azure-kubernetes-service-aks"></a>Развертывание кластера больших данных SQL Server в Службе Azure Kubernetes (AKS) с помощью скрипта Python

[!INCLUDE[SQL Server 2019](../includes/applies-to-version/sqlserver2019.md)]

В этом руководстве используется пример скрипта Python для развертывания [!INCLUDE[big-data-clusters-2019](../includes/ssbigdataclusters-ver15.md)] в службе Azure Kubernetes (AKS).

> [!TIP]
> AKS — это единственный вариант размещения Kubernetes для кластера больших данных. Сведения о других вариантах развертывания и настройке параметров развертывания см. в статье [Развертывание [!INCLUDE[big-data-clusters-2019](../includes/ssbigdataclusters-ss-nover.md)] в Kubernetes](deployment-guidance.md).

Используемое здесь развертывание кластера больших данных по умолчанию состоит из главного экземпляра SQL, одного экземпляра пула вычислительных ресурсов, двух экземпляров пула данных и двух экземпляров пула носителей. Данные сохраняются с помощью постоянных томов Kubernetes, использующих классы хранения AKS по умолчанию. Конфигурация по умолчанию, применяемая в этом руководстве, подходит для сред разработки и тестирования.

## <a name="prerequisites"></a>Предварительные требования

- Подписка Azure.
- [Средства работы с большими данными](deploy-big-data-tools.md):
   - **azdata**
   - **kubectl**
   - **Azure Data Studio**
   - **Расширение SQL Server 2019**
   - **Azure CLI**

## <a name="log-in-to-your-azure-account"></a>Вход в учетную запись Azure

Скрипт использует Azure CLI для автоматизации создания кластера AKS. Перед выполнением скрипта необходимо по крайней мере один раз войти в учетную запись Azure с помощью Azure CLI. В командной строке выполните следующую команду:

```
az login
```

## <a name="download-the-deployment-script"></a>Скачивание скрипта развертывания

В этом руководстве рассматривается автоматизация создания кластера больших данных в AKS с помощью скрипта Python **deploy-sql-big-data-aks.py**. Если вы уже установили Python для **azdata**, вы сможете успешно запустить скрипт, который приводится в этом руководстве. 

В командной строке PowerShell в Windows или Bash в Linux выполните следующую команду, чтобы скачать скрипт развертывания из GitHub:

```
curl -o deploy-sql-big-data-aks.py "https://raw.githubusercontent.com/Microsoft/sql-server-samples/master/samples/features/sql-big-data-cluster/deployment/aks/deploy-sql-big-data-aks.py"
```

## <a name="run-the-deployment-script"></a>Выполнение скрипта развертывания

В командной строке PowerShell в Windows или Bash в Linux выполните следующие шаги, чтобы выполнить скрипт развертывания. Этот скрипт создаст службу AKS в Azure, а затем развернет кластер больших данных SQL Server 2019 в AKS. Можно также изменить [переменные среды](deployment-guidance.md#configfile) в скрипте, чтобы создать пользовательское развертывание.

1. Выполните скрипт с помощью следующей команды:

   ```
   python deploy-sql-big-data-aks.py
   ```

   > [!NOTE]
   > При наличии как python3, так и python2 по пути на клиентском компьютере команду необходимо выполнить с использованием python3: `python3 deploy-sql-big-data-aks.py`.

1. При появлении запроса введите указанные ниже сведения.

   | Значение | Описание |
   |---|---|
   | **Идентификатор подписки Azure** | Идентификатор подписки Azure, которую следует использовать для AKS. Чтобы получить список всех подписок и их идентификаторов, выполните команду `az account list` из другой командной строки. |
   | **Группа ресурсов Azure** | Имя группы ресурсов Azure, создаваемой для кластера AKS. |
   | **Регион Azure** | Регион Azure для нового кластера AKS (по умолчанию **westus**). |
   | **Размер машины** | [Размер машины](/azure/virtual-machines/windows/sizes), который следует использовать для узлов в кластере AKS (по умолчанию **Standard_L8s**). |
   | **Рабочие узлы** | Число рабочих узлов в кластере AKS (по умолчанию **1**). |
   | **Имя кластера** | Имя кластера AKS и кластера больших данных. Имя кластера больших данных должно содержать только строчные буквы и цифры без пробелов. (Имя по умолчанию — **sqlbigdata**.) |
   | **Пароль** | Пароль для контроллера, шлюза HDFS/Spark и главного экземпляра (по умолчанию **MySQLBigData2019**). |
   | **Имя пользователя** | Имя пользователя контроллера (по умолчанию **admin**). |

   > [!IMPORTANT]
   > Размер машины **Standard_L8s** по умолчанию может быть доступен не во всех регионах Azure. Если вы выбираете другой размер машины, имейте в виду, что общее количество дисков, которые можно подключить во всех узлах кластера, должно быть не меньше 24. Для каждого утверждения постоянного тома в кластере требуется подключенный диск. В настоящее время для кластера больших данных требуется 24 утверждения постоянных томов. Например, размер машины [Standard_L8s](/azure/virtual-machines/lsv2-series) поддерживает 32 подключенных диска, поэтому вы можете оценивать кластеры больших данных с одним узлом этого размера.

   > [!NOTE]
   > Учетная запись `sa` SQL Server отключена во время развертывания кластера больших данных. В основном экземпляре SQL Server подготавливается новая учетная запись sysadmin с именем пользователя, соответствующим введенному в поле **Имя пользователя** значению, и паролем, соответствующим значению, введенному в поле **Пароль**. Те же значения **Имя пользователя** и **Пароль** используются для подготовки пользователя с полномочиями администратора контроллера. В кластерах, развернутых до выпуска SQL Server 2019 с накопительным пакетом обновления 5 (CU5), единственный пользователь, поддерживаемый для шлюза (Knox), — **root**. При этом пароль такой же, как указано выше.
   >[!INCLUDE [big-data-cluster-root-user](../includes/big-data-cluster-root-user.md)]

1. Скрипт сначала создает кластер AKS, используя указанные параметры. Это может занять несколько минут.

## <a name="monitor-the-status"></a>Отслеживание состояния

После того как скрипт создаст кластер AKS, он задаст необходимые переменные среды с использованием ранее указанных параметров. Далее он вызовет **azdata** для развертывания кластера больших данных в AKS.

Состояние развертывания выводится в командном окне клиента. В процессе развертывания вы увидите ряд сообщений об ожидании pod контроллера.

```output
2018-11-15 15:42:02.0209 UTC | INFO | Waiting for controller pod to be up...
```

В течение 10–20 минут вы должны получить уведомление о том, что pod контроллера работает.

```output
2018-11-15 15:50:50.0300 UTC | INFO | Controller pod is running.
2018-11-15 15:50:50.0585 UTC | INFO | Controller Endpoint: https://111.111.111.111:30080
```

> [!IMPORTANT]
> Полное развертывание может занять много времени из-за временных затрат на скачивание образов контейнеров для компонентов кластера больших данных. Однако это не должно занять несколько часов. При возникновении проблем с развертыванием см. статью [Мониторинг и устранение неполадок [!INCLUDE[big-data-clusters-2019](../includes/ssbigdataclusters-ss-nover.md)]](cluster-troubleshooting-commands.md).

## <a name="inspect-the-cluster"></a>Проверка кластера

В любой момент во время развертывания можно использовать **kubectl** или **azdata** для проверки состояния и сведений о работающем кластере больших данных.

### <a name="use-kubectl"></a>Использование kubectl

Откройте новое командное окно, чтобы использовать **kubectl** в процессе развертывания.

1. Чтобы получить сводку состояния всего кластера, выполните следующую команду:

   ```
   kubectl get all -n <your-big-data-cluster-name>
   ```

   > [!TIP]
   > Если вы не изменили имя кластера больших данных, по умолчанию используется имя **sqlbigdata**.

1. Проверьте службы Kubernetes и их внутренние и внешние конечные точки с помощью следующей команды **kubectl**:

   ```
   kubectl get svc -n <your-big-data-cluster-name>
   ```

1. Вы также можете проверить состояние объектов pod Kubernetes с помощью следующей команды:

   ```
   kubectl get pods -n <your-big-data-cluster-name>
   ```

1. Чтобы получить дополнительные сведения об определенном объекте pod, выполните следующую команду:

   ```
   kubectl describe pod <pod name> -n <your-big-data-cluster-name>
   ```

> [!TIP]
> Дополнительные сведения об отслеживании и устранении неполадок развертывания см. в статье [Мониторинг и устранение неполадок [!INCLUDE[big-data-clusters-2019](../includes/ssbigdataclusters-ss-nover.md)]](cluster-troubleshooting-commands.md).

## <a name="connect-to-the-cluster"></a>Подключение к кластеру

После завершения работы скрипта развертывания выходные данные указывают на успешное выполнение.

```output
2018-11-15 16:10:25.0583 UTC | INFO | Cluster state: Ready
2018-11-15 16:10:25.0583 UTC | INFO | Cluster deployed successfully.
```

Кластер больших данных SQL Server теперь развернут в AKS. Вы можете подключиться к кластеру с помощью Azure Data Studio. Дополнительные сведения см. в статье [Подключение к кластеру больших данных SQL Server с помощью Azure Data Studio](connect-to-big-data-cluster.md).

## <a name="clean-up"></a>Очистка

Если вы тестируете [!INCLUDE[big-data-clusters-2019](../includes/ssbigdataclusters-ss-nover.md)] в Azure, по завершении следует удалить кластер AKS, чтобы избежать непредвиденных расходов. Не удаляйте кластер, если планируете продолжать использовать его.

> [!WARNING]
> Приведенные ниже инструкции служат для удаления кластера AKS, что также приводит к удалению кластера больших данных SQL Server. Если вы хотите сохранить какие-либо базы данных или данные HDFS, перед удалением кластера следует выполнить их резервное копирование.

Выполните следующую команду в Azure CLI, чтобы удалить кластер больших данных и службу AKS в Azure (замените `<resource group name>` на **имя группы ресурсов Azure**, указанное в скрипте развертывания):

```azurecli
az group delete -n <resource group name>
```

## <a name="next-steps"></a>Дальнейшие действия

Скрипт развертывания настроил Службу Azure Kubernetes, а также развернул кластер больших данных SQL Server 2019. Вы также можете настраивать будущие развертывания путем установки вручную. Дополнительные сведения о развертывании кластеров больших данных и настройке развертывания см. в статье [Развертывание [!INCLUDE[big-data-clusters-2019](../includes/ssbigdataclusters-ss-nover.md)] в Kubernetes](deployment-guidance.md).

Теперь, когда кластер больших данных SQL Server развернут, вы можете загрузить демонстрационные данные и изучить другие руководства:

> [!div class="nextstepaction"]
> [Руководство. Загрузка примера данных в кластер больших данных SQL Server 2019](tutorial-load-sample-data.md)