---
title: Развертывание HDFS или Spark с высоким уровнем доступности
titleSuffix: SQL Server Big Data Clusters
description: Сведения о развертывании кластеров больших данных SQL Server с высоким уровнем доступности.
author: mihaelablendea
ms.author: mihaelab
ms.reviewer: mikeray
ms.date: 01/07/2020
ms.topic: conceptual
ms.prod: sql
ms.technology: big-data-cluster
ms.openlocfilehash: 4d7d8bd2251a646b5c419b80b2067f8a25fa4d7c
ms.sourcegitcommit: 917df4ffd22e4a229af7dc481dcce3ebba0aa4d7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/10/2021
ms.locfileid: "100046944"
---
# <a name="deploy-hdfs-name-node-and-shared-spark-services-in-a-highly-available-configuration"></a>Развертывание узла имен HDFS и общих служб Spark в конфигурации с высоким уровнем доступности

[!INCLUDE[SQL Server 2019](../includes/applies-to-version/sqlserver2019.md)]

Помимо развертывания главного экземпляра SQL Server в конфигурации с высоким уровнем доступности с помощью групп доступности можно развернуть другие критически важные службы в кластере больших данных, чтобы обеспечить повышенный уровень надежности. Вы можете настроить `HDFS name node` и общие службы Spark, сгруппированные в `sparkhead`, с помощью дополнительной реплики. В этом случае `Zookeeper` также развертывается в кластере больших данных на сервере в качестве координатора кластера и хранилища метаданных для следующих служб: 

- узла имен HDFS;
- Livy и Yarn Resource Manager. 

Журнал Spark, журнал заданий и служба метаданных Hive — это службы без отслеживания состояния. Zookeeper не участвует в обеспечении работоспособности служб для этих компонентов. 

Развертывание нескольких реплик для этих служб обеспечивает повышенную масштабируемость, надежность и балансировку рабочих нагрузок между доступными репликами.

> [!NOTE]
> Следующие службы развертываются в виде контейнеров в pod `sparkhead`. 
> - Livy
> - Yarn Resource Manager
> - Журнал Spark
> - Журнал заданий
> - Служба метаданных Hive  
>

На следующем рисунке показано развертывание Spark с высоким уровнем доступности в кластере больших данных SQL Server.

:::image type="content" source="media/deployment-high-availability-hdfs-spark/spark-ha.png" alt-text="spark-ha-bdc":::

На следующем рисунке показано развертывание HDFS с высоким уровнем доступности в кластере больших данных SQL Server.

:::image type="content" source="media/deployment-high-availability-hdfs-spark/hdfs-ha.png" alt-text="hdfs-ha-bdc":::

## <a name="deploy"></a>Развертывание

Если узел имен или SparkHead настроены с двумя репликами, необходимо также настроить ресурс Zookeeper с тремя репликами. В конфигурации с высоким уровнем доступности для узла имен HDFS две реплики размещаются в двух pod. Это pod `nmnode-0` и pod `nmnode-1`. Это конфигурация "активный-пассивный". В каждый момент времени активен только один из узлов имен. Второй находится в режиме ожидания и становится активным в результате события отработки отказа. 

Чтобы начать настройку развертывания кластера больших данных, можно использовать встроенные профили конфигурации `aks-dev-test-ha` или `kubeadm-prod`. Эти профили включают необходимые для ресурсов параметры, которые можно дополнительно настроить для высокого уровня доступности. Например, ниже приведен раздел файла конфигурации `bdc.json`, который относится к развертыванию узла имен HDFS, Zookeeper и общих ресурсов Spark (`sparkhead`) с высоким уровнем доступности.  

```json
{
  ...
    "nmnode-0": {
        "spec": {
            "replicas": 2
        }
    },
    "sparkhead": {
        "spec": {
            "replicas": 2
        }
    },
    "zookeeper": {
        "spec": {
            "replicas": 3
        }
    },
  ...
}
```

В рабочем развертывании рекомендуется также задать значение 3 для репликации блоков HDFS. В профилях `aks-dev-test-ha` и `kubeadm-prod` этот параметр уже задан. См. ниже раздел из файла конфигурации `bdc.json`.

```json
{
  ...
  "hdfs": {
      "resources": [
          "nmnode-0",
          "zookeeper",
          "storage-0",
          "sparkhead"
      ],
      "settings": {
          "hdfs-site.dfs.replication": "3"
      }
  },
  ...
}
```

## <a name="known-limitations"></a>Известные ограничения

Ниже перечислены известные проблемы и ограничения, связанные с настройкой высокого уровня доступности для служб Hadoop в кластерах больших данных SQL Server.

- Все конфигурации должны быть заданы во время развертывания кластера больших данных. В выпуске SQL Server 2019 CU1 нельзя включить конфигурацию с высоким уровнем доступности после развертывания.

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения об использовании файлов конфигурации в развертываниях кластеров больших данных см. в статье [Развертывание [!INCLUDE[big-data-clusters-2019](../includes/ssbigdataclusters-ss-nover.md)] в Kubernetes](deployment-guidance.md#configfile).
- Дополнительные сведения о вариантах главного экземпляра SQL Server с высоким уровнем доступности в кластерах больших данных см. в разделе [Развертывание главного экземпляра SQL Server с высоким уровнем доступности](deployment-high-availability.md).
