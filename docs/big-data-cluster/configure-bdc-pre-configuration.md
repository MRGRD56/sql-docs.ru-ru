---
title: Настройка кластеров больших данных SQL Server до накопительного пакета обновления 9
titleSuffix: SQL Server big data clusters
description: Настройка кластеров больших данных до накопительного пакета обновления 9
author: MikeRayMSFT
ms.author: mikeray
ms.reviewer: rahul.ajmera
ms.date: 02/11/2021
ms.topic: reference
ms.prod: sql
ms.technology: big-data-cluster
ms.openlocfilehash: f2adf48a0aef465f4c013b5adaf97a75be4abf77
ms.sourcegitcommit: 765262cdc6352a5325148afc22fa4f1499fe1aa3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/09/2021
ms.locfileid: "102514871"
---
# <a name="configure-a-sql-server-big-data-cluster---pre-cu9-release"></a>Настройка кластера больших данных SQL Server до выпуска накопительного пакета обновления 9

[!INCLUDE[SQL Server 2019](../includes/applies-to-version/sqlserver2019.md)]

> [!NOTE]
> До выпуска накопительного пакета обновления 9 и появления кластеров с поддержкой конфигурации кластеры больших данных можно было настраивать только во время развертывания за исключением главного экземпляра SQL Server, который можно было настраивать после развертывания только с помощью mssql-conf. Инструкции по настройке накопительного пакета обновления 9 и более поздних версий для кластера больших данных см. [здесь](configure-bdc-overview.md).


В выпусках кластера больших данных с накопительным пакетом обновления 8 и более ранних версий параметры можно настроить во время развертывания с помощью файла `bdc.json`. Главный экземпляр SQL Server можно настроить после развертывания только с помощью mssql-conf.

## <a name="configuration-scopes"></a>Области конфигурации
Конфигурация кластеров больших данных до накопительного пакета обновления 9 включает два уровня: `service` и `resource`. Иерархия параметров также следует этому порядку — от высшего к низшему. Компоненты Кластеров больших данных принимают значение параметра, определенное на самом низком уровне. Если параметр не определен в заданной области, он наследует значение из более высокой родительской области.

Например, вы можете определить число ядер по умолчанию для использования драйвером Spark в ресурсах пула носителей и `Sparkhead`. Это можно сделать двумя способами.

* Задайте число ядер по умолчанию в области службы `Spark`. 
* Задайте число ядер по умолчанию в области ресурсов `storage-0` и `sparkhead`.

В первом сценарии все ресурсы низшей области службы Spark (пул носителей и `Sparkhead`) *наследуют* число ядер по умолчанию из значения службы Spark по умолчанию.

Во втором сценарии каждый ресурс будет использовать значение, определенное в соответствующей области.

Если число ядер по умолчанию настроено как в области службы, так и в области ресурсов, значение из области ресурсов будет переопределять значение из области службы, так как это самая низкая **настроенная пользователем** область для заданного параметра.

Конкретные сведения о конфигурации см. в соответствующих статьях:

## <a name="configure-the-sql-server-master-instance"></a>Настройка главного экземпляра SQL Server
Настройте главный экземпляр [!INCLUDE[big-data-clusters-2019](../includes/ssbigdataclusters-ss-nover.md)].

Нельзя настроить параметры конфигурации сервера для главного экземпляра SQL Server во время развертывания. В этой статье описывается временное решение для настройки таких параметров, как версия SQL Server, включение или отключение агента SQL Server, включение конкретных флагов трассировки или включение или отключение отзывов пользователей.

Чтобы изменить какие либо из этих параметров, выполните следующие действия.

1. Создайте пользовательский файл `mssql-custom.conf`, включающий нужные параметры. В следующем примере показано включение агента SQL, телеметрии, установка PID для выпуска Enterprise и включение флага трассировки 1204.

   ```
   [sqlagent]
   enabled=true
   
   [telemetry]
   customerfeedback=true
   userRequestedLocalAuditDirectory = /tmp/audit

   [DEFAULT]
   pid = Enterprise

   [traceflag]
   traceflag0 = 1204
   ```

1. Скопируйте файл `mssql-custom.conf` в каталог `/var/opt/mssql` в контейнере в `mssql-server` pod `master-0`. Замените `<namespaceName>` именем кластера больших данных.

   ```bash
   kubectl cp mssql-custom.conf master-0:/var/opt/mssql/mssql-custom.conf -c mssql-server -n <namespaceName>
   ```

1. Перезапустите экземпляр SQL Server.  Замените `<namespaceName>` именем кластера больших данных.

   ```bash
   kubectl exec -it master-0  -c mssql-server -n <namespaceName> -- /bin/bash
   supervisorctl restart mssql-server
   exit
   ```

> [!IMPORTANT]
> Если главный экземпляр SQL Server находится в конфигурации с группами доступности, скопируйте файл `mssql-custom.conf` во все pod `master`. Обратите внимание, что при каждом перезапуске будет происходить отработка отказа, поэтому необходимо убедиться, что это действие выполняется в период простоя.

### <a name="known-limitations"></a>Известные ограничения

- Для выполнения приведенных выше действий требуются разрешения администратора кластера Kubernetes.
- Невозможно изменить параметры сортировки сервера для главного экземпляра SQL Server кластера больших данных после развертывания.

## <a name="configure-apache-spark-and-apache-hadoop"></a>Настройка Apache Spark и Apache Hadoop
Чтобы настроить Apache Spark и Apache Hadoop в Кластерах больших данных, необходимо изменить профиль кластера во время развертывания.

Кластер больших данных имеет четыре категории конфигураций: 

- `sql` 
- `hdfs` 
- `spark` 
- `gateway` 

`sql`, `hdfs`, `spark`, `sql` являются службами. Каждая служба соответствует одноименной категории конфигураций. Все конфигурации шлюзов относятся к категории `gateway`. 

Например, все конфигурации в службе `hdfs` относятся к категории `hdfs`. Обратите внимание, что все конфигурации Hadoop (core-site), HDFS и Zookeeper относятся к категории `hdfs`; все конфигурации Livy, Spark, Yarn и Hive Metastore относятся к категории `spark`. 

В разделе [Поддерживаемые конфигурации](reference-config-spark-hadoop.md) перечислены свойства Apache Spark и Hadoop, которые можно настроить при развертывании кластера больших данных SQL Server.

В следующих разделах перечислены свойства, которые **невозможно** изменить в кластере.

- [Неподдерживаемые `spark`конфигурации](reference-config-spark-hadoop.md#unsupported-spark-configurations)
- [Неподдерживаемые `hdfs`конфигурации](reference-config-spark-hadoop.md#unsupported-hdfs-configurations)
- [Неподдерживаемые `gateway`конфигурации](reference-config-spark-hadoop.md#unsupported-gateway-configurations)

## <a name="next-steps"></a>Дальнейшие действия

[Настройка кластера больших данных SQL Server](configure-bdc-overview.md)