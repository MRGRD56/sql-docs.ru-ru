---
title: Создание кода для задач первичной обработки данных
titleSuffix: Azure Data Studio
description: В этой статье описывается применение ускорителя кода PROSE в составе Azure Data Studio для автоматического создания кода для общих задач первичной обработки данных.
author: dphansen
ms.author: davidph
ms.reviewer: mihaelab
ms.date: 12/06/2018
ms.topic: conceptual
ms.prod: sql
ms.technology: machine-learning-bdc
ms.openlocfilehash: 9768c406ca94cd16e8e9075bd5247434b8359d5c
ms.sourcegitcommit: c7f40918dc3ecdb0ed2ef5c237a3996cb4cd268d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/05/2020
ms.locfileid: "91725765"
---
# <a name="data-wrangling-using-prose-code-accelerator"></a>Первичная обработка данных с использованием ускорителя кода PROSE

[!INCLUDE[SQL Server 2019](../includes/applies-to-version/sqlserver2019.md)]

Ускоритель кода PROSE создает код Python для задач первичной обработки данных в доступном для чтения формате. Этот код можно без проблем добавлять к написанному вручную коду при работе с записной книжкой в Azure Data Studio. В этой статье приводятся общие сведения об использовании этого ускорителя кода.

 > [!NOTE]
 > Program Synthesis using Examples (или PROSE) — это технология Майкрософт, которая обеспечивает создание удобочитаемого кода на основе искусственного интеллекта. Для этого анализируется намерение пользователя, создается несколько потенциальных программ, после чего с применением алгоритмов ранжирования выбирается лучшая программа. Чтобы узнать больше о технологии PROSE, посетите [эту страницу](https://microsoft.github.io/prose/).

Этот ускоритель кода устанавливается в составе Azure Data Studio. Его можно импортировать в записную книжку так же, как и любой другой пакет Python. В соответствии с соглашением импорт осуществляется в формате CX.

```python
import prose.codeaccelerator as cx
```

В текущем выпуске этот ускоритель кода обеспечивает создание кода Python на основе искусственного интеллекта для решения следующих задач:

- Считывание файлов данных в кадр данных Pandas или Pyspark.
- Исправление типов данных в кадре данных.
- Поиск регулярных выражений, представляющих закономерности в списке строк.

Общие сведения о методах этого ускорителя кода см. в [документации](/python/api/overview/azure/prose/intro).

## <a name="reading-data-from-a-file-to-a-dataframe"></a>Считывание данных из файла в кадр данных

При считывании файлов в кадр данных часто осуществляется просмотр содержимого файла и определение параметров, которые будут передаваться в библиотеку загрузки данных. В зависимости от сложности файла для определения необходимых параметров может потребоваться несколько итераций.

Ускоритель кода PROSE позволяет решить эту проблему за счет анализа структуры файла данных и автоматического создания кода для загрузки файла. В большинстве случаев созданный код корректно анализирует данные. В некоторых случаях может потребоваться настройка кода в соответствии с конкретными потребностями.

Рассмотрим следующий пример:

 ```python
import prose.codeaccelerator as cx

# Call the ReadCsvBuilder builder to analyze the file content and generate code to load it
builder = cx.ReadCsvBuilder(r'C:/911.txt')

#Set target to pyspark if generating code to use pyspark library
#builder.Target = "pyspark"

#Get the code generated to fix the data types
builder.learn().code()
 ```

Предыдущий блок кода выводит следующий код Python для считывания файла с разделителями. Обратите внимание, что PROSE автоматически определяет количество строк, которые требуется пропустить, а также заголовки, символы кавычек, разделители и т. д.

 ```python
import pandas as pd

def read_file(file):
    names = ["lat",
             "lng",
             "desc",
             "zip",
             "title"]

    df = pd.read_csv(file,
        skiprows = 11,
        header = None,
        names = names,
        quotechar = "\"",
        delimiter = "|",
        index_col = False,
        dtype = str,
        na_values = [],
        keep_default_na = False,
        skipinitialspace = True)
    return df
 ```

Ускоритель может создать код для загрузки файлов с разделителями, файлов JSON и файлов фиксированной ширины в кадр данных. Для считывания файлов фиксированной ширины `ReadFwfBuilder` может использовать удобочитаемый файл схемы, анализ которого позволяет определить позиции столбцов. Дополнительные сведения см. в [документации](/python/api/overview/azure/prose/intro).

## <a name="fixing-data-types-in-a-dataframe"></a>Исправление типов данных в кадре данных

В кадре данных Pandas или Pyspark могут присутствовать неправильные типы данных. Это часто связано с наличием несоответствующих значений в столбце. В результате этого целые числа считываются с типом Float или String, а даты — в строковом представлении. Затраты времени на исправление типов данных вручную пропорциональны количеству столбцов.

В таких ситуациях можно использовать `DetectTypesBuilder`. Он анализирует данные и создает код для исправления типов данных вместо того, чтобы вносить исправления без подготовки. Этот код выступает в качестве отправной точки. При необходимости вы можете проверить его и внести изменения, либо использовать в исходном виде.

```python
import prose.codeaccelerator as cx

builder = cx.DetectTypesBuilder(df)

#Set target to pyspark if working with pyspark
#builder.Target = "pyspark"

#Get the code generated to fix the data types
builder.learn().code()
```

Дополнительные сведения см. в [документации](/python/api/overview/azure/prose/fixdatatypes).

## <a name="identifying-patterns-in-strings"></a>Выявление закономерностей в строках

Также нередко требуется выявить закономерности в столбце строк для проведения очистки или группировки. Например, это может потребоваться для столбца, который содержит даты в различных форматах. Чтобы стандартизировать значения, может потребоваться использовать условные инструкции на основе регулярных выражений.


|Строка|Имя                      |BirthDate      |
|--:|:-------------------------|:--------------|
| 0 |Bertram du Plessis        |1995           |
| 1 |Naiara Moravcikova        |Неизвестно        |
| 2 |Jihoo Spel                |2014           |
| 3 |Viachaslau Gordan Hilario |22-апр-67      |
| 4 |Maya de Villiers          |19-мар-60      |

В зависимости от объема и степени разнообразия данных написание регулярных выражений для различных закономерностей в столбце может потребовать много времени. `FindPatternsBuilder` предоставляет эффективный способ для решения описываемой проблемы за счет создания регулярных выражений для списка строк.

```python
import prose.codeaccelerator as cx

builder = cx.FindPatternsBuilder(df['BirthDate'])

#Set target to pyspark if working with pyspark
#builder.Target = "pyspark"

builder.learn().regexes
```

Ниже показаны регулярные выражения, созданные `FindPatternsBuilder` для приведенных выше данных.

```
^[0-9]{2}-[A-Z][a-z]+-[0-9]{2}$
^[0-9]{2}[\s][A-Z][a-z]+[\s][0-9]{4}$
^[0-9]{4}$
^Unknown$
```

Помимо создания регулярных выражений, `FindPatternsBuilder` также может создавать код для кластеризации значений на основе созданных регулярных выражений. Кроме того, может быть сделано утверждение о том, что все значения в столбце соответствуют созданным регулярным выражениям. Дополнительные сведения и другие практические сценарии см. в [документации](/python/api/overview/azure/prose/findpatterns).