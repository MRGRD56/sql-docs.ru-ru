---
title: Развертывание в режиме Active Directory — предварительные требования
titleSuffix: SQL Server Big Data Cluster
description: Настройка Active Directory для кластеров больших данных SQL Server
author: cloudmelon
ms.author: melqin
ms.reviewer: mikeray
ms.date: 09/30/2020
ms.topic: conceptual
ms.prod: sql
ms.technology: big-data-cluster
ms.openlocfilehash: 3424863924338a0d3f02102609052d6c159e1043
ms.sourcegitcommit: 917df4ffd22e4a229af7dc481dcce3ebba0aa4d7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/10/2021
ms.locfileid: "100048024"
---
# <a name="deploy-big-data-clusters-2019-in-active-directory-mode-prerequisites"></a>Развертывание [!INCLUDE[big-data-clusters-2019](../includes/ssbigdataclusters-ss-nover.md)] в режиме Active Directory: Предварительные требования

[!INCLUDE[SQL Server 2019](../includes/applies-to-version/sqlserver2019.md)]

Этот документ объясняет, как подготовить к развертыванию кластер больших данных SQL Server в режиме проверки подлинности Active Directory. Для проверки подлинности кластер использует существующий домен AD.

>[!Note]
>До выпуска накопительного пакета обновления 5 (CU5) для SQL Server 2019 существовало ограничение для кластеров больших данных, позволявшее развернуть в домене Active Directory только один кластер. После выхода накопительного пакета обновления 5 (CU5) это ограничение было устранено. Дополнительные сведения о новых возможностях см. в разделе [Концепция: развертывание [!INCLUDE[big-data-clusters-2019](../includes/ssbigdataclusters-ss-nover.md)] в режиме Active Directory](active-directory-deployment-background.md). Примеры в этой статье скорректированы в соответствии с обоими вариантами использования развертывания.

## <a name="background"></a>Историческая справка

Чтобы включить проверку подлинности Active Directory (AD), кластер больших данных автоматически создает пользователей, группы, учетные записи компьютеров и имена субъектов-служб (SPN), необходимые различным службам кластера. Чтобы обеспечить некоторую автономность этих учетных записей и предоставить разрешения на определение областей, мы рекомендуем создать подразделение перед развертыванием кластера. Все объекты AD, связанные с BDC, будут созданы во время развертывания. 

## <a name="pre-requisites"></a>Предварительные требования

### <a name="organizational-unit-ou"></a>Подразделение
Подразделение — это подраздел в Active Directory, который включает пользователей, группы и даже другие подразделения. В целом, подразделения можно использовать для воссоздания функциональной структуры или бизнес-структуры организации. В качестве примера для этой статьи мы создадим подразделение с именем `bdc`. 

>[!NOTE]
>Подразделение обозначает границы администрирования и позволяет клиентам управлять областью полномочий администраторов данных. 

Чтобы выбрать оптимальную структуру для работы с подразделениями в организации, можете руководствоваться [этими принципами проектирования подразделений](/windows-server/identity/ad-ds/plan/reviewing-ou-design-concepts).

### <a name="ad-account-for-bdc-domain-service-account"></a>Учетная запись AD для учетной записи службы домена BDC

Чтобы обеспечить автоматическое создание всех необходимых объектов в AD, для BDC требуется учетная запись AD с определенными разрешениями на создание пользователей, групп и учетных записей компьютеров в предоставленном подразделении. В этой статье показано, как настроить разрешение для этой учетной записи AD. В качестве примера для этой статьи мы используем вызов учетной записи AD `bdcDSA`.

### <a name="auto-generated-active-directory-objects"></a>Автоматически созданные объекты Active Directory
При развертывании BDC автоматически создаются имена учетных записей и групп. Каждая из учетных записей представляет собой службу в BDC, которой управляет кластер BDC в течение своего времени существования. У таких учетных записей есть имена субъектов-служб (SPN), требуемые для каждой службы.  Полный список автоматически создаваемых учетных записей, групп и служб в AD см. в статье [Автоматически созданные объекты Active Directory](active-directory-objects.md).

>[!IMPORTANT]
>В зависимости от политики истечения срока действия паролей, заданной на контроллере домена, срок действия паролей для этих учетных записей может истечь. Политика истечения срока действия по умолчанию — 42 дня. Не существует механизма для смены учетных данных для всех учетных записей в BDC, поэтому кластер станет неработоспособным по истечении этого срока действия. Чтобы избежать этой проблемы, обновите политику срока действия учетных записей служб BDC, вследствие чего на контроллере домена не будет задан срок действия пароля. Это действие можно выполнить до или после истечения срока действия. В последнем случае Active Directory повторно активирует пароли с истекшим сроком действия.
>
>На рисунке ниже показано, где задать это свойство в ветке "Пользователи и компьютеры" Active Directory.
>
>:::image type="content" source="media/deploy-active-directory/image25.png" alt-text="Настройка политики срока действия паролей":::

В описанных ниже действиях предполагается, что у вас уже есть контроллер домена Active Directory. Если у вас нет контроллера домена, полезные пошаговые инструкции содержатся в следующем [руководстве](https://social.technet.microsoft.com/wiki/contents/articles/37528.create-and-configure-active-directory-domain-controller-in-azure-windows-server.aspx).

## <a name="create-ad-objects"></a>Создание объектов AD

Перед развертыванием BDC с интеграцией AD выполните следующие действия.

1. Создайте подразделение, в котором будут храниться все объекты AD, связанные с BDC. Кроме того, при развертывании можно назначить существующее подразделение.
1. Создайте новую учетную запись AD для BDC или используйте существующую и предоставьте этой учетной записи AD для кластера больших данных требуемые разрешения в пределах указанного подразделения.

### <a name="create-a-user-in-ad-for-bdc-domain-service-account"></a>Создание пользователя в AD для учетной записи службы домена кластера больших данных

Для кластера больших данных требуется учетная запись с конкретными разрешениями. Прежде чем продолжать, убедитесь, что у вас есть учетная запись AD, или создайте новую учетную запись, которую кластер больших данных может использовать для настройки необходимых объектов.

Чтобы создать нового пользователя в AD, можно щелкнуть правой кнопкой мыши домен или подразделение и выбрать **Новый** > **пользователь**:

![Диалоговое окно пользователей в Active Directory](./media/deploy-active-directory/image12.png)

В этой статье мы будем называть этого пользователя *учетной записью службы домена кластера больших данных*.

### <a name="create-an-ou"></a>Создание подразделения

На контроллере домена откройте **Пользователи и компьютеры Active Directory**. На левой панели щелкните правой кнопкой мыши каталог, в котором нужно создать подразделение, и выберите команду **Создать**  \> **Подразделение**, а затем следуйте указаниям мастера, чтобы создать подразделение. Кроме того, можно создать подразделение с помощью PowerShell:

```powershell
New-ADOrganizationalUnit -Name "<name>" -Path "<Distinguished name of the directory you wish to create the OU in>"
```

В примерах, приведенных в этой статье, для имени подразделения используется значение `bdc`.

![Подразделение Active Directory](./media/deploy-active-directory/image13.png)

![Новый объект — подразделение](./media/deploy-active-directory/image14.png)

### <a name="set-permissions-for-an-ad-account"></a>Задание разрешений для учетной записи AD

Независимо от того, создавали ли вы нового пользователя AD или использовали существующего, у него должны быть определенные разрешения. Это учетная запись пользователя, которую контроллер BDC будет использовать при присоединении кластера к AD.

Учетная запись службы домена BDC должна иметь возможность создавать пользователей, группы и учетные записи компьютеров в подразделении. В следующих шагах мы именуем учетную запись доменной службы BDC `bdcDSA`. Для этой учетной записи можно выбрать любое имя.

1. На контроллере домена откройте **Пользователи и компьютеры Active Directory**.

1. На панели слева перейдите к своему домену, а затем к подразделению, которое `bdc` будет использовать.

1. Щелкните подразделение правой кнопкой мыши и выберите пункт **Свойства**.

1. Перейдите на вкладку "Безопасность" (убедитесь, что выбран параметр **Дополнительные компоненты**, щелкнув правой кнопкой мыши подразделение и выбрав пункт **Вид**).

    ![Свойства объекта кластера больших данных](./media/deploy-active-directory/image15.png)

1. Щелкните **Добавить...** и добавьте пользователя **bdcDSA**

    ![Добавить свойства объекта кластера больших данных](./media/deploy-active-directory/image16.png)

    ![Выбрать объект](./media/deploy-active-directory/image17.png)

1. Выберите пользователя **bdcDSA** и снимите все разрешения, а затем нажмите **Дополнительно**

1. Нажмите кнопку **Добавить**

    ![Нажмите кнопку "Добавить"](./media/deploy-active-directory/image18.png)

    - Нажмите **Выбрать субъект-службу**, вставьте **bdcDSA** и нажмите кнопку ОК

    - В поле **Тип** задайте значение **Разрешить**.

    - В поле **Применяется к** задайте **Этот объект и все объекты-потомки**

        ![Задать разрешение для свойств](./media/deploy-active-directory/image19.png)

    - Прокрутите вниз и нажмите кнопку **Очистить все**

    - Снова прокрутите вверх и выберите:
       - **Чтение всех свойств**
       - **Запись всех свойств**
       - **Создание объектов "Компьютер"**
       - **Удаление объектов "Компьютер"**
       - **Создание объектов "Группа"**
       - **Удаление объектов "Группа"**
       - **Создание объектов "Пользователь"**
       - **Удаление пользовательских объектов**

    - Нажмите кнопку **ОК**.

- Нажмите кнопку **Добавить**

    - Нажмите **Выбрать субъект-службу**, вставьте **bdcDSA** и нажмите кнопку ОК

    - В поле **Тип** задайте значение **Разрешить**.

    - В поле **Применяется к** укажите **Объекты-потомки "Компьютер"**

    - Прокрутите вниз и нажмите кнопку **Очистить все**

    - Снова прокрутите вверх и выберите **Сбросить пароль**

    - Нажмите кнопку **ОК**.

- Нажмите кнопку **Добавить**

    - Нажмите **Выбрать субъект-службу**, вставьте **bdcDSA** и нажмите кнопку ОК

    - В поле **Тип** задайте значение **Разрешить**.

    - В поле **Применяется к** укажите **Объекты-потомки "Пользователь"**

    - Прокрутите вниз и нажмите кнопку **Очистить все**

    - Снова прокрутите вверх и выберите **Сбросить пароль**

    - Нажмите кнопку **ОК**.

- Еще два раза нажмите кнопку **ОК**, чтобы закрыть открытые диалоговые окна.

## <a name="next-steps"></a>Дальнейшие действия

[Развертывание [!INCLUDE[big-data-clusters-2019](../includes/ssbigdataclusters-ss-nover.md)] в режиме Active Directory](active-directory-deploy.md)

[Устранение неполадок при интеграции кластера больших данных SQL Server с Active Directory](troubleshoot-active-directory.md)

[Концепция: развертывание [!INCLUDE[big-data-clusters-2019](../includes/ssbigdataclusters-ss-nover.md)] в режиме Active Directory](active-directory-deployment-background.md)
