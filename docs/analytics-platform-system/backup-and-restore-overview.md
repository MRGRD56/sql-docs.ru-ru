---
title: Резервное копирование и восстановление
description: Описание работы резервного копирования и восстановления данных для параллельного хранилища данных (PDW). Операции резервного копирования и восстановления используются для аварийного восстановления. Резервное копирование и восстановление также можно использовать для копирования базы данных с одного устройства на другое.
author: mzaman1
ms.prod: sql
ms.technology: data-warehouse
ms.topic: conceptual
ms.date: 01/19/2019
ms.author: murshedz
ms.reviewer: martinle
ms.custom: seo-dt-2019
ms.openlocfilehash: 9dd52db9d34519f2b09cbaba880806c17509c84c
ms.sourcegitcommit: 3bd188e652102f3703812af53ba877cce94b44a9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/15/2020
ms.locfileid: "97489714"
---
# <a name="backup-and-restore"></a>Резервное копирование и восстановление

Описание работы резервного копирования и восстановления данных для параллельного хранилища данных (PDW). Операции резервного копирования и восстановления используются для аварийного восстановления. Резервное копирование и восстановление также можно использовать для копирования базы данных с одного устройства на другое.  
    
## <a name="backup-and-restore-basics"></a><a name="BackupRestoreBasics"></a>Основы резервного копирования и восстановления

*Резервная копия базы данных* PDW — это копия базы данных устройства, сохраненная в формате, чтобы ее можно было использовать для восстановления исходной базы данных на устройстве.  
  
Резервная копия базы данных PDW создается с помощью инструкции t-SQL [BACKUP DATABASE](../t-sql/statements/backup-transact-sql.md?view=aps-pdw-2016&preserve-view=true) и форматируется для использования с инструкцией [RESTORE DATABASE](../t-sql/statements/restore-statements-transact-sql.md?view=aps-pdw-2016&preserve-view=true) . она непригодна для других целей. Резервную копию можно восстановить только на устройство с тем же числом или большим числом вычислений.  
  
<!-- MISSING LINKS
The [master database](master-database.md) is a SMP SQL Server database. It is backed up with the BACKUP DATABASE statement. To restore master, use the [Restore the Master Database](configuration-manager-restore-master-database.md) page of the Configuration Manager tool.  
-->
  
PDW использует технологию резервного копирования SQL Server для резервного копирования и восстановления баз данных устройств. SQL Server параметры резервного копирования предварительно настроены для использования сжатия резервных копий. Невозможно задать параметры резервного копирования, такие как сжатие, контрольная сумма, размер блока и число буферов.  
  
Резервные копии баз данных хранятся на одном или нескольких резервных серверах, которые существуют в вашей клиентской сети.  PDW записывает резервную копию пользовательской базы данных в параллельном режиме непосредственно из вычислений на один резервный сервер и восстанавливает резервную копию пользовательской базы данных параллельно непосредственно с сервера резервного копирования на кластерные узлы.  
  
Резервные копии хранятся на сервере архивации в виде набора файлов в файловой системе Windows. Резервную копию базы данных PDW можно восстановить только в PDW. Однако резервные копии баз данных можно архивировать с сервера резервного копирования в другое расположение с помощью стандартных процессов резервного копирования файлов Windows. Дополнительные сведения о резервных серверах см. [в статье получение и Настройка резервного сервера](acquire-and-configure-backup-server.md).  
  
## <a name="database-backup-types"></a><a name="BackupTypes"></a>Типы резервных копий базы данных

Существует два типа данных, для которых требуется резервное копирование: пользовательские базы данных и системные базы данных (например, база данных master). PDW не выполняет резервное копирование журнала транзакций.  
  
Полная резервная копия базы данных — это резервная копия всей базы данных PDW. Это тип резервного копирования по умолчанию. Полная резервная копия пользовательской базы данных включает в себя пользователей базы данных и роли базы данных. Резервная копия главного сервера включает имена входа.  
  
Разностная резервная копия содержит все изменения с момента последнего полного резервного копирования. Разностная резервная копия обычно создается быстрее, чем полная, создавать такие копии можно чаще. Если несколько разностных резервных копий основаны на одной полной резервной копии, каждая разностная копия включает все изменения предыдущей разностной копии.  
  
Например, можно создать полную резервную копию еженедельно, а разностную резервную копию — ежедневно. Чтобы восстановить пользовательскую базу данных, необходимо восстановить полную резервную копию, а также последнюю разностную копию (если она существует).  
  
Разностная резервная копия поддерживается только для пользовательских баз данных. Резервная копия главной реплики всегда является полной резервной копией.  
  
Чтобы создать резервную копию всего устройства, необходимо выполнить резервное копирование всех пользовательских баз данных и резервной копии базы данных master.  
  
## <a name="database-backup-process"></a><a name="BackupProc"></a>Процесс резервного копирования базы данных

На следующей диаграмме показан поток данных во время резервного копирования базы данных.  
  
![Процесс резервного копирования PDW](media/backup-process.png "Процесс резервного копирования PDW")  
  
Процесс резервного копирования работает следующим образом.  
  
1.  Пользователь отправляет инструкцию TSQL базы данных BACKUP в управляющий узел.  
  
    -   Резервная копия может быть полной или разностной.  
  
2.  Для пользовательских баз данных управляющий узел (подсистема MPP) создает план распределенного запроса для выполнения параллельного резервного копирования базы данных.  
  
3.  Каждый узел, вовлеченный в резервную копию, копирует свой файл резервной копии на резервный сервер с помощью функции SQL Server резервного копирования.  
  
    -   Каждый узел участвует в копировании одного файла резервной копии на резервный сервер.  
  
    -   Резервная копия пользовательской базы данных (полная или разностная) включает резервную копию части базы данных, хранящейся на каждом кластерном узле, и резервную копию пользователей базы данных и ролей базы данных.  
  
4.  Устройство выполняет резервное копирование параллельно с помощью сети InfiniBand.  
  
    -   PDW выполняет каждую полную и разностную резервные копии параллельно. Однако несколько резервных копий базы данных не выполняются одновременно. Каждый запрос на резервное копирование должен ждать завершения ранее отправленных резервных копий.  
  
    -   Резервная копия базы данных master создает резервные копии только данных из управляющего узла. Этот тип резервного копирования выполняется последовательно.  
  
5.  Резервная копия базы данных PDW — это группа файлов, хранящихся в каталоге, который находится за пределами устройства. Имя каталога указывается в виде сетевого пути и имени каталога. Каталог не может быть локальным путем и не может быть на устройстве.  
  
6.  После завершения резервного копирования можно использовать файловую систему Windows для копирования каталога резервного копирования в другое расположение, если это необходимо.  
  
    -   Резервную копию можно восстановить только на устройство PDW, имеющее меньшее или большее количество вычислений.  
  
    -   Невозможно изменить имя резервной копии перед выполнением восстановления. Имя каталога резервного копирования должно совпадать с именем исходного имени резервной копии. Исходное имя резервной копии находится в файле backup.xml в каталоге резервного копирования. Чтобы восстановить базу данных с другим именем, можно указать новое имя в команде RESTORE. Например: `RESTORE DATABASE MyDB1 FROM DISK = ꞌ\\10.192.10.10\backups\MyDB2ꞌ`.  
  
## <a name="database-restore-modes"></a><a name="RestoreModes"></a>Режимы восстановления базы данных

При полном восстановлении базы данных выполняется повторное создание базы данных PDW с использованием данных из резервной копии базы данных. Восстановление базы данных выполняется при первом восстановлении полной резервной копии, а затем при необходимости восстановления одной разностной резервной копии. Восстановление базы данных включает в себя пользователей базы данных и роли базы данных.  
  
Восстановление только заголовка возвращает сведения о заголовке базы данных. Он не восстанавливает данные на устройстве.  
  
Восстановление устройства — это восстановление всего устройства. Сюда входит восстановление всех пользовательских баз данных и базы данных master.  
  
## <a name="restore-process"></a><a name="RestoreProc"></a>Процесс восстановления

На следующей диаграмме показан поток данных во время восстановления базы данных.  
  
![Процесс восстановления](media/restore-process.png "Процесс восстановления")  
  
## <a name="restoring-to-an-appliance-with-the-same-number-of-compute-nodes"></a>Восстановление на устройство с тем же числом вычислений на разных узлах * *  
  
При восстановлении данных устройство определяет количество Вычисленийных узлов на исходном устройстве и целевом устройстве. Если оба устройства имеют одинаковое число вычислений, процесс восстановления будет работать следующим образом:  
  
1.  Восстанавливаемая резервная копия базы данных доступна в общей папке Windows на сервере, не являющемся устройством резервного копирования. Для лучшей производительности этот сервер подключен к сети устройства InfiniBand.  
  
2.  Пользователь отправляет инструкцию инструкции TSQL [RESTORE DATABASE](../t-sql/statements/restore-statements-transact-sql.md?view=aps-pdw-2016&preserve-view=true) в управляющий узел.  
  
    -   Восстановление является полным восстановлением или восстановлением заголовка. При полном восстановлении восстанавливается полная резервная копия, а затем при необходимости восстанавливается разностная резервная копия.  
  
3.  Управляющий узел (подсистема MPP) создает план распределенного запроса для выполнения параллельного восстановления базы данных.  
  
    -   SQL Серверпдв выполняет восстановление пользовательской базы данных в параллельном режиме. Однако несколько резервных копий и восстановлений баз данных не выполняются одновременно. Обработчик MPP помещает каждую инструкцию RESTORE в очередь. Он должен ожидать завершения ранее отправленных запросов на резервное копирование и восстановление.  
  
    -   При восстановлении базы данных master данные восстанавливаются только в управляющий узел. восстановление выполняется последовательно.  
  
    -   Восстановление данных заголовка — это быстрая операция, которая не восстанавливает какие-либо данные на узлах вычислений или элементов управления. Вместо этого управляющий узел возвращает результаты в виде выходных данных запроса.  
  
4.  Файлы резервных копий копируются на правильные кластерные узлы параллельно, обычно через сеть устройства InfiniBand.  
  
5.  Каждый узел вычислений восстанавливает свою часть пользовательской базы данных. Если какое бы то ни было восстановление не завершится успешно, все базы данных удаляются, и восстановление завершается неудачно.  
  
## <a name="restoring-to-an-appliance-with-a-larger-number-of-compute-nodes"></a>Восстановление на устройство с большим количеством вычислительных узлов  
  
Восстановление резервной копии на устройство с большим числом вычислительных узлов приводит к увеличению размера базы данных пропорционально количеству вычислительных узлов.  
  
Например, при восстановлении базы данных 60 ГБ с 2-узлового устройства (30 ГБ на узел) на устройство с 6 узлами SQL Server PDW создает базу данных размером 180 ГБ (6 узлов с 30 ГБ на узел) на устройстве с 6 узлами. SQL Server PDW изначально восстанавливает базу данных на 2 узла в соответствии с конфигурацией источника, а затем распространяет данные на все 6 узлов.  
  
После повторного распространения каждый расчетный узел будет содержать меньше фактических данных и больше свободного места, чем каждый из вычислений на устройстве источника меньшего размера. Используйте дополнительное место для добавления дополнительных данных в базу данных. Если размер восстановленной базы данных больше, чем требуется, можно использовать [инструкцию ALTER DATABASE](../t-sql/statements/alter-database-transact-sql.md?tabs=sqlpdw) для сжатия размеров файлов базы данных.  
  
## <a name="related-tasks"></a>Связанные задачи  
  
|Задача резервного копирования и восстановления|Описание|  
|---------------------------|---------------|  
|Подготовьте сервер в качестве резервного сервера.|[Приобретение и настройка резервного сервера](acquire-and-configure-backup-server.md)|  
|Резервное копирование базы данных.|[BACKUP DATABASE](../t-sql/statements/backup-transact-sql.md?view=aps-pdw-2016&preserve-view=true)|  
|Восстановление базы данных.|[ВОССТАНОВЛЕНИЕ БАЗЫ ДАННЫХ](../t-sql/statements/restore-statements-transact-sql.md?view=aps-pdw-2016&preserve-view=true)|    

<!-- MISSING LINKS

|Create a disaster recovery plan.|[Create a Disaster Recovery Plan](create-disaster-recovery-plan.md)|
|Restore the master database.|To restore the master database, use the [Restore the master database](configuration-manager-restore-master-database.md) page in the Configuration Manager tool.| 
|Copy a database from one appliance to another appliance.|[Copy a PDW database to another appliance](copy-pdw-database-to-another-appliance.md).|  
|Monitor backups and restores.|[Monitor backups and restores](monitor-backup-and-restore.md)|  

-->
