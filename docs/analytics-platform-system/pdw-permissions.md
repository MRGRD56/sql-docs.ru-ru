---
title: Разрешения
description: В этой статье описываются требования и параметры для управления разрешениями базы данных для параллельного хранилища данных.
author: mzaman1
ms.prod: sql
ms.technology: data-warehouse
ms.topic: conceptual
ms.date: 04/17/2018
ms.author: murshedz
ms.reviewer: martinle
ms.custom: seo-dt-2019
ms.openlocfilehash: 499ac56d8a462f62dac92b97654a9ace12bd356e
ms.sourcegitcommit: ae474d21db4f724523e419622ce79f611e956a22
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/20/2020
ms.locfileid: "92257450"
---
# <a name="managing-permissions-in-parallel-data-warehouse"></a>Управление разрешениями в параллельном хранилище данных
В этой статье описаны требования и параметры для управления разрешениями базы данных для SQL Server PDW.

## <a name="database-engine-permission-basics"></a><a name="BackupRestoreBasics"></a>Основы разрешений ядро СУБД
Ядро СУБД разрешения на SQL Server PDW управляются на уровне сервера с помощью имен входа, а также на уровне базы данных с помощью пользователей базы данных и пользовательских ролей базы данных.

**Имена входа** Имена входа являются учетными записями отдельных пользователей для входа в SQL Server PDW. SQL Server PDW поддерживает имена входа с использованием проверки подлинности Windows и SQL Server проверки подлинности.  Имена входа для проверки подлинности Windows могут быть пользователями Windows или группами Windows из любого домена, который является доверенным для SQL Server PDW. SQL Server имена входа для проверки подлинности определяются и проходят проверку подлинности SQL Server PDW и должны быть созданы путем указания пароля.

Члены предопределенной роли сервера **sysadmin** (например, имя входа **SA** ) могут подключаться к базе данных без сопоставления с пользователем базы данных. Они сопоставлены с пользователем **dbo** . Владелец базы данных также сопоставлен как пользователь **dbo** .

**Роли сервера** Существует четыре специальные роли сервера с набором предварительно настроенных ролей, предоставляющих удобную группу разрешений уровня сервера. Роли сервера **sysadmin**, **MediumRC**, **LargeRC**и **ксларжеркфиксед** являются единственными серверными ролями, которые в настоящее время реализованы в SQL Server PDW. Имя входа **SA** является единственным членом предопределенной роли сервера **sysadmin** , и к роли **sysadmin** нельзя добавить дополнительные имена входа. Именам входа могут быть предоставлены разрешения **Control Server** , которые похожи, хотя и не идентичны, к предопределенной роли сервера **sysadmin** . Используйте [инструкцию ALTER Server Role](../t-sql/statements/alter-server-role-transact-sql.md) для добавления членов в другие роли сервера. SQL Server PDW не поддерживает определяемые пользователем роли сервера.

**Пользователи базы данных** Именам входа предоставляется доступ к базе данных путем создания пользователя базы данных в базе данных и сопоставления этого пользователя базы данных с именем входа. Как правило, имя пользователя базы данных совпадает с именем входа, хотя это и необязательно. Один пользователь базы данных сопоставляется с одним именем входа. Имя входа может быть сопоставлено только с одним пользователем в базе данных, однако может сопоставляться как пользователь базы данных в нескольких базах данных.

Предопределенные **роли базы данных** Предопределенные роли базы данных — это набор предварительно настроенных ролей, предоставляющих удобную группу разрешений уровня базы данных. Пользователи базы данных и пользовательские роли базы данных могут быть добавлены к предопределенным ролям базы данных с помощью процедуры [sp_addrolemember](../relational-databases/system-stored-procedures/sp-addrolemember-transact-sql.md) . Дополнительные сведения об предопределенных ролях базы данных см. в разделе Предопределенные [роли базы данных](#fixed-database-roles).

**Определяемые пользователем роли базы данных** Пользователи с разрешением **Создание роли** могут создавать новые пользовательские роли базы данных для представления групп пользователей с общими разрешениями. Обычно разрешения предоставляются или отклоняются для всей роли, что упрощает управление разрешениями и мониторинг.

Разрешения предоставляются субъектам безопасности (именам входа, пользователям и ролям) с помощью инструкции **Grant** . Разрешения явно отклоняются с помощью команды **Deny** . Ранее предоставленное или отклоненное разрешение удаляется с помощью инструкции **REVOKE** . Разрешения накапливаются, то есть пользователь получает все разрешения, предоставленные пользователю, имени входа и любой группе, членом которой он является. При этом отклонение разрешения отменяет все предоставленные ранее разрешения. <!-- MISSING LINKS (For information, syntax, and available permissions with these commands, see [Permissions: GRANT, DENY, REVOKE &#40;SQL Server PDW&#41;](../sqlpdw/permissions-grant-deny-revoke-sql-server-pdw.md)).  -->

В следующем примере представлен типичный и рекомендуемый способ настройки разрешений.

1.  При использовании проверки подлинности Windows создайте имя входа для каждого пользователя Windows или группы Windows, которые будут подключаться к SQL Server PDW. При использовании SQL Server проверки подлинности создайте имя входа для каждого пользователя, который будет подключаться к SQL Server PDW.

2.  Создайте пользователя базы данных для каждого имени входа во всех необходимых базах данных.

3.  Создайте одну или несколько определяемых пользователем ролей базы данных, каждая из которых представляет аналогичную функцию. Например, финансовый аналитик и аналитик продаж.

4.  Добавление пользователей базы данных в одну или несколько определяемых пользователем ролей базы данных.

5.  Предоставьте разрешения для определяемых пользователем ролей базы данных.

Имена входа являются объектами уровня сервера и могут быть перечислены в [sys.server_principals](../relational-databases/system-catalog-views/sys-server-principals-transact-sql.md). Участникам сервера могут быть предоставлены только разрешения уровня сервера.

Пользователи и роли базы данных являются объектами уровня базы данных и могут быть перечислены в [sys.database_principals](../relational-databases/system-catalog-views/sys-database-principals-transact-sql.md). Участникам базы данных могут быть предоставлены только разрешения уровня базы данных.

## <a name="default-permissions"></a><a name="BackupTypes"></a>Разрешения по умолчанию
Разрешения по умолчанию приведены в следующем списке:

-   При создании имени входа с помощью инструкции **CREATE LOGIN** имя входа получает разрешение **CONNECT SQL** , что позволяет имени входа подключаться к SQL Server PDW.

-   При создании пользователя базы данных с помощью инструкции **CREATE USER** пользователь получает разрешение **Connect on database::** _<database_name>_ , позволяя имени входа подключиться к этой базе данных в качестве пользователя.

-   Все субъекты, включая роль PUBLIC, по умолчанию не имеют явных или неявных разрешений, так как неявные разрешения наследуются от явных разрешений. Таким образом, если явные разрешения отсутствуют, также могут отсутствовать неявные разрешения.

-   Когда имя входа превращается в владельца объекта или базы данных, имя входа всегда имеет все разрешения на объект или базу данных. Разрешения владельца не отображаются как явные разрешения. Инструкции **Grant**, **REVOKE**и **Deny** не влияют на разрешения владения. Владение можно изменить с помощью инструкции [ALTER AUTHORIZATION](../t-sql/statements/alter-authorization-transact-sql.md) .

-   У имени входа sa есть все разрешения на устройстве. Как и разрешения владельца, разрешения sa не могут быть изменены и не отображаются как явные разрешения. Инструкции **Grant**, **REVOKE**и **Deny** не влияют на разрешения SA.

-   Роль PUBLIC Server не получает разрешений по умолчанию и не наследует разрешения от других ролей сервера. Роли PUBLIC Server можно предоставить явные разрешения с помощью инструкций **Grant**, **REVOKE**и **Deny** .

-   Транзакции не нуждаются в разрешениях. Все участники могут выполнять команды **BEGIN TRANSACTION**, **commit**и **ROLLBACK** Transaction. Однако участник должен иметь соответствующие разрешения для выполнения каждой инструкции внутри транзакции.

-   Для использования инструкции **USE** не требуются разрешения. Все участники могут выполнять инструкцию **use** для любой базы данных, однако для доступа к базе данных они должны иметь участника-пользователя в базе данных, или гостевой пользователь должен быть включен.

### <a name="the-public-role"></a>ОТКРЫТАЯ роль
Все новые имена входа устройств автоматически принадлежат роли PUBLIC. Роль общедоступного сервера имеет следующие характеристики.

-   По умолчанию роль PUBLIC Server не имеет разрешений.

-   Все участники являются членами роли сервера PUBLIC, а роль PUBLIC Server не является членом другой роли сервера.

-   Роль общедоступного сервера не может наследовать неявные разрешения. Все разрешения, предоставленные роли PUBLIC, должны быть явно предоставлены.

## <a name="determining-permissions"></a><a name="BackupProc"></a>Определение разрешений
Наличие у имени входа разрешения на выполнение определенного действия зависит от разрешений, предоставленных или запрещенных для входа, пользователя и ролей, членом которых является пользователь. Разрешения уровня сервера (такие как **Создание имени входа** и **Просмотр состояния сервера**) доступны участникам уровня сервера (имена входа). Разрешения уровня базы данных (например, **SELECT** из таблицы или **выполнения** в процедуре) доступны для участников уровня базы данных (пользователи и роли базы данных).

### <a name="implicit-and-explicit-permissions"></a>Явные и неявные разрешения
*Явное разрешение* — это разрешение **GRANT** или **DENY**, предоставляемое субъекту с помощью инструкции **GRANT** или **DENY**. Разрешения уровня базы данных перечислены в представлении [sys.database_permissions](../relational-databases/system-catalog-views/sys-database-permissions-transact-sql.md) . Разрешения уровня сервера перечислены в представлении [sys.server_permissions](../relational-databases/system-catalog-views/sys-server-permissions-transact-sql.md) .

*Неявное разрешение* — это разрешение **Grant** или **Deny** , унаследованное участником (имя входа или роль сервера). Разрешение можно наследовать следующими способами.

-   Участник может наследовать разрешение от роли, если участник является членом роли, даже если участник не имеет явного разрешения **Grant** или **Deny** .

-   Участник может наследовать разрешение на подчиненный объект (например, таблицу), если у участника есть разрешение на одну из родительских областей объектов (например, схема таблицы или разрешение для всей базы данных).

-   Участник может наследовать разрешение, имея разрешение, включающее подчиненное разрешение. Например, разрешение **ALTER ANY USER** включает в себя и параметр **создать пользователя** , и **инструкцию ALTER ON User::** _<name>_ Permissions.

### <a name="determining-permissions-when-performing-actions"></a>Определение разрешений при выполнении действий
Процесс определения разрешения, назначаемого участнику, является сложным. Сложность возникает при определении неявных разрешений, поскольку участники могут быть членами нескольких ролей, а разрешения можно передавать через несколько уровней в иерархии ролей.

В следующем списке описаны общие правила определения разрешений.

-   Владение подразумевает разрешение.

    Владелец объекта имеет все разрешения на объект. Аналогично, владелец базы данных имеет все разрешения на базу данных и все разрешения на объекты в базе данных. Эти разрешения нельзя изменить.

-   Разрешения могут наследоваться на нескольких уровнях иерархии членства в ролях сервера.

    Например, предположим, что у вас есть следующая ситуация:

    -   Имя входа Дэвид является членом роли базы данных Перфаналистс.

    -   Перфаналистс является членом рабочей роли базы данных.

    -   Дэвид и Перфаналистс не имеют разрешения **SELECT** на таблицу Customer. Разрешение было либо отозвано, либо никогда не было предоставлено явным образом.

    -   Рабочая среда имеет разрешение **SELECT** на таблицу Заказчик.

    В этом случае Перфаналистс будет наследовать разрешение **Grant** на таблицу Customer из рабочей среды, и Дэвид наследует разрешение **Grant** на таблицу Customer из рабочей среды.

-   **Deny** Overrides **Grant** , если разрешения конфликтуют.

    Например, предположим, что имя входа Дэвид не имеет разрешений на таблицу Customer и является членом двух ролей базы данных — dbgroup1, у которых есть разрешение **Deny** на таблицу Customer, и dbgroup2, которая имеет разрешение **Grant** на таблицу Customer. В этом случае Дэвид будет наследовать разрешение **Deny** на таблицу Customer. В этом случае роли получают разрешения явным образом или неявно.

### <a name="auditing-permissions"></a>Разрешения аудита
Чтобы изучить разрешения пользователя, проверьте следующее.

-   Выполните следующий запрос, чтобы определить, какие имена входа являются системными администраторами.

    ```sql
    SELECT SPLogins.name, 'is a member of ', SPRoles.name 
    FROM sys.server_role_members AS SRM 
    JOIN sys.server_principals AS SPRoles 
        ON SRM.role_principal_id = SPRoles.principal_id 
    JOIN sys.server_principals AS SPLogins 
        ON SRM.member_principal_id = SPLogins.principal_id;
    ```

-   Выполните следующий запрос, чтобы определить, какие имена входа предоставили явные разрешения.

    ```sql
    SELECT name, 'has the ', state_desc , permission_name, ' permission'
    FROM sys.server_permissions AS SP
    JOIN sys.server_principals AS SPRoles 
        ON SP.grantee_principal_id = SPRoles.principal_id;
    ```

-   Выполните следующий запрос в пользовательской базе данных, чтобы определить, какие пользователи базы данных являются членами роли базы данных.

    ```sql
    SELECT DPUsers.name, 'is a member of ', DPRoles.name  
    FROM sys.database_role_members AS DRM
    JOIN sys.database_principals AS DPRoles 
        ON DRM.role_principal_id = DPRoles.principal_id
    JOIN sys.database_principals AS DPUsers
        ON DRM.member_principal_id = DPUsers.principal_id;
    ```

-   Выполните следующий запрос в пользовательской базе данных, чтобы определить, какие пользователи и роли базы данных были предоставлены или отклонили определенные разрешения. Вам потребуется запросить дополнительные представления, такие как sys. objects и sys. schemas, чтобы найти элементы, описанные в major_id.

    ```sql
    SELECT DPUsers.name, 'has the ', permission_name, 
    'permission on the item described as class = ', class, 'id = ', major_id
    FROM sys.database_permissions AS DP
    JOIN sys.database_principals AS DPUsers
        ON DP.grantee_principal_id = DPUsers.principal_id;
    ```

## <a name="database-permissions-best-practices"></a><a name="RestoreProc"></a>Рекомендации по разрешениям базы данных

-   Предоставьте разрешения на наиболее детализированном уровне. Предоставление разрешений на уровне таблицы или представления может стать неуправляемым. Но предоставление разрешений на уровне базы данных может быть слишком строгим. Если база данных разработана с использованием схем для определения границ работы, то, возможно, предоставление схемы разрешений является адекватным компромиссом между уровнем таблицы и уровнем базы данных.

-   Предоставьте разрешения ролям, а не пользователям или именам входа. Управление правами с помощью ролей, а не пользователей упрощает быстрый предоставление или отзыв набора разрешений для пользователя или имени входа путем перемещения их в роль или из нее. Когда функция передается от одного человека другому, разрешения могут оставаться нетронутыми на уровне роли при изменении членства в роли.

-   Предоставьте разрешения ролям на основе должностных обязанностей и ролей групп более высокого уровня, которые объединяют роли функции задания на основе группы компании, выполняющей действия.

-   У каждого конечного пользователя должно быть уникальное имя входа. Не разрешайте пользователям предоставлять общий доступ к именам входа. Предоставление имени входа для каждого пользователя обеспечивает журнал аудита и упрощает управление разрешениями.

## <a name="fixed-database-roles"></a>Предопределенные роли базы данных
SQL Server предоставляет предварительно настроенные (фиксированные) роли уровня базы данных, которые позволяют управлять разрешениями на сервере. Предварительно настроенные роли фиксируются в том, что нельзя изменить назначенные им разрешения. Также можно создавать пользовательские роли базы данных. Можно изменить разрешения, назначенные определяемым пользователем ролям базы данных.

Роли — это субъекты безопасности, которые группируют другие участники. Роли базы данных находятся в области разрешений на уровне базы данных. Пользователи базы данных и другие роли базы данных могут быть добавлены как члены ролей базы данных. Предопределенные роли базы данных не могут быть добавлены друг к другу. (*Роли* похожи на *группы* в операционной системе Windows.)

Существует 9 предопределенных ролей базы данных.

-   **db_owner**

-   **db_securityadmin**

-   **db_accessadmin**

-   **db_backupoperator**

-   **db_ddladmin**

-   **db_datawriter**

-   **db_datareader**

-   **db_denydatawriter**

-   **db_denydatareader**

### <a name="permissions-of-the-fixed-database-roles"></a>Разрешения предопределенных ролей базы данных
Система предопределенных ролей сервера и предопределенных ролей базы данных — это устаревшая система, созданная в 1980. Фиксированные роли по-прежнему поддерживаются и полезны в средах с небольшими пользователями и требованиями безопасности. Начиная с SQL Server 2005, была создана более детальная система предоставления разрешений. Эта новая система более детализирована, предоставляя множество дополнительных параметров для предоставления и запрета разрешений. Дополнительная сложность более детализированной системы затрудняет изучение, но большинство корпоративных систем должны предоставлять разрешения вместо использования предопределенных ролей. <!-- MISSING LINKS The permissions are discussed and listed in the topic [Permissions: GRANT, DENY, REVOKE &#40;SQL Server PDW&#41;](../sqlpdw/permissions-grant-deny-revoke-sql-server-pdw.md). -->На следующей диаграмме показаны разрешения, связанные с каждой предопределенной ролью базы данных. Все разрешения в этом SQL Server рисунке недоступны (или необходимы) в ТД.

![Фиксированные роли безопасности для базы данных](./media/pdw-permissions/APS_security_fixed_db_roles.png "APS_security_fixed_db_roles")

### <a name="related-content"></a>См. также

-   Сведения о создании определяемых пользователем ролей см. в разделе [Создание роли](../t-sql/statements/create-role-transact-sql.md).


## <a name="fixed-server-roles"></a>Предопределенные роли сервера
Предопределенные роли сервера создаются автоматически SQL Server. SQL Server PDW имеет ограниченную реализацию SQL Server предопределенных ролей сервера. Только **Администраторы sysadmin** и **Public** имеют имена входа пользователя в качестве членов. Роли **setupadmin** и **dbcreator** используются внутренне SQL Server PDW. Дополнительные члены нельзя добавлять или удалять из любой роли.

### <a name="sysadmin-fixed-server-role"></a>предопределенной роли сервера sysadmin
Члены предопределенной роли сервера **sysadmin** могут выполнять любые действия на сервере. Имя входа **SA** является единственным членом предопределенной роли сервера **sysadmin** . Дополнительные имена для входа нельзя добавить к предопределенной роли сервера **sysadmin** . Для предоставления разрешения **CONTROL SERVER** требуется членство в предопределенной роли сервера **sysadmin**. В следующем примере предоставляется разрешение **Control Server** для имени входа с именем фай.

```sql
USE master;
GO
GRANT CONTROL SERVER TO Fay;
```

> [!IMPORTANT]
> Разрешение **Control Server** обеспечивает почти полное управление SQL Server PDW. Когда это возможно, предоставьте более детализированные разрешения для имен входа. Например, рассмотрите возможность предоставления разрешения на **Просмотр состояния сервера**, **изменение любого имени входа**, **Просмотр любой базы данных**или **создание любых разрешений базы данных** .

### <a name="public-server-role"></a>Роль общего сервера
Каждое имя входа, которое может подключиться к SQL Server PDW, является членом роли сервера **Public** . Все имена входа наследуют разрешения, предоставленные для **общего** доступа к любому объекту. Присвойте объекту только **открытые** разрешения, если требуется, чтобы объект был доступен всем пользователям. Нельзя изменить членство в роли **Public** .

> [!NOTE]
> **Public** реализован не так, как другие роли. Поскольку все участники сервера являются членами общедоступной версии, членство роли **Public** не отображается в **sys.server_role_members** динамического административного представления.

### <a name="fixed-server-roles-vs-granting-permissions"></a>Предопределенные роли сервера и предоставление разрешений
Система предопределенных ролей сервера и предопределенных ролей базы данных — это устаревшая система, созданная в 1980. Фиксированные роли по-прежнему поддерживаются и полезны в средах с небольшими пользователями и требованиями безопасности. Начиная с SQL Server 2005, была создана более детальная система предоставления разрешений. Эта новая система более детализирована, предоставляя множество дополнительных параметров для предоставления и запрета разрешений. Дополнительная сложность более детализированной системы затрудняет изучение, но большинство корпоративных систем должны предоставлять разрешения вместо использования предопределенных ролей. <!-- MISSING LINKS The permissions are discussed and listed in the topic [Permissions: GRANT, DENY, REVOKE &#40;SQL Server PDW&#41;](../sqlpdw/permissions-grant-deny-revoke-sql-server-pdw.md).  -->

## <a name="related-topics"></a>См. также

- [Предоставление разрешений](grant-permissions.md)

<!-- MISSING LINKS
## See Also
[Common Metadata Query Examples &#40;SQL Server PDW&#41;](../sqlpdw/common-metadata-query-examples-sql-server-pdw.md)
-->

