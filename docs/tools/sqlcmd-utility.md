---
title: Служебная программа sqlcmd
description: Служебная программа sqlcmd позволяет выполнять инструкции Transact-SQL, системные процедуры и файлы скриптов в разных режимах. Она использует ODBC для выполнения пакетов Transact-SQL.
ms.prod: sql
ms.prod_service: sql-tools
ms.technology: tools-other
ms.topic: conceptual
helpviewer_keywords:
- statements [SQL Server], command prompt
- QUIT command
- Transact-SQL statements, command prompt
- EXIT command
- sqlcmd commands
- ED command
- sqlcmd utility
- command prompt utilities [SQL Server], sqlcmd
- '!! command'
- stored procedures [SQL Server], command prompt
- system stored procedures [SQL Server], command prompt
- sqlcmd utility, about sqlcmd utility
- scripts [SQL Server], command prompt
- RESET command
- GO command
ms.assetid: e1728707-5215-4c04-8320-e36f161b834a
author: markingmyname
ms.author: maghan
ms.reviewer: ''
ms.custom: seo-lt-2019
ms.date: 09/11/2020
monikerRange: '>=aps-pdw-2016||=azuresqldb-current||=azure-sqldw-latest||>=sql-server-2016||>=sql-server-linux-2017'
ms.openlocfilehash: b499c7236391c7286c4a267c433ad991a963dab5
ms.sourcegitcommit: 713e5a709e45711e18dae1e5ffc190c7918d52e7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/22/2021
ms.locfileid: "98688933"
---
# <a name="sqlcmd-utility"></a>Служебная программа sqlcmd

[!INCLUDE[SQL Server Azure SQL Database Synapse Analytics PDW ](../includes/applies-to-version/sql-asdb-asdbmi-asa-pdw.md)]

> Сведения об SQL Server 2014 и более ранние версиях см. в статье о [служебной программе sqlcmd](/previous-versions/sql/2014/tools/sqlcmd-utility?view=sql-server-2014&preserve-view=true).
>
> Сведения об использовании программы sqlcmd в Linux см. в статье [Установка программ командной строки SQL Server sqlcmd и bcp в Linux](../linux/sql-server-linux-setup-tools.md).

 Служебная программа **sqlcmd** позволяет выполнять инструкции Transact-SQL, системные процедуры и файлы скриптов в различных доступных режимах:

- В командной строке.
- В режиме SQLCMD в **редакторе запросов**.
- В файле скрипта Windows.
- В шаге задания операционной системы (cmd.exe), выполняемого в агенте SQL Server.

Эта программа использует ODBC для выполнения пакетов Transact-SQL.

## <a name="download-the-latest-version-of-sqlcmd-utility"></a>Скачивание последней версии служебной программы sqlcmd

**[![Скачивание sqlcmd для x64](../ssdt/media/download.png) Скачать программы командной строки Microsoft 15 для SQL Server (х64) (2,6 МБ)](https://go.microsoft.com/fwlink/?linkid=2142258)**
<br>**[![Скачивание sqlcmd для x86](../ssdt/media/download.png) Скачать программы командной строки Microsoft 15 для SQL Server (х86) (2,3 МБ)](https://go.microsoft.com/fwlink/?linkid=2142257)**

Программы командной строки предоставляются в общедоступной версии, тем не менее они выпускаются вместе с пакетом установщика для [!INCLUDE[sql-server-2019](../includes/sssqlv15-md.md)].

**Сведения о версии**

Номер выпуска: 15.0.2<br>
Номер сборки: 15.0.2000.5<br>
Дата выпуска: 11 сентября 2020 г.

Новая версия SQLCMD поддерживает проверку подлинности Azure AD, в том числе многофакторную проверку подлинности (MFA) для базы данных SQL, Azure Synapse Analytics и функции Always Encrypted.
Новая версия программы BCP поддерживает проверку подлинности Azure AD, в том числе многофакторную проверку подлинности (MFA) для базы данных SQL и Azure Synapse Analytics.

**Требования к системе** Windows 10, Windows 7, Windows 8, Windows 8.1, Windows Server 2008–2019.

Этот компонент требует наличия [установщика Windows версии 4.5](https://www.microsoft.com/download/details.aspx?id=8483) и [драйвера Microsoft ODBC 17 для SQL Server](../connect/odbc/download-odbc-driver-for-sql-server.md).
 
Чтобы проверить версию SQLCMD, выполните команду `sqlcmd -?` и убедитесь, что используется версия 15.0.2000.5 или более поздняя.

> [!NOTE]
> Для поддержки Always Encrypted (`-g`) и проверки подлинности Azure Active Directory (`-G`) требуется версия не ниже 13.1. (На компьютере можно установить несколько версий sqlcmd.exe. Убедитесь, что используется правильная версия. Чтобы определить версию, выполните `sqlcmd -?`.)

Программу sqlcmd можно запустить из Azure Cloud Shell, так как она предварительно установлена по умолчанию: [![Запуск Cloud Shell](https://shell.azure.com/images/launchcloudshell.png "Запуск Cloud Shell")](https://shell.azure.com)

Чтобы выполнить инструкции sqlcmd в SSMS, выберите "Режим SQLCMD" в раскрывающемся списке "Запрос" на верхней панели навигации.  

> [!IMPORTANT]
> [!INCLUDE[ssManStudioFull_md](../includes/ssmanstudiofull-md.md)] (SSMS) использует Microsoft [!INCLUDE[dnprdnshort_md](../includes/dnprdnshort-md.md)] SqlClient для выполнения в обычном режиме и в режиме SQLCMD в **редакторе запросов**. Когда **sqlcmd** вызывается из командной строки, **sqlcmd** использует драйвер ODBC. Так как могут применяться разные параметры по умолчанию, выполнение одного и того же запроса в среде [!INCLUDE[ssManStudioFull_md](../includes/ssmanstudiofull-md.md)] в режиме SQLCMD и в программе **sqlcmd** может различаться.  
>

Сейчас **sqlcmd** не требует вводить пробел между параметром командной строки и значением. Однако такой формат может появиться в будущих выпусках.  

 Другие разделы: 

- [Запуск программы sqlcmd](../ssms/scripting/sqlcmd-start-the-utility.md)
- [Использование программы sqlcmd](../ssms/scripting/sqlcmd-use-the-utility.md)
  
## <a name="syntax"></a>Синтаксис

```cmd
sqlcmd
   -a packet_size
   -A (dedicated administrator connection)
   -b (terminate batch job if there is an error)
   -c batch_terminator
   -C (trust the server certificate)
   -d db_name
   -D
   -e (echo input)
   -E (use trusted connection)
   -f codepage | i:codepage[,o:codepage] | o:codepage[,i:codepage]
   -g (enable column encryption)
   -G (use Azure Active Directory for authentication)
   -h rows_per_header
   -H workstation_name
   -i input_file
   -I (enable quoted identifiers)
   -j (Print raw error messages)
   -k[1 | 2] (remove or replace control characters)  
   -K application_intent  
   -l login_timeout  
   -L[c] (list servers, optional clean output)  
   -m error_level  
   -M multisubnet_failover  
   -N (encrypt connection)  
   -o output_file  
   -p[1] (print statistics, optional colon format)  
   -P password  
   -q "cmdline query"  
   -Q "cmdline query" (and exit)  
   -r[0 | 1] (msgs to stderr)  
   -R (use client regional settings)  
   -s col_separator  
   -S [protocol:]server[instance_name][,port]  
   -t query_timeout  
   -u (unicode output file)  
   -U login_id  
   -v var = "value"
   -V error_severity_level
   -w column_width
   -W (remove trailing spaces)
   -x (disable variable substitution)
   -X[1] (disable commands, startup script, environment variables, optional exit)
   -y variable_length_type_display_width
   -Y fixed_length_type_display_width
   -z new_password
   -Z new_password (and exit)
   -? (usage)
```
  
## <a name="command-line-options"></a>Параметры командной строки

**Параметры, связанные с именем для входа**

**-A**  
Входит в SQL Server через выделенное административное соединение. Этот вид соединения предназначен для устранения неполадок на сервере. Это подключение работает только с серверными компьютерами, поддерживающими выделенное административное подключение (DAC). Если выделенное административное соединение недоступно, **sqlcmd** выдает сообщение об ошибке и завершает работу. Дополнительные сведения о DAC см. в статье [Диагностическое соединение для администраторов баз данных](../database-engine/configure-windows/diagnostic-connection-for-database-administrators.md). Параметр -A не поддерживается вместе с параметром -G. При подключении к базе данных SQL с использованием параметра -A необходимо быть администратором SQL Server. DAC недоступно для администратора Azure Active Directory.

**-C**  
С помощью этого переключателя клиент настраивает неявное доверие к сертификату сервера без проверки. Этот параметр аналогичен параметру ADO.NET `TRUSTSERVERCERTIFICATE = true`.  

**-d** _имя_базы данных_  
Выдает инструкцию `USE` *имя_базы данных* при запуске программы **sqlcmd**. Этот параметр задает переменную скрипта SQLCMDDBNAME программы **sqlcmd** . Этот параметр задает начальную базу данных. По умолчанию свойство default-database имени входа. Если база данных не существует, выдается сообщение об ошибке и программа **sqlcmd** завершает работу.  

**-D**  
Интерпретирует имя сервера, предоставленное для -S, как имя DSN, а не имя узла. Дополнительные сведения см. в разделе _Поддержка имени DSN в sqlcmd и bcp_ статьи [Соединение с помощью sqlcmd](../connect/odbc/linux-mac/connecting-with-sqlcmd.md).

> [!NOTE]
> Параметр -D доступен только для клиентов Linux и MacOS. В клиентах Windows он объявлен устаревшим, был удален и игнорируется.

**-l** _время_ожидания_входа_  
Задает время ожидания (в секундах) при подключении программы **sqlcmd** через драйвер ODBC при попытке соединения с сервером. Этот параметр задает переменную скрипта SQLCMDLOGINTIMEOUT программы **sqlcmd** . По умолчанию время ожидания входа для программы **sqlcmd** составляет 8 секунд. При использовании параметра **- G** для подключения к базе данных SQL или Azure Synapse Analytics и проверке подлинности с помощью Azure Active Directory рекомендуется задавать время ожидания не меньше 30 секунд. Время ожидания входа должно быть числом в диапазоне от 0 до 65 534. Если указанное значение не является числом или выходит за пределы указанного диапазона, **sqlcmd** выдает сообщение об ошибке. Значение 0 задает неограниченное время ожидания.

**-E**  
Для входа в SQL Server вместо имени пользователя и пароля использует доверительное соединение. По умолчанию, если параметр **-E** не указан, программа **sqlcmd** использует доверительное соединение.  

Параметр **-E** не использует имя пользователя и пароль, указанные в переменных среды, например SQLCMDPASSWORD. Если параметр **-E** используется в сочетании с параметром **-U** или **-P** , выдается сообщение об ошибке.  

**-g**  
Задает значение `Enabled`для параметра "Шифрование столбцов". Дополнительные сведения см. в разделе [Постоянное шифрование](../relational-databases/security/encryption/always-encrypted-database-engine.md). Поддерживаются только главные ключи, хранящиеся в хранилище сертификатов Windows. Для использования параметра -g требуется версия **sqlcmd** не ниже [13.1](https://go.microsoft.com/fwlink/?LinkID=825643). Чтобы определить версию, выполните `sqlcmd -?`.

**-G**  
Клиент использует этот переключатель при подключении к базе данных SQL или Azure Synapse Analytics, чтобы указать, что проверка подлинности пользователя выполняется с помощью Azure Active Directory. Этот параметр задает переменную скрипта SQLCMDUSEAAD = true программы **sqlcmd** . Для использования параметра -G требуется версия **sqlcmd** не ниже [13.1](https://go.microsoft.com/fwlink/?LinkID=825643). Чтобы определить версию, выполните `sqlcmd -?`. Дополнительные сведения см. в статье [Подключение к базе данных SQL или Azure Synapse Analytics с использованием проверки подлинности Azure Active Directory](/azure/azure-sql/database/authentication-aad-overview). Параметр -A не поддерживается вместе с параметром -G.

> [!IMPORTANT]
> Параметр `-G` применяется только для Базы данных SQL Azure и хранилища данных Azure.
> Интерактивная проверка подлинности AAD в Linux и macOS в настоящее время не поддерживается. Для интегрированной проверки подлинности AAD требуется [драйвер Microsoft ODBC 17 для SQL Server](../connect/odbc/download-odbc-driver-for-sql-server.md) версии 17.6.1 или более поздней, а также правильно настроенная среда Kerberos.

- **Имя пользователя и пароль Azure Active Directory** 

    Если вы хотите использовать имя пользователя и пароль Azure Active Directory, можно указать параметр **-G** , а также использовать имя пользователя и пароль, задав параметры **-U** и **-P** .

    ```cmd
    Sqlcmd -S testsrv.database.windows.net -d Target_DB_or_DW -U bob@contoso.com -P MyAADPassword -G
    ```

    Параметр -G создает следующую строку подключения в серверной части: 

    ```cmd
     SERVER = Target_DB_or_DW.testsrv.database.windows.net;UID= bob@contoso.com;PWD=MyAADPassword;AUTHENTICATION = ActiveDirectoryPassword 
    ```

- **Встроенная проверка подлинности Azure Active Directory**

   Чтобы использовать встроенную проверку подлинности Azure Active Directory, укажите параметр **-G** без имени пользователя или пароля.
   *Интегрированная проверка подлинности AAD в настоящее время не поддерживается в Linux или macOS*.

    ```cmd
    Sqlcmd -S Target_DB_or_DW.testsrv.database.windows.net -G
    ```

    При этом на сервере формируется следующая строка подключения: 

    ```cmd
    SERVER = Target_DB_or_DW.testsrv.database.windows.net Authentication = ActiveDirectoryIntegrated; Trusted_Connection=NO
    ```

    > [!NOTE]
    > Параметр `-E` (Trusted_Connection) нельзя использовать вместе с параметром `-G`.

- **Интерактивная проверка подлинности Azure Active Directory**

    Интерактивная проверка подлинности Azure AD для Базы данных SQL Azure и Azure Synapse Analytics позволяет использовать интерактивный метод, поддерживающий многофакторную проверку подлинности. Дополнительные сведения см. в разделе [Интерактивная проверка подлинности Active Directory](../ssdt/azure-active-directory.md#active-directory-interactive-authentication). 

   Для интерактивного режима Azure AD требуется программа **sqlcmd** [версии 15.0.1000.34](#download-the-latest-version-of-sqlcmd-utility) или более поздней, а также [ODBC версии 17.2 или более поздней](../connect/odbc/download-odbc-driver-for-sql-server.md).  

   Чтобы включить интерактивную проверку подлинности, укажите аргумент -G только с именем пользователя (-U) без пароля.

   В приведенном ниже примере данные экспортируются с помощью интерактивного режима Azure AD с указанием имени пользователя, который представляет собой учетную запись AAD. Это тот же пример, который использовался в предыдущем разделе: *Имя пользователя и пароль Azure Active Directory*.  

   Для интерактивного режима требуется вводить пароль вручную. Для учетных записей с включенной многофакторной проверкой подлинности следует выполнить настроенный метод аутентификации MFA.

   ```cmd
   sqlcmd -S testsrv.database.windows.net -d Target_DB_or_DW -G -U alice@aadtest.onmicrosoft.com
   ```

   Предыдущая команда создает следующую строку подключения в серверной части:  

   ```cmd
   SERVER = Target_DB_or_DW.testsrv.database.windows.net;UID=alice@aadtest.onmicrosoft.com; AUTHENTICATION = ActiveDirectoryInteractive   
   ```

   Если пользователь Azure AD является федеративным пользователем домена с учетной записью Windows, имя пользователя, необходимое в командной строке, содержит учетную запись домена (например, joe@contoso.com; см. ниже):

   ```cmd
   sqlcmd -S testsrv.database.windows.net -d Target_DB_or_DW -G -U joe@contoso.com  
   ```

   Если гостевые пользователи есть в определенной службе Azure AD и являются частью группы, которая существует в базе данных SQL, имеющей разрешения на выполнение команды sqlcmd, используется псевдоним гостевого пользователя (например, *keith0@adventureworks.com* ).

  >[!IMPORTANT]
  >Существует известная неполадка при использовании параметра `-G` и `-U` с программой SQLCMD, при которой размещение параметра `-U` перед параметром `-G` может привести к сбою проверки подлинности. Всегда начинайте с использования параметра `-G`, за которым следует параметр `-U`.

**-H** _имя_рабочей_станции_  
 Имя рабочей станции. Этот параметр задает переменную скрипта SQLCMDWORKSTATION программы **sqlcmd** . Имя рабочей станции заносится в столбец **hostname** представления каталога **sys.sysprocesses** и может быть возвращено с помощью хранимой процедуры **sp_who**. Если этот параметр не указан, используется текущее имя компьютера. Это имя может использоваться для идентификации других 

сеансов **sqlcmd**.  

**-j** выводит на экран необработанные сообщения об ошибках.
  
 **-K** _намерение_приложения_  
 Объявляет тип рабочей нагрузки приложения при соединении с сервером. Единственным поддерживаемым в данное время значением является **ReadOnly**. Если параметр **-K** не указан, то программа sqlcmd не будет поддерживать возможность подключения к вторичной реплике в группе доступности AlwaysOn. Дополнительные сведения см. в статье [Активные вторичные реплики: доступ только для чтения к вторичным репликам (группы доступности AlwaysOn)](../database-engine/availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md)  
  
**-M** _отработка_отказа_в_сети_с_несколькими_подсетями_  
 Всегда указывайте параметр **-M** при соединении с прослушивателем группы доступности SQL Server или экземпляром отказоустойчивого кластера SQL Server. **-M** обеспечивает более быстрое обнаружение активного (в данный момент) сервера и соединение с ним. Если параметр **-M** не указан, значит **-M** отключен. Дополнительные сведения см. в статьях: [Прослушиватели, подключение клиентов и отработка отказа приложений](../database-engine/availability-groups/windows/listeners-client-connectivity-application-failover.md), [Создание и настройка групп доступности (SQL Server)](../database-engine/availability-groups/windows/creation-and-configuration-of-availability-groups-sql-server.md), [Отказоустойчивая кластеризация и группы доступности AlwaysOn (SQL Server)](../database-engine/availability-groups/windows/failover-clustering-and-always-on-availability-groups-sql-server.md) и [Активные вторичные реплики. Доступ только для чтения к вторичным репликам (группы доступности AlwaysOn)](../database-engine/availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md).
  
 **-N**  
 С помощью этого переключателя клиент запрашивает шифрованное соединение.  
  
 **-P** _пароль_  
 Пароль, задаваемый пользователем. В паролях учитывается регистр символов. Если указан параметр -U, а параметр **-P** отсутствует и не задана переменная среды SQLCMDPASSWORD, программа **sqlcmd** запрашивает пароль у пользователя. Не рекомендуется задавать пароль со значением null, но можно указать пароль null, используя пару смежных двойных кавычек для значения параметра:

- **-P ""**

Рекомендуется выбрать надежный пароль.

#### <a name="use-a-strong-password"></a>[**Выбирайте надежные пароли!**](../relational-databases/security/strong-passwords.md)

 Запрос на ввод пароля выводится на консоль следующим образом: `Password:`.  
  
 Вводимые пользователем данные на экране не отображаются, то есть символы не выводятся и курсор остается на месте.  
  
 Переменная среды SQLCMDPASSWORD позволяет задать значение пароля по умолчанию для текущего сеанса. Таким образом, нет необходимости указывать пароль в пакетных файлах.  
  
 В следующем примере сначала из командной строки устанавливается переменная SQLCMDPASSWORD, а затем производится вызов программы **sqlcmd** . В командной строке введите:  
  
 `SET SQLCMDPASSWORD= p@a$$w0rd`  
 В командной строке введите:  
  
 `sqlcmd`  
  
 Если обнаружено неверное сочетание имени пользователя и пароля, выдается сообщение об ошибке.  
  
**Примечание.**  Переменная среды OSQLPASSWORD была сохранена в целях обратной совместимости. Переменная среды SQLCMDPASSWORD имеет больший приоритет, чем OSQLPASSWORD. Теперь, когда переменная OSQLPASSWORD больше не указана, служебные программы **sqlcmd** и **osql** могут использоваться рядом друг с другом без помех. Старые скрипты продолжат работать.  
  
 Если параметр **-P** указан одновременно с параметром **-E** , выдается сообщение об ошибке.  
  
 Если после параметра **-P** указано более одного аргумента, выдается сообщение об ошибке, и программа завершает работу.  
  
 **-S** [*протокол*:]*сервер*[ **\\** _имя\_экземпляра_][ **,** _порт_]  
 Указывает экземпляр SQL Server, к которому выполняется подключение. Задает переменную скрипта SQLCMDSERVER программы **sqlcmd** .  
  
 Укажите значение *имя_сервера*, чтобы подключиться к экземпляру SQL Server по умолчанию на этом сервере. Укажите *имя_сервера* [ **\\** _имя\_экземпляра_ ], чтобы подключиться к именованному экземпляру SQL Server на этом компьютере сервера. Если сервер не указан, программа **sqlcmd** выполняет подключение к экземпляру SQL Server по умолчанию на локальном компьютере. Этот параметр обязателен при запуске программы **sqlcmd** с удаленного компьютера в сети.  
  
 Параметр *протокол* может иметь значение **tcp** (TCP/IP), **lpc** (общая память) или **np** (именованные каналы).  
  
 Если значение *имя_сервера* [ **\\** _имя\_экземпляра_ ] при запуске программы **sqlcmd** не указано, то SQL Server проверяет наличие переменной среды SQLCMDSERVER и, если она задана, использует ее значение.  
  
> [!NOTE]  
>  Переменная среды OSQLSERVER была сохранена в целях обратной совместимости. Переменная среды SQLCMDSERVER имеет больший приоритет, чем переменная среды OSQLSERVER. Это означает, что программы **sqlcmd** и **osql** могут применяться одновременно, не мешая друг другу, и скрипты прежних версий не перестанут работать.  
  
 **-U** _имя_для_входа_  
 Является именем для входа или именем пользователя автономной базы данных. Для пользователей автономной базы данных нужно ввести параметр имени базы данных (-d).  
  
> [!NOTE]  
>  В целях обратной совместимости доступна переменная среды OSQLUSER. Переменная среды SQLCMDUSER имеет больший приоритет, чем OSQLUSER. То есть программы **sqlcmd** и **osql** могут применяться одновременно, не мешая друг другу. Кроме того, это означает, что существующие скрипты **osql** не перестанут работать.  
  
 Если не указан ни параметр **-U**, ни параметр **-P**, **sqlcmd** пытается подключиться с помощью режима проверки подлинности Microsoft Windows. При этом используется учетная запись пользователя Windows, который запустил программу **sqlcmd**.  
  
 Если параметры **-U** и **-E** (описанные ниже в этой статье) указаны одновременно, то появляется сообщение об ошибке. Если после параметра **-U** указано более одного аргумента, выдается сообщение об ошибке и программа завершает работу.  
  
 **-z** _новый_пароль_  
 Сменить пароль:  
  
 `sqlcmd -U someuser -P s0mep@ssword -z a_new_p@a$$w0rd`  
  
 **-z** _новый_пароль_  
 Измените пароль и выйти:  
  
 `sqlcmd -U someuser -P s0mep@ssword -Z a_new_p@a$$w0rd`  
  
 **Параметры ввода-вывода**  
  **-f**_кодовая_страница_ | **i:** _кодовая_страница_[ **,o:** _кодовая_страница_] | **o:** _кодовая_страница_[ **,i:** _кодовая_страница_]  
 Задает входные и выходные кодовые страницы. Номер кодовой страницы — это числовое значение, которое определяет установленную кодовую страницу Windows.  
  
 Правила преобразования кодовых страниц:  
  
- Если кодовые страницы не заданы, программа **sqlcmd** использует текущую кодовую страницу как для входных, так и для выходных файлов. Для входного файла в формате Юникод преобразование не требуется.  
  
- Программа **sqlcmd** автоматически распознает входные файлы в Юникоде как с прямым, так и с обратным порядком байтов. Если задан параметр **-u** , выходные данные всегда будут в Юникоде с прямым порядком байтов.  
  
- Если выходной файл не задан, то выходные данные будут иметь кодовую страницу консоли. Такой подход обеспечивает корректное отображение данных на консоли.  
  
- Предполагается, что все входные файлы имеют одинаковую кодовую страницу. Входные файлы в Юникоде и не в Юникоде можно обрабатывать вместе.  
  
 Чтобы проверить кодовую страницу Cmd.exe, введите в командной строке команду **chcp** .  
  
 **-i** _файл_ввода_[ **,** _файл\_ввода2_...]  
 Указывает файл, содержащий пакет инструкций или хранимых процедур SQL. Можно указать несколько файлов, которые будут считываться и обрабатываться в указанном порядке. Не разделяйте имена файлов пробелами. Сначала программа **sqlcmd** проверяет наличие всех указанных файлов. Если хотя бы один из файлов не найден, программа **sqlcmd** завершает работу. Параметры -i и -Q/-q являются взаимоисключающими.  
  
 Примеры пути:  

```cmd
-i C:\<filename>  
-i \\<Server>\<Share$>\<filename>  
-i "C:\Some Folder\<file name>"  
```
  
 Пути к файлам, содержащие пробелы, необходимо заключать в кавычки.  
  
 Этот параметр можно использовать многократно: **-i**_файл\_ввода_ **-I**_I файл_ввода_.  
  
 **-o** _файл_ввода_  
 Указывает файл, получающий выходные данные программы **sqlcmd**.  
  
 Если указан параметр **-u** , *выходной_файл* сохраняется в Юникоде. Если указано недопустимое имя файла, программа **sqlcmd** выдает сообщение об ошибке и завершает работу. Программа **sqlcmd** не поддерживает одновременную запись нескольких процессов **sqlcmd** в один файл. В этом случае выводимые в файл данные будут неверны или повреждены. См. параметр **-f**, который также относится к форматам файлов. Если этот файл не существует, он будет создан. Файл от предыдущего сеанса программы **sqlcmd** с тем же именем будет перезаписан. Указанный здесь файл не является файлом **stdout** . Если файл **stdout** указан, то этот файл использоваться не будет.  
  
 Примеры пути:  

```cmd
-o C:< filename>  
-o \\<Server>\<Share$>\<filename>  
-o "C:\Some Folder\<file name>"  
 ```
 Пути к файлам, содержащие пробелы, необходимо заключать в кавычки.  
  
 **-r**[**0** | **1**]  
 Перенаправляет вывод сообщений об ошибке на экран (**stderr**). Если параметр не указан или если указано значение **0**, происходит перенаправление только сообщений об ошибках с уровнем серьезности 11 и выше. Если указать **1**, то происходит перенаправление всех сообщений об ошибках (включая команду PRINT). Не имеет эффекта, если указан параметр -o. По умолчанию сообщения отправляются в **stdout**.  
  
 **-R**  
 Указывает **sqlcmd**, что локализация в столбцах числовых и денежных данных, значений даты и времени, полученных из SQL Server, должна выполняться с учетом языка и региональных параметров клиента. По умолчанию эти столбцы отображаются с использованием региональных параметров сервера.  
  
 **-u**  
 Указывает, что *выходной_файл* хранится в Юникоде независимо от формата файла *входной_файл*.  
  
 **Параметры выполнения запросов**  
  **-e**  
 Выдает входные скрипты на стандартное устройство вывода (**stdout**).  
  
 **-I**  
 Устанавливает значение ON для параметра соединения SET QUOTED_IDENTIFIER. По умолчанию этот параметр имеет значение OFF. Дополнительные сведения см. в статье [SET QUOTED_IDENTIFIER (Transact-SQL)](~/t-sql/statements/set-quoted-identifier-transact-sql.md).  
  
 **-q "** _запрос_командной_строки_ **"**  
 Выполняет запрос при запуске программы **sqlcmd** , но выход из программы **sqlcmd** по его завершении не производится. Может быть выполнено несколько запросов, разделенных точкой с запятой. Заключайте запрос в кавычки, как показано в следующем примере.  
  
 В командной строке введите:  
  
 `sqlcmd -d AdventureWorks2012 -q "SELECT FirstName, LastName FROM Person.Person WHERE LastName LIKE 'Whi%';"`  
  
 `sqlcmd -d AdventureWorks2012 -q "SELECT TOP 5 FirstName FROM Person.Person;SELECT TOP 5 LastName FROM Person.Person;"`  
  
> [!IMPORTANT]  
>  Не используйте в запросе признак конца GO.  
  
 Если вместе с этим параметром указан параметр **-b** , программа **sqlcmd** завершает работу при возникновении ошибки. Параметр **-b** описан выше в этой статье.  
  
 **-Q "** _запрос_командной_строки_ **"**  
 Выполняет запрос при запуске программы **sqlcmd** и немедленно завершает работу **sqlcmd**. Может быть выполнено несколько запросов, разделенных точкой с запятой.  
  
 Заключайте запрос в кавычки, как показано в следующем примере.  
  
 В командной строке введите:  
  
 `sqlcmd -d AdventureWorks2012 -Q "SELECT FirstName, LastName FROM Person.Person WHERE LastName LIKE 'Whi%';"`  
  
 `sqlcmd -d AdventureWorks2012 -Q "SELECT TOP 5 FirstName FROM Person.Person;SELECT TOP 5 LastName FROM Person.Person;"`  
  
> [!IMPORTANT]  
>  Не используйте в запросе признак конца GO.  
  
 Если вместе с этим параметром указан параметр **-b** , программа **sqlcmd** завершает работу при возникновении ошибки. Параметр **-b** описан выше в этой статье.  
  
 **-t** _время_ожижания_запроса_  
 Задает число секунд времени ожидания команды (или инструкции SQL). Этот параметр задает переменную скрипта SQLCMDSTATTIMEOUT программы **sqlcmd** . Если значение *время_ожидания* не указывается, то команда имеет неограниченное время ожидания. Значение *время_ожидания* *запроса* должно быть числом в диапазоне от 1 до 65534. Если указанное значение не является числом или выходит за пределы указанного диапазона, **sqlcmd** выдает сообщение об ошибке.  
  
> [!NOTE]  
>  Фактическое время ожидания может отличаться от указанного значения *время_ожидания* на несколько секунд.  
  
 **-vvar =** _значение_[ **var =** _значение_...]  
 Создает переменную скрипта **sqlcmd**, которая может быть использована в скрипте **sqlcmd** . Если значение содержит пробелы, заключите его в кавычки. Можно определить несколько значений _**var**_= **"** _значения_ **"** . Если в каком-либо из указанных значений обнаружена ошибка, программа **sqlcmd** выдает сообщение и завершает работу.  
  
 `sqlcmd -v MyVar1=something MyVar2="some thing"`  
  
 `sqlcmd -v MyVar1=something -v MyVar2="some thing"`  
  
 **-x**  
 Указывает, что программа **sqlcmd** не должна обрабатывать переменные скрипта. Этот параметр полезен, когда скрипт содержит много инструкций INSERT, в которых могут быть строки с форматом, как у обычных переменных, например: "$(*имя_переменной*)".  
  
 **Параметры форматирования**  
  **-h** _заголовки_  
 Указывает количество строк для печати между заголовками столбцов. По умолчанию заголовки печатаются один раз для каждого набора результатов запроса. Этот параметр задает переменную скрипта SQLCMDHEADERS программы **sqlcmd** . Используйте значение **-1**, чтобы отменить печать заголовков. Любое недопустимое значение приводит к тому, что программа **sqlcmd** выдает сообщение об ошибке и завершает работу.  
  
 **-k** [**1** | **2**]  
 Удаляет из выходных данных все управляющие символы, такие как символы табуляции и символы новой строки. Этот параметр сохраняет формат столбцов при возврате данных. При указании значения 1 управляющие символы заменяются одиночным пробелом. Если указано значение 2, все последовательные управляющие символы заменяются одиночным пробелом. Параметр **-k** аналогичен параметру **-k1**.  
  
 **-s** _символ-разделитель_столбцов_  
 Задает символ-разделитель столбцов. Значением по умолчанию является пробел. Этот параметр задает переменную скрипта SQLCMDCOLSEP программы **sqlcmd** . Чтобы использовать символы, имеющие специальное значение для операционной системы, такие как амперсанд (&) или точка с запятой (;), заключайте этот символ в кавычки ("). Разделитель столбцов может быть любым 8-разрядным символом.  
  
 **-w** _ширина_столбца_  
 Задает ширину экрана для вывода. Этот параметр задает переменную скрипта SQLCMDCOLWIDTH программы **sqlcmd** . Ширина столбца должна находиться в диапазоне от 8 до 65 536. Если указанное значение ширины столбца выходит за пределы заданного диапазона, **sqlcmd** выдает сообщение об ошибке. Ширина по умолчанию составляет 80 символов. Когда строка вывода превышает указанную ширину столбца, вывод переносится на следующую строку.  
  
 **-W**  
 Этот параметр удаляет конечные пробелы в столбце. При подготовке данных для экспорта в другое приложение указывайте этот параметр вместе с параметром **-s** . Не может указываться одновременно с параметром **-y** или **-Y** .  
  
 **-y** _изменяемая_ширина_отображения_  
 Задает переменную скрипта **sqlcmd**`SQLCMDMAXVARTYPEWIDTH`. Значение по умолчанию равно 256. Ограничивает число символов, возвращаемых для больших типов данных переменной длины:  
  
- **varchar(max)**  
  
- **nvarchar(max)**  
  
- **varbinary(max)**  
  
- **xml**  
  
- **UDT (пользовательский тип)**  
  
- **text**  
  
- **ntext**  
  
- **image**  
  
> [!NOTE]  
>  Определяемые пользователем типы могут иметь фиксированную длину в зависимости от реализации. Если фиксированная длина определяемого пользователем типа короче, чем значение переменной *ширина_отображения*, то значение типа возвращается без изменений. Однако если длина превышает значение *ширина_отображения*, то производится усечение выходных данных.  
   
  
> [!IMPORTANT]  
>  Используйте параметр **-y 0** с особой осторожностью, поскольку при большом объеме возвращаемых данных может значительно снизиться производительность сервера и сети.  
  
 **-Y** _фиксированная_ширина_отображения_  
 Задает переменную скрипта **sqlcmd**`SQLCMDMAXFIXEDTYPEWIDTH`. Значение по умолчанию 0 (неограниченно). Ограничивает число символов, возвращаемых для следующих типов данных:  
  
- **char(** _n_ **)** , где 1<=n<=8000  
  
- **nchar(n** _n_ **)** , где 1<=n<=4000  
  
- **varchar(n** _n_ **)** , где 1<=n<=8000  
  
- **nvarchar(n** _n_ **)** , где 1<=n<=4000  
  
- **varbinary(n** _n_ **)** , где 1<=n\<=4000  
  
- **variant**  
  
 **Параметры отчетов об ошибках**  
  **-b**  
 Указывает, что в случае ошибки программа **sqlcmd** завершает работу и возвращает значение DOS ERRORLEVEL. Значение, возвращаемое в переменную DOS ERRORLEVEL, равно **1**, если сообщение об ошибке SQL Server имеет степень серьезности выше 10. В противном случае возвращаемое значение равно **0**. Если параметр **-V** был указан вместе с параметром **-b**, программа **sqlcmd** не выдает сообщение об ошибке при степени серьезности ниже значения, заданного параметром **-V**. Пакетные файлы командной строки могут быть использованы для проверки значения ERRORLEVEL и для обработки ошибки соответствующим образом. Программа **sqlcmd** не выдает ошибки при степени серьезности 10 (информационные сообщения).  
  
 Если скрипт программы **sqlcmd** содержит неверный комментарий, синтаксическую ошибку или обнаружено отсутствие переменной скрипта, то возвращается значение ERRORLEVEL, равное 1.  
  
 **-m** _уровень_ошибки_  
 Управляет сообщениями об ошибках, отправляемыми в **stdout**. Передаются сообщения со степенью серьезности, которая больше заданной или равна ей. Если это значение равно **-1**, передаются все сообщения, в том числе информационные. Пробелы между параметрами **-m** и **-1** не допускаются. Например, **-m-1** является допустимым, а **-m-1** — нет.  
  
 Кроме того, этот параметр задает переменную скрипта SQLCMDERRORLEVEL программы **sqlcmd** . По умолчанию ее значение равно 0.  
  
 **-V** _уровень_серьезности_ошибки_  
 Управляет степенью серьезности, используемой для задания переменной ERRORLEVEL. Сообщения об ошибках со степенями серьезности, большими этого значения или равными ему, устанавливают переменную ERRORLEVEL. Значения меньше 0 сообщаются как 0. Пакетные файлы и CMD-файлы могут быть использованы для проверки значения переменной ERRORLEVEL.  
  
 **Прочие параметры**  
  **-a** _размер_пакета_  
 Запрашивает пакет другого размера. Этот параметр задает переменную скрипта SQLCMDPACKETSIZE программы **sqlcmd** . Значение *размер_пакета* должно находиться в диапазоне от 512 до 32767. Значение по умолчанию = 4096. Увеличение размера пакета повышает производительность выполнения скриптов, содержащих большое количество инструкций SQL между командами GO. Можно запросить больший размер пакета. Но в случае отклонения запроса программа **sqlcmd** использует размер пакета по умолчанию для сервера.  
  
 **-c** _конец_пакета_  
 Задает признак конца пакета. По умолчанию команды завершаются и отправляются в SQL Server при вводе слова GO в отдельной строке. При сбросе признака конца пакета не используйте зарезервированные ключевые слова или символы Transact-SQL, которые имеют специальное значение для операционной системы, даже если перед ними присутствует символ обратной косой черты.  
  
 **-L**[**c**]  
 Выводит список локально настроенных серверов и имена серверов, осуществляющих передачу данных в сети. Этот параметр не может использоваться в сочетании с другими параметрами. Максимальное число компьютеров серверов, которое можно указать, составляет 3 000. При усечении списка серверов в связи с нехваткой размера буфера выдается предупреждающее сообщение.  
  
> [!NOTE]  
>  Из-за особенностей передачи широковещательных сообщений по сети программа **sqlcmd** не всегда своевременно получает ответ от всех серверов. Поэтому возвращаемый список серверов от вызова к вызову может различаться.  
  
 Если указать необязательный параметр **c**, данные будут выводиться без строки заголовка **Servers:** (Серверы), а в строке каждого сервера не будет начальных пробелов. Это представление называется "чистым выводом". Чистый выход улучшает производительность обработки языков скриптов.  
  
 **-p**[**1**]  
 Выводит на печать статистику производительности для каждого результирующего набора. Далее представлен пример формата для статистики производительности:  
  
 `Network packet size (bytes): n`  
  
 `x xact[s]:`  
  
 `Clock Time (ms.): total       t1  avg       t2 (t3 xacts per sec.)`  
  
 Где:  
  
 `x` = количество транзакций, обработанных SQL Server.  
  
 `t1` = Общее время обработки всех транзакций.  
  
 `t2` = среднее время обработки одной транзакции.  
  
 `t3` = среднее количество транзакций, обрабатываемых в секунду.  
  
 Все значения времени приведены в миллисекундах.  
  
 Если указывается необязательный параметр **1** , статистика выводится в формате со столбцами, разделенными двоеточиями, и может быть легко импортирована в электронную таблицу или обработана скриптом.  
  
 Если необязательный параметр имеет любое значение, кроме **1**, выводится сообщение об ошибке и программа **sqlcmd** завершает работу.  
  
 **-X**[**1**]  
 Отключает команды, которые могут поставить под угрозу безопасность системы при выполнении программы **sqlcmd** из пакетного файла. Отключенные команды по-прежнему распознаются. Программа **sqlcmd** выдает предупреждение и продолжает работу. Если необязательный параметр равен **1** , программа **sqlcmd** выдает сообщение об ошибке и завершает работу. При использовании параметра **-X** отключаются следующие команды:  
  
- **ED**  
  
- **!!** _command_  
  
 Указание параметра **-X** блокирует передачу переменных среды программе **sqlcmd**. Он также препятствует выполнению скрипта запуска, указанного с помощью переменной скрипта SQLCMDINI. Дополнительные сведения об использовании переменных скрипта **sqlcmd** см. в разделе [Использование программы sqlcmd с переменными скрипта](~/relational-databases/scripting/sqlcmd-use-with-scripting-variables.md).  
  
 **-?**  
 Отображает версию программы **sqlcmd** и сводку по синтаксису параметров для **sqlcmd** .  
  
## <a name="remarks"></a>Remarks

Параметры не обязательно должны указываться в том порядке, в котором они приведены в разделе описания синтаксиса.

Если возвращается несколько результатов, программа **sqlcmd** выводит между результирующими наборами в пакете пустую строку. Кроме того, сообщение " `<x> rows affected` не выдается, если оно не соответствует выполненной инструкции.

Для работы с программой **sqlcmd** в интерактивном режиме в командной строке введите **sqlcmd**, указав любой из параметров, описанных ранее в этой статье. Дополнительные сведения см. в статье [Использование программы sqlcmd](~/relational-databases/scripting/sqlcmd-use-the-utility.md)

> [!NOTE]  
>  Параметры **-L**, **-Q**, **-Z** или **-i** приводят к завершению программы **sqlcmd** после выполнения.
  
 Суммарная длина строки команды **sqlcmd** в командной среде (Cmd.exe), включая все аргументы и дополнительные переменные, равна допустимой длине строк для Cmd.exe, определяемой операционной системой.
  
## <a name="variable-precedence-low-to-high"></a>Приоритет переменных (от низкого к высокому)
  
1.  Переменные среды системного уровня.
  
2.  Переменные среды пользовательского уровня.  
  
3.  Командная оболочка (**SET** X=Y), заданная в командной строке перед запуском программы **sqlcmd**.  
  
4.  **sqlcmd-v** X=Y  
  
5.  **:Setvar** X Y  
  
> [!NOTE]  
>  Чтобы просмотреть переменные среды, на **панели управления** откройте компонент **Система** и перейдите на вкладку **Дополнительно** .  
  
## <a name="sqlcmd-scripting-variables"></a>Переменные скрипта sqlcmd  
  
|Переменная|Связанный параметр|Чтение-запись|По умолчанию|  
|--------------|--------------------|----------|-------------|  
|SQLCMDUSER|-U|R|""|  
|SQLCMDPASSWORD|-P|--|""|  
|SQLCMDSERVER|-S|R|"DefaultLocalInstance"|  
|SQLCMDWORKSTATION|-H|R|"ComputerName"|  
|SQLCMDDBNAME|-d|R|""|  
|SQLCMDLOGINTIMEOUT|-l|Чтение-запись|"8" (секунд)|  
|SQLCMDSTATTIMEOUT|-T|Чтение-запись|"0" = неограниченное время ожидания|  
|SQLCMDHEADERS|-H|Чтение-запись|"0"|  
|SQLCMDCOLSEP|-S|Чтение-запись|" "|  
|SQLCMDCOLWIDTH|-w|Чтение-запись|"0"|  
|SQLCMDPACKETSIZE|-a|R|"4096"|  
|SQLCMDERRORLEVEL|-M|Чтение-запись|0|  
|SQLCMDMAXVARTYPEWIDTH|-y|Чтение-запись|«256»|  
|SQLCMDMAXFIXEDTYPEWIDTH|-y|Чтение-запись|"0" = неограниченное время ожидания|  
|SQLCMDEDITOR||Чтение-запись|"edit.com"|  
|SQLCMDINI||R|""|
|SQLCMDUSEAAD  | \- G | Чтение-запись | "" |  
  
 Значения переменных SQLCMDUSER, SQLCMDPASSWORD и SQLCMDSERVER задаются при использовании команды **:Connect** (Подключиться).  
  
 Пометка «Чтение» означает, что значение может быть задано только один раз в процессе инициализации программы.  
  
 Пометка "Чтение/запись" означает, что переменная может быть изменена командой **setvar** и все последующие команды будут использовать новое значение.  
  
## <a name="sqlcmd-commands"></a>Команды sqlcmd  
 В дополнение к инструкциям Transact-SQL в программе **sqlcmd** доступны следующие команды:  
  
|||  
|-|-|  
|**GO** [*число*]|**:List**|  
|[ **:** ] **RESET**|**:Error**|  
|[ **:** ] **ED**|**:Out**|  
|[**:**] **!!**|**:Perftrace**|  
|[ **:** ] **QUIT**|**:Connect**|  
|[ **:** ] **EXIT**|**:On Error**|  
|**:r**|**:Help**|  
|**:ServerList**|**:XML** [**ON** &#124; **OFF**]|  
|**:Setvar**|**:Listvar**|  
  
 При использовании команд программы **sqlcmd** следует учитывать следующие особенности.  
  
- Все команды **sqlcmd** , за исключением GO, должны предваряться двоеточием (:).  
  
    > [!IMPORTANT]  
    >  Для поддержки обратной совместимости с существующими скриптами **osql** некоторые команды будут распознаваться без двоеточия [ **:** ].
  
- Команды **sqlcmd** распознаются только в случае, если они введены в начале строки.  
  
- Во всех командах **sqlcmd** регистр символов не учитывается.  
  
- Каждая команда должна находиться на отдельной строке. За командой не должна следовать инструкция Transact-SQL или другая команда.  
  
- Команды выполняются немедленно. Они не помещаются в буфер выполнения, как инструкции Transact-SQL.  
  
 **Команды изменения**  
  [ **:** ] **ED**  
 Производит запуск текстового редактора. Этот редактор может использоваться для изменения текущего пакета Transact-SQL или последнего выполненного пакета. Для изменения последнего выполненного пакета необходимо ввести команду **ED** сразу после выполнения последнего пакета.  
  
 Текстовый редактор определяется переменной среды SQLCMDEDITOR. Редактором по умолчанию является «Edit». Чтобы изменить редактор, установите переменную среды SQLCMDEDITOR. Например, чтобы установить в качестве редактора Блокнот (Майкрософт), в командной строке введите:  
  
 `SET SQLCMDEDITOR=notepad`  
  
 [ **:** ] **RESET**  
 Очистка кэша инструкций.  
  
 **:List**  
 Вывод содержимого кэша инструкций.  
  
 **Переменные**  
  **:Setvar** \<**var**> [ **"** _значение_ **"** ]  
 Определяет переменные скрипта **sqlcmd** . Переменные скрипта имеют следующий формат: `$(VARNAME)`.  
  
 Имена переменных не зависят от регистра символов.  
  
 Переменные скрипта могут быть установлены следующими способами.  
  
- Неявно, с помощью параметра командной строки. Например, параметр **-l** задает переменную скрипта SQLCMDLOGINTIMEOUT программы **sqlcmd** .  
  
- Явным образом, с помощью команды **:Setvar** .  
  
- Путем задания переменной среды до запуска программы **sqlcmd**.  
  
> [!NOTE]  
>  Параметр **-X** предотвращает передачу переменных среды программе **sqlcmd**.  
  
 Если переменная, определенная с использованием **:Setvar** и переменной окружения, имеет одно и то же имя, переменная, определенная с помощью **:Setvar** имеет преимущество.  
  
 Имена переменных не должны содержать пробелы.  
  
 Имена переменных не могут иметь тот же формат, что и выражение переменной: $(переменная).  
  
 Если строковое значение переменной скрипта содержит пробелы, то заключите значение в кавычки. Если значение для переменной скрипта не указано, переменная скрипта удаляется.  
  
 **:Listvar**  
 Список переменных скрипта, заданных в настоящее время.  
  
> [!NOTE]  
>  Отображаются только переменные, заданные программой **sqlcmd** и командой **:Setvar** .  
  
 **Команды вывода**  
  **:Error**   
 _**\<**_  _filename_  **_>|_ STDERR|STDOUT**  
 Перенаправляет вывод всех сообщений об ошибках в файл, указываемый параметром *имя_файла*, в поток **stderr** или **stdout**. Команда **Error** может встречаться в скрипте несколько раз. По умолчанию вывод об ошибках направляется в **STDERR**.  
  
 *имя_файла*  
 Создает и открывает файл, который принимает выходные данные. Если файл уже существует, он будет усечен до 0 байт. Если файл недоступен по причине нехватки разрешений или по другим причинам, вывод перенаправляется не в него, а в последнее указанное назначение или в назначение по умолчанию.  
  
 **STDERR**  
 Перенаправляет вывод сообщений об ошибках в поток **stderr** . Если было выполнено перенаправление, то адресат, которому был перенаправлен поток, получит выход ошибок.  
  
 **STDOUT**  
 Перенаправляет выход ошибок в поток **stdout** . Если было выполнено перенаправление, то адресат, которому был перенаправлен поток, получит выход ошибок.  
  
 **:Out \<** _filename_ **>** | **STDERR**| **STDOUT**  
 Создает и переадресовывает все результаты запроса в файл, указываемый параметром *имя_файла*, в **stderr** или **stdout**. По умолчанию вывод направляется в **stdout**. Если файл уже существует, то он усекается до 0 байт. Команда **Out** может встречаться в скрипте несколько раз.  
  
 **:Perftrace \<** _filename_ **>** | **STDERR**| **STDOUT**  
 Создает и переадресовывает все данные трассировки производительности в файл, указываемый параметром *имя_файла*, в **stderr** или **stdout**. По умолчанию вывод о трассировки производительности направляется в **stdout**. Если файл уже существует, то он усекается до 0 байт. Команда **Perftrace** может встречаться в скрипте несколько раз.  
  
 **Команды контроля выполнения**  
  **:On Error**[ **exit** | **ignore**]  
 Установка действия, выполняемого при возникновении ошибки во время исполнения скрипта или пакета.  
  
 Если используется параметр **exit** , программа **sqlcmd** завершает работу с возвратом соответствующего значения ошибки.  
  
 Если указан параметр **ignore** , программа **sqlcmd** пропускает ошибку и продолжает выполнять пакет или скрипт. По умолчанию выводится сообщение об ошибке.  
  
 [ **:** ] **QUIT**  
 Ведет к завершению работы **sqlcmd** .  
  
 [ **:** ] **EXIT**[ **(** _инструкция_ **)** ]  
 Позволяет использовать результат инструкции SELECT в качестве возвращаемого значения программы **sqlcmd**. Если числовой, первый столбец последней строки результатов преобразуется в 4-байтовое целое число (long). В MS-DOS, Linux и Mac младший байт передается родительскому процессу или уровню ошибки операционной системы. В Windows 200x передается 4-байтовое целое число. Синтаксис:  
  
 `:EXIT(query)`  
  
 Пример:  
  
 `:EXIT(SELECT @@ROWCOUNT)`  
  
 Также можно включить параметр **EXIT** в пакетный файл. Например, в командной строке введите:  
  
 `sqlcmd -Q "EXIT(SELECT COUNT(*) FROM '%1')"`  
  
 Программа **sqlcmd** отправляет на сервер все, что заключено в круглые скобки **()** . Если хранимая системная процедура выбирает набор и возвращает значение, то возвращается только выбранный набор. Инструкция EXIT **()** с пустыми круглыми скобками выполняет все, что предшествует ей в пакете, а затем завершается без возврата значения.  
  
 Если указан неверный запрос, программа **sqlcmd** завершает работу без возврата значения.  
  
 Список форматов инструкции EXIT:  
  
- :EXIT  
  
 Не выполняет пакет, немедленно завершает работу и не возвращает значения.  
  
- :EXIT( )  
  
 Выполняет пакет, завершает выполнение и не возвращает значения.  
  
- :EXIT(query)  
  
 Выполняет пакет, включая запрос, возвращает результаты запроса и завершает работу.  
  
 Если в скрипте **sqlcmd** используется параметр RAISERROR и при этом возникает состояние 127, программа **sqlcmd** завершает работу и возвращает клиенту идентификатор сообщения. Пример:  
  
 `RAISERROR(50001, 10, 127)`  
  
 Эта ошибка приведет к завершению скрипта **sqlcmd** , а клиенту будет возвращено сообщение с идентификатором 50001.  
  
 Возвращаемые значения от –1 до –99 резервируются SQL Server. Программа **sqlcmd** дополнительно определяет следующие возвращаемые значения:  
  
|Возвращаемые значения|Описание|  
|-------------------|-----------------|  
|–100|Перед выбором возвращаемого значения произошла ошибка.|  
|–101|При выборе возвращаемого значения не найдены строки.|  
|–102|При выборе возвращаемого значения произошла ошибка преобразования.|  
  
 **GO** [*число*]  
 GO обозначает конец пакета и выполнение любых кэшированных инструкций Transact-SQL. Пакет выполняется несколько раз в виде отдельных пакетов. Нельзя объявить переменную более одного раза в одном пакете.
  
 **Прочие команды**  
  **:r \<** _filename_ **>**  
 Производит синтаксический анализ дополнительных инструкций Transact-SQL и команд программы **sqlcmd** в файле **\<**_filename_**>** , загружая их в кэш инструкций.  
  
 Если файл содержит инструкции Transact-SQL, за которыми не следует ключевое слово **GO**, необходимо ввести **GO** в строку, следующую за **:r**.  
  
> [!NOTE]  
>  Файл **\<** _filename_ **>** считывается относительно стартового каталога, в котором была запущена программа **sqlcmd**.  
  
 Файл будет считан и выполнен после обнаружения признака конца пакета. Можно указывать несколько команд **:r** . В файле могут содержаться любые команды программы **sqlcmd** , в том числе признак конца пакета **GO**.  
  
> [!NOTE]  
>  Число строк, отображаемых в интерактивном режиме, для каждой найденной команды `:r` будет увеличено на 1. Команда `:r` отображается в выводе команды list.  
  
 **:Serverlist**  
 Выводит список локально настроенных серверов и имена серверов, осуществляющих трансляцию данных в сети.  
  
 **:Connect**_имя_сервера_[ **\\** _имя\_экземпляра_] [-l *время_ожидания*] [-U *имя_пользователя* [-P *пароль*]]  
 Подключается к экземпляру SQL Server. Также закрывает текущее соединение.  
  
 Параметры времени ожидания:  
  
|Значение|Поведение|  
|-|-|  
|0|ждать бесконечно|  
|n>0|ждать в течение n секунд|  
  
 Переменная скрипта SQLCMDSERVER отображает текущее активное соединение.  
  
 Если не указан параметр *timeout* , то берется значение переменной SQLCMDLOGINTIMEOUT по умолчанию.  
  
 Если указано только *имя_пользователя* (в виде параметра или в виде переменной среды), у пользователя будет запрошен пароль. Однако пользователи не получают запрос, если установлены переменные среды SQLCMDUSER или SQLCMDPASSWORD. Если никаких параметров и переменных среды не указано, для входа используется режим проверки подлинности Windows. Например, для подключения к экземпляру SQL Server (`instance1`) с именем `myserver` с использованием встроенной безопасности следует ввести следующую команду.  
  
 `:connect myserver\instance1`  
  
 Для подключения к экземпляру `myserver` по умолчанию с использованием переменных скрипта следует ввести следующее выражение:  
  
 `:setvar myusername test`  
  
 `:setvar myservername myserver`  
  
 `:connect $(myservername) $(myusername)`  
  
 [ **:** ] **!!** < *команда*>  
 Исполнение команд операционной системы. Чтобы выполнить команду операционной системы, начните строку с двух восклицательных знаков ( **!!** ) и далее укажите команду операционной системы. Пример:  
  
 `:!! Dir`  
  
> [!NOTE]  
>  Команда выполняется на компьютере, где запущена программа **sqlcmd** .  
  
 **:XML** [**ON** | **OFF**]  
 Дополнительные сведения см. в разделах этой статьи [Формат вывода XML](#OutputXML) и [Формат вывода JSON](#OutputJSON).  
  
 **:Help**  
 Выводит список команд программы **sqlcmd** вместе с кратким описанием.  
  
### <a name="sqlcmd-file-names"></a>Имена файлов sqlcmd  
 Входные файлы **sqlcmd** можно указать с помощью параметра **-i** или команды **:r** . Выходные файлы можно указать параметром **-o** или командами **:Error**, **:Out** и **:Perftrace** . При работе с этими файлами следует придерживаться следующих правил.  
  
- Для команд **:Error**, **:Out** и **:Perftrace** должно быть указано отдельное **\<**_filename_**>** . Одинаковое **\<**_filename_**>** может привести к смешиванию входных данных команд.  
  
- Если входной файл, вызываемый из программы **sqlcmd** на локальном компьютере, расположен на удаленном сервере и путь к нему содержит букву диска (например, ":Оut c:\OutputFile.txt"), то выходной файл создается на локальном компьютере, а не на удаленном сервере.  
  
- Допустимы следующие пути: `C:\<filename>`, `\\<Server>\<Share$>\<filename>` и `"C:\Some Folder\<file name>"`. Если путь содержит пробелы, его необходимо заключить в кавычки.  
  
- Каждый новый сеанс программы **sqlcmd** перезаписывает существующие файлы с теми же именами.  
  
### <a name="informational-messages"></a>Информационные сообщения

Программа **sqlcmd** выводит все информационные сообщения, отправляемые сервером. В следующем примере после выполнения инструкций Transact-SQL выводится информационное сообщение.
  
Введите в командную строку следующую команду.

`sqlcmd`
  
В командной строке sqlcmd введите:

`USE AdventureWorks2012;`

`GO`

При нажатии клавиши ВВОД выводится следующее информационное сообщение: Контекст базы данных изменен на AdventureWorks2012.  
  
### <a name="output-format-from-transact-sql-queries"></a>Формат вывода результатов выполнения запросов Transact-SQL  
 Сначала программа **sqlcmd** выводит заголовок с именами столбцов, перечисленными в списке выборки, которые разделяются символом, определенным в переменной SQLCMDCOLSEP. По умолчанию это пробел. Если имя столбца короче, чем ширина столбца, выходные данные дополняются пробелами до начала следующего столбца.  
  
 За этой строкой выводится строка-разделитель, которая представляет собой последовательность дефисов. Далее представлен пример вывода.  
  
 Запустите программу **sqlcmd**. Введите в командную строку **sqlcmd** следующий запрос.  
  
 `USE AdventureWorks2012;`  
  
 `SELECT TOP (2) BusinessEntityID, FirstName, LastName`  
  
 `FROM Person.Person;`  
  
 `GO`  
  
 После нажатия клавиши ВВОД отобразится следующий результирующий набор.  
  
 `BusinessEntityID FirstName    LastName`  
  
 `---------------- ------------ ----------`  
  
 `285              Syed         Abbas`  
  
 `293              Catherine    Abel`  
  
 `(2 row(s) affected)`  
  
 Хотя столбец `BusinessEntityID` имеет ширину в четыре символа, она была увеличена, чтобы вместить более длинное имя столбца. По умолчанию вывод заканчивается на 80 символе. Это можно изменить с помощью параметра **-w** , либо задав переменную скрипта SQLCMDCOLWIDTH.  
  
###  <a name="xml-output-format"></a><a name="OutputXML"></a> Формат вывода XML  
 Выходные XML-данные, получаемые в результате выполнения предложения FOR XML, выводятся непрерывным потоком в неформатированном виде.  
  
 Если вы ожидаете вывод XML-данных, воспользуйтесь следующей командой: `:XML ON`.  
  
> [!NOTE]  
>  Программа **sqlcmd** выводит сообщения об ошибках в обычном формате. Обратите внимание, что сообщения об ошибках также выводятся в текстовый поток в формате XML. Если указать параметр `:XML ON`, программа **sqlcmd** не выводит информационные сообщения.  
  
 Чтобы отключить режим XML, введите следующую команду: `:XML OFF`.  
  
 Команда GO не должна стоять раньше команды XML OFF, поскольку последняя возвращает **sqlcmd** в режим вывода с построчным форматированием.  
  
 Смешивание XML-данных (потоковых) и данных набора строк не допускается. Если перед выполнением инструкции Transact-SQL, которая выводит потоки XML-данных, не была введена команда XML ON, то вывод будет искажен. Если была выполнена команда XML ON, то выполнить инструкции Transact-SQL, которые выводят обычные наборы строк, нельзя.  
  
> [!NOTE]  
>  Команда `:XML` не поддерживает инструкцию SET STATISTICS XML.  
  
###  <a name="json-output-format"></a><a name="OutputJSON"></a> Формат вывода JSON  
 Если ожидается вывод данных JSON, воспользуйтесь следующей командой: `:XML ON`. В противном случае выходные данные содержат как имя столбца, так и текст JSON. Эти данные не являются допустимой JSON.  
  
 Чтобы отключить режим XML, введите следующую команду: `:XML OFF`.  
  
 Дополнительные сведения см. в разделе [Формат вывода XML](#OutputXML) этой статьи.  

### <a name="using-azure-active-directory-authentication"></a>Использование проверки подлинности Azure Active Directory

Примеры использования проверки подлинности Azure Active Directory:

```cmd
sqlcmd -S Target_DB_or_DW.testsrv.database.windows.net  -G  -l 30
sqlcmd -S Target_DB_or_DW.testsrv.database.windows.net -G -U bob@contoso.com -P MyAADPassword -l 30
```
  
## <a name="sqlcmd-best-practices"></a>Рекомендации по использованию sqlcmd

Чтобы добиться максимальной безопасности и эффективности, придерживайтесь следующих правил.  

- Используйте встроенную безопасность.  

- В автоматических средах указывайте параметр **-X[1]** .

- Обеспечьте защиту входных и выходных файлов при помощи соответствующих разрешений файловой системы NTFS.

- В целях повышения производительности выполняйте как можно больше работы в одном сеансе программы **sqlcmd** .

- Задайте значение времени ожидания для выполнения пакетов или запросов выше, чем ожидаемое время их выполнения.

Чтобы добиться максимальной правильности, придерживайтесь следующих правил.

- Для регистрации любых [сообщений уровня серьезности 16](../relational-databases/errors-events/database-engine-error-severities.md#levels-of-severity) используйте параметр **-V16**.  Сообщения уровня 16 обозначают общие ошибки, которые могут быть исправлены пользователем.

- После завершения процесса проверьте код завершения и переменную DOS ERRORLEVEL.  В обычном режиме **sqlcmd** возвращает 0, в противном случае — устанавливает уровень ошибки (ERRORLEVEL), настроенный с помощью **-V**.  Другими словами, не следует ожидать, что ERRORLEVEL будет иметь то же значение, что и Error Number (номер ошибки), полученный от SQL Server. Error Number — это характерное для SQL Server значение, соответствующее системной функции [ **@@ERROR**](../t-sql/functions/error-transact-sql.md).  ERRORLEVEL — это характерное для служебной программы sqlcmd значение, указывающее, почему она завершила работу. На это значение влияет указание аргумента командной строки **-b**.

Использование **-V16** в сочетании с проверкой кода завершения и DOS ERRORLEVEL может помочь в поиске ошибок в автоматических средах, особенно при проверках качества перед производственным выпуском.

## <a name="next-steps"></a>Дальнейшие действия

- [Запуск программы sqlcmd](~/relational-databases/scripting/sqlcmd-start-the-utility.md)
- [Выполнение файлов скрипта Transact-SQL с использованием программы sqlcmd](~/relational-databases/scripting/sqlcmd-run-transact-sql-script-files.md)
- [Использование программы sqlcmd](~/relational-databases/scripting/sqlcmd-use-the-utility.md)
- [Использование программы sqlcmd с переменными скрипта](~/relational-databases/scripting/sqlcmd-use-with-scripting-variables.md)
- [Подключение к компоненту Database Engine при помощи программы sqlcmd](~/relational-databases/scripting/sqlcmd-connect-to-the-database-engine.md)
- [Изменение скриптов SQLCMD при помощи редактора запросов](~/relational-databases/scripting/edit-sqlcmd-scripts-with-query-editor.md)
- [Управление шагами задания](~/ssms/agent/manage-job-steps.md)   
- [Create a CmdExec Job Step](~/ssms/agent/create-a-cmdexec-job-step.md)  

[!INCLUDE[get-help-options](../includes/paragraph-content/get-help-options.md)]