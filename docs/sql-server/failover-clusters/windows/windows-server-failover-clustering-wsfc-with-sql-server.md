---
title: Отказоустойчивый кластер Windows Server и SQL Server
description: Сведения об использовании службы отказоустойчивых кластеров Windows Server с SQL Server и экземплярами отказоустойчивого кластера.
ms.custom: seo-lt-2019
ms.date: 01/18/2017
ms.prod: sql
ms.reviewer: ''
ms.technology: failover-cluster-instance
ms.topic: conceptual
helpviewer_keywords:
- Availability Groups [SQL Server], WSFC clusters
- Windows Server Failover Clustering, with SQL Server
- WSFC, with SQL Server
- quorum [SQL Server]
- failover clustering [SQL Server], Always On Availability Groups
ms.assetid: 79d2ea5a-edd8-4b3b-9502-96202057b01a
author: cawrites
ms.author: chadam
ms.openlocfilehash: 56cfc62709e24fc48704ed44b86a866b07a0b0ef
ms.sourcegitcommit: 370cab80fba17c15fb0bceed9f80cb099017e000
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/17/2020
ms.locfileid: "97642672"
---
# <a name="windows-server-failover-clustering-with-sql-server"></a>Отказоустойчивая кластеризация Windows Server с SQL Server
[!INCLUDE [SQL Server](../../../includes/applies-to-version/sqlserver.md)]
  *Отказоустойчивый кластер Windows Server* (WSFC) представляет собой группу независимых серверов, совместная работа которых позволяет повысить доступность приложений и служб. [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] поддержка экземпляров отказоустойчивого кластера [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] и [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] осуществляется с использованием служб и возможностей WSFC.  
  
   
##  <a name="terms-and-definitions"></a><a name="TermsAndDefs"></a> Термины и определения  
 Отказоустойчивый кластер Windows Server (WSFC) — это группа независимых серверов, совместная работа которых позволяет повысить доступность приложений и служб.  
  
 Узел  
 Сервер, который является членом WSFC.
  
 Ресурс кластера  
 Физическая или логическая сущность, которая может принадлежать узлу, которую можно переводить в режимы «в сети» и «вне сети», перемещать между узлами и которой можно управлять как объектом кластера. Ресурс кластера может принадлежать одновременно только одному узлу.  
  
 Роль  
 Коллекция ресурсов кластера, управляемая как единый объект кластера и предоставляющая определенные функциональные возможности. Для SQL Server ролью будет группа доступности AlwaysOn или экземпляр отказоустойчивого кластера AlwaysOn. Роль содержит все ресурсы кластера, необходимые для роли группы доступности или экземпляра отказоустойчивого кластера. Отработка отказа и восстановление размещения всегда выполняются в контексте ролей. Роль экземпляра отказоустойчивого кластера содержит ресурс IP-адреса, ресурс сетевого имени и ресурсы SQL Server. Роль группы доступности содержит ресурс группы доступности, а также, если настроен прослушиватель, ресурсы сетевого имени и IP-адреса. 

 Ресурс сетевого имени  
 Имя логического сервера, которое управляется как ресурс кластера. Ресурс сетевого имени должен использоваться с ресурсом IP-адреса. Для этих элементов могут требоваться объекты в доменных службах Active Directory или в службе доменных имен (DNS). 
  
 Зависимость ресурсов  
 Ресурс, от которого зависит другой ресурс. Если ресурс А зависит от ресурса Б, то Б является зависимостью А. Ресурс A невозможно будет запустить, если отсутствует ресурс Б.  
  
  
 Предпочитаемый владелец  
 Предпочтительный узел для запуска группы ресурсов. Каждая группа ресурсов связана со списком предпочитаемых владельцев, отсортированных в порядке предпочтения. Во время автоматического перехода на другой ресурс группа ресурсов перемещается на следующий предпочтительный узел в списке.  
  
 Возможный владелец  
 Дополнительный узел, на котором может запускаться ресурс. Каждая группа ресурсов связана со списком возможных владельцев. Отработка отказа ролей может выполняться только на узлы из списка возможных владельцев.   
  
 Режим кворума  
 Конфигурация кворума в отказоустойчивом кластере, определяющая количество сбоев узлов, которое может выдержать кластер.  
  
 Обязательный кворум  
 Процесс запуска кластера несмотря на то, что на связи недостаточное количество элементов для кворума.  
  

##  <a name="overview-of-windows-server-failover-clustering"></a><a name="Overview"></a> Обзор отказоустойчивого кластера Windows Server  
 Отказоустойчивая кластеризация Windows Server предусматривает инфраструктурные компоненты, поддерживающие сценарии высокого уровня доступности и аварийного восстановления для таких размещенных серверных приложений, как Microsoft [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] и Microsoft Exchange. При отказе узла кластера или службы все службы, которые размещались на этом узле, могут автоматически или вручную переноситься на другой доступный узел в рамках процесса под названием *отработка отказа*.  
  
 Узлы в кластере WSFC за счет совместной работы обеспечивают следующие типы возможностей:  
  
-   **Распределенные метаданные и уведомления.** Метаданные служб и размещенных приложений WSFC хранятся на каждом узле кластера. Среди этих метаданных не только параметры размещенных приложений, но также конфигурация и состояние WSFC. Изменения в метаданных или состоянии узла автоматически распространяются на другие узлы кластера WSFC.  
  
-   **Управление ресурсами.** Отдельные узлы в кластере WSFC могут предоставлять физические ресурсы, например подключаемое напрямую хранилище, сетевые интерфейсы и доступ к общему дисковому хранилищу. Размещенные приложения регистрируют себя как ресурсы кластера и могут настраивать запуск и зависимости от исправности других ресурсов.  
  
-   **Мониторинг работоспособности.** Определение исправности основного узла и исправности между узлами осуществляется за счет сочетания сетевых соединений по типу тактовых импульсов и мониторинга ресурсов. Общее состояние работоспособности кластера WSFC определяется голосами кворума узлов в кластере.  
  
-   **Координация отработки отказа.** Каждый ресурс настроен для размещения на основном узле, и каждый можно автоматически или вручную переносить на один или несколько второстепенных узлов. Политика отработки отказа в зависимости от исправности управляет автоматическим переносом владения ресурсами между узлами. Узлы и размещенные приложения получают уведомления об отработке отказа, что позволяет им выполнить соответствующие действия.  
  
 Дополнительные сведения см. в статье [Failover Clustering Overview — Windows Server](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/hh831579(v=ws.11))(Обзор отказоустойчивой кластеризации — Windows Server).  
  
##  <a name="sql-server-always-on-technologies-and-wsfc"></a><a name="AlwaysOnWsfcTech"></a> Технологии SQL Server AlwaysOn и WSFC  
 [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] *AlwaysOn* — это решение высокого уровня доступности и аварийного восстановления с использованием WSFC. Компоненты AlwaysOn представляют собой интегрированные, гибкие решения, повышающие доступность приложений, окупаемость вложений в оборудование и упрощающее развертывание систем высокого уровня доступности и управление ими.  
  
 Экземпляры [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] и экземпляры отказоустойчивого кластера AlwaysOn используют технологию платформы WSFC и регистрируют компоненты в качестве ресурсов кластера WSFC.  Связанные ресурсы объединяются в *роль*, которую можно сделать зависимой от других ресурсов кластера WSFC. Затем кластер WSFC сможет выявлять необходимость в перезапуске экземпляра [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (и сигнализировать об этой необходимости), а также автоматически выполнять отработку отказа с переходом на другой серверный узел в кластере WSFC.  
  
> **ВАЖНО!** Чтобы воспользоваться всеми возможностями технологий [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] AlwaysOn, вам следует выполнить несколько связанных с WSFC предварительных требований.  
>   
>  Дополнительные сведения см. в разделе [Предварительные требования, ограничения и рекомендации для групп доступности AlwaysOn &#40;SQL Server&#41;](../../../database-engine/availability-groups/windows/prereqs-restrictions-recommendations-always-on-availability.md)  
  
### <a name="instance-level-high-availability-with-always-on-failover-cluster-instances"></a>Высокий уровень доступности на уровне экземпляра с помощью экземпляров отказоустойчивого кластера AlwaysOn  
 *Экземпляр отказоустойчивого кластера* AlwaysOn представляет собой экземпляр [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], установленный на нескольких узлах в кластере WSFC. Этот тип экземпляра зависит от ресурсов для хранения и имени виртуальной сети. Хранилище может использовать общее дисковое пространство на базе Fibre Channel, iSCSI, FCoE или SAS либо локально подключенное хранилище на основе [локальных дисковых пространств (S2D)](/windows-server/storage/storage-spaces/storage-spaces-direct-overview). Ресурс имени виртуальной сети зависит от одного или нескольких виртуальных IP-адресов, которые расположены в разных подсетях. Служба SQL Server и служба агента SQL Server также являются ресурсами, и обе они зависят от ресурсов хранилища и имени виртуальной сети.  
  
 В случае отработки отказа служба WSFC переносит владение ресурсов экземпляра на указанный узел отработки отказа. Затем экземпляр [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] перезапускается на узле отработки отказа и выполняется обычное восстановление баз данных. В любой момент времени FCI и базовые ресурсы могут размещаться только на одном узле в кластере.  
  
> **ПРИМЕЧАНИЕ.**  Экземпляру отказоустойчивого кластера AlwaysOn требуется симметричное общее дисковое хранилище, например сеть хранения данных (SAN) или общая папка SMB.  Тома общего дискового хранилища должны быть доступны всем потенциальным узлам отработки отказа в кластере WSFC.  
  
 Дополнительные сведения см. в разделе [Экземпляры отказоустойчивого кластера (режим AlwaysOn) &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md)  
  
### <a name="database-level-high-availability-with-sshadr"></a>Высокий уровень доступности на уровне баз данных с [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]  
 *Группа доступности* AlwaysOn — это одна или несколько пользовательских баз данных, для которых отработка отказа выполняется одновременно. Группа доступности состоит из первичной *реплики доступности* и от одной до четырех вторичных реплик, которые поддерживаются за счет перемещения данных на основании журнала SQL Server для обеспечения защиты данных, не требующей общего хранилища. Каждая реплика размещается в экземпляре [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] в отдельном узле кластера WSFC. Группа доступности и соответствующее имя виртуальной сети регистрируются как ресурсы в кластере WSFC.  
  
 *Прослушиватель группы доступности* на узле первичной реплики отвечает на входящие клиентские запросы на подключение к имени виртуальной сети и в зависимости от атрибутов в строке подключения перенаправляет каждый запрос в соответствующий экземпляр [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .  
  
 При отработке отказа вместо переноса владения общих физических ресурсов на другой узел WSFC используется для перенастройки вторичной реплики на другом экземпляре [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] в первичную реплику группы доступности. Затем ресурс виртуального сетевого имени группы доступности переводится на этот экземпляр.  
  
 Первичная реплика баз данных группы доступности одновременно может размещаться только на одном экземпляре [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , все связанные вторичные реплики должны находиться на отдельном экземпляре, и каждый экземпляр должен находиться на отдельном физическом узле.  
  
> **ПРИМЕЧАНИЕ.** [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] не требует развертывать экземпляр отказоустойчивого кластера или использовать симметричное общее хранилище (SAN или SMB).  
>   
>  Экземпляр отказоустойчивого кластера (FCI) может использоваться совместно с группой доступности для повышения доступности реплики доступности. Однако во избежание соперничества в кластере WSFC автоматический переход на другой ресурс группы доступности не поддерживается для реплики доступности, размещенной в FCI.  
  
 Дополнительные сведения см. в статье [Обзор групп доступности AlwaysOn SQL Server)](../../../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md)  
  
##  <a name="wsfc-health-monitoring-and-failover"></a><a name="AlwaysOnWsfcHealth"></a> Мониторинг исправности WSFC и отработка отказа  
 Высокий уровень доступности для решения AlwaysOn достигается за счет упреждающего мониторинга работоспособности физических и логических ресурсов кластера WSFC, а также за счет автоматического перехода на другой ресурс с переходом на дублирующее оборудование и его перенастройкой.  Системный администратор также может запустить *переход на другой ресурс вручную* для группы доступности или экземпляра [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] для перехода с одного узла на другой.  
  
### <a name="failover-policies-for-nodes-failover-cluster-instances-and-availability-groups"></a>Политики отработки отказа для узлов, экземпляров отказоустойчивого кластера и групп доступности  
 *Политика отработки отказа* настраивается на уровне узла кластера WSFC, экземпляра отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] и группы доступности.  Эта политика на основе серьезности, продолжительности и частоты неисправного состояния ресурса кластера и времени отклика узла может включать перезапуск службы или *автоматический переход на другой ресурс* с переходом с одного узла на другой либо включать перевод первичной реплики группы доступности с одного экземпляра [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] на другой.  
  
 Отработка отказа реплики группы доступности не влияет на базовый экземпляр [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .  При отработке отказа экземпляра отказоустойчивого кластера вместе с этим экземпляром перемещаются размещенные реплики группы доступности.  
  
 Дополнительные сведения см. в разделе [Политика отработки отказа для экземпляров откзоустойчивого кластера](../../../sql-server/failover-clusters/windows/failover-policy-for-failover-cluster-instances.md).  
  
### <a name="wsfc-resource-health-detection"></a>Определение исправности ресурсов WSFC  
 Все ресурсы в кластере WSFC могут сообщать о своем состоянии и работоспособности периодически или по запросу. Об отказе ресурса могут говорить различные обстоятельства, например неисправность электропитания, ошибки дисков или памяти, ошибки в сети, неотвечающие службы.  
  
 Ресурсы кластера WSFC, например сети, хранилища и службы, можно делать зависимыми друг от друга. Совокупная исправность ресурса определяется путем последовательного суммирования его работоспособности с исправностью каждого из зависимых ресурсов.  
  
### <a name="wsfc-inter-node-health-detection-and-quorum-voting"></a>Определение исправности между узлами WSFC и определение голосов в кворуме  
 Все узлы в кластере WSFC участвуют в периодической передаче пульса, сообщающего состояние работоспособности узла другим узлам. Неотвечающие узлы считаются неисправными.  
  
 *Кворум* — это механизм, позволяющий обеспечивать работоспособность кластера WSFC путем проверки наличия достаточного количества ресурсов в нем. Если кластер WSFC имеет достаточно голосов, он работоспособен и может обеспечивать отказоустойчивость на уровне узлов.  
  
 *Режим кворума* настраивается в кластере WSFC, который определяет методику голосования кворума, а также момент выполнения автоматического перехода на другой ресурс или перевода кластера в режим "вне сети". 
  
> **СОВЕТ.** Рекомендуется, чтобы число голосов кворума в кластере WSFC всегда было нечетным.  По соображениям голосования кворума нет необходимости устанавливать [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] на всех узлах в кластере. Дополнительный сервер может выступать в качестве члена кворума, либо модель кворума WSFC можно настроить для использования удаленной общей папки в качестве решающего голоса.  
>   
>  Дополнительные сведения см. в разделе [Режим кворума и участвующая в голосовании конфигурация WSFC (SQL Server)](../../../sql-server/failover-clusters/windows/wsfc-quorum-modes-and-voting-configuration-sql-server.md).  
  
### <a name="disaster-recovery-through-forcing-quorum"></a>Аварийное восстановление через принудительный кворум  
 В зависимости от принятых методов работы и конфигурации кластера WSFC можно использовать как автоматический, так и ручной переход на другой ресурс. При этом решение [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] AlwaysOn остается всегда надежным и отказоустойчивым. Однако если кворуму узлов с правом голоса в кластере WSFC не удается связаться друг с другом либо если кластеру WSFC по другим причинам не удается проверить работоспособность, то кластер WSFC может перейти в автономный режим.  
  
 При переходе кластера WSFC в автономный режим из-за неожиданной аварии или по причине постоянно возникающего сбоя в работе оборудования или ошибки связи требуется вмешательство администратора для *принудительного создания кворума* и переключения работоспособных кластеров обратно в режим "в сети" в неотказоустойчивой конфигурации.  
  
 После этого будет необходимо также предпринять ряд действий по перенастройке кластера WSFC, восстановлению затронутых реплик баз данных и повторному созданию кворума.  
  
 Дополнительные сведения см. в статье [Аварийное восстановление WSFC через принудительный кворум (SQL Server)](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md).  
  
##  <a name="relationship-of-sql-server-alwayson-components-to-wsfc"></a><a name="AlwaysOnWsfcRelationship"></a> Связь компонентов SQL Server AlwaysOn с WSFC  
 Между функциями и компонентами [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] AlwaysOn и WSFC существуют связи нескольких уровней.  
  
 Группы доступности AlwaysOn размещаются в экземплярах [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .  
 Клиентский запрос с указанием логического сетевого имени прослушивателя группы доступности для подключения к базе данных-источнику или базе данных-получателю направляется на соответствующее сетевое имя экземпляра базового экземпляра [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] или экземпляра отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].  
  
 Экземпляры SQL Server активно размещаются на одном узле.  
 Если имеется изолированный экземпляр [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , то он всегда находится на отдельном узле со статическим сетевым именем экземпляра.  Экземпляр отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (если он есть) активен на одном из нескольких возможных узлов отработки отказа с единым виртуальным сетевым именем экземпляра.  
  
 Узлы являются членами кластера WSFC.  
 Метаданные и состояние конфигурации WSFC для всех узлов сохраняются на каждом узле. Каждый сервер может предоставлять тома асимметричного хранения или общего хранения (SAN) для пользовательских и системных баз данных. Каждый сервер имеет по крайней мере один физический сетевой интерфейс в одной или нескольких IP-подсетях.  
  
 Кластер WSFC контролирует работоспособность группы серверов и управляет их конфигурацией.  
 Механизмы WSFC распространяют изменения в метаданных и состоянии конфигурации WSFC во всех узлах кластера WSFC. Если используется диск-свидетель, метаданные также хранятся на нем. По умолчанию каждый узел кластера WSFC имеет голос в кворуме, а ресурс-свидетель используется, если он необходим и настроен.
 
 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] — это подразделы кластера WSFC.  
 При удалении и повторном создании кластера WSFC необходимо отключить и повторно включить функцию [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] на каждом экземпляре сервера, на котором была включена функция [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] в исходном кластере WSFC. Дополнительные сведения см. в разделе [Включение и отключение групп доступности AlwaysOn (SQL Server)](../../../database-engine/availability-groups/windows/enable-and-disable-always-on-availability-groups-sql-server.md).  
  
 ![Схема контекста для компонента AlwaysOn в SQL Server](../../../sql-server/failover-clusters/windows/media/alwaysoncomponentcontextdiagram.gif "Схема контекста для компонента AlwaysOn в SQL Server")  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> Связанные задачи  
  
-   [Просмотр параметров NodeWeight кворума кластера](../../../sql-server/failover-clusters/windows/view-cluster-quorum-nodeweight-settings.md)  
  
-   [Настройка параметров NodeWeight для кворума кластера](../../../sql-server/failover-clusters/windows/configure-cluster-quorum-nodeweight-settings.md)  
  
-   [Принудительный запуск кластера WSFC без кворума](../../../sql-server/failover-clusters/windows/force-a-wsfc-cluster-to-start-without-a-quorum.md)  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> См. также  
  
-   [Технологии Windows Server: отказоустойчивые кластеры](https://technet.microsoft.com/library/cc732488\(v=WS.10\).aspx)  

-   [Обзор локальных дисковых пространств \(S2D\)](/windows-server/storage/storage-spaces/storage-spaces-direct-overview)

-   [Отказоустойчивые кластеры в Windows Server 2008 R2](https://technet.microsoft.com/library/ff182338\(WS.10\).aspx)  
  
-   [Просмотр событий и журналов для отказоустойчивого кластера](https://technet.microsoft.com/library/cc772342\(WS.10\).aspx)  
  
-   [Командлет Get-ClusterLog отказоустойчивого кластера](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/ee461045(v=technet.10))  
  
## <a name="see-also"></a>См. также:  
 [Экземпляры отказоустойчивого кластера AlwaysOn (SQL Server)](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md)   
 [Обзор групп доступности AlwaysOn SQL Server)](../../../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md)   
 [Режим кворума и участвующая в голосовании конфигурация WSFC (SQL Server)](../../../sql-server/failover-clusters/windows/wsfc-quorum-modes-and-voting-configuration-sql-server.md)   
 [Политика отработки отказа для экземпляров откзоустойчивого кластера](../../../sql-server/failover-clusters/windows/failover-policy-for-failover-cluster-instances.md)   
 [Аварийное восстановление WSFC через принудительный кворум (SQL Server)](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md)  
 [Windows Server 2016 поддерживает функцию локальных дисковых пространств Windows Server 2016](https://blogs.technet.microsoft.com/dataplatforminsider/2016/09/27/sql-server-2016-now-supports-windows-server-2016-storage-spaces-direct/)
