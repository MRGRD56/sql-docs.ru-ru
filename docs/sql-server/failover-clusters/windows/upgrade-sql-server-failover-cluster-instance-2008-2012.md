---
title: 'Обновление экземпляров SQL Server: кластеры Windows Server 2012 и других версий'
description: Сведения о том, как обновить экземпляры отказоустойчивого кластера SQL Server, работающие под управлением Windows Server 2008, Windows Server 2008 R2 и (или) Windows Server 2012.
ms.date: 06/15/2020
ms.custom: seo-lt-2019
ms.prod: sql
ms.technology: failover-cluster-instance
ms.topic: how-to
helpviewer_keywords:
- upgrading failover clusters
- clusters [SQL Server], upgrading
- failover clustering [SQL Server], upgrading
author: cawrites
ms.author: chadam
ms.openlocfilehash: 4d9e3116902ae96eaa97e9624ea33ba3fa8952d3
ms.sourcegitcommit: f29f74e04ba9c4d72b9bcc292490f3c076227f7c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/13/2021
ms.locfileid: "98171586"
---
# <a name="upgrade-sql-server-instances-running-on-windows-server-20082008-r22012-clusters"></a>Обновление экземпляров SQL Server, работающих в кластерах Windows Server 2008, Windows Server 2008 R2 или Windows Server 2012

[!INCLUDE[nextref-longhorn-md](../../../includes/nextref-longhorn-md.md)], [!INCLUDE[winserver2008r2-md](../../../includes/winserver2008r2-md.md)] и [!INCLUDE[win8srv-md](../../../includes/win8srv-md.md)] не позволяют отказоустойчивым кластерам Windows Server производить обновление операционной системы на месте, ограничивая допустимую версию [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] в кластере. Чтобы кластер оставался в актуальном состоянии, его следует обновить по меньшей мере до версии [!INCLUDE[winblue-server-2-md](../../../includes/winblue-server-2-md.md)].

## <a name="prerequisites"></a>Предварительные требования

-   Перед реализацией любых стратегий миграции необходимо подготовить параллельный отказоустойчивый кластер Windows Server с Windows Server 2016 или Windows Server 2012 R2. Все узлы, входящие в экземпляры отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], необходимо присоединить к кластеру Windows с установленными параллельными экземплярами отказоустойчивого кластера. Автономные компьютеры **не должны быть** присоединены к отказоустойчивому кластеру Windows Server перед миграцией. Пользовательские базы данных должны быть синхронизированы в новой среде перед миграцией.
-   Во всех конечных экземплярах должна использоваться та же версия [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], что и в параллельных экземплярах в исходной среде, с теми же именами и идентификаторами экземпляров и с теми же установленными компонентами. Пути установки и структура каталогов на конечных компьютерах должны быть аналогичными. Это не относится к именам виртуальных сетей экземпляров отказоустойчивого кластера, которые должны отличаться перед миграцией. Все функции, включенные в исходном экземпляре (AlwaysOn, FILESTREAM и т. д.), должны быть включены в конечном экземпляре.

-   В параллельном кластере не должны быть установлены [!INCLUDE[sshadrc-md](../../../includes/sshadrc-md.md)] перед миграцией.

-   Время простоя при миграции кластера, в котором используются только группы доступности (с экземплярами отказоустойчивого кластера SQL или без них), можно значительно сократить с помощью распределенных групп доступности, но для этого не требуется, чтобы во всех экземплярах использовалась версия [!INCLUDE[sssql15-md](../../../includes/sssql16-md.md)] RTM или более поздняя.

-   Для всех стратегий миграции требуется роль администратора [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]. Все учетные записи пользователей Windows, применяемые службами [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (например, учетная запись Windows, с которой выполняются агенты репликации), должны иметь разрешения уровня ОС на каждом компьютере в новой среде.

-   Сетевые общие папки и подключенные сетевые диски, используемые в среде исходного кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], должны по-прежнему существовать и быть доступными для конечного кластера с теми же разрешениями, что и исходные экземпляры.

-   Все порты TCP/IP, прослушиваемые исходным экземпляром [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], должны быть свободны и разрешать передачу входящего трафика на конечном компьютере.
-   Все связанные с SQL службы должны быть установлены и выполняться с применением той же учетной записи Windows.

-   Конечные экземпляры должны быть установлены с тем же языковым стандартом, что и исходные экземпляры.

## <a name="migration-scenarios"></a>Сценарии миграции

Оптимальная стратегия миграции зависит от определенных параметров топологии исходного кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], а именно от использования [!INCLUDE[sshadrc-md](../../../includes/sshadrc-md.md)] и экземпляров отказоустойчивого кластера SQL. Выбор стратегии также зависит от требований конечной среды. Если новая среда требует, чтобы для каждого компьютера или экземпляра отказоустойчивого кластера SQL сохранялось исходное имя виртуальной сети (VNN), или если топология [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] требует, чтобы новые экземпляры наследовали все системные объекты исходных экземпляров, необходимо выбрать стратегию, обеспечивающую перенос этих элементов.

|                                   | Требуются все серверные объекты и имена VNN | Требуются все серверные объекты и имена VNN | Серверные объекты и имена VNN не требуются\* | Серверные объекты и имена VNN не требуются\* |
|-----------------------------------|--------------------------------------|--------------------------------------------------------------------|------------|------------|
| **_Группы доступности? (да или нет_)**                  | **_Да_**                              | **_Нет_**                                                            | **_Да_**    | **_Нет_**    |
| **Кластер использует только экземпляр отказоустойчивого кластера SQL**         | [Сценарий 3](#scenario-3-windows-cluster-has-both-sql-fcis-and-sql-server-availability-groups)                           | [Сценарий 2](#scenario-2-windows-clusters-with-sql-server-failover-cluster-instances-fcis)                                                        | [Сценарий 1](#scenario-1-windows-cluster-with-sql-server-availability-groups-and-no-failover-cluster-instances-fcis) | [Сценарий 2](#scenario-2-windows-clusters-with-sql-server-failover-cluster-instances-fcis) |
| **Кластер использует автономные экземпляры** | [Сценарий 5](#scenario-5-windows-cluster-with-standalone-sql-server-instances-and-availability-groups)                           | [Сценарий 4](#scenario-4-windows-cluster-with-standalone-sql-server-instances-and-no-availability-groups)                                                         | [Сценарий 1](#scenario-1-windows-cluster-with-sql-server-availability-groups-and-no-failover-cluster-instances-fcis) | [Сценарий 4](#scenario-4-windows-cluster-with-standalone-sql-server-instances-and-no-availability-groups) |

\* Исключая имена прослушивателей группы доступности

## <a name="scenario-1-windows-cluster-with-sql-server-availability-groups-and-no-failover-cluster-instances-fcis"></a>Сценарий 1. Кластер Windows с группами доступности SQL Server и без экземпляров отказоустойчивого кластера
Если в установке [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] используются группы доступности без экземпляров отказоустойчивого кластера, для миграции в новый кластер можно создать параллельное развертывание [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] в другом кластере Windows с Windows Server 2016 или Windows Server 2012 R2. После этого можно создать распределенную группу доступности, в которой конечный кластер является вторичным по отношению к текущему рабочему кластеру. Для этого пользователю не нужно производить обновление до [!INCLUDE[sssql15-md](../../../includes/sssql16-md.md)] или более поздней версии.

###  <a name="to-perform-the-upgrade"></a>Выполнение обновления

1.  При необходимости обновите все экземпляры до [!INCLUDE[sssql15-md](../../../includes/sssql16-md.md)] или более поздней версии. В параллельных экземплярах должна использоваться одна и та же версия [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].

2.  Создайте группу доступности для конечного кластера. Если основной узел конечного кластера не является экземпляром отказоустойчивого кластера, создайте прослушиватель.

3.  Сформируйте распределенную группу доступности, в которой конечный кластер является вторичной группой доступности.

    >[!NOTE]
    >Параметр LISTENER\_URL запроса на создание распределенной группы доступности T-SQL работает несколько иначе для групп доступности, в которых экземпляр отказоустойчивого кластера SQL выступает в роли основного экземпляра. Если такой сценарий применяется для основной или вторичной группы доступности, используйте имя VNN основного экземпляра отказоустойчивого кластера SQL в качестве URL-адреса прослушивателя вместо сетевого имени прослушивателя, а также укажите порт конечной точки зеркального отображения базы данных.

4.  Присоединение вторичной группы доступности к распределенной группе доступности

5.  Присоедините базы данных-получатели во вторичной группе доступности.

    >[!NOTE]
    >Это будет сделано автоматически, если в конечной группе доступности используется автоматическое заполнение. Это возможно, только если пути к файлам данных и журналов во всех репликах одинаковы.

6.  Заблокируйте весь трафик к основной группе доступности и разрешите синхронизацию вторичной группы доступности.

7.  Поменяйте политику фиксации в обеих группах доступности на SYNCHRONOUS_COMMIT и проведите отработку отказа в целевой кластер, когда состояние изменится на SYNCHRONIZED.

8.  Удалите распределенную группу доступности.

9.  Удалите или переименуйте прослушиватель в исходной группе доступности.

10. Переименуйте существующий или создайте новый прослушиватель группы доступности с тем же именем, что и в исходной группе доступности.

    >[!NOTE]
    >Пока запись DNS для прослушивателя исходной группы доступности существует, попытки создать прослушиватель с тем же именем будут завершаться сбоем.

11. Возобновите передачу трафика в прослушиватель.

## <a name="scenario-2-windows-clusters-with-sql-server-failover-cluster-instances-fcis"></a>Сценарий 2. Кластеры Windows с экземплярами отказоустойчивого кластера SQL

Если в вашей среде [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] есть только экземпляры отказоустойчивого кластера SQL, для миграции в новый кластер можно создать параллельную среду [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] в другом кластере Windows с Windows Server 2016 или Windows Server 2012 R2. Для миграции в конечный кластер нужно извлечь имена VNN старых экземпляров отказоустойчивого кластера SQL и применить их в новых кластерах. В зависимости от времени распространения настроек DNS это может привести к увеличению времени простоя.

###  <a name="to-perform-the-upgrade"></a>Выполнение обновления

1.  Создайте полную резервную копию и остановите передачу трафика в исходный кластер [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].

2.  Для пользовательских баз данных создайте резервную копию заключительного фрагмента журнала и восстановите ее с помощью команды RESTORE WITH RECOVERY в новой среде.

3.  В конечном кластере в диспетчере отказоустойчивости кластеров отключите каждую кластерную роль экземпляра отказоустойчивого кластера SQL.

4.  В конечном кластере в диспетчере отказоустойчивости кластеров снова подключите кластерные диски, используемые каждым экземпляром отказоустойчивого кластера SQL.

5.  В исходном кластере в диспетчере отказоустойчивости кластеров отключите каждую кластерную роль экземпляра отказоустойчивого кластера SQL.

6.  В исходном кластере в диспетчере отказоустойчивости кластеров снова подключите кластерные диски, используемые каждым экземпляром отказоустойчивого кластера SQL.

7.  Скопируйте системные базы данных с исходных компьютеров на параллельные конечные компьютеры.

8.  В исходной среде в диспетчере отказоустойчивости кластеров измените имя ресурса "Имя сервера" для каждой роли экземпляра отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].

9.  Включите только переименованные ресурсы "Имя сервера" для каждой роли экземпляра отказоустойчивого кластера SQL.

10. В конечном кластере в диспетчере отказоустойчивости кластеров измените имя ресурса "Имя сервера" для каждой роли экземпляра отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] на имя, которое использовалось в исходном кластере.

    >[!NOTE]
    >Ошибки, связанные с тем, что имена уже заняты другими компьютерами, перестанут возникать после удаления записей DNS для этих имен.

11. После переименования всех экземпляров отказоустойчивого кластера перезапустите каждый компьютер в новом кластере.

12. После того как компьютеры снова подключатся после перезапуска, запустите каждую из ролей экземпляра отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] в диспетчере отказоустойчивости кластеров.

## <a name="scenario-3-windows-cluster-has-both-sql-fcis-and-sql-server-availability-groups"></a>Сценарий 3. Кластер Windows с экземплярами отказоустойчивого кластера SQL и группами доступности SQL Server

Если в установке [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] не используются автономные экземпляры [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], а только экземпляры отказоустойчивого кластера SQL, которые включены по крайней мере в одну группу доступности, выполнить миграцию в новый кластер можно с помощью методов, схожих с применяемыми в сценарии без групп доступности и автономных экземпляров. Перед копированием системных таблиц в общие диски конечных экземпляров отказоустойчивого кластера необходимо удалить все группы доступности в исходной среде. После переноса всех баз данных на конечные компьютеры следует повторно создать группы доступности, используя ту же схему и имена прослушивателей. Благодаря этому ресурсы отказоустойчивого кластера Windows Server будут правильно сформированы в конечном кластере, и управление ими будет осуществляться корректно. **Перед миграцией необходимо включить функцию AlwaysOn в диспетчере конфигурации [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] на каждом компьютере в конечной среде.**

### <a name="to-perform-the-upgrade"></a>Выполнение обновления

1.  Остановите передачу трафика в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].

2.  Для пользовательских баз данных создайте резервную копию заключительного фрагмента журнала и восстановите ее в новой среде с помощью команды RESTORE WITH RECOVERY в основной группе доступности и с помощью команды NORECOVERY во вторичных группах доступности.

3.  В конечном кластере в диспетчере отказоустойчивости кластеров отключите каждую кластерную роль экземпляра отказоустойчивого кластера SQL.

4.  В конечном кластере в диспетчере отказоустойчивости кластеров снова подключите кластерные диски, используемые каждым экземпляром отказоустойчивого кластера SQL.

5.  В исходном кластере удалите группу доступности.

6.  В исходном кластере в диспетчере отказоустойчивости кластеров отключите каждую кластерную роль экземпляра отказоустойчивого кластера SQL.

7.  В исходном кластере в диспетчере отказоустойчивости кластеров снова подключите кластерные диски, используемые каждым экземпляром отказоустойчивого кластера SQL.

8.  Скопируйте системные базы данных с исходных компьютеров на параллельные конечные компьютеры.

9.  В исходной среде в диспетчере отказоустойчивости кластеров измените имя ресурса "Имя сервера" для каждой роли экземпляра отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].

10. Включите только переименованные ресурсы "Имя сервера" для каждой роли экземпляра отказоустойчивого кластера SQL.

11. В конечном кластере в диспетчере отказоустойчивости кластеров измените имя ресурса "Имя сервера" для каждой роли экземпляра отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] на имя, которое использовалось в исходном кластере.

12. После переименования всех экземпляров отказоустойчивого кластера перезапустите каждый компьютер в новом кластере.

13. После того как компьютеры снова подключатся после перезапуска, запустите каждую из ролей экземпляра отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] в диспетчере отказоустойчивости кластеров.

14. Как только все экземпляры перейдут в режим "в сети", сформируйте группу доступности в реплике, в которой базы данных были восстановлены с помощью команды RESTORE WITH RECOVERY.

15. Присоедините все вторичные реплики и базы данных-получатели к группе доступности.

16. Создайте в новой группе доступности прослушиватель с тем же именем, что и в исходной группе доступности.

## <a name="scenario-4-windows-cluster-with-standalone-sql-server-instances-and-no-availability-groups"></a>Сценарий 4. Кластер Windows с автономными экземплярами SQL Server и без групп доступности

Миграция кластера с автономными экземплярами производится аналогично миграции кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], содержащего только экземпляры отказоустойчивого кластера, но вместо изменения имени VNN для кластерного ресурса "Сетевое имя" экземпляра отказоустойчивого кластера необходимо изменить имя исходного автономного компьютера и применить прежнее имя к конечному компьютеру. Время простоя по сравнению со сценарием без автономных экземпляров при этом не увеличивается, так как вы не можете присоединить конечный автономный компьютер к отказоустойчивому кластеру Windows Server, пока не получите прежнее сетевое имя исходного компьютера.

###  <a name="to-perform-the-upgrade"></a>Выполнение обновления

1.  Остановите передачу трафика в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].

2.  Для пользовательских баз данных создайте резервную копию заключительного фрагмента журнала и восстановите ее с помощью команды RESTORE WITH RECOVERY в новой среде на каждом компьютере.

3.  В конечном кластере в диспетчере отказоустойчивости кластеров отключите каждую кластерную роль экземпляра отказоустойчивого кластера SQL.

4.  В конечном кластере в диспетчере отказоустойчивости кластеров снова подключите кластерные диски, используемые каждым экземпляром отказоустойчивого кластера SQL.

5.  В исходном кластере в диспетчере отказоустойчивости кластеров отключите каждую кластерную роль экземпляра отказоустойчивого кластера SQL и остановите работу автономных экземпляров [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] в диспетчере конфигурации [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].

6.  Измените имя каждого автономного компьютера в исходном кластере на новое уникальное имя. Перезапустите каждый из этих компьютеров согласно указаниям.

7.  В исходном кластере в диспетчере отказоустойчивости кластеров снова подключите кластерные диски, используемые каждым экземпляром отказоустойчивого кластера SQL.

8.  Скопируйте системные базы данных на конечные компьютеры.

9.  В исходной среде в диспетчере отказоустойчивости кластеров измените имя ресурса "Имя сервера" для каждой роли экземпляра отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] на новое уникальное имя.

10. Включите только переименованные ресурсы "Имя сервера" для каждой роли экземпляра отказоустойчивого кластера SQL.

11. Теперь в параллельных автономных экземплярах переименуйте компьютеры, присвоив им имена исходных автономных компьютеров. (Удалите старые имена серверов и добавьте новые имена с помощью локального параметра.) Перезапустите компьютеры согласно указаниям.

12. После перезапуска присоедините каждый автономный компьютер к конечному отказоустойчивому кластеру Windows Server.

13. В конечном кластере в диспетчере отказоустойчивости кластеров измените имя ресурса "Имя сервера" для каждой роли экземпляра отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] на имя, которое использовалось в исходном кластере.

14. После переименования всех экземпляров отказоустойчивого кластера перезапустите каждый компьютер в новом кластере.

15. После того как компьютеры снова подключатся после перезапуска, запустите каждую из ролей экземпляра отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] в диспетчере отказоустойчивости кластеров.

## <a name="scenario-5-windows-cluster-with-standalone-sql-server-instances-and-availability-groups"></a>Сценарий 5. Кластер Windows с автономными экземплярами SQL Server и группами доступности

Миграция кластера, в котором используются группы доступности с автономными репликами, производится аналогично миграции кластера, в котором имеются экземпляры отказоустойчивого кластера и используются группы доступности. Вам также необходимо удалить исходные группы доступности и повторно создать их в конечном кластере. Однако время простоя увеличивается из-за необходимости переносить автономные экземпляры. **Перед миграцией необходимо включить функцию AlwaysOn в каждом экземпляре отказоустойчивого кластера в конечной среде.**

###  <a name="to-perform-the-upgrade"></a>Выполнение обновления

1.  Остановите передачу трафика в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].

2.  Для пользовательских баз данных создайте резервную копию заключительного фрагмента журнала и восстановите ее в новой среде с помощью команды RESTORE WITH RECOVERY в основной группе доступности и с помощью команды NORECOVERY в каждой вторичной группе доступности.

3.  В исходном кластере удалите группу доступности.

4.  В конечном кластере в диспетчере отказоустойчивости кластеров отключите каждую кластерную роль экземпляра отказоустойчивого кластера SQL.

5.  В конечном кластере в диспетчере отказоустойчивости кластеров снова подключите кластерные диски, используемые каждым экземпляром отказоустойчивого кластера SQL.

6.  В исходном кластере в диспетчере отказоустойчивости кластеров отключите каждую кластерную роль экземпляра отказоустойчивого кластера SQL и остановите работу автономных экземпляров [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] в диспетчере конфигурации [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].

7.  Измените имя каждого автономного компьютера в исходном кластере на новое уникальное имя. Перезапустите каждый из этих компьютеров согласно указаниям.

8.  В исходном кластере в диспетчере отказоустойчивости кластеров снова подключите кластерные диски, используемые каждым экземпляром отказоустойчивого кластера SQL.

9.  Скопируйте системные базы данных на конечные компьютеры.

10. В исходной среде в диспетчере отказоустойчивости кластеров измените имя ресурса "Имя сервера" для каждой роли экземпляра отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] на новое уникальное имя.

11. Включите только переименованные ресурсы "Имя сервера" для каждой роли экземпляра отказоустойчивого кластера SQL.

12. Теперь в параллельных автономных экземплярах переименуйте компьютеры, присвоив им имена исходных автономных компьютеров. (Удалите имя сервера в SQL, а затем добавьте его.) Перезапустите компьютеры согласно указаниям.

13. После перезапуска присоедините каждый автономный компьютер к конечному отказоустойчивому кластеру Windows Server.

14. В конечном кластере в диспетчере отказоустойчивости кластеров измените имя ресурса "Имя сервера" для каждой роли экземпляра отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] на имя, которое использовалось в исходном кластере.

15. После переименования всех экземпляров отказоустойчивого кластера перезапустите каждый компьютер в новом кластере.

16. После того как компьютеры снова подключатся после перезапуска, запустите каждую из ролей экземпляра отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] в диспетчере отказоустойчивости кластеров.

17. После того как все экземпляры перейдут в режим "в сети", повторно создайте группу доступности в основном экземпляре.

18. Присоедините все вторичные реплики и базы данных-получатели.

19. Повторно создайте прослушиватель группы доступности с тем же именем, что и в исходной группе доступности.

## <a name="specific-concerns-for-individual-features"></a>Вопросы, касающиеся отдельных компонентов

### [!INCLUDE[sshadrc-md](../../../includes/sshadrc-md.md)]

-   **Конечная точка зеркального отображения базы данных**

    С точки зрения SQL конечная точка зеркального отображения баз данных переносится в новый экземпляр [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] вместе с системными таблицами. Перед миграцией убедитесь в том, что в брандмауэрах применены соответствующие правила и что другие процессы не ожидают передачи данных через тот же порт.

-   **Группы доступности**

    Группы доступности и их прослушиватели невозможно переносить между экземплярами. Ресурсы отказоустойчивого кластера Windows Server, созданные группой доступности, нельзя легко воссоздать в конечной среде. Вместо того чтобы пытаться перенести группы доступности, мы рекомендуем удалить и повторно создать группы доступности в конечном кластере.

-   **Прослушиватели групп доступности**

    Вместо переноса прослушивателей напрямую их следует удалять и создавать повторно, так же как и сами группы доступности.

### <a name="replication"></a>Репликация

-   **Удаленные распространители, издатели, подписчики**

    Отношение между распространителем и издателем зависит только от имен VNN компьютеров, на которых размещаются эти экземпляры. Они должны правильно разрешаться в имена новых компьютеров. Задания агентов [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] также правильно переносятся вместе с системными таблицами, поэтому выполнение различных агентов репликации может продолжаться в обычном режиме. Однако перед миграцией необходимо, чтобы все учетные записи Windows, с помощью которых выполняется сам агент [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] или любые задания агента [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], имели те же разрешения в конечной среде. Взаимодействие с издателем и подписчиками будет осуществляться обычным образом.

-   **Папка моментальных снимков**

    Перед миграцией необходимо предоставить компьютерам в конечной среде доступ ко всем сетевым папкам, используемым компонентами [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], с теми же разрешениями, что и в исходной среде. Для этого нужно выполнить соответствующие действия.

### <a name="service-broker"></a>Service Broker

-   **Конечная точка Service Broker**

    Никаких особых требований к этой конечной точке [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] не предъявляет. Перед миграцией необходимо убедиться в том, что нет процессов, ожидающих передачи данных через тот же порт, и что он не блокируется правилом брандмауэра или что есть правило брандмауэра, явным образом разрешающее этот порт.

-   **Сертификаты**

    Если сертификаты требуются на новых компьютерах, следует выполнить их резервное копирование, а затем восстановить на конечных компьютерах.

-   **Маршруты**

    Маршруты зависят от имени виртуальной сети в конечной среде. Как имена компьютеров, так и сетевые имена экземпляров отказоустойчивого кластера SQL должны правильно разрешаться в имена компьютеров в новой среде. Прочие используемые имена VNN также должны быть перенаправлены на новые компьютеры.

-   **Привязки удаленных служб**

    Привязки удаленных служб после миграции должны работать требуемым образом, так как переносятся все учетные записи пользователей, использующие эти привязки.

### <a name="ssnoversion-agent"></a>Агент[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]

-   **Задания**

    Задания переносятся надлежащим образом вместе с системными базами данных. Любой пользователь, от имени которого выполняется задание агента SQL или сам агент SQL, будет иметь на конечном компьютере разрешения, указанные в предварительных требованиях.

-   **Предупреждения и операторы**

    Предупреждения и операторы переносятся надлежащим образом вместе с системными базами данных.

### <a name="filestream"></a>FILESTREAM

-   **Порты обмена файлами Windows**

    Для портов обмена файлами Windows 139 и 445 должны быть настроены правила, разрешающие использование файлового потока для входящего трафика FILESTREAM.

-   **Общий ресурс Windows**

    Путь к общему ресурсу Windows зависит от ресурса имени экземпляра отказоустойчивого кластера SQL по пути `\\ServerName\ShareName`. Для переноса файлового потока необходимо, чтобы он был включен во всех узлах конечного экземпляра отказоустойчивого кластера. При использовании общего ресурса Windows для всех этих узлов должно быть настроено использование того же имени общего ресурса Windows, что и на исходном компьютере. После получения правильного имени сервера конечным экземпляром отказоустойчивого кластера общий ресурс Windows будет размещаться в нем по нужному пути.

-   **Данные файлового потока**

    Данные файлового потока включаются в резервную копию.

### <a name="integration-services"></a>Службы Integration Services

-   **Проекты служб SSIS**

    Проекты служб SSIS переносятся вместе с базой данных SSIS. Пакеты могут выполняться сразу после переноса базы данных SSIS до того, как будут перемещены системные таблицы.

-   **Файловые источники данных**

    Неструктурированные файлы, файлы Excel, источники XML и другие источники должны быть доступны в расположениях, указанных в пакете служб SSIS.

## <a name="next-steps"></a>Дальнейшие действия
- [Завершение обновления ядра СУБД](../../../database-engine/install-windows/complete-the-database-engine-upgrade.md)
- [Изменение режима совместимости базы данных и использование хранилища запросов](../../../database-engine/install-windows/change-the-database-compatibility-mode-and-use-the-query-store.md)
- [Использование преимуществ новых функций SQL Server 2016](../../what-s-new-in-sql-server-2017.md)
- [Обновление экземпляра отказоустойчивого кластера SQL Server](upgrade-a-sql-server-failover-cluster-instance.md).
- [Просмотр и чтение файлов журналов программы установки SQL Server](../../../database-engine/install-windows/view-and-read-sql-server-setup-log-files.md)
- [Добавление компонентов в экземпляр SQL Server 2016 (программа установки)](../../../database-engine/install-windows/add-features-to-an-instance-of-sql-server-setup.md)