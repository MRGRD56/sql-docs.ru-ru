---
title: Обновление экземпляра отказоустойчивого кластера
description: Сведения о процедуре обновления экземпляра отказоустойчивого кластера SQL Server группы доступности Always On с использованием установочного носителя. Сведения о последовательном обновлении и обновлении кластера с несколькими подсетями.
ms.custom: seo-lt-2019
ms.date: 11/21/2019
ms.prod: sql
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- upgrading failover cluster instances
- clusters [SQL Server], upgrading
- failover clustering [SQL Server], upgrading
ms.assetid: daac41fe-7d0b-4f14-84c2-62952ad8cbfa
author: cawrites
ms.author: chadam
ms.openlocfilehash: cad44bde76e3915aeb5f99d8eeb415d89b02359e
ms.sourcegitcommit: 5a1ed81749800c33059dac91b0e18bd8bb3081b1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/23/2020
ms.locfileid: "96127587"
---
# <a name="upgrade-a-failover-cluster-instance"></a>Обновление экземпляра отказоустойчивого кластера 
[!INCLUDE [SQL Server](../../../includes/applies-to-version/sqlserver.md)]
  [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] поддерживает обновление отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] при установке новой версии [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], нового пакета обновления [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]или накопительного пакета обновления, а также при установке нового пакета обновлений Windows или накопительного пакета обновлений Windows отдельно на все отказоустойчивые кластеры. Это позволяет сократить время простоя до одной операции перехода на другой ресурс вручную (или двух таких операций, если нужно перейти на исходную первичную реплику).  

  
 Обновление операционной системы Windows Server узла, содержащего экземпляр отказоустойчивого кластера, не поддерживается для операционных систем до [!INCLUDE[winblue-server-2-md](../../../includes/winblue-server-2-md.md)]. Сведения об обновлении узла отказоустойчивого кластера Windows Server, работающего на [!INCLUDE[winblue-server-2-md](../../../includes/winblue-server-2-md.md)] или более поздней версии, см. в разделе [Выполнение последовательного обновления](#perform-a-rolling-upgrade-or-update).  
  
 Далее приведены сведения о поддержке:  
  
-   Обновление [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] можно выполнить как через пользовательский интерфейс, так и с помощью командной строки. Обновление можно запустить из командной строки на каждом узле отказоустойчивого кластера. Можно также обновить каждый узел кластера при помощи пользовательского интерфейса программы установки [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]. Дополнительные сведения можно найти в разделе

   - Установка нового экземпляра отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]
   - [Установка SQL Server из командной строки](../../../database-engine/install-windows/install-sql-server-from-the-command-prompt.md)

-   В [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] не поддерживаются следующие сценарии в рамках обновления:  
  
    -   Невозможно обновить изолированный экземпляр [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] до экземпляра кластера отработки отказа.  
  
    -   Невозможно добавить компоненты в экземпляр кластера отработки отказа. Например, невозможно добавить компонент [!INCLUDE[ssDE](../../../includes/ssde-md.md)] в существующий экземпляр отказоустойчивого кластера, содержащий только службы [!INCLUDE[ssASnoversion](../../../includes/ssasnoversion-md.md)].  
  
    -   Невозможно понизить уровень экземпляра отказоустойчивого кластера до изолированного экземпляра на любом узле отказоустойчивого кластера Windows Server.  
  
    -   Изменение выпуска экземпляра отказоустойчивого кластера ограничено определенными сценариями. Дополнительные сведения см. в статье [Supported Version and Edition Upgrades](../../../database-engine/install-windows/supported-version-and-edition-upgrades.md).  
  
-   При обновлении экземпляра отказоустойчивого кластера время простоя ограничивается временем отработки отказа и временем, необходимым для обновления запускаемых скриптов. При соблюдении процесса последовательного обновления экземпляра отказоустойчивого кластера, описанного ниже, и выполнении всех предварительных условий для всех узлов до начала процедуры обновления время простоя сводится к минимуму. Обновление [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] при использовании оптимизированных для памяти таблиц займет немного больше времени. Дополнительные сведения см. в разделе [Составление и тестирование плана обновления ядра СУБД](../../../database-engine/install-windows/plan-and-test-the-database-engine-upgrade-plan.md).  
  
## <a name="prerequisites"></a>Предварительные требования  
 Перед установкой ознакомьтесь со следующими важными сведениями.  
  
-   [Поддерживаемые обновления версий и выпусков](../../../database-engine/install-windows/supported-version-and-edition-upgrades.md). Убедитесь в том, что текущая версия операционной системы Windows позволяет обновить текущую версию [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] до версии [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)]. Например, невозможно напрямую обновить экземпляр отказоустойчивого кластера SQL Server 2005 до версии [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] или обновить экземпляр отказоустойчивого кластера, запущенный в [!INCLUDE[winxpsvr-md](../../../includes/winxpsvr-md.md)].  
  
-   [Выбор метода обновления ядра СУБД](../../../database-engine/install-windows/choose-a-database-engine-upgrade-method.md). Выберите подходящий метод обновления с учетом сведений о поддерживаемых версиях и обновлениях выпуска, а также компонентах, установленных в среде и требующих обновления (это нужно, чтобы обеспечить правильный порядок обновления этих компонентов).  
  
-   [Составление и тестирование плана обновления ядра СУБД](../../../database-engine/install-windows/plan-and-test-the-database-engine-upgrade-plan.md). Просмотрите заметки о выпуске и известные проблемы, связанные с обновлением, изучите контрольный список предварительных требований, а затем разработайте и протестируйте план обновления.  
  
-   [Требования к оборудованию и программному обеспечению для установки SQL Server](../../../sql-server/install/hardware-and-software-requirements-for-installing-sql-server.md):  Изучите требования к программному обеспечению для установки [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)]. Если требуется дополнительное программное обеспечение, установите его на каждом узле перед запуском обновления, чтобы минимизировать время простоя.  
  
## <a name="perform-a-rolling-upgrade-or-update"></a>Выполнение последовательного обновления  
 Чтобы обновить экземпляр отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] до [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)], используйте программу установки [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], чтобы обновить каждый узел, входящий в состав экземпляра отказоустойчивого кластера, по одному за раз, начиная с пассивных узлов. В процессе обновления каждого узла связи последнего с возможными владельцами соответствующего экземпляра отказоустойчивого кластера прерываются. В случае непредвиденной отработки отказа обновленные узлы не участвуют в этом процессе до тех пор, пока программа установки [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] не передаст роль отказоустойчивого кластера Windows Server во владение одному из обновленных узлов.  
  
 По умолчанию программа установки [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] автоматически определяет момент перехода на обновленный узел. Этот момент определяется в зависимости от общего числа узлов в экземпляре отказоустойчивого кластера и от количества уже обновленных узлов. Если обновлена половина или большее число узлов, при выполнении обновления следующего узла программа установки [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] осуществляет отработку отказа с переходом на один из обновленных узлов. После отработки отказа с переходом на обновленный узел кластерная группа перемещается на обновленный узел. Все обновленные узлы помещаются в список возможных владельцев, а все еще не обновленные узлы удаляются из списка возможных владельцев. При обновлении каждого из оставшихся узлов этот узел добавляется к возможным владельцам соответствующего экземпляра отказоустойчивого кластера.  
  
 В результате этого процесса время простоя ограничивается временем отработки отказа и временем выполнения скрипта обновления базы данных в течение всей операции обновления отказоустойчивого кластера.  
  
 Чтобы управлять отработкой отказа узлов кластера во время обновления, запустите операцию обновления из командной строки с параметром /FAILOVERCLUSTERROLLOWNERSHIP. Дополнительные сведения см. в разделе [Установка SQL Server из командной строки](../../../database-engine/install-windows/install-sql-server-from-the-command-prompt.md).  

 ## <a name="upgrade-with-installation-media"></a>Обновление с установочного носителя 
  
1.  На установочном носителе [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] для выпуска, соответствующего обновляемому выпуску, дважды щелкните файл setup.exe в корневой папке. Может появиться запрос на установку обязательных компонентов, если они не установлены ранее.  
  
2.  После установки необходимых компонентов мастер установки запустит центр установки [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] . Чтобы обновить существующий экземпляр служб [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], выберите свой экземпляр.  
  
3.  Если требуются файлы поддержки программы установки [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , программа установки [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] установит их. Если будет предложено перезагрузить компьютер, перезапустите его перед продолжением.  
  
4.  Средство проверки конфигурации системы запускает операцию обнаружения на компьютере. Чтобы продолжить, [!INCLUDE[clickOK](../../../includes/clickok-md.md)].  
  
5.  На странице «Ключ продукта» введите ключ идентификатора продукта (PID) для выпуска новой версии, соответствующий выпуску старой версии продукта. Например, чтобы обновить отказоустойчивый кластер выпуска Enterprise, нужно ввести ключ PID для выпуска [!INCLUDE[ssEnterprise](../../../includes/ssenterprise-md.md)]. Чтобы продолжить, нажмите кнопку **Далее** . Не забудьте, что используемый для обновления отказоустойчивого кластера ключ PID должен быть согласован во всех узлах данного экземпляра отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .  
  
6.  На странице «Условия лицензии» прочтите лицензионное соглашение, а затем установите флажок, подтверждая принятие условий соглашения. Чтобы помочь в улучшении [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], можно также включить параметр наблюдения за использованием компонентов и отправлять отчеты в [!INCLUDE[msCoName](../../../includes/msconame-md.md)]. **Чтобы продолжить, нажмите кнопку "Далее"** . Чтобы выйти из программы установки, нажмите кнопку **Отмена**.  
  
7.  На странице «Выбор экземпляра» укажите экземпляр [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , который необходимо обновить до [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)]. **Чтобы продолжить, нажмите кнопку "Далее"** .  
  
8.  На странице Выбор компонентов компоненты для обновления предварительно выбраны. После выбора компонента описание его группы отображается в правой панели окна. Не забудьте, что во время обновления невозможно ни изменять обновляемые компоненты, ни добавлять их. Инструкции по добавлению компонентов к обновляемому экземпляру [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] после завершения обновления см. в разделе [Добавление компонентов в экземпляр SQL Server 2016 (программа установки)](../../../database-engine/install-windows/add-features-to-an-instance-of-sql-server-setup.md).  
  
     Требования для выбранных компонентов показаны на правой панели. Программа установки SQL Server установит обязательный компонент, который еще не был установлен, в шаге установки, описанном ниже в данной процедуре. Чтобы сэкономить время, следует предварительно установить эти обязательные компоненты на каждом узле.  
  
9. На странице «Конфигурация экземпляра» поля автоматически заполняются из старого экземпляра. Можно указать новое значение идентификатора экземпляра.  
  
     **Идентификатор экземпляра** — по умолчанию в качестве идентификатора экземпляра используется его имя. Предназначен для идентификации каталогов установки и разделов реестра для данного экземпляра [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]. Действует как для экземпляров по умолчанию, так и для именованных экземпляров. Для экземпляра по умолчанию именем и идентификатором экземпляра является «MSSQLSERVER». Если необходимо, чтобы идентификатор экземпляра отличался от значения по умолчанию, установите флажок **Идентификатор экземпляра** и введите значение. При переопределении значения по умолчанию необходимо указывать один и тот же идентификатор экземпляра для обновляемого экземпляра на всех узлах отказоустойчивого кластера. Значение идентификатора экземпляра должно быть идентичным для всех узлов.  
  
     **Обнаруженные экземпляры и компоненты** — в сетке показаны все установленные экземпляры [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] на компьютере, на котором запущена программа установки. **Чтобы продолжить, нажмите кнопку "Далее"** .  
  
10. На странице «Требования к свободному месту на диске» показан расчет требуемого пространства на диске для выбранных компонентов, а также приведено сравнение требуемого и имеющегося свободного места на компьютере, на котором работает программа установки.  
  
11. На странице «Обновление полнотекстового поиска» укажите параметры обновления для обновляемых баз данных. Дополнительные сведения см. в разделе [Параметры обновления полнотекстового поиска](../../../database-engine/install-windows/install-sql-server.md).  
  
12. На странице **Отчеты об ошибках** укажите сведения, которые будут отправлены в [!INCLUDE[msCoName](../../../includes/msconame-md.md)] и помогут улучшить [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]. По умолчанию параметры создания отчетов об ошибках включены.  
  
13. Перед началом операции обновления средство проверки конфигурации выполнится еще раз для оценки конфигурации компьютера с выбранными компонентами [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .  
  
14. На странице «Отчет по обновлению кластера» отображается список узлов экземпляра отказоустойчивого кластера и сведения о версии экземпляра для компонентов [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] на каждом узле. Также отображается состояние скрипта базы данных и состояние скрипта репликации. Кроме того, на этой странице выводятся информационные сообщения о том, что произойдет при нажатии кнопки **Далее**. В программе установки отображается поведение при отработке отказа после нажатия кнопки **Далее** в зависимости от количества уже обновленных узлов отказоустойчивого кластера и общего числа узлов. Кроме того, если еще не установлены необходимые компоненты, программа предупреждает о возможных простоях.   
  
15. На странице готовности к обновлению отображается представление параметров установки в виде дерева, заданных в программе установки. Чтобы продолжить, нажмите кнопку **Обновить**. [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Программа установки вначале устанавливает требуемые компоненты для выбранных средств, затем устанавливает сами средства.  
  
16. В ходе обновления на странице выполнения установки отображается информация о состоянии, так что во время выполнения программы установки можно наблюдать за ходом обновления на текущем узле.  
  
17. По завершении обновления текущего узла на странице «Отчет по обновлению кластера» отображаются сведения о состоянии обновления для всех узлов отказоустойчивого кластера, компонентов на каждом узле отказоустойчивого кластера, а также информация об их версиях. Подтвердите отображенную информацию о версии и продолжайте обновление оставшихся узлов. В случае отработки отказа с переходом на обновленные узлы информация об этом будет также отображена на странице состояния. Эти данные можно также проверить в оснастке Windows «Администрирование кластера».  
  
18. После обновления на завершающей странице будет приведена ссылка на файл сводного журнала установки и даны другие важные примечания. Чтобы завершить процесс установки [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , нажмите кнопку **Готово**.  
  
19. Если будет предложено перезагрузить компьютер, выполните перезагрузку. После завершения установки важно прочитать сообщение мастера установки. Дополнительные сведения о файлах журналов установки см. в разделе [Просмотр и чтение файлов журналов программы установки SQL Server](../../../database-engine/install-windows/view-and-read-sql-server-setup-log-files.md).  
  
20. Чтобы завершить процесс обновления, повторите эти шаги на всех остальных узлах экземпляра отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].  
  
## <a name="upgrade-a-multi-subnet-failover-cluster-instance"></a>Обновление экземпляра отказоустойчивого кластера с несколькими подсетями  

Выполните следующие шаги, чтобы обновить экземпляр отказоустойчивого кластера Always On в среде с несколькими подсетями. 
  
### <a name="to-upgrade-to-a-ssnoversion-multi-subnet-failover-cluster-instance-existing-ssnoversion-cluster-is-a-non-multi-subnet-cluster"></a>Обновление до экземпляра отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] с несколькими подсетями (существующий кластер [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] не является кластером с несколькими подсетями).  
  
1.  Выполните описанные выше действия, чтобы обновить экземпляр отказоустойчивого кластера.  
  
2.  С помощью действия установки AddNode добавьте узел из другой подсети и подтвердите значение зависимости OR для ресурса IP-адреса на странице **Конфигурация сети кластера**. Дополнительные сведения см. на странице [Добавление и удаление узлов в экземпляре отказоустойчивого кластера Always On (настройка)](../install/add-or-remove-nodes-in-a-sql-server-failover-cluster-setup.md).  
  
### <a name="to-upgrade-a-multi-subnet-failover-cluster-instance-currently-using-stretch-vlan-to-use-multi-subnet"></a>Обновите экземпляр отказоустойчивого кластера с несколькими подсетями, в настоящее время использующий функцию Stretch VLAN, чтобы использовать несколько подсетей.  
  
1.  Выполните действия, перечисленные выше, чтобы обновить кластер до [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].  
  
2.  Измените параметры сети, чтобы переместить удаленный узел в другую подсеть.  
  
3.  С помощью Диспетчера отказоустойчивого кластера или PowerShell добавьте новый IP-адрес для новой подсети, чтобы задать для зависимости ресурса IP-адреса значение OR.  
  
## <a name="next-steps"></a>Next Steps  
 После обновления до [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)]выполните следующие задачи.  
  
-   [Завершение обновления ядра СУБД](../../../database-engine/install-windows/complete-the-database-engine-upgrade.md)  
  
-   [Изменение режима совместимости базы данных и использование хранилища запросов](../../../database-engine/install-windows/change-the-database-compatibility-mode-and-use-the-query-store.md)  
  
-   [Использование преимуществ новых функций SQL Server 2016](../../what-s-new-in-sql-server-2017.md)  
  

  
