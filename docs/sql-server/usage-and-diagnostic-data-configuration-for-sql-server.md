---
title: Настройка сбора данных об использовании и данных диагностики для SQL Server (CEIP) | Документация Майкрософт
description: Сведения о данных, которые SQL Server собирает от пользователей для улучшения продуктов. Узнайте, как отключить в SQL Server отправку этих данных.
author: MikeRayMSFT
ms.author: mikeray
ms.date: 03/27/2019
ms.topic: conceptual
ms.prod: sql
ms.custom: ''
ms.technology: configuration
ms.openlocfilehash: 0fc8437d6ffb3382dbcc53edc816b00ec22b7a07
ms.sourcegitcommit: 917df4ffd22e4a229af7dc481dcce3ebba0aa4d7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/10/2021
ms.locfileid: "100353576"
---
# <a name="configure-usage-and-diagnostic-data-collection-for-sql-server-ceip"></a>Настройка сбора данных об использовании и данных диагностики для SQL Server (CEIP)

[!INCLUDE[sqlserver](../includes/applies-to-version/sqlserver.md)]

## <a name="summary"></a>Сводка

По умолчанию Microsoft SQL Server собирает сведения о том, как пользователи используют приложение. В частности, SQL Server собирает сведения об установке, использовании и производительности. Эти сведения помогают корпорации Майкрософт улучшать продукты и удовлетворять ожидания клиентов. Например, корпорация Майкрософт собирает сведения о кодах ошибок, с которыми сталкиваются пользователи. Это помогает нам исправлять вызвавшие их проблемы, улучшать качество документации об использовании SQL Server и определять, нужно ли добавить в продукт новые возможности, которые будут полезны нашим клиентам.

При этом, используя этот механизм, корпорация Майкрософт не собирает следующие данные:
- любые значения из пользовательских таблиц;
- любые учетные данные или другие параметры аутентификации;
- личные сведения (PII).

В примере ниже показано, какие именно сведения об использовании компонентов помогают нам улучшить продукт.

SQL Server 2017 поддерживает индексы ColumnStore для сценариев быстрого анализа. Индексы ColumnStore сочетают традиционную для индексов структуру сбалансированного дерева для новых данных с особым алгоритмом сжатия на основе характеристик столбцов, который позволяет успешно сжимать данные и ускорять выполнение запросов. Продукт выполняет эвристический анализ для переноса в фоновом режиме данных из структуры сбалансированного дерева в сжатую структуру, чтобы ускорить выполнение последующих запросов.

Если механизм фоновой обработки не успевает обрабатывать данные с той скоростью, с которой добавляются новые данные, производительность запросов может оказаться медленнее ожидаемой. Чтобы повысить производительность продукта, корпорация Майкрософт собирает сведения о том, насколько хорошо SQL Server справляется с процессом автоматического сжатия данных. Команда разработчиков использует эти сведения для точной настройки частоты выполнения и параллелизма в коде, который выполняет сжатие. Время от времени выполняется запрос для сбора этой информации, который позволяет корпорации Майкрософт оценить скорость перемещения данных. Это помогает оптимизировать эвристические возможности продукта.  

```sql
SELECT object_id, type_desc, data_space_id, db_id() AS database_id FROM sys.indexes WITH(nolock) WHERE type = 5 or type = 6 
```

```sql
SELECT cntr_value as merge_policy_evaluation
FROM sys.dm_os_performance_counters WITH(nolock)
WHERE object_name LIKE '%columnstore%' 
AND counter_name ='Total Merge Policy Evaluations' 
AND instance_name = '_Total'
```

Не забывайте, что этот процесс контролирует механизмы, предоставляющие важную для клиентов функциональность. Команда разработчиков не просматривает данные, содержащиеся в индексе, и не отправляет эти данные в корпорацию Майкрософт. SQL Server 2017 всегда собирает и отправляет сведения о ходе установки. Это помогает нам быстро обнаруживать и исправлять любые проблемы, которые возникают у клиентов при установке. Можно настроить SQL Server 2017 так, чтобы он не отправлял в корпорацию Майкрософт какие-либо сведения. Такое поведение настраивается отдельно для каждого экземпляра сервера следующим образом.
- С помощью приложения отчетов об ошибках и использовании.
- С помощью настройки определенных разделов реестра на сервере.

См. дополнительные сведения об [отзывах клиентов SQL Server в Linux](../linux/usage-and-diagnostic-data-configuration-for-sql-server-linux.md).

> [!NOTE]
> Вы можете отключить отправку данных в корпорацию Майкрософт только в платной версии SQL Server.

## <a name="remarks"></a>Remarks
 - Удаление или отключение службы SQL CEIP не поддерживается. 
 - Удаление ресурсов SQL CEIP из группы кластера не поддерживается. 

Чтобы отказаться от сбора данных, см. сведения в разделе [Отключение локального аудита](usage-and-diagnostic-data-in-local-audit.md#turning-local-audit-on-or-off)

## <a name="error-and-usage-reporting-application"></a>Приложение отчетов об ошибках и использовании 

По завершении установки вы можете изменить параметры сбора данных об использовании и данных диагностики для компонентов и экземпляров SQL Server с помощью приложения отчетов об ошибках и использовании. Это приложение доступно как часть установки SQL Server. Это средство позволяет настроить параметр "Отчеты об использовании" отдельно для каждого экземпляра SQL Server.

> [!NOTE]
> Приложение отчетов об ошибках и использовании размещается в списке средств настройки SQL Server. Средство можно использовать для управления настройками, а также для сбора отчетов об ошибках, данных об использовании и данных диагностики точно так же, как в SQL Server 2017. Отчеты об ошибках создаются отдельно от сбора данных об использовании и данных диагностики, что позволяет включать и отключать эти механизмы отдельно. С отчетом об ошибках в корпорацию Майкрософт отправляются аварийные дампы, которые могут содержать конфиденциальные сведения, как описано в [заявлении о конфиденциальности](./sql-server-privacy.md).

Чтобы открыть средство отчетов об ошибках и использовании SQL Server, выберите действие **Запустить** и выполните поиск по слову "ошибка". Вы увидите элемент отчетов об ошибках и использовании SQL Server. Запустив это средство, вы сможете управлять данными об использовании, серьезных ошибках и данными диагностики, которые собираются для экземпляров и компонентов, установленных на соответствующем компьютере.

В платной версии вы можете использовать флажки "Отчеты об использовании", чтобы управлять отправкой данных об использовании и данных диагностики в корпорацию Майкрософт.

Как в платной, так и в бесплатной версиях можно использовать флажки "Отчеты об ошибках", чтобы управлять отправкой сведений о серьезных ошибках и аварийных дампов в корпорацию Майкрософт.

## <a name="set-registry-subkeys-on-the-server"></a>Изменение разделов реестра на сервере

Настроив соответствующие параметры групповой политики, корпоративные клиенты могут согласиться на сбор данных об использовании и данных диагностики или отказаться от него. Для этого нужно создать политику на основе реестра. Ниже приведены соответствующие подразделы и параметры реестра:

- Для настройки экземпляра SQL Server:
    
    подраздел = HKEY_LOCAL_MACHINE\Software\Microsoft\Microsoft SQL Server\{InstanceID}\CPE;
    
    Имя записи = CustomerFeedback
    
    Тип записи DWORD: 0 — не участвовать; 1 — участвовать
    
    {InstanceID} указывает тип экземпляра и сам экземпляр, как показано в следующих примерах:

    - MSSQL14.CANBERRA обозначает ядро СУБД SQL Server 2017 и имя экземпляра CANBERRA;
    - MSAS14.CANBERRA обозначает ядро СУБД SQL Server 2017 Analysis Services и имя экземпляра CANBERRA;
    - MSRS14.CANBERRA обозначает ядро СУБД SQL Server 2017 Reporting Services и имя экземпляра CANBERRA.

- Для всех общих компонентов:
    
    подраздел = HKEY_LOCAL_MACHINE\Software\Microsoft\Microsoft SQL Server\{Major Version};
    
    Имя записи = CustomerFeedback
    
    Тип записи DWORD: 0 — не участвовать; 1 — участвовать

> [!NOTE]
> {Major Version} обозначает основную версию SQL Server, например 140 для SQL Server 2017.

- Сведения об SQL Server Management Studio 17 и 18 см. в статье [Локальный аудит для сбора отзывов об использовании SSMS](../ssms/sql-server-management-studio-telemetry-ssms.md).

## <a name="set-registry-subkeys-for-crash-dump-collection"></a>Настройка подразделов реестра для сбора аварийных дампов

Как и в более ранней версии SQL Server, корпоративные клиенты SQL Server 2017 могут настроить параметры групповой политики на сервере, чтобы участвовать или не участвовать в сборе аварийных дампов. Для этого нужно создать политику на основе реестра. Ниже приведены соответствующие подразделы и параметры реестра: 

- Для настройки экземпляра SQL Server:

    подраздел = HKEY_LOCAL_MACHINE\Software\Microsoft\Microsoft SQL Server\{InstanceID}\CPE;

    имя RegEntry = EnableErrorReporting;

    Тип записи DWORD: 0 — не участвовать; 1 — участвовать
 
    {InstanceID} указывает тип экземпляра и сам экземпляр, как показано в следующих примерах: 

    - MSSQL14.CANBERRA обозначает ядро СУБД SQL Server 2017 и имя экземпляра CANBERRA;
    - MSAS14.CANBERRA обозначает ядро СУБД SQL Server 2017 Analysis Services и имя экземпляра CANBERRA;
    - MSRS14.CANBERRA обозначает ядро СУБД SQL Server 2017 Reporting Services и имя экземпляра CANBERRA.
 

- Для всех общих компонентов:
    
    подраздел = HKEY_LOCAL_MACHINE\Software\Microsoft\Microsoft SQL Server\{Major Version};

    имя RegEntry = EnableErrorReporting;

    Тип записи DWORD: 0 — не участвовать; 1 — участвовать

> [!NOTE]
> {Major Version} обозначает основную версию SQL Server. Например, 140 соответствует версии SQL Server 2017.

Групповая политика на базе реестра с этими подразделами будет соблюдаться системой сбора аварийных дампов SQL Server 2017. 

## <a name="crash-dump-collection-for-ssms"></a>Сбор аварийных дампов для SSMS
Среда SSMS не собирает отдельные аварийные дампы. Все аварийные дампы, связанные с SSMS, собираются единой системой сбора отчетов об ошибках Windows.

Процедура, позволяющая включить или отключить эту функцию, будет разной в разных версиях операционной системы. Чтобы включить или отключить эту функцию, выполните инструкции, соответствующие вашей версии Windows.
 
- Windows Server 2016 и Windows 10

    [Настройка сбора данных диагностики Windows в вашей организации](/windows/privacy/configure-windows-diagnostic-data-in-your-organization)
- Windows Server 2008 R2 и Windows 7

    [WER Settings](/windows/desktop/wer/wer-settings) (Параметры отчетов об ошибках Windows)
 
## <a name="feedback-for-analysis-services"></a>Сбор информации для Analysis Services

Во время установки SQL Server 2016 Analysis Services добавляет в экземпляр служб Analysis Services специальную учетную запись. Эта учетная запись является членом роли администратора на сервере Analysis Services. Она используется для сбора сведений от экземпляра служб Analysis Services.  

В настройках службы можно отказаться от отправки данных об использовании и данных диагностики, как описано в разделе "Изменение разделов реестра на сервере". При этом учетная запись службы не удаляется. 
 
[!INCLUDE[get-help-options](../includes/paragraph-content/get-help-options.md)]