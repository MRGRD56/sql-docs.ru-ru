---
description: Аргументы инструкций RESTORE (Transact-SQL)
title: Аргументы инструкций RESTORE (Transact-SQL) | Документы Майкрософт
ms.custom: ''
ms.date: 08/08/2018
ms.prod: sql
ms.prod_service: sql-database
ms.reviewer: ''
ms.technology: t-sql
ms.topic: language-reference
dev_langs:
- TSQL
helpviewer_keywords:
- RESTORE statement, arguments
- RESTORE statement
ms.assetid: 4bfe5734-3003-4165-afd4-b1131ea26e2b
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 35ed1cf50f1d39af97ac636c8aba3ca36f90e7d7
ms.sourcegitcommit: f29f74e04ba9c4d72b9bcc292490f3c076227f7c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/13/2021
ms.locfileid: "98171676"
---
# <a name="restore-statements---arguments-transact-sql"></a>Аргументы инструкций RESTORE (Transact-SQL)
[!INCLUDE [SQL Server](../../includes/applies-to-version/sqlserver.md)]

В этом разделе документированы аргументы, описанные в разделах "Синтаксис" инструкции RESTORE {DATABASE|LOG} и связанного с ней набора вспомогательных инструкций: RESTORE FILELISTONLY, RESTORE HEADERONLY, RESTORE LABELONLY, RESTORE REWINDONLY и RESTORE VERIFYONLY. Большинство аргументов поддерживается только вложенными наборами этих шести инструкций. Поддержка каждого аргумента указана в его описании.  
  
 ![Значок ссылки на раздел](../../database-engine/configure-windows/media/topic-link.gif "Значок ссылки на раздел") [Синтаксические обозначения в Transact-SQL](../../t-sql/language-elements/transact-sql-syntax-conventions-transact-sql.md)  
  
## <a name="syntax"></a>Синтаксис  
 Синтаксис см. в следующих разделах:  
  
-   [RESTORE (Transact-SQL)](../../t-sql/statements/restore-statements-transact-sql.md)  
  
-   [RESTORE FILELISTONLY (Transact-SQL)](../../t-sql/statements/restore-statements-filelistonly-transact-sql.md)  
  
-   [RESTORE HEADERONLY (Transact-SQL)](../../t-sql/statements/restore-statements-headeronly-transact-sql.md)  
  
-   [RESTORE LABELONLY (Transact-SQL)](../../t-sql/statements/restore-statements-labelonly-transact-sql.md)  
  
-   [RESTORE REWINDONLY (Transact-SQL)](../../t-sql/statements/restore-statements-rewindonly-transact-sql.md)  
  
-   [RESTORE VERIFYONLY (Transact-SQL)](../../t-sql/statements/restore-statements-verifyonly-transact-sql.md)  
  
[!INCLUDE[sql-server-tsql-previous-offline-documentation](../../includes/sql-server-tsql-previous-offline-documentation.md)]

## <a name="arguments"></a>Аргументы
 DATABASE  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md)  
  
 Указывает целевую базу данных. Если указан список файлов и файловых групп, то восстанавливаются только эти файлы и файловые группы.  
  
 Для базы данных, использующей модель полного восстановления или модель восстановления с неполным протоколированием, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] в большинстве случаев требует, чтобы перед восстановлением базы данных была создана резервная копия конца журнала. Восстановление базы данных без создания резервной копии заключительного фрагмента журнала приведет к ошибке, если инструкция RESTORE DATABASE не содержит предложение WITH REPLACE или WITH STOPAT, в котором должно указываться время или транзакция, выполняемая после завершения резервного копирования данных. Дополнительные сведения о резервных копиях заключительного фрагмента журнала см. в разделе [Резервные копии заключительного фрагмента журнала (SQL Server)](../../relational-databases/backup-restore/tail-log-backups-sql-server.md).  
  
 LOG  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md)  
  
 Указывает, что резервная копия журналов транзакций должна быть применена к базе данных. Журналы транзакций должны применяться в последовательном порядке. [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] проверяет резервные копии журнала транзакций, чтобы гарантировать, что транзакции загружаются в нужную базу данных и в верной последовательности. Для применения нескольких журналов транзакций следует использовать параметр NORECOVERY во всех операциях восстановления, кроме последней.  
  
> [!NOTE]  
>  Как правило, последний восстановленный журнал представляет собой резервную копию заключительного фрагмента журнала. *Резервная копия заключительного фрагмента журнала* — это резервная копия журнала, созданная непосредственно перед восстановлением базы данных, обычно после отказа базы данных. Создание резервной копии заключительного фрагмента журнала поврежденной базы данных предотвращает потерю работы благодаря сохранению журнала, для которого еще не была создана резервная копия (заключительный фрагмент журнала). Дополнительные сведения см. в статье [Резервные копии заключительного фрагмента журнала (SQL Server)](../../relational-databases/backup-restore/tail-log-backups-sql-server.md).  
  
 Дополнительные сведения см. в разделе [Применение резервных копий журналов транзакций (SQL Server)](../../relational-databases/backup-restore/apply-transaction-log-backups-sql-server.md).  
  
 { _database\_name_ |  **@** _database\_name\_var_}  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md)  
  
 База данных, в которую восстанавливается журнал или полная база данных. Если аргумент задается в виде переменной ( **@** _database\_name\_var_), имя может быть указано как строковая константа ( **@** _database\_name\_var_ = *database*\_*name*) или как переменная любого строкового типа данных, за исключением типов данных **ntext** или **text**.  
  
 \<file_or_filegroup_or_page> [ **,** ...*n* ]  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md)  
  
 Указывает имя логического файла или файловой группы или страницы, которая входит в инструкцию RESTORE DATABASE или RESTORE LOG. Можно указать список файлов или файловых групп.  
  
 Для базы данных с простой моделью восстановления параметры FILE и FILEGROUP можно использовать только в том случае, если целевые файлы или файловые группы доступны только для чтения или если это восстановление является частичным (PARTIAL), что приводит к появлению [нерабочей файловой группы](../../relational-databases/backup-restore/remove-defunct-filegroups-sql-server.md).  
  
 Для восстановления одного или нескольких файлов, файловых групп или страниц в базе данных, в которой используется полная модель восстановления или модель восстановления с неполным протоколированием, как правило, необходимо применить журнал транзакций к файлам, содержащим восстановленные файлы; благодаря применению журнала файлы согласуются с остальной базой данных. Из этого правила существуют следующие исключения:  
  
-   Если восстанавливаемые файлы перед последним резервным копированием были доступны только для чтения, то журнал транзакций применять не нужно и инструкция RESTORE сообщит вам об этом.  
  
-   Если резервная копия содержит первичную файловую группу и выполняется частичное восстановление, журнал восстановления не нужен, так как журнал восстанавливается автоматически из набора резервных данных.  
  
FILE **=** { *logical_file_name_in_backup*|  **@** _logical\_file\_name\_in\_backup\_var_}  
 Указывает имя файла, который необходимо включить в восстановление базы данных.  
  
FILEGROUP **=** { *logical_filegroup_name* |  **@** _logical\_filegroup\_name\_var_ }  
 Указывает имя файловой группы, которую необходимо включить в восстановление базы данных.  
  
 **Примечание.** Инструкцию FILEGROUP можно использовать в простой модели восстановления только в том случае, если указанная файловая группа доступна только для чтения и данная операция восстановления является частичной (то есть при использовании WITH PARTIAL). Любые невосстановленные файловые группы, доступные для чтения и записи, отмечаются как несуществующие и впоследствии не могут быть восстановлены в результирующей базе данных.  
  
READ_WRITE_FILEGROUPS  
 Выбирает все файловые группы, доступные для чтения и записи. Этот параметр особенно полезен, если файловые группы, доступные для чтения и записи, нужно восстановить раньше, чем файловые группы, доступные только для чтения.  
  
PAGE = **'** _file_ **:** _page* [ **,** ...*n* ] **'**  
 Указывает список, состоящий из одной или нескольких страниц для операции восстановления страниц (которая поддерживается только для баз данных, использующих полную модель восстановления или модель восстановления с неполным протоколированием). Возможны следующие значения.  
  
PAGE  
 Указывает список из одного или нескольких файлов и страниц.  
  
 *файл*  
 Идентификатор файла, содержащего определенную страницу для восстановления.  
  
 *страница*  
 Идентификатор страницы, подлежащей восстановлению в файле.  
  
 *n*  
 Заполнитель, который указывает, что можно задать несколько страниц.  
  
 Максимальное число страниц, которое можно восстановить в один файл в последовательности восстановления, — 1 000. Но если файл содержит большое количество поврежденных страниц, лучше восстанавливать не страницы, а весь файл целиком.  
  
> [!NOTE]  
>  Восстановленные страницы невозможно восстановить повторно.  
  
 Дополнительные сведения о восстановлении страниц см. в разделе [Восстановление страниц (SQL Server)](../../relational-databases/backup-restore/restore-pages-sql-server.md).  
  
 [ **,** ...*n* ]  
 Заполнитель, который указывает, что можно задать в списке несколько файлов, файловых групп и страниц с разделителями-запятыми. Их число не ограничено.  
  
FROM { \<backup_device> [ **,** ...*n* ]| \<database_snapshot> }. Как правило, определяет устройства резервного копирования, с которых восстанавливаются резервные копии. В другом случае в предложении FROM инструкции RESTORE DATABASE можно указать имя моментального снимка базы данных, к которому возвращается база данных; в этом случае не разрешается применять предложение WITH.  
  
 Если предложение FROM опущено, то операция восстановления из резервной копии не производится. Вместо этого восстанавливается база данных. Это позволяет восстановить базу данных, которая была восстановлена с параметром NORECOVERY, или переключиться на резервный сервер. Если предложение FROM опущено, то с предложением WITH должен быть указан параметр NORECOVERY, RECOVERY или STANDBY.  
  
 \<backup_device> [ **,** ...*n* ]. Указывает логическое или физическое устройство резервного копирования, используемое для операции восстановления.  
  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md), [RESTORE FILELISTONLY](../../t-sql/statements/restore-statements-filelistonly-transact-sql.md), [RESTORE HEADERONLY](../../t-sql/statements/restore-statements-headeronly-transact-sql.md), [RESTORE LABELONLY](../../t-sql/statements/restore-statements-labelonly-transact-sql.md), [RESTORE REWINDONLY](../../t-sql/statements/restore-statements-rewindonly-transact-sql.md) и [RESTORE VERIFYONLY](../../t-sql/statements/restore-statements-verifyonly-transact-sql.md).  
  
 \<backup_device>::=. Указывает логическое или физическое устройство резервного копирования, используемое для операции резервного копирования, следующим образом:  
  
 { _logical\_backup\_device\_name_ |  **@** _logical\_backup\_device\_name\_var_ }  
 Логическое имя устройства или устройств резервного копирования, созданных процедурой **sp_addumpdevice**, из которых восстанавливается база данных, должно соответствовать правилам для идентификаторов. Если аргумент задается в виде переменной ( **@** _logical\_backup\_device\_name\_var_), имя устройства резервного копирования можно указать как строковую константу ( **@** _logical\_backup\_device\_name\_var_ = _logical\_backup\_device\_name_) или как переменную любого строкового типа данных, за исключением типов данных **ntext** или **text**.  
  
 {DISK | TAPE } **=** { **'** _physical\_backup\_device\_name_ **'**  |  **@** _physical\_backup\_device\_name\_var_ }  
 Разрешает сохранение резервных копий с названного диска или ленточного устройства хранения данных. Для дисковых и магнитных устройств необходимо указать фактическое имя устройства (например, полный путь и имя файла): `DISK ='Z:\SQLServerBackups\AdventureWorks.bak'` или `TAPE ='\\\\.\TAPE0'`. Если аргумент задается в виде переменной ( **@** _physical\_backup\_device\_name\_var_), имя устройства можно указать как строковую константу ( **@** _physical\_backup\_device\_name\_var_ = '*physical_backup_device_name*') или как другую переменную строкового типа данных, за исключением типов данных **ntext** или **text**.  
  
 Укажите тип дискового устройства с помощью сетевого сервера с именем UNC (которое должно содержать имя компьютера). Дополнительные сведения об использовании имен UNC см. в разделе [Устройства резервного копирования (SQL Server)](../../relational-databases/backup-restore/backup-devices-sql-server.md).  
  
 Учетная запись, под которой работает [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], должна обладать доступом READ на удаленном компьютере или сетевом сервере, чтобы выполнять операцию RESTORE.  
  
 *n*  
 Заполнитель, который указывает, что можно задать в списке до 64 устройств резервного копирования с разделителями-запятыми.  
  
 Требует ли последовательность восстановления столько же устройств резервного копирования, сколько было использовано для создания набора носителей, которым принадлежат резервные копии, зависит от того, происходит восстановление в режиме «вне сети» или режиме «в сети», следующим образом:  
  
-   Восстановление в сети позволяет использовать меньше устройств, чем было задействовано при создании резервных копий.  
  
-   При восстановлении в сети обязательно наличие всех устройств резервного копирования. Попытка выполнить восстановление с меньшим числом устройств не будет успешно завершена.  
  
 Например, рассмотрим случай резервного копирования базы данных на четыре накопителя на магнитной ленте, подключенных к серверу. Для восстановления в сети необходимо иметь четыре накопителя, подключенных к серверу; восстановление вне сети позволяет восстановить резервную копию, если в компьютере менее четырех накопителей.  
  
> [!NOTE]  
>  Проводя восстановление из копии с зеркального набора носителей, можно указать по одному зеркалу для каждого семейства носителей. Но в случае ошибок наличие других зеркальных носителей позволяет быстро устранить некоторые проблемы восстановления. Поврежденный том носителя можно заменить соответствующим томом с другого зеркала. Учтите, что при восстановлении вне сети можно использовать меньше устройств, чем семейств носителей, но каждое семейство обрабатывается только один раз.  
  
\<database_snapshot>::=  
**Поддерживается:**  [RESTORE DATABASE](../../t-sql/statements/restore-statements-transact-sql.md)  
  
DATABASE_SNAPSHOT **=** _database\_snapshot\_name_  
 Возвращает базу данных к моментальному снимку базы данных, определяемому *именем_моментального_снимка_базы_данных*. Аргумент DATABASE_SNAPSHOT доступен только для полного восстановления базы данных. При выполнении операции возврата к предшествующему состоянию моментальный снимок базы данных занимает место полной резервной копии базы данных.  
  
 Для операции возврата к предшествующему состоянию необходимо, чтобы указанный моментальный снимок базы данных был единственным для базы данных. В ходе операции возврата моментальный снимок базы данных и целевая база данных отмечаются как `In restore`. Дополнительные сведения см. в подразделе "Замечания" раздела [Восстановление базы данных](../../t-sql/statements/restore-statements-transact-sql.md).  
  
### <a name="with-options"></a>Параметры инструкции WITH  
 Указывает параметры, используемые для операции восстановления предшествующего состояния. Сводку инструкций, в которых используется каждый параметр, см. в секции «Сводка совместимости с параметрами WITH» ниже в данном разделе.  
  
> [!NOTE]  
>  Параметры WITH указаны в том же порядке, что и в подразделе "Синтаксис" раздела [RESTORE {DATABASE|LOG}](../../t-sql/statements/restore-statements-transact-sql.md).  
  
 PARTIAL  
 **Поддерживается:**  [RESTORE DATABASE](../../t-sql/statements/restore-statements-transact-sql.md)  
  
 Указывает операцию частичного восстановления, которая восстанавливает первичную файловую группу и любые указанные вторичные файловые группы. Параметр PARTIAL неявно выбирает первичную файловую группу; указывать FILEGROUP = 'PRIMARY' не требуется. Чтобы восстановить вторичную файловую группу, необходимо явно задать ее с помощью параметра FILE или FILEGROUP.  
  
 Не разрешается применять параметр PARTIAL в инструкциях RESTORE LOG.  
  
 Параметр PARTIAL запускает начальный этап поэтапного восстановления, которое позволяет восстановить оставшиеся файловые группы позднее. Дополнительные сведения см. в разделе [Поэтапное восстановление (SQL Server)](../../relational-databases/backup-restore/piecemeal-restores-sql-server.md).  
  
 [ **RECOVERY** | NORECOVERY | STANDBY ]  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md)  
  
 **RECOVERY**  
 Настраивает операцию восстановления на откат любых незавершенных транзакций. После процедуры восстановления база данных готова к использованию. Если не указан ни один из параметров NORECOVERY, RECOVERY и STANDBY, RECOVERY является параметром по умолчанию.  
  
 Если запланированы последующие операции RESTORE (RESTORE LOG или RESTORE DATABASE из разностного архива), то вместо них следует указать параметры NORECOVERY или STANDBY.  
  
 При восстановлении из резервных наборов данных, созданных в более ранних версиях [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], может потребоваться обновление базы данных. Это обновление выполняется автоматически, если указан параметр WITH RECOVERY. Дополнительные сведения см. в разделе [Применение резервных копий журналов транзакций (SQL Server)](../../relational-databases/backup-restore/apply-transaction-log-backups-sql-server.md).  
  
> [!NOTE]  
>  Если предложение FROM опущено, то с предложением WITH должен быть указан параметр NORECOVERY, RECOVERY или STANDBY.  
  
 NORECOVERY  
 Настраивает операцию восстановления на отмену отката любых незавершенных транзакций. Если впоследствии должен применяться другой журнал транзакций, то следует указать параметр NORECOVERY или STANDBY. Если не указан ни один из параметров NORECOVERY, RECOVERY и STANDBY, RECOVERY является параметром по умолчанию. В ходе восстановления вне сети с использованием параметра NORECOVERY база данных непригодна для использования.  
  
 Для восстановления резервной копии базы данных и одного или нескольких журналов транзакций или в других случаях, когда необходимо применить несколько инструкций RESTORE (например, при восстановлении полной резервной копии базы данных с последующим разностным восстановлением базы), необходимо указать параметр WITH NORECOVERY для всех инструкций RESTORE, кроме последней. Лучший способ — использовать параметр WITH NORECOVERY во ВСЕХ инструкциях многоэтапной последовательности восстановления до тех пор, пока не будет достигнута желаемая точка восстановления, а затем использовать отдельную инструкцию RESTORE WITH RECOVERY только для восстановления.  
  
 При использовании с операцией восстановления файла или файловой группы параметр NORECOVERY принудительно оставляет базу данных в состоянии восстановления после операции восстановления. Это полезно в следующих ситуациях:  
  
-   Выполняется скрипт восстановления, и журнал всегда применяется.  
  
-   Используется последовательность восстановления файлов, и база данных не предназначена для использования между двумя операциями восстановления.  
  
 В некоторых случаях RESTORE WITH NORECOVERY переводит набор данных наката достаточно далеко вперед, чтобы он был совместим с базой данных. В таких случаях откат не производится и данные остаются вне сети, как и предполагается при использовании этого параметра. Однако компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] выдает информационное сообщение о том, что теперь набор данных наката можно восстановить с помощью параметра RECOVERY.  
  
STANDBY **=** _standby\_file\_name_  
 Указывает резервный файл, с помощью которого можно отменить результаты восстановления. Параметр STANDBY разрешается применять для восстановления вне сети (в том числе частичного восстановления). Параметр не разрешается использовать при восстановлении в сети. При попытке указать параметр STANDBY для восстановления в сети операция восстановления заканчивается неудачей. Инструкцию STANDBY также не разрешается применять, если необходимо обновление базы данных.  
  
 Резервный файл используется для сохранения прообраза страниц, измененных во время прохода отмены инструкции RESTORE WITH STANDBY. Благодаря резервному файлу базу данных можно сделать доступной только для чтения между транзакциями и использовать с сервером «горячего» резервирования или в особых ситуациях восстановления, когда полезно проверить базу данных между операциями восстановления журналов транзакций. После операции RESTORE WITH STANDBY файл отката автоматически удаляется следующей операцией RESTORE. Если резервный файл был удален вручную перед следующей операцией RESTORE, то необходимо повторно восстановить всю базу данных. Пока база данных находится в состоянии STANDBY, к резервному файлу следует относиться с такой же осторожностью, как к любому другому файлу базы данных. В отличие от других файлов базы данных этот файл открывается только компонентом [!INCLUDE[ssDE](../../includes/ssde-md.md)] во время активных операций восстановления.  
  
 Аргумент *имя_резервного_файла* указывает резервный файл, местонахождение которого хранится в журнале базы данных. Если файл с таким именем существует, то он перезаписывается; в противном случае компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] создает этот файл.  
  
 Требования к размерам конкретного резервного файла зависят от числа действий отката, вызванных незавершенными транзакциями в ходе операции восстановления.  
  
> [!IMPORTANT]  
>  Если на диске, содержащем резервный файл с указанным именем, отсутствует свободное место, то операция восстановления останавливается.  
  
 Сравнение параметров RECOVERY и NORECOVERY приведено в подразделе "Замечания" раздела [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md).  
  
LOADHISTORY  
 **Поддерживается:**  [RESTORE VERIFYONLY](../../t-sql/statements/restore-statements-verifyonly-transact-sql.md)  
  
 Указывает, что операция восстановления загружает данные в таблицы журнала **msdb**. Параметр LOADHISTORY загружает сведения о [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]резервных копиях, которые хранятся на наборе носителей, в таблицы журналов резервного копирования и восстановления в базе данных **msdb** для единственного проверяемого резервного набора данных. Дополнительные сведения о таблицах журналов см. в разделе [Системные таблицы (Transact-SQL)](../../relational-databases/system-tables/system-tables-transact-sql.md).  
  
#### <a name="general_with_options--n-"></a>\<general_WITH_options> [ ,...n ]  
 Общие параметры WITH поддерживаются в инструкциях RESTORE DATABASE и RESTORE LOG. Некоторые из этих параметров также поддерживаются одной или более вспомогательными инструкциями, как отмечено ниже.  
  
##### <a name="restore-operation-options"></a>Параметры операции восстановления  
 Эти параметры влияют на поведение операции восстановления.  
  
MOVE **'** _logical\_file\_name\_in\_backup_ **'** TO **'** _operating\_system\_file\_name_ **'** [ ...*n* ]  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md) и [RESTORE VERIFYONLY](../../t-sql/statements/restore-statements-verifyonly-transact-sql.md)  
  
 Указывает, что файл данных или журнала, логическое имя которого указано в параметре *логическое_имя_файла_в_резервной_копии*, следует переместить, восстановив его в расположение, указанное в параметре *имя_файла_в_операционной_системе*. Логическое имя файла данных или журнала в резервном наборе данных соответствует его логическому имени в базе данных на момент создания резервного набора данных.  
  
*n* — заполнитель, который указывает, что можно указать дополнительные инструкции MOVE. Укажите инструкцию MOVE для каждого логического файла, который надо восстановить из резервного набора данных в новом месте. По умолчанию файл, имя которого указано в параметре *логическое_имя_файла_в_резервной_копии*, восстанавливается в исходное расположение.  
  
> [!NOTE]  
>  Для получения списка логических файлов из набора резервных данных следует использовать инструкцию RESTORE FILELISTONLY.  
  
 Если инструкция RESTORE используется для переноса базы данных в пределах сервера или копирования на другой сервер, то для перемещения файлов базы данных может потребоваться параметр MOVE, чтобы избежать конфликтов с существующими файлам.  
  
 При использовании с инструкцией RESTORE LOG параметр MOVE можно использовать для переноса файлов, добавленных за интервал времени, охваченный восстанавливаемым журналом. Например, если резервная копия журналов содержит операцию добавления файла для файла `file23`, то этот файл можно перенести с использованием параметра MOVE инструкции RESTORE LOG.  
  
 При использовании с резервной копией моментального снимка [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] параметр MOVE можно использовать только для перемещения файлов в BLOB-объекты Azure в той же учетной записи хранения, в которой размещается исходный BLOB-объект. Параметр MOVE не может использоваться для восстановления моментального снимка резервной копии в локальный файл или в другую учетную запись хранения.  
  
 Если инструкция RESTORE VERIFYONLY используется для переноса базы данных в пределах сервера или ее копирования на другой сервер, то параметр MOVE может быть необходим, чтобы убедиться в наличии достаточного свободного пространства в месте назначения и определить потенциальные конфликты с существующими файлами.  
  
 Дополнительные сведения см. в статье [Копирование баз данных путем создания и восстановления резервных копий](../../relational-databases/databases/copy-databases-with-backup-and-restore.md).  
  
CREDENTIAL  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md), [RESTORE FILELISTONLY](../../t-sql/statements/restore-statements-filelistonly-transact-sql.md), [RESTORE HEADERONLY](../../t-sql/statements/restore-statements-headeronly-transact-sql.md), [RESTORE LABELONLY](../../t-sql/statements/restore-statements-labelonly-transact-sql.md) и [RESTORE VERIFYONLY](../../t-sql/statements/restore-statements-verifyonly-transact-sql.md).  
  
**Область применения**: [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] SP1 CU2 и выше
  
 Используется только при восстановлении резервной копии с помощью службы хранилища BLOB-объектов Azure.  
  
> [!NOTE]  
>  Начиная с [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] с пакетом обновления 1 (SP1) и накопительным обновлением 2 (CU2) по [!INCLUDE[ssSQL15](../../includes/sssql16-md.md)] восстановление с URL-адреса можно выполнять только с одного устройства. Чтобы выполнить восстановление с URL-адреса с нескольких устройств, необходимо использовать версию с [!INCLUDE[ssSQL15](../../includes/sssql16-md.md)] по [текущую версию](https://go.microsoft.com/fwlink/p/?LinkId=299658) и маркеры подписанных URL-адресов (SAS). Дополнительные сведения см. в разделах [Включение управляемого резервного копирования SQL Server в Microsoft Azure](../../relational-databases/backup-restore/enable-sql-server-managed-backup-to-microsoft-azure.md) и [Упрощение создания учетных данных SQL с помощью маркеров подписанных URL-адресов (SAS) в службе хранилища Azure с PowerShell](https://docs.microsoft.com/archive/blogs/sqlcat/simplifying-creation-of-sql-credentials-with-shared-access-signature-sas-tokens-on-azure-storage-with-powershell).  
  
 REPLACE  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md)  
  
 Указывает, что [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] должен создать указанную базу данных и связанные с ней файлы, даже если уже существует другая база данных с таким именем. В этом случае существующая база данных будет удалена. Если параметр REPLACE не указан, выполняется проверка безопасности. Это предотвращает перезапись другой базы данных по ошибке. Проверка безопасности гарантирует, что инструкция RESTORE DATABASE не восстанавливает базу данных на текущем сервере, если выполнены два следующих условия:  
  
-   база данных, указанная в инструкции RESTORE, уже существует на текущем сервере;  
  
-   имя базы данных отличается от имени базы данных, записанного в резервный набор данных.  
  
 Параметр REPLACE также позволяет инструкции RESTORE перезаписать существующий файл, принадлежность которого к восстанавливаемой базе данных не может быть удостоверена. Обычно при использовании инструкции RESTORE блокируется перезапись ранее существовавших файлов. Параметр WITH REPLACE может использоваться таким же образом, как и параметр RESTORE LOG.  
  
 Параметр REPLACE также отменяет требование создать резервную копию конца журнала перед восстановлением базы данных.  
  
 Дополнительные сведения об использовании параметра REPLACE см. в разделе [RESTORE (Transact-SQL)](../../t-sql/statements/restore-statements-transact-sql.md).  
  
RESTART  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md)  
  
 Указывает, что [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] должен перезапустить прерванную операцию восстановления. Инструкция RESTART перезапускает операцию восстановления с точки прерывания.  
  
RESTRICTED_USER  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md).  
  
 Ограничивает доступ к вновь созданной базе данных для членов ролей **db_owner**, **dbcreator** и **sysadmin**.  Параметр RESTRICTED_USER заменяет параметр DBO_ONLY. Параметр DBO_ONLY в [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] не поддерживается.  
  
 Следует использовать с параметром RECOVERY.  
  
##### <a name="backup-set-options"></a>Параметры резервного набора данных  
 Эти параметры оперируют с резервным набором данных, содержащим резервную копию для восстановления.  
  
FILE **=** { *backup_set_file_number* |  **@** _backup\_set\_file\_number_ }  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md), [RESTORE FILELISTONLY](../../t-sql/statements/restore-statements-filelistonly-transact-sql.md), [RESTORE HEADERONLY](../../t-sql/statements/restore-statements-headeronly-transact-sql.md) и [RESTORE VERIFYONLY](../../t-sql/statements/restore-statements-verifyonly-transact-sql.md).  
  
 Идентифицирует резервный набор данных для восстановления. Например, аргумент *номер_файла_резервного_набора* , равный **1** , указывает первый резервный набор данных на носителе данных резервных копий, а аргумент *номер_файла_резервного_набора* , равный **2** , указывает второй резервный набор данных. Значение *номер_файла_резервного_набора* резервного набора данных можно получить с помощью инструкции [RESTORE HEADERONLY](../../t-sql/statements/restore-statements-headeronly-transact-sql.md) .  
  
 Если не указано иное, то значение по умолчанию — **1**, за исключением инструкции RESTORE HEADERONLY, которая обрабатывает все резервные наборы в наборе носителей. Дополнительные сведения см. в подразделе «Указание резервного набора данных» этого раздела.  
  
> [!IMPORTANT]  
>  Этот параметр FILE не связан с параметром FILE для указания файла базы данных, FILE **=** { *logical_file_name_in_backup* |  **@** _logical\_file\_name\_in\_backup\_var_ }.  
  
 PASSWORD  **=** { *password* |  **@** _password\_variable_ }  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md), [RESTORE FILELISTONLY](../../t-sql/statements/restore-statements-filelistonly-transact-sql.md), [RESTORE HEADERONLY](../../t-sql/statements/restore-statements-headeronly-transact-sql.md) и [RESTORE VERIFYONLY](../../t-sql/statements/restore-statements-verifyonly-transact-sql.md).  
  
 Предоставляет пароль резервного набора данных. Пароль набора резервных копий является символьной строкой.  
  
> [!NOTE]  
>  [!INCLUDE[ssNoteDepFutureAvoid](../../includes/ssnotedepfutureavoid-md.md)]  
  
 Если при создании резервного набора данных был назначен пароль, то этот пароль необходим для выполнения любой операции восстановления из резервного набора данных. Указать неверный пароль или указать пароль, если резервный набор данных настроен на работу без пароля, является ошибкой.  
  
> [!IMPORTANT]  
>  Этот пароль обеспечивает слабую защиту для набора носителей. Дополнительные сведения см. в подразделе «Разрешения» для соответствующих инструкций.  
  
##### <a name="media-set-options"></a>Параметры набора носителей  
 Эти параметры влияют на весь набор носителей.  
  
 MEDIANAME **=** { *media_name* |  **@** _media\_name\_variable_}  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md), [RESTORE FILELISTONLY](../../t-sql/statements/restore-statements-filelistonly-transact-sql.md), [RESTORE HEADERONLY](../../t-sql/statements/restore-statements-headeronly-transact-sql.md), [RESTORE LABELONLY](../../t-sql/statements/restore-statements-labelonly-transact-sql.md) и [RESTORE VERIFYONLY](../../t-sql/statements/restore-statements-verifyonly-transact-sql.md).  
  
 Задает имя данного носителя. Если имя носителя указано, оно должно соответствовать имени резервных томов; в противном случае операция восстановления прекращается. Если имя носителя в инструкции RESTORE не указано, то поиск совпадающего имени носителя на резервных томах не выполняется.  
  
> [!IMPORTANT]  
>  Соответствие имен носителей в операциях восстановления и резервного копирования обеспечивает дополнительную проверку носителя, выбранного для операции восстановления.  
  
 MEDIAPASSWORD **=** { *mediapassword* |  **@** _mediapassword\_variable_ }  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md), [RESTORE FILELISTONLY](../../t-sql/statements/restore-statements-filelistonly-transact-sql.md), [RESTORE HEADERONLY](../../t-sql/statements/restore-statements-headeronly-transact-sql.md), [RESTORE LABELONLY](../../t-sql/statements/restore-statements-labelonly-transact-sql.md) и [RESTORE VERIFYONLY](../../t-sql/statements/restore-statements-verifyonly-transact-sql.md).  
  
 Предоставляет пароль набора носителей. Пароль набора носителей является символьной строкой.  
  
> [!NOTE]  
>  [!INCLUDE[ssNoteDepFutureAvoid](../../includes/ssnotedepfutureavoid-md.md)]  
  
 Если пароль был назначен во время форматирования набора носителей, этот пароль необходим для доступа к любому набору резервных данных на этом носителе. Указать неверный пароль или указать пароль, если набор носителей настроен на работу без пароля, является ошибкой.  
  
> [!IMPORTANT]  
>  Этот пароль обеспечивает слабую защиту для набора носителей. Дополнительные сведения см. в разделе «Разрешения» для соответствующей инструкции.  
  
 BLOCKSIZE **=** { *blocksize* |  **@** _blocksize\_variable_ }  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md)  
  
 Указывает размер физического блока в байтах. Поддерживаются размеры 512, 1024, 2048, 4096, 8192, 16 384, 32 768 и 65 536 байт (64 КБ). Значение по умолчанию равно 65 536 для ленточных устройств и 512 для других устройств. Обычно в этом параметре нет необходимости, так как инструкция RESTORE автоматически выбирает размер блока, соответствующий устройству. Явная установка размера блока переопределяет автоматический выбор размера блока.  
  
 При восстановлении из копии с носителя CD-ROM укажите значение BLOCKSIZE=2048.  
  
> [!NOTE]  
>  Этот параметр обычно влияет на производительность только при чтении с ленточных устройств.  
  
##### <a name="data-transfer-options"></a>Параметры передачи данных  
 Эти параметры позволяют оптимизировать передачу данных с устройства резервного копирования.  
  
 BUFFERCOUNT **=** { *buffercount* |  **@** _buffercount\_variable_ }  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md)  
  
 Указывает общее число буферов ввода-вывода, которые будут использоваться для операции восстановления. Можно указать любое целое положительное значение, однако большое число буферов может вызвать ошибку нехватки памяти из-за чрезмерного виртуального адресного пространства в процессе Sqlservr.exe.  
  
 Общее используемое буферами пространство определяется по следующей формуле: _число_буферов_* *\** _максимальный_размер_передаваемых_данных_.  
  
 MAXTRANSFERSIZE **=** { _maxtransfersize_ |  **@** _maxtransfersize\_variable_ }  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md)  
  
 Указывает наибольший объем пакета данных в байтах для обмена между носителем резервного набора и [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Поддерживаются значения, кратные 65 536 байтам (64 КБ), вплоть до 4 194 304 байт (4 МБ).  
> [!NOTE]  
>  Если для базы данных настроена файловая группа FILESTREAM или база данных включает файловые группы OLTP в памяти, то значение `MAXTRANSFERSIZE` в момент восстановления должно быть не меньше этого значения, указанного при создании резервной копии.  
  
##### <a name="error-management-options"></a>Параметры управления ошибками  
 Эти параметры позволяют определить, разрешены ли контрольные суммы резервных копий в операции восстановления и останавливается ли операция при обнаружении ошибки.    
  
 { CHECKSUM | NO_CHECKSUM }  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md), [RESTORE FILELISTONLY](../../t-sql/statements/restore-statements-filelistonly-transact-sql.md), [RESTORE HEADERONLY](../../t-sql/statements/restore-statements-headeronly-transact-sql.md), [RESTORE LABELONLY](../../t-sql/statements/restore-statements-labelonly-transact-sql.md) и [RESTORE VERIFYONLY](../../t-sql/statements/restore-statements-verifyonly-transact-sql.md).  
  
 Поведение по умолчанию обозначает проверку контрольных сумм, если они существуют, и продолжать без проверки, если они отсутствуют.  
  
 CHECKSUM  
 Указывает, что необходимо проверить контрольные суммы резервных копий, и если в резервной копии нет контрольной суммы, приводит к отказу операции восстановления с выдачей сообщения об отсутствии контрольной суммы.  
  
> [!NOTE]  
>  Контрольные суммы страниц относятся к операциям резервного копирования только в случае, если используются контрольные суммы резервных копий.  
  
 По умолчанию при обнаружении правильной контрольной суммы RESTORE сообщает об ошибке контрольной суммы и восстановление прекращается. Но если указать CONTINUE_AFTER_ERROR, то работа RESTORE продолжается после сообщения об ошибке контрольной суммы и обнаружения нескольких страниц, содержащих неправильные контрольные суммы, если этому не препятствуют ошибки.  
  
 Дополнительные сведения о работе с контрольными суммами резервных копий см. в разделе [Возможные ошибки носителей во время резервного копирования и восстановления (SQL Server)](../../relational-databases/backup-restore/possible-media-errors-during-backup-and-restore-sql-server.md).  
  
 NO_CHECKSUM  
 Явно отменяет проверку контрольных сумм операцией восстановления.  
  
 { **STOP_ON_ERROR** | CONTINUE_AFTER_ERROR }  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md), [RESTORE FILELISTONLY](../../t-sql/statements/restore-statements-filelistonly-transact-sql.md), [RESTORE HEADERONLY](../../t-sql/statements/restore-statements-headeronly-transact-sql.md), [RESTORE LABELONLY](../../t-sql/statements/restore-statements-labelonly-transact-sql.md) и [RESTORE VERIFYONLY](../../t-sql/statements/restore-statements-verifyonly-transact-sql.md).  
  
 STOP_ON_ERROR  
 Указывает, что операция восстановления прекращается после обнаружения первой ошибки. Это поведение по умолчанию для инструкций RESTORE, за исключением инструкции RESTORE VERIFYONLY, для которой по умолчанию действует режим CONTINUE_AFTER_ERROR.  
  
 CONTINUE_AFTER_ERROR  
 Указывает на то, что после возникновении ошибки операция восстановления должна продолжаться.  
  
 Если в резервной копии есть поврежденные страницы, то лучше всего повторить операцию восстановления с использованием альтернативной резервной копии, не содержащей ошибок (например, используя резервную копию, созданную до повреждения страниц). В качестве последнего средства можно попытаться восстановить данные из поврежденной резервной копии с помощью параметра CONTINUE_AFTER_ERROR восстанавливающей инструкции.  
  
##### <a name="filestream-options"></a>Параметры FILESTREAM  
 FILESTREAM ( DIRECTORY_NAME =*имя_каталога* )  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md) и [RESTORE VERIFYONLY](../../t-sql/statements/restore-statements-verifyonly-transact-sql.md)  
  
**Область применения**: [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] и более поздних версий
  
 Имя каталога, совместимое с Windows. Это имя должно быть уникальным среди всех имен каталогов уровня базы данных FILESTREAM в экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Проверка уникальности выполняется с учетом регистра, независимо от параметров сортировки [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].  
  
##### <a name="monitoring-options"></a>Параметры наблюдения  
 Эти параметры позволяют наблюдать за передачей данных с устройства резервного копирования.  
  
 STATS [ **=** _percentage_ ]  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md) и [RESTORE VERIFYONLY](../../t-sql/statements/restore-statements-verifyonly-transact-sql.md)  
  
 Отображает сообщение каждый раз, когда завершается очередной процент задания, и используется для отслеживания хода выполнения. Если *процент* не указан, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] выводит сообщение после завершения каждых 10 процентов (приблизительно).  
  
 Параметр STATS сообщает о готовности в процентах по отношению к порогу сообщения о следующем интервале. Это происходит приблизительно при указанном процентном значении; например, если параметру STATS присвоено значение 10, компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] выдает сообщения приблизительно с таким интервалом; в частности, вместо точного значения 40% может быть показано значение 43%. Это не является проблемой для больших резервных наборов данных, поскольку показатель готовности в процентах перемещается очень медленно между завершенными вызовами ввода-вывода.  
  
##### <a name="tape-options"></a>Параметры ленты  
 Эти параметры используются только для ленточных устройств. При использовании другого устройства они не обрабатываются.  
  
 { **REWIND** | NOREWIND }  
 Эти параметры используются только для ленточных устройств. При использовании другого устройства они пропускаются.  
  
 REWIND  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md), [RESTORE FILELISTONLY](../../t-sql/statements/restore-statements-filelistonly-transact-sql.md), [RESTORE HEADERONLY](../../t-sql/statements/restore-statements-headeronly-transact-sql.md), [RESTORE LABELONLY](../../t-sql/statements/restore-statements-labelonly-transact-sql.md) и [RESTORE VERIFYONLY](../../t-sql/statements/restore-statements-verifyonly-transact-sql.md).  
  
 Указывает, что [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] должен освободить и перемотать ленту. REWIND — значение по умолчанию.  
  
 NOREWIND  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md) и [RESTORE VERIFYONLY](../../t-sql/statements/restore-statements-verifyonly-transact-sql.md)  
  
 Использование NOREWIND в любой другой инструкции восстановления приводит к ошибке.  
  
 Указывает, что [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] сохранит ленту открытой после операции резервного копирования. Этим параметром можно пользоваться для увеличения производительности при выполнении нескольких операций резервного копирования на ленту.  
  
 Параметр NOREWIND подразумевает параметр NOUNLOAD, и эти параметры несовместимы в одной инструкции RESTORE.  
  
> [!NOTE]  
>  При использовании параметра NOREWIND экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] продолжает владеть накопителем на магнитной ленте до тех пор, пока инструкция BACKUP или RESTORE, работающая в этом же процессе, не использует параметр REWIND или UNLOAD, или пока не закончит работу экземпляр сервера. Поскольку лента остается открытой, другие процессы не могут получить доступа к ленте. Дополнительные сведения об отображении списка открытых лент и закрытии открытой ленты см. в разделе [Устройства резервного копирования (SQL Server)](../../relational-databases/backup-restore/backup-devices-sql-server.md).  
  
 { **UNLOAD** | NOUNLOAD }  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md), [RESTORE FILELISTONLY](../../t-sql/statements/restore-statements-filelistonly-transact-sql.md), [RESTORE HEADERONLY](../../t-sql/statements/restore-statements-headeronly-transact-sql.md), [RESTORE LABELONLY](../../t-sql/statements/restore-statements-labelonly-transact-sql.md), [RESTORE REWINDONLY](../../t-sql/statements/restore-statements-rewindonly-transact-sql.md) и [RESTORE VERIFYONLY](../../t-sql/statements/restore-statements-verifyonly-transact-sql.md).  
  
 Эти параметры используются только для ленточных устройств. При использовании другого устройства они пропускаются.  
  
> [!NOTE]  
>  Параметр UNLOAD/NOUNLOAD является настройкой сеанса, он сохраняется в течение работы сеанса или пока не будет сброшен при указании другого значения.  
  
 UNLOAD  
 Указывает, что лента автоматически перематывается и выгружается по завершении операции резервного копирования. Параметр UNLOAD применяется в начале сеанса по умолчанию.  
  
 NOUNLOAD  
 Указывает, что после операции RESTORE лента останется загруженной в ленточный накопитель.  
  
#### <a name="replication_with_option"></a><параметр_WITH_для_репликации>  
 Этот параметр имеет значение, только если во время создания резервной копии проводилась репликация базы данных.  
  
 KEEP_REPLICATION  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md)  
  
Аргумент KEEP_REPLICATION следует использовать при настройке репликации с доставкой журналов. Это предотвращает удаление параметров репликации, если резервная копия базы данных или резервная копия журналов восстанавливается на сервере «горячего» резервирования и база данных воссоздается. Не разрешается указывать этот параметр при восстановлении резервной копии с параметром NORECOVERY. Для обеспечения функций репликации после восстановления:  
  
-   Базы данных **msdb** и **master** на сервере "горячего" резервирования должны быть синхронизированы с базами данных **msdb** и **master** на сервере-источнике.  
  
-   Сервер «горячего» резервирования должен быть переименован, и ему должно быть присвоено такое же имя, как у сервера-источника.  
  
#### <a name="change_data_capture_with_option"></a><параметр_WITH_для_изменения_отслеживания_данных>  
 Этот параметр имеет значение, только если при создании резервной копии в базе данных была включена система отслеживания измененных данных.  
  
 KEEP_CDC  
 **Поддерживается:**  [RESTORE](../../t-sql/statements/restore-statements-transact-sql.md)  
  
 Ключевое слово KEEP_CDC следует использовать для предотвращения удаления настроек системы отслеживания измененных данных при восстановлении резервной копии базы данных или журнала на другом сервере и восстановлении базы данных. Не разрешается указывать этот параметр при восстановлении резервной копии с параметром NORECOVERY.  
  
 Восстановление базы данных с ключевым словом KEEP_CDC не приводит к созданию заданий по системе отслеживания измененных данных. Чтобы извлечь изменения из журнала после восстановления базы данных, заново создайте задание отслеживания изменений и задание очистки для восстановленной базы данных. Дополнительные сведения см. в разделе [sys.sp_cdc_add_job (Transact-SQL)](../../relational-databases/system-stored-procedures/sys-sp-cdc-add-job-transact-sql.md).  
  
 Дополнительные сведения об использовании системы отслеживания измененных данных с зеркальным отображением базы данных см. в разделе [Система отслеживания измененных данных и другие функции SQL Server](../../relational-databases/track-changes/change-data-capture-and-other-sql-server-features.md).  
  
#### \<service_broker_WITH_options>  
 Включает или выключает доставку сообщений компонентом [!INCLUDE[ssSB](../../includes/sssb-md.md)] либо задает новый идентификатор компонента [!INCLUDE[ssSB](../../includes/sssb-md.md)]. Этот параметр имеет значение, только если при создании резервной копии в базе данных был включен компонент [!INCLUDE[ssSB](../../includes/sssb-md.md)].  
  
 { ENABLE_BROKER  | ERROR_BROKER_CONVERSATIONS  | NEW_BROKER }  
 **Поддерживается:**  [RESTORE DATABASE](../../t-sql/statements/restore-statements-transact-sql.md)  
  
 ENABLE_BROKER  
 Указывает, что доставка сообщений компонента [!INCLUDE[ssSB](../../includes/sssb-md.md)] включена по завершении восстановления, поэтому сообщения можно отправлять немедленно. По умолчанию при восстановлении доставка сообщений компонента [!INCLUDE[ssSB](../../includes/sssb-md.md)] отключена. Существующий идентификатор компонента Service Broker сохраняется в базе данных.  
  
 ERROR_BROKER_CONVERSATIONS  
 Завершает все диалоги, находящиеся в состоянии ошибки, которые были присоединены к базе данных или восстановлены. Это дает возможность приложениям выполнять регулярную очистку существующих сеансов связи. Доставка сообщений компонента Service Broker отключается до завершения данной операции, затем снова включается. Существующий идентификатор компонента Service Broker сохраняется в базе данных.  
  
 NEW_BROKER  
 Указывает, что базе данных назначен новый идентификатор компонента Service Broker. Поскольку база данных предполагает наличие нового компонента Service Broker, все существующие сеансы связи в базе данных будут немедленно удалены, не выдавая диалоговых сообщений о завершении. Все маршруты, ссылающиеся на прежний идентификатор компонента Service Broker, должны быть повторно созданы с использованием нового идентификатора.  
  
#### \<point_in_time_WITH_options>  
 **Поддерживается:**  [RESTORE {DATABASE|LOG}](../../t-sql/statements/restore-statements-transact-sql.md) только для модели полного восстановления и модели восстановления с неполным протоколированием.  
  
 Можно восстановить базу данных на определенный момент времени или к определенной транзакции, указав целевую точку восстановления в предложении STOPAT, STOPATMARK или STOPBEFOREMARK. Восстановление на определенный момент времени или к определенной транзакции всегда выполняется из резервной копии журнала. В каждой инструкции RESTORE LOG из последовательности восстановления необходимо указывать целевое время или целевую транзакцию в одинаковых предложениях STOPAT, STOPATMARK или STOPBEFOREMARK.  
  
 Для восстановления на определенный момент времени сначала необходимо восстановить полную резервную копию базы данных, конечная точка которой располагается раньше, чем целевая точка восстановления. Чтобы упростить определение резервной копии базы данных, которую следует восстановить, можно дополнительно указать предложение WITH STOPAT, STOPATMARK или STOPBEFOREMARK в инструкции RESTORE DATABASE, чтобы вызвать ошибку, если резервная копия данных окажется слишком поздней для заданного целевого времени. Однако полная резервная копия базы данных всегда восстанавливается, даже если она содержит целевое время.  
  
> [!NOTE]  
>  Параметры WITH для заданного момента времени для инструкций RESTORE_DATABASE и RESTORE_LOG одинаковы, но аргумент *имя_метки* поддерживается только инструкцией RESTORE LOG.  
  
 { STOPAT | STOPATMARK | STOPBEFOREMARK }   
 
 STOPAT **=** { **'** _datetime_ **'**  |  **@** _datetime\_var* }  
 Указывает, что база данных будет восстановлена в состояние, в котором она находилась в момент, соответствующий дате и времени, которые указаны в параметре *datetime* или **@** _datetime\_var_. Дополнительные сведения об указании даты и времени см. в статье [Типы данных и функции даты и времени (Transact-SQL)](../../t-sql/functions/date-and-time-data-types-and-functions-transact-sql.md).  
  
 Если для параметра STOPAT использована переменная, то она должна иметь тип данных **varchar**, **char**, **smalldatetime** или **datetime**. Только записи журнала транзакций, сделанные до указанных даты и времени, применяются к базе данных.  
  
> [!NOTE]  
>  Если указанное время STOPAT назначено после создания последней резервной копии журналов, база данных остается в невосстановленном состоянии, как если бы инструкция RESTORE LOG работала с параметром NORECOVERY.  
  
 Дополнительные сведения см. в статье [Восстановление базы данных SQL Server до определенного момента времени (модель полного восстановления)](../../relational-databases/backup-restore/restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md).  
  
 STOPATMARK **=** { **'** _mark\_name_ **'**  |  **'** lsn:_lsn\_number_ **'** } [ AFTER **'** _datetime_ **'** ]  
 Задает восстановление до указанной точки восстановления. Заданная транзакция включается в восстановление, но фиксируется только в том случае, если она была изначально зафиксирована в ходе формирования транзакции.  
  
 Инструкции RESTORE DATABASE и RESTORE LOG поддерживают параметр *номер_lsn*. Этот параметр определяет регистрационный номер транзакции в журнале.  
  
 Параметр *имя_метки* поддерживается только инструкцией RESTORE LOG. Этот параметр идентифицирует метку транзакции в резервной копии журнала.  
  
 Если в инструкции RESTORE LOG опущен параметр AFTER *дата_и_время*, то восстановление останавливается на первой метке с указанным именем. Если указан параметр AFTER *дата_и_время*, то восстановление останавливается на первой метке с указанным именем непосредственно перед или после указанных *даты_и_времени*.  
  
> [!NOTE]  
>  Если указанная отметка (номер LSN) или время назначены после создания последней резервной копии журналов, база данных остается в невосстановленном состоянии, как если бы инструкция RESTORE LOG работала с параметром NORECOVERY.  
  
 Дополнительные сведения см. в разделах [Использование помеченных транзакций для согласованного восстановления связанных баз данных (модель полного восстановления)](../../relational-databases/backup-restore/use-marked-transactions-to-recover-related-databases-consistently.md) и [Восстановление до номера LSN (SQL Server)](../../relational-databases/backup-restore/recover-to-a-log-sequence-number-sql-server.md).  
  
 STOPBEFOREMARK **=** { **'** _mark\_name_ **'**  |  **'** lsn:_lsn\_number_ **'** } [ AFTER **'** _datetime_ **'** ]  
 Задает восстановление до указанной точки восстановления. Заданная транзакция не включается в восстановление; после применения параметра WITH RECOVERY производится ее откат.  
  
 Инструкции RESTORE DATABASE и RESTORE LOG поддерживают параметр *номер_lsn*. Этот параметр определяет регистрационный номер транзакции в журнале.  
  
 Параметр *имя_метки* поддерживается только инструкцией RESTORE LOG. Этот параметр идентифицирует метку транзакции в резервной копии журнала.  
  
 Если в инструкции RESTORE LOG опущен параметр AFTER *дата_и_время*, то восстановление останавливается на первой метке с указанным именем. Если указан параметр AFTER *дата_и_время*, то восстановление останавливается на первой метке с указанным именем непосредственно перед или после указанных *даты_и_времени*.  
  
> [!IMPORTANT]  
>  Если последовательность частичного восстановления исключает любые файловые группы FILESTREAM, восстановление на момент времени не поддерживается. Можно принудительно продолжить последовательность восстановления. Тем не менее файловые группы файлового потока, не вошедшие в инструкцию RESTORE, восстановить невозможно. Для принудительного продолжения восстановления на момент времени укажите параметр CONTINUE_AFTER_ERROR вместе с параметром STOPAT, STOPATMARK или STOPBEFOREMARK. Если указать параметр CONTINUE_AFTER_ERROR, выполняется последовательность частичного восстановления, а файловая группа FILESTREAM становится невосстановимой.  
  
## <a name="result-sets"></a>Результирующие наборы  
 Сведения о результирующих наборах см. в следующих разделах:  
  
-   [RESTORE FILELISTONLY (Transact-SQL)](../../t-sql/statements/restore-statements-filelistonly-transact-sql.md)  
  
-   [RESTORE HEADERONLY (Transact-SQL)](../../t-sql/statements/restore-statements-headeronly-transact-sql.md)  
  
-   [RESTORE LABELONLY (Transact-SQL)](../../t-sql/statements/restore-statements-labelonly-transact-sql.md)  
  
## <a name="remarks"></a>Remarks  
 Дополнительные замечания см. в следующих разделах:  
  
-   [RESTORE (Transact-SQL)](../../t-sql/statements/restore-statements-transact-sql.md)  
  
-   [RESTORE HEADERONLY (Transact-SQL)](../../t-sql/statements/restore-statements-headeronly-transact-sql.md)  
  
-   [RESTORE LABELONLY (Transact-SQL)](../../t-sql/statements/restore-statements-labelonly-transact-sql.md)  
  
-   [RESTORE REWINDONLY (Transact-SQL)](../../t-sql/statements/restore-statements-rewindonly-transact-sql.md)  
  
-   [RESTORE VERIFYONLY (Transact-SQL)](../../t-sql/statements/restore-statements-verifyonly-transact-sql.md)  
  
## <a name="specifying-a-backup-set"></a>Указание резервного набора данных  
 *Резервный набор данных* содержит резервную копию, полученную в результате отдельной успешной операции резервного копирования. Инструкции RESTORE, RESTORE FILELISTONLY, RESTORE HEADERONLY и RESTORE VERIFYONLY выполняются над отдельным резервным набором данных в рамках набора носителей на указанном устройстве или устройствах резервного копирования. Указанная резервная копия должна быть расположена на наборе носителей. Значение *номер_файла_резервного_набора* резервного набора данных можно получить с помощью инструкции [RESTORE HEADERONLY](../../t-sql/statements/restore-statements-headeronly-transact-sql.md) .  
  
 Параметр для указания резервного набора данных с целью восстановления имеет вид:  
  
 FILE **=** { *backup_set_file_number* |  **@** _backup\_set\_file\_number_ }  
  
 Аргумент *номер_файла_резервного_набора* указывает позицию резервной копии в наборе носителей. Аргумент *номер_файла_резервного_набора*, равный 1 (FILE = 1), указывает первый резервный набор данных на носителе данных резервных копий, аргумент *номер_файла_резервного_набора*, равный 2 (FILE = 2), указывает второй резервный набор данных и т. д.  
  
 Поведение этого параметра зависит от инструкции, как описано в следующей таблице:  
  
|.|Поведение параметра резервного набора данных FILE|  
|---------------|-----------------------------------------|  
|RESTORE|По умолчанию номер файла резервного набора данных равен 1. В инструкции RESTORE разрешено использовать только один параметр резервного набора данных FILE. Важно указывать резервные наборы данных по порядку.|  
|RESTORE FILELISTONLY|По умолчанию номер файла резервного набора данных равен 1.|  
|инструкция RESTORE HEADERONLY|По умолчанию обрабатываются все резервные наборы данных в наборе носителей. Результирующий набор инструкции RESTORE HEADERONLY возвращает сведения о каждом резервном наборе данных, включая их **положение** в наборе носителей. Чтобы получить сведения о конкретном резервном наборе данных, укажите его положение в качестве значения аргумента *номер_файла_резервного_набора_данных* в параметре FILE.<br /><br /> Примечание. Для ленточных носителей инструкция RESTORE HEADER обрабатывает только резервные наборы данных на загруженной ленте.|  
|RESTORE VERIFYONLY|Значение *номера_файла_резервного_набора_данных* по умолчанию — 1.|  
  
> [!NOTE]  
>  Параметр FILE для указания резервного набора данных не связан с параметром FILE для указания файла базы данных, FILE **=** { *logical_file_name_in_backup* |  **@** _logical\_file\_name\_in\_backup\_var_ }.  
  
## <a name="summary-of-support-for-with-options"></a>Сводка совместимости с параметрами инструкции WITH  
 Следующие параметры инструкции WITH совместимы только с инструкцией RESTORE: BLOCKSIZE, BUFFERCOUNT, MAXTRANSFERSIZE, PARTIAL, KEEP_REPLICATION, { RECOVERY | NORECOVERY | STANDBY }, REPLACE, RESTART, RESTRICTED_USER и { STOPAT | STOPATMARK | STOPBEFOREMARK }  
  
> [!NOTE]  
>  Параметр PARTIAL поддерживается только инструкцией RESTORE DATABASE.  
  
 В следующей таблице перечислены параметры инструкции WITH, которые используются одной или несколькими инструкциями, и указано, какие инструкции совместимы с каждым параметром. Галочка (√) показывает, что параметр поддерживается; тире (—) показывает, что параметр не поддерживается.  
  
|Параметр инструкции WITH|RESTORE|RESTORE FILELISTONLY|инструкция RESTORE HEADERONLY|RESTORE LABELONLY|RESTORE REWINDONLY|RESTORE VERIFYONLY|  
|-----------------|-------------|--------------------------|------------------------|-----------------------|------------------------|------------------------|  
|{ CHECKSUM<br /><br /> &#124; NO_CHECKSUM }|√|√|√|√|-|√|  
|{ CONTINUE_AFTER_ERROR<br /><br /> &#124; STOP_ON_ERROR }|√|√|√|√|-|√|  
|FILE<sup>1</sup>|√|√|√|-|-|√|  
|LOADHISTORY|-|-|-|-|-|√|  
|MEDIANAME|√|√|√|√|-|√|  
|MEDIAPASSWORD|√|√|√|√|-|√|  
|MOVE|√|-|-|-|-|√|  
|PASSWORD|√|√|√|-|-|√|  
|{ REWIND &#124; NOREWIND }|√|Только REWIND|Только REWIND|Только REWIND|-|√|  
|STATS|√|-|-|-|-|√|  
|{ UNLOAD &#124; NOUNLOAD }|√|√|√|√|√|√|  
  
 <sup>1</sup> FILE **=** _backup\_set\_file\_number_, который отличается от {FILE | FILEGROUP}.  
  
## <a name="permissions"></a>Разрешения  
 Сведения о разрешениях см. в следующих разделах:  
  
-   [RESTORE (Transact-SQL)](../../t-sql/statements/restore-statements-transact-sql.md)  
  
-   [RESTORE FILELISTONLY (Transact-SQL)](../../t-sql/statements/restore-statements-filelistonly-transact-sql.md)  
  
-   [RESTORE HEADERONLY (Transact-SQL)](../../t-sql/statements/restore-statements-headeronly-transact-sql.md)  
  
-   [RESTORE LABELONLY (Transact-SQL)](../../t-sql/statements/restore-statements-labelonly-transact-sql.md)  
  
-   [RESTORE REWINDONLY (Transact-SQL)](../../t-sql/statements/restore-statements-rewindonly-transact-sql.md)  
  
-   [RESTORE VERIFYONLY (Transact-SQL)](../../t-sql/statements/restore-statements-verifyonly-transact-sql.md)  
  
## <a name="examples"></a>Примеры  
 Примеры см. в следующих разделах:  
  
-   [RESTORE (Transact-SQL)](../../t-sql/statements/restore-statements-transact-sql.md)  
  
-   [RESTORE FILELISTONLY (Transact-SQL)](../../t-sql/statements/restore-statements-filelistonly-transact-sql.md)  
  
-   [RESTORE HEADERONLY (Transact-SQL)](../../t-sql/statements/restore-statements-headeronly-transact-sql.md)  
  
## <a name="see-also"></a>См. также:  
 [BACKUP (Transact-SQL)](../../t-sql/statements/backup-transact-sql.md)   
 [RESTORE (Transact-SQL)](../../t-sql/statements/restore-statements-transact-sql.md)   
 [Инструкция RESTORE FILELISTONLY (Transact-SQL)](../../t-sql/statements/restore-statements-filelistonly-transact-sql.md)   
 [RESTORE HEADERONLY (Transact-SQL)](../../t-sql/statements/restore-statements-headeronly-transact-sql.md)   
 [RESTORE LABELONLY (Transact-SQL)](../../t-sql/statements/restore-statements-labelonly-transact-sql.md)   
 [RESTORE REWINDONLY (Transact-SQL)](../../t-sql/statements/restore-statements-rewindonly-transact-sql.md)   
 [RESTORE VERIFYONLY (Transact-SQL)](../../t-sql/statements/restore-statements-verifyonly-transact-sql.md)   
 [Резервное копирование и восстановление баз данных SQL Server](../../relational-databases/backup-restore/back-up-and-restore-of-sql-server-databases.md)   
 [FILESTREAM (SQL Server)](../../relational-databases/blob/filestream-sql-server.md)  
  
  

