---
description: Отображение связей "многие-ко-многим" в производных иерархиях (Master Data Services)
title: Отображение связей "многие-ко-многим" в производных иерархиях
ms.custom: seo-lt-2019
ms.date: 03/01/2017
ms.prod: sql
ms.prod_service: mds
ms.reviewer: ''
ms.technology: master-data-services
ms.topic: conceptual
ms.assetid: 8b2a9c43-40e0-48f7-a6a9-325beb9f27da
author: lrtoyou1223
ms.author: lle
ms.openlocfilehash: ab2eaf50f73ae59bdde5cb40c75050bb0bc8206f
ms.sourcegitcommit: efce0ed7d1c0ab36a4a9b88585111636134c0fbb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/23/2021
ms.locfileid: "104833814"
---
# <a name="show-many-to-many-relationships-in-derived-hierarchies-master-data-services"></a>Отображение связей "многие-ко-многим" в производных иерархиях (Master Data Services)

[!INCLUDE [SQL Server - Windows only ASDBMI  ](../includes/applies-to-version/sql-windows-only-asdbmi.md)]

  Теперь в производных иерархиях (DH) наряду с отображением связей "один-ко-многим" могут отображаться связи "многие-ко-многим".  
  
## <a name="many-to-many-m2m-relationships"></a>Связи "многие-ко-многим"  

Связь "многие-ко-многим" (M2M) между двумя сущностями можно смоделировать с помощью третьей сущности, обеспечивающей между ними сопоставление.  
  
![mds_hierarchies_manytomany](../master-data-services/media/mds-hierarchies-manytomany.png "mds_hierarchies_manytomany")  
  
В приведенном выше примере между сущностями **Employee** и **TrainingClass** имеется связь "многие-ко-многим", обеспечиваемая сущностью сопоставления **ClassRegistration**. Сотрудник может быть зарегистрирован как учащийся на нескольких курсах, и каждый курс может содержать несколько учащихся.  
  
Можно создать производную иерархию, которая отображает, например учащихся по классам, или инвертировать связь и показать классы, сгруппированные по учащимся.  

> [!NOTE]
> [!INCLUDE [sssql16-md](../includes/sssql16-md.md)] введена производная иерархия для связей M2M. Эта возможность была недоступна до этой версии.
  
Сначала перейдите на страницу Управление производной иерархией и создайте новую производную иерархию:  
  
 ![mds_hierarchies_add_derived_hierarchy](../master-data-services/media/mds-hierarchies-add-derived-hierarchy.png "mds_hierarchies_add_derived_hierarchy")  
  
 Затем добавьте уровни в новую производную иерархию, начиная с нижнего края. В этом примере нужно показать учащихся (сотрудников), сгруппированных по учебному курсу. Сущность **Employee** находится на конечном уровне иерархии и добавляется первой.  
  
 ![mds_hierarchies_edit_derived_hierarchy_one](../master-data-services/media/mds-hierarchies-edit-derived-hierarchy-one.PNG "mds_hierarchies_edit_derived_hierarchy_one")  
  
 Обратите внимание, что на приведенном выше снимке экрана сущность **Employee** отображается в среднем разделе **Текущие уровни** как единственный уровень. В **предварительной версии** производной иерархии справа просто отображается список всех элементов сущности **Employee** . В разделе **Доступные уровни** слева отображаются уровни, которые можно добавить выше текущего верхнего уровня (**Сотрудник**). Большинство из них являются атрибутами на основе домена в сущности **Сотрудник** , включая атрибут на основе домена **Отдел** .  
  
 Начиная с [!INCLUDE[ssnoversion](../includes/ssnoversion-md.md)]существует новый тип уровня, который моделирует связи "многие ко многим", например **Class (сопоставленный через ClassRegistration.Student)**. Имя уровня является более подробным по сравнению с другими именами. Это необходимо для предоставления дополнительных сведений для однозначного описания связи сопоставления. Перетащите этот уровень на уровень **Employee** в разделе **Текущие уровни** .  
  
 ![mds_hierarchies_edit_derived_hierarchy_two](../master-data-services/media/mds-hierarchies-edit-derived-hierarchy-two.PNG "mds_hierarchies_edit_derived_hierarchy_two")  
  
 Теперь в области предварительного просмотра отображаются сотрудники, сгруппированные по учебным курсам, для прохождения которых они зарегистрированы. Поскольку это связь "многие-ко-многим", каждый дочерний элемент может иметь несколько родительских элементов. В приведенном выше примере сотрудник **6 {Hillman, Reinout N}** зарегистрирован как учащийся двух курсов: **1 {Master Data Services 101}** и **4 {Career-Limiting Moves}**.  
  
 Эта связь сопоставления может отображаться в инвертированном виде с группировкой курсов по учащимся.  
  
 ![mds_hierarchies_available_entities_and_hierarchies](../master-data-services/media/mds-hierarchies-available-entities-and-hierarchies.PNG "mds_hierarchies_available_entities_and_hierarchies")  
  
 Опять же, мы видим, что дочерний элемент может отображаться в нескольких родительских: учебный курс **1 {Master Data Services 101}** отображается для **6 {Hillman, Reinout N}** и **40 {Ford, Jeffrey L}**.  
  
 Элементы сущности сопоставления **ClassRegistration** не отображаются в производной иерархии. Они используются для определения связей между родительскими и дочерними элементами в иерархии.  
  
 Чтобы изменить связь "многие-ко-многим" путем изменения элементов сущности сопоставления, выполните одно из указанных далее действий. Связь "многие ко многим" доступна только для чтения на странице **Обозреватель производных иерархий** .  
  
-   Измените элементы сущности сопоставления на странице **Обозреватель сущностей** , используя надстройку Master Data Services для Excel или функцию промежуточного хранения данных.  
  
-   Перетащите дочерние узлы между родителями на странице **Обозреватель производной иерархии** .  
  
     Этот метод позволяет изменять существующие элементы (если это возможно) и при необходимости добавлять новые элементы. Существующие элементы не удаляются.  
  
     Например, при перемещении учащегося на неиспользуемый узел с помощью сущности сопоставления ClassRegistration значение атрибута курса соответствующего элемента сущности сопоставления меняется на NULL и элемент не удаляется. И наоборот, если при перемещении учащегося с неиспользуемого узла в какой-либо курс существует элемент сопоставления, соответствующий учащемуся, где курс имеет значение NULL, этот элемент изменяется путем изменения курса с NULL на новый родительский элемент. Если такой элемент не найден, он добавляется.  
  
     Этот процесс позволяет избежать удаление элемента для предотвращения нежелательного удаления других данных пользователей, например, если сущность сопоставления помимо двух атрибутов, определяющих связь "родитель — потомок", содержит другие атрибуты. Пользователи должны выполнять удаления непосредственно в сущности сопоставления.  
  
 Новый уровень M2M может находиться в любом месте в производной иерархии, для которой разрешен уровень атрибута на основе домена (DBA). Уровень "многие-ко-многим" может отображаться в верхней части, как в приведенных выше примерах. Он может быть над или под уровнем DBA, включая рекурсивные уровни. Он может находиться под верхним уровнем явной иерархии (устаревшей). Несколько M2M связей могут быть объединены в одну и ту же производную иерархию.  
  
 Уровни M2M могут быть скрыты, как и другие уровни производной иерархии.  
   
### <a name="m2m-relationship-in-sample-model"></a><a name="M2MSample"></a> Связь "многие ко многим" в образце модели  
Для демонстрации связи "многие ко многим" просмотрите производную иерархию "Region Climate" в образце модели Customer, входящем в состав [!INCLUDE[ssMDSshort_md](../includes/ssmdsshort-md.md)].   
  
Как показано на рисунке ниже, имя уровня, моделирующего эту связь, — ![mds_Number1](../master-data-services/media/mds-number1.png)**Climate (сопоставляется через RegionClimate.Region)**. ![mds_Number2](../master-data-services/media/mds-number2.png)**Preview** показывает регионы, сгруппированные по связанному с ними типу климата. Это связь "многие ко многим", так как имеются регионы (дочерние элементы), связанные с несколькими типами климата (родительские элементы). Например, элемент ![mds_Number3](../master-data-services/media/mds-number3.png)**APCR {Asia Pacific}** связан с элементами ![mds_Number4](../master-data-services/media/mds-number4.png)**A {Tropical}** и ![mds_Number5](../master-data-services/media/mds-number5.png)**B {Dry}**.  
  
![mds_M2MRelationship_Example_CustomerModel](../master-data-services/media/mds-m2mrelationship-example-customermodel.png)  
  
Инструкции по развертыванию образца модели Customer и других образцов моделей, входящих в состав [!INCLUDE[ssMDSshort_md](../includes/ssmdsshort-md.md)], см. в разделе [Развертывание образцов моделей и данных](~/master-data-services/sql-server-samples-model-deployment-packages-mds.md).   
  
## <a name="one-many-relationship"></a>Связь "один-ко-многим"  
 Элемент производной иерархии может быть родителем нескольких дочерних элементов, однако обычно у него не может быть больше одного родительского элемента (исключения см. в разделе [Безопасность элементов](#bkmk_member_security)). Предположим, что имеются две сущности — Employee и Department — и каждый сотрудник принадлежит одному отделу. Эта связь моделируется путем добавления в сущность Employee атрибута DBA, который ссылается на сущность Department.  
  
 ![mds_hierarchies_onetomany](../master-data-services/media/mds-hierarchies-onetomany.png "mds_hierarchies_onetomany")  
  
 Это связь "один-ко-многим", так как каждый сотрудник принадлежит только одному отделу, но в каждом отделе может быть несколько сотрудников. Может быть создана производная иерархия, в которой отображаются сотрудники, сгруппированные по отделу:  
  
 ![mds_hierarchies_dh_screenshot](../master-data-services/media/mds-hierarchies-dh-screenshot.png "mds_hierarchies_dh_screenshot")  
  
##  <a name="member-security"></a><a name="bkmk_member_security"></a> Безопасность элементов  
 Иерархию, допускающую дублирование элементов (элемент может иметь несколько родительских элементов), нельзя использовать для назначения элементам разрешений безопасности. Пример:  
  
-   Рекурсивная производная иерархия (РДХ), которая не привязывает нулевые рекурсии (каждый элемент на рекурсивном уровне отображается под КОРНем и его рекурсивным родительским элементом).  
  
-   Рекурсивная производная иерархия с уровнем выше рекурсивного уровня (каждый элемент рекурсивного уровня отображается как в нерекурсивном родительском элементе, так и в его рекурсивном родительском элементе).  
  
-   Производная иерархия с уровнем M2M (дочерний элемент может быть сопоставлен с множеством родителей).  
  
## <a name="collections"></a>Коллекции  
 Коллекции и явные иерархии устарели. Хранимая процедура преобразования (udpConvertCollectionAndConsolidatedMembersToLeaf) преобразует элементы коллекции в конечные элементы и создает производные иерархии "многие-ко-многим" для записи сведений о принадлежности к коллекции.  
  
## <a name="see-also"></a>См. также:  
 [Производные иерархии (службы Master Data Services)](../master-data-services/derived-hierarchies-master-data-services.md)  
  
  
