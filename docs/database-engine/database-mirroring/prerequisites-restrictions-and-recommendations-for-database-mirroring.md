---
title: Зеркальное отображение базы данных. Предварительные условия, ограничения и рекомендации
description: Дополнительные сведения о предварительных требованиях, ограничениях и рекомендациях по настройке зеркального отображения базы данных с помощью SQL Server.
ms.custom: seo-lt-2019
ms.date: 05/17/2016
ms.prod: sql
ms.prod_service: high-availability
ms.reviewer: ''
ms.technology: database-mirroring
ms.topic: conceptual
helpviewer_keywords:
- database mirroring [SQL Server], deployment
- partners [SQL Server]
- database mirroring [SQL Server], prerequisites
- database mirroring [SQL Server], recommendations
- database mirroring [SQL Server], restrictions
- database mirroring [SQL Server], planning
- database mirroring [SQL Server], about database mirroring
ms.assetid: fdcf2251-9895-44c6-b81e-768fef32e732
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 95dd833cfe2fa558bc03b2aa68b29ac5b13d3272
ms.sourcegitcommit: 917df4ffd22e4a229af7dc481dcce3ebba0aa4d7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/10/2021
ms.locfileid: "100343285"
---
# <a name="prerequisites-restrictions-and-recommendations-for-database-mirroring"></a>Предварительные условия, ограничения и рекомендации по зеркальному отображению базы данных
 [!INCLUDE [SQL Server](../../includes/applies-to-version/sqlserver.md)]
    
> [!NOTE]  
>  [!INCLUDE[ssNoteDepFutureAvoid](../../includes/ssnotedepfutureavoid-md.md)] Вместо этого используйте [!INCLUDE[ssHADR](../../includes/sshadr-md.md)].  
  
 В этом разделе описываются предварительные условия и рекомендации по настройке зеркального отображения базы данных. Базовые сведения о зеркальном отображении базы данных см. в разделе [Зеркальное отображение базы данных (SQL Server)](../../database-engine/database-mirroring/database-mirroring-sql-server.md).  
  
  
##  <a name="support-for-database-mirroring"></a><a name="DbmSupport"></a> Поддержка зеркального отображения базы данных  
 Дополнительные сведения о поддержке зеркального отображения базы данных в [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] см. в разделе [Функции, поддерживаемые различными выпусками SQL Server 2016](../../sql-server/editions-and-components-of-sql-server-2016.md).
  
 Имейте в виду, что зеркальное отображение базы данных работает при любом поддерживаемом уровне совместимости базы данных. Сведения о поддерживаемых уровнях совместимости см. в разделе [Уровень совместимости ALTER DATABASE (Transact-SQL)](../../t-sql/statements/alter-database-transact-sql-compatibility-level.md).  
  
  
##  <a name="prerequisites"></a><a name="Prerequisites"></a> Предварительные требования  
  
-   Чтобы создать сеанс зеркального отображения, у участников и следящего сервера (если он есть) должна быть установлена одна и та же версия [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].  
  
-   На обоих участниках — как на основном, так и на зеркальном сервере — должен работать один и тот же выпуск [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. На следящем сервере (если он есть) может работать любой выпуск [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , поддерживающий зеркальное отображение базы данных.  
  
    > [!NOTE]  
    >  Экземпляры сервера, которые являются участниками сеанса зеркального отображения, вы можете обновить до более новой версии [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Дополнительные сведения см. в статье [Upgrading Mirrored Instances](../../database-engine/database-mirroring/upgrading-mirrored-instances.md).  
  
-   База данных должна использовать модель полного восстановления. Простая модель восстановления и модель восстановления с неполным протоколированием не поддерживают зеркальное отображение базы данных. Таким образом, массовые операции для зеркальной базы данных всегда полностью протоколируются. Дополнительные сведения о моделях восстановления см. в разделе [Модели восстановления (SQL Server)](../../relational-databases/backup-restore/recovery-models-sql-server.md).  
  
-   Убедитесь, что у зеркального сервера достаточно места на диске для зеркальной базы данных.  
  
    > [!NOTE]  
    >  Дополнительные сведения об использовании зеркального отображения базы данных на реплицируемой базе данных см. в разделе [Зеркальное отображение и репликация баз данных (SQL Server)](../../database-engine/database-mirroring/database-mirroring-and-replication-sql-server.md).  
  
-   При создании зеркальной базы данных на зеркальном сервере убедитесь, что резервная копия основной базы данных восстановлена, указав имя базы данных в предложении WITH NORECOVERY. Кроме того, все резервные копии журналов, созданные после резервного копирования этой базы данных, также должны быть восстановлены с использованием предложения WITH NORECOVERY.  
  
    > [!IMPORTANT]  
    >  Если зеркальное отображение базы данных было остановлено, то перед тем как заново запустить его, необходимо применить к зеркальной базе данных все последующие резервные копии журналов основной базы данных.  
  
  
##  <a name="restrictions"></a><a name="Restrictions"></a> Ограничения  
  
-   Зеркальное отображение возможно только для пользовательских баз данных. Нельзя осуществлять зеркальное отображение баз данных **master**, **msdb**, **tempdb** или **model** .  
  
-   Зеркальные базы данных нельзя переименовывать во время сеанса зеркального отображения.  
  
-   Зеркальное отображение базы данных не поддерживает FILESTREAM. Создание файловой группы FILESTREAM на основном сервере невозможно. Настройка зеркального отображения для базы данных, содержащей файловые группы FILESTREAM, невозможна.  
  
-   Зеркальное отображение базы данных не поддерживается с межбазовыми или с распределенными транзакциями. Дополнительные сведения см. в статье [Транзакции между базами данных и распределенные транзакции для групп доступности AlwaysOn и зеркального отображения базы данных (SQL Server)](../../database-engine/availability-groups/windows/transactions-always-on-availability-and-database-mirroring.md).  
  
  
##  <a name="recommendations-for-configuring-partner-servers"></a><a name="RecommendationsForPartners"></a> Рекомендации по настройке серверов-участников  
  
-   Участники должны выполняться на сопоставимых системах, которые могут обрабатывать одинаковые рабочие нагрузки.  
  
    > [!NOTE]  
    >  Если планируется использовать режим высокого уровня безопасности с автоматической отработкой отказа, каждый партнер по обеспечению отработки отказа должен использовать менее 50 процентов ЦП. Если рабочая нагрузка перегружает ЦП, партнер по обеспечению отработки отказа может оказаться неспособным выполнить команду ping для другого экземпляра сервера в сеансе зеркального отображения. Это приводит к излишним отработкам отказа. Если не удается избежать загрузки процессора более чем на 50 процентов, то рекомендуется использовать либо режим высокой безопасности без автоматической отработки отказа, либо режим высокой производительности.  
  
-   Желательно, чтобы путь зеркальной базы данных (включая имя диска) был идентичен пути основной базы данных. Если размещение файлов различается для разных баз данных, необходимо включить в инструкцию RESTORE параметр MOVE. Например, если основная база данных расположена на диске «F:», а в зеркальной системе нет диска «F:».  
  
    > [!IMPORTANT]  
    >  Если во время создания зеркального отображения базы данных файлы базы данных перемещаются, в дальнейшем добавление файлов в базу данных без приостановки зеркального отображения может быть невозможным.  
  
-   В сеансе зеркального отображения все экземпляры сервера должны использовать одну и ту же основную кодовую страницу и параметры сортировки. Отличия могут вызвать проблемы при настройке зеркального отображения.  
  
-   Если требуется, можно оценить время на переключение базы данных, чтобы убедиться в том, что конфигурация системы позволяет достичь нужной производительности. Дополнительные сведения см. в статье [Оценка прерывания обслуживания во время переключения ролей (зеркальное отображение базы данных)](../../database-engine/database-mirroring/estimate-the-interruption-of-service-during-role-switching-database-mirroring.md).  
  
-   Для максимальной производительности используйте для зеркального отображения выделенный сетевой адаптер.  
  
-   Мы не даем никаких рекомендаций по поводу того, достаточно ли надежна глобальная сеть (WAN) для зеркального отображения базы данных в режиме высокой безопасности. Если режим высокой безопасности используется в глобальной сети, добавлять следящий сервер в сеанс следует осторожно, чтобы не произошла ненужная автоматическая отработка отказа. Дополнительные сведения см. в подразделе [Рекомендации по развертыванию зеркального отображения базы данных](#RecommendationsForDeploying)далее в этом разделе.  
  
  
##  <a name="recommendations-for-deploying-database-mirroring"></a><a name="RecommendationsForDeploying"></a> Рекомендации по развертыванию зеркального отображения базы данных  
 Оптимальная производительность зеркального отображения базы данных достигается при помощи асинхронного режима. В сеансе зеркального отображения, который работает в синхронном режиме, наблюдается меньшая производительность, если рабочая нагрузка формирует большое количество данных журнала транзакций.  
  
 В тестовой среде полезно изучить все режимы работы, чтобы оценить, как выполняется зеркальное отображение базы данных. Но прежде чем развертывать зеркальное отображение в рабочей среде, важно понять, как реально функционирует сеть.  
  
 Режим высокого уровня безопасности с автоматической отработкой отказа разработан для сети высокого уровня обслуживания, которая имеет либо выделенное соединение, либо довольно простую конфигурацию, которая сводит к минимуму возможные источники сбоя сети. Такая сетевая среда высокого качества является критически необходимой для режима высокой безопасности с автоматической отработкой отказа и рекомендуется для всех сеансов зеркального отображения базы данных. Высокопроизводительный режим и режим высокого уровня безопасности без автоматической отработки отказа на другой ресурс меньше зависят от надежности сети.  
  
 Поэтому для рабочей среды рекомендуется следовать следующим правилам развертывания.  
  
1.  Начните работу в асинхронном режиме высокой производительности. Этот режим наименее чувствителен к сетевой среде и обеспечивает наилучшую конфигурацию для изучения того, как работает зеркальное отображение. Рекомендуется запускать систему в асинхронном режиме до тех пор, пока вы не убедитесь, что пропускная способность сети поддерживает зеркальное отображение, и не поймете настройки зеркального отображения и работы в асинхронном режиме в вашей среде. Дополнительные сведения см. в статье [Database Mirroring Operating Modes](../../database-engine/database-mirroring/database-mirroring-operating-modes.md).  
  
    > [!IMPORTANT]  
    >  В процессе тестирования рекомендуется следить за сетевыми ошибками в сеансах, которые могут вызвать сбой во время зеркального отображения базы данных. Дополнительные сведения о возможных источниках сбоев см. в разделе [Possible Failures During Database Mirroring](../../database-engine/database-mirroring/possible-failures-during-database-mirroring.md). Дополнительные сведения о зеркальном отображении базы данных см. в разделе [Зеркальное отображение базы данных (SQL Server)](../../database-engine/database-mirroring/monitoring-database-mirroring-sql-server.md).  
  
2.  Если вы уверены, что функционирование в асинхронном режиме удовлетворяет рабочим требованиям, можно опробовать работу в синхронном режиме, чтобы улучшить защиту данных. При тестировании синхронного режима зеркального отображения в среде рекомендуется в первую очередь протестировать режим высокого уровня безопасности без автоматической отработки отказа на другой ресурс. Главная цель тестирования — увидеть, как синхронный режим влияет на производительность базы данных. Дополнительные сведения см. в статье [Database Mirroring Operating Modes](../../database-engine/database-mirroring/database-mirroring-operating-modes.md).  
  
3.  Не торопитесь включать автоматическую отработку отказа до тех пор, пока не убедитесь, что режим высокого уровня безопасности без автоматической отработки отказа удовлетворяет требованиям вашего предприятия и сетевые ошибки не вызывают сбои. Дополнительные сведения см. в статье [Переключение ролей во время сеанса зеркального отображения базы данных (SQL Server)](../../database-engine/database-mirroring/role-switching-during-a-database-mirroring-session-sql-server.md).  
  
  
## <a name="see-also"></a>См. также:  
 [Настройка зеркального отображения базы данных (SQL Server)](../../database-engine/database-mirroring/setting-up-database-mirroring-sql-server.md)   
 [Безопасность транспорта для зеркального отображения баз данных и групп доступности AlwaysOn (SQL Server)](../../database-engine/database-mirroring/transport-security-database-mirroring-always-on-availability.md)   
 [Зеркальное отображение базы данных (SQL Server)](../../database-engine/database-mirroring/database-mirroring-sql-server.md)   
 [Диагностика конфигурации зеркального отображения базы данных (SQL Server)](../../database-engine/database-mirroring/troubleshoot-database-mirroring-configuration-sql-server.md)  
  
