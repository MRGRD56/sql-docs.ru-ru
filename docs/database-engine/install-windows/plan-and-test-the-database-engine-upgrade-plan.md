---
title: Составление и тестирование плана обновления ядра СУБД | Документы Майкрософт
description: В этой статье описываются вопросы планирования, которые нужно принять во внимание перед началом обновления SQL Server, включая контрольный список планирования, а также действия по разработке и тестированию плана обновления.
ms.custom: ''
ms.date: 05/18/2018
ms.prod: sql
ms.technology: install
ms.reviewer: ''
ms.topic: conceptual
ms.assetid: 19c5b725-7400-4881-af8f-fd232ca28234
author: cawrites
ms.author: chadam
monikerRange: '>=sql-server-2016'
ms.openlocfilehash: 7a6311f79aa87d93ee980cf4d0c8d00352b14687
ms.sourcegitcommit: 917df4ffd22e4a229af7dc481dcce3ebba0aa4d7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/10/2021
ms.locfileid: "100353054"
---
# <a name="plan-and-test-the-database-engine-upgrade-plan"></a>Составление и тестирование плана обновления ядра СУБД

[!INCLUDE [SQL Server -Windows Only](../../includes/applies-to-version/sql-windows-only.md)]
  
 Для выполнения успешного обновления [!INCLUDE[ssnoversion](../../includes/ssnoversion-md.md)] , независимо от подхода, необходимо соответствующее планирование.  
  
## <a name="release-notes-and-known-upgrade-issues"></a>Заметки о выпуске и известные проблемы при обновлении  
 Прежде чем приступать к обновлению [!INCLUDE[ssDE](../../includes/ssde-md.md)], ознакомьтесь с разделами:

- [Заметки о выпуске SQL Server 2019](../../sql-server/sql-server-version-15-release-notes.md)
- [Заметки о выпуске SQL Server 2017](../../sql-server/sql-server-2017-release-notes.md) 
- [Заметки о выпуске для SQL Server 2016](../../sql-server/sql-server-2016-release-notes.md)
- Статья [Обратная совместимость ядра СУБД SQL Server](../discontinued-database-engine-functionality-in-sql-server.md).  
  
## <a name="pre-upgrade-planning-checklist"></a>Контрольный список планирования обновления  
 Перед обновлением [!INCLUDE[ssDE](../../includes/ssde-md.md)]просмотрите приведенный ниже контрольный список, а также связанные статьи. Эти статьи относятся ко всем методам обновления и помогут вам подобрать оптимальный: последовательное обновление, обновление путем новой установки или обновление на месте. Например, вы не можете выполнить обновление на месте или последовательное обновление при обновлении операционной системы, SQL Server 2005 или 32-разрядной версии SQL Server. Дерево принятия решений см. в разделе [Choose a Database Engine Upgrade Method](../../database-engine/install-windows/choose-a-database-engine-upgrade-method.md).  
  
-   **Требования к оборудованию и программному обеспечению**. Проверьте требования к оборудованию и программному обеспечению для установки [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Эти требования описываются в следующем разделе: [Требования к оборудованию и программному обеспечению для установки SQL Server](../../sql-server/install/hardware-and-software-requirements-for-installing-sql-server.md). В ходе планирования обновления необходимо рассмотреть обновление оборудования (новое оборудование работает быстрее и может позволить сократить число лицензий, например благодаря меньшему количеству процессоров или консолидации баз данных и серверов) и обновление операционной системы. Такие изменения оборудования и программного обеспечения влияют на выбор метода обновления.  
  
-   **Текущая среда**. Проведите оценку текущей среды, чтобы понять, какие компоненты [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] используются и какие клиенты подключаются к среде.  
  
    -   **Поставщики клиентов**. Хотя обновление платформы не требует непременного обновления поставщиков для каждого из клиентов, вы можете это сделать. При обновлении с [!INCLUDE[sql14](../../includes/sssql14-md.md)] или более ранних версий следующие компоненты [!INCLUDE[sql15](../../includes/sssql16-md.md)] могут потребовать обновить поставщики для всех клиентов или обновить поставщик для обеспечения дополнительных функций:  
  
       -   [Постоянное шифрование (компонент Database Engine)](../../relational-databases/security/encryption/always-encrypted-database-engine.md)  
  
       -   [База данных Stretch](../../sql-server/stretch-database/stretch-database.md)  
  
       -   [Прослушиватели групп доступности, возможность подключения клиентов и отработка отказа приложений (SQL Server)](../../database-engine/availability-groups/windows/listeners-client-connectivity-application-failover.md)  
  
       -   Обновление системы безопасности для TLS  

   >[!NOTE]
   >Предыдущий список также применяется к [!INCLUDE[sscurrent](../../includes/sscurrent-md.md)].
  
-   **Сторонние компоненты**. Проверьте совместимость сторонних компонентов, таких как интегрированное резервное копирование.  
  
-   **Целевая среда**. Целевая среда должна соответствовать требованиям к оборудованию и программному обеспечению, а также поддерживать требования исходной системы. Например, обновление может включать консолидацию нескольких экземпляров SQL Server в один новый экземпляр [!INCLUDE[ssnoversion](../../includes/ssnoversion-md.md)] или виртуализацию среды [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] с преобразованием в частное или общедоступное облако.  
  
-   **Выпуск**. Определите необходимый выпуск [!INCLUDE[ssCurrent](../../includes/ssnoversion-md.md)] и допустимые пути обновления. Дополнительные сведения см. в разделе [Supported Version and Edition Upgrades](../../database-engine/install-windows/supported-version-and-edition-upgrades.md). Если обновление производится с одного выпуска [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] до другого, то сначала проверьте, поддерживаются ли в целевом выпуске все используемые функции.  
  
    > [!NOTE]  
    >  При обновлении до [!INCLUDE[ssCurrent](../../includes/ssnoversion-md.md)] с предыдущей версии выпуска [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise выберите Enterprise Edition: лицензирование по числу ядер и Enterprise Edition. Эти выпуски Enterprise отличаются только режимом лицензирования. Дополнительные сведения см. в разделе [Compute Capacity Limits by Edition of SQL Server](../../sql-server/compute-capacity-limits-by-edition-of-sql-server.md).  
  
-   **Обратная совместимость**. Ознакомьтесь со статьей, посвященной обратной совместимости ядра СУБД [!INCLUDE[ssCurrent](../../includes/ssnoversion-md.md)], в которой описываются изменения в поведении между [!INCLUDE[ssCurrent](../../includes/ssnoversion-md.md)] и версией [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], которую вы обновляете. См. раздел [SQL Server Database Engine Backward Compatibility](../discontinued-database-engine-functionality-in-sql-server.md).  
  
-   **Помощник по миграции данных**. Запустите помощник по миграции данных, который поможет выявить проблемы, препятствующие обновлению, и критические изменения, из-за которых требуется изменить существующие сценарии или приложения.
    Помощник по миграции данных можно скачать [здесь](https://aka.ms/get-dma).  
  
-   **Средство проверки конфигурации**. Запустите средство проверки конфигурации [!INCLUDE[ssCurrent](../../includes/ssnoversion-md.md)], прежде чем запланировать обновление, чтобы определить, не возникнут ли в программе установки SQL Server препятствующие обновлению проблемы. Дополнительные сведения см. в разделе [Check Parameters for the System Configuration Checker](../../database-engine/install-windows/check-parameters-for-the-system-configuration-checker.md).  
  
-   **Обновление таблиц, оптимизированных для памяти**. Если вы обновляете до версии SQL Server 2016 экземпляр базы данных SQL Server 2014, содержащей оптимизированные для памяти таблицы, то процессу потребуется дополнительное время на преобразование таких таблиц в новый формат на диске. Кроме того, пока выполняется эта процедура, база данных будет отключена.   Время, необходимое для этой процедуры, зависит от размера таблиц, оптимизированных для памяти, и быстродействия подсистемы ввода-вывода. Для обновления на месте и обновления путем новой установки требуется трехкратный размер операций с данными (шаг 1 не требуется для последовательного обновления, однако шаги 2 и 3 обязательны):  
  
    1.  Выполните восстановление базы данных с использованием старого формата данных на диске (включая загрузку всех данных из оптимизированных для памяти таблиц в память на диске)  
  
    2.  Выполните сериализацию данных на диск в новом формате на диске.  
  
    3.  Выполните восстановление базы данных с использованием нового формата (включая загрузку всех данных из оптимизированных для памяти таблиц в память на диске)  
  
     Кроме того, нехватка места на диске во время этой процедуры приводит к сбою восстановления. Для обновления на месте или при подключении базы данных SQL Server 2014 к экземпляру SQL Server 2016 убедитесь, что на диске достаточно места для хранения существующей базы данных и есть дополнительное пространство, соответствующее текущему размеру контейнеров в файловой группе MEMORY_OPTIMIZED_DATA базы данных. Чтобы определить, сколько места на диске сейчас требуется для файловой группы MEMORY_OPTIMIZED_DATA и, соответственно, сколько свободного места нужно для обновления, используйте следующий запрос:  
  
    ```  
    select cast(sum(size) as float)*8/1024/1024 'size in GB'   
    from sys.database_files  
    where data_space_id in (select data_space_id from sys.filegroups where type=N'FX')  
    ```  
  
## <a name="develop-and-test-the-upgrade-plan"></a>Разработка и тестирование плана обновления  
 Рекомендуется подходить к обновлению как к любому другому ИТ-проекту. Сформируйте рабочую группу по обновлению, включающую администратора базы данных, специалистов по сетям, извлечению, преобразованию и загрузке (ETL) и другим сферам, затрагиваемым в процессе обновления. Группа должна:  
  
-   **Выбрать метод обновления**: см. раздел [Выбор метода обновления ядра СУБД](../../database-engine/install-windows/choose-a-database-engine-upgrade-method.md).  
  
-   **Разработать план отката**: выполнение этого плана позволит восстановить исходную среду, если потребуется откат.  
  
-   **Определить условия приемки**: необходимо убедиться в успешном завершении обновления перед переносом пользователей в обновленную среду.  
  
-   **Протестировать план обновления**: для тестирования производительности на уровне фактической нагрузки используйте программу распределенного воспроизведения Microsoft SQL Server. Эта программа позволяет использовать несколько компьютеров для воспроизведения данных трассировки и моделирования ответственной рабочей нагрузки. С помощью воспроизведения на тестовом сервере до и после обновления SQL Server можно измерить разницу в производительности и обнаружить любые проблемы совместимости приложений с обновлением. Дополнительные сведения см. в разделах [Распределенное воспроизведение SQL Server](../../tools/distributed-replay/sql-server-distributed-replay.md) и [Параметры командной строки средства администрирования (программа распределенного воспроизведения)](../../tools/distributed-replay/administration-tool-command-line-options-distributed-replay-utility.md).  
  
## <a name="next-steps"></a>Дальнейшие действия  
[Обновление [компонент ядра СУБД]](../../database-engine/install-windows/upgrade-database-engine.md) 
  
## <a name="additional-resources"></a>Дополнительные ресурсы 
[Руководство по переносу баз данных](https://aka.ms/datamigration)