---
title: Настройка группы доступности в SSMS
description: Создание и настройка группы доступности Always On с помощью мастера создания группы доступности в SQL Server Management Studio (SSMS).
ms.custom: seo-lt-2019
ms.date: 05/17/2016
ms.prod: sql
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
f1_keywords:
- sql13.swb.newagwizard.f1
- sql13.swb.newavgroupwiz.f1
helpviewer_keywords:
- New Availability Group Wizard, availability replicas
- Availability Groups [SQL Server], wizards
- Availability Groups [SQL Server], creating
ms.assetid: e1f1dccc-9e65-471d-8fd1-b45085c9484a
author: cawrites
ms.author: chadam
ms.openlocfilehash: 96ef99a120c050f098d6d690055479e5711c11bb
ms.sourcegitcommit: 54cd97a33f417432aa26b948b3fc4b71a5e9162b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/13/2020
ms.locfileid: "94583636"
---
# <a name="use-the-availability-group-wizard-sql-server-management-studio"></a>Использование мастера групп доступности (SQL Server Management Studio)
[!INCLUDE [SQL Server](../../../includes/applies-to-version/sqlserver.md)]
  В этом разделе описывается использование **мастера создания групп доступности** (в среде [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]) для создания и настройки группы доступности AlwaysOn в [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)]. *Группа доступности* определяет набор пользовательских баз данных, которые будут действовать при сбое как единое целое, и набор партнеров по обеспечению отработки отказа, называемых *репликами доступности* и поддерживающих отработку отказа.  
  
> [!NOTE]  
>  Базовые сведения о группах доступности см. в разделе [Обзор групп доступности AlwaysOn (SQL Server)](../../../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md).  
    
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> Перед началом  
 Настоятельно рекомендуется прочитать этот раздел, прежде чем пытаться настроить свою первую группу доступности.  
  
###  <a name="prerequisites-restrictions-and-recommendations"></a><a name="Prerequisites"></a> Предварительные условия, ограничения и рекомендации  

В большинстве случаев можно использовать мастер создания групп доступности для выполнения всех задач по созданию и настройке группы доступности. Однако некоторые задачи может потребоваться выполнить вручную.  
  
- Если вы используете тип кластера WSFC для размещения группы доступности, необходимо, чтобы экземпляры [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], на которых находятся реплики доступности, были расположены на различных серверах кластера (или узлах) одного кластера WSFC. Кроме того, убедитесь, что каждый экземпляр сервера соответствует всем другим обязательным условиям [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]. Для получения дополнительных сведений настоятельно рекомендуется изучить раздел [Предварительные требования, ограничения и рекомендации для групп доступности AlwaysOn (SQL Server)](../../../database-engine/availability-groups/windows/prereqs-restrictions-recommendations-always-on-availability.md).  
  
-   Если экземпляр сервера, который выбран для размещения реплики доступности, запускается из-под учетной записи службы домена и не содержит конечной точки зеркального отображения базы данных, то мастер может создать конечную точку и предоставить учетной записи службы экземпляра сервера разрешение CONNECT. Но если служба [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] запущена от имени встроенной учетной записи, такой как «Локальная система», «Локальная служба» или «Сетевая служба», или от имени учетной записи, не входящей в домен, то для проверки подлинности конечных точек необходимо пользоваться сертификатами, а мастер не сможет создать точку зеркального отображения базы данных на этом экземпляре сервера. В этом случае рекомендуется создать конечные точки зеркального отображения базы данных вручную до запуска мастера создания групп доступности.  
  
     **Использование сертификатов для конечной точки зеркального отображения базы данных**  
  
     [CREATE ENDPOINT (Transact-SQL)](../../../t-sql/statements/create-endpoint-transact-sql.md)  
  
     [Использование сертификатов для конечной точки зеркального отображения базы данных (Transact-SQL)](../../../database-engine/database-mirroring/use-certificates-for-a-database-mirroring-endpoint-transact-sql.md)  
  
-   Экземпляры отказоустойчивого кластера SQL Server не поддерживают автоматический переход на другой ресурс с учетом групп доступности, поэтому любая реплика доступности, размещенная в них, должна быть настроена для перехода на другой ресурс вручную.  
  
-   **Предварительные условия для выполнения мастером полной первоначальной синхронизации данных**  
  
    -   Все пути к файлам базы данных должны быть одинаковыми на всех экземплярах сервера, на которых размещены реплики группы доступности.  
  
    -   На экземпляре сервера, содержащем вторичную реплику, не может существовать имя базы данных-источника. Это означает, что еще не может существовать ни одна из новых баз данных-получателей.  
  
    -   Чтобы при помощи мастера можно было создавать резервные копии и обращаться к ним, необходимо будет указать общую сетевую папку. Для каждой первичной реплики учетная запись, используемая для запуска [!INCLUDE[ssDE](../../../includes/ssde-md.md)] , должна иметь разрешения в файловой системе на чтение и запись в общей сетевой папке. Для вторичных реплик учетная запись должна иметь разрешение на чтение в сетевой папке.  
  
        > [!IMPORTANT]  
        >  Резервные копии журналов будут входить в цепочку резервных копий журналов. Храните файлы резервных копий журналов надлежащим образом.  
  
     Если нет возможности воспользоваться мастером для выполнения полной первоначальной синхронизации данных, то базы данных-получатели нужно подготовить вручную. Это можно сделать до или после запуска мастера. Дополнительные сведения см. в статье [Ручная подготовка базы данных-получателя для присоединения к группе доступности (SQL Server)](../../../database-engine/availability-groups/windows/manually-prepare-a-secondary-database-for-an-availability-group-sql-server.md).  
  
###  <a name="security"></a><a name="Security"></a> безопасность  
  
####  <a name="permissions"></a><a name="Permissions"></a> Permissions  
 Требуется членство в фиксированной роли сервера **sysadmin** и одно из разрешений: CREATE AVAILABILITY GROUP, ALTER ANY AVAILABILITY GROUP или CONTROL SERVER.  
  
 Кроме того, требуется разрешение CONTROL ON ENDPOINT, если мастер группы доступности должен иметь возможность управлять конечной точкой зеркального отображения базы данных.  
  
##  <a name="using-the-new-availability-group-wizard"></a><a name="RunAGwiz"></a> Использование мастера создания группы доступности  
  
1.  В обозревателе объектов подключитесь к экземпляру сервера, на котором размещена первичная реплика доступности.  
  
2.  Разверните узел **Высокий уровень доступности AlwaysOn** и узел **Группы доступности** .  
  
3.  Для запуска мастера создания группы доступности выберите команду **Создать группу доступности** .  
  
4.  При первом запуске этого мастера отображается страница **Введение** . Чтобы в будущем эта страница не отображалась, можно щелкнуть **Больше не показывать эту страницу**. Прочитав эту страницу, нажмите кнопку **Далее**.  
  
5.  На странице **Укажите параметры группы доступности** введите имя новой группы доступности в поле **Имя группы доступности**. Это имя должно быть действительным идентификатором [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], который является уникальным для кластера WSFC и для домена в целом. Максимальная длина имени группы доступности составляет 128 символов.

6. Затем укажите тип кластера. Возможные типы кластера зависят от версии [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] и ОС. Выберите **WSFC**, **EXTERNAL** или **NONE**. Дополнительные сведения см. в разделе [Страница "Указание имени группы доступности"](specify-availability-group-name-page.md).
 
6.  На странице **Выбор баз данных** в сетке приведен список пользовательских баз данных на подключеном экземпляре сервера, которые могут стать *базами данных доступности*. Выберите одну или несколько из указанных баз данных для участия в новой группе доступности. Эти базы данных станут первоначальными *базами данных-источниками*.  
  
     Для каждой из перечисленных баз данных столбец **Размер** отображает размер базы данных, если он известен. Столбец **Состояние** показывает, соответствует ли эта база данных [предварительным условиям](../../../database-engine/availability-groups/windows/prereqs-restrictions-recommendations-always-on-availability.md), необходимым для баз данных доступности. Если необходимые условия не выполняются, краткое описание состояния указывает на причину того, почему эта база данных не может использоваться. Например, если для нее не используется модель полного восстановления. Для получения дополнительны сведений щелкните описание состояния.  
  
     После изменения базы данных для обеспечения соответствия требованиям щелкните **Обновить** , чтобы обновить сетку баз данных.  
  
     Если база данных содержит главный ключ базы данных, введите пароль для него в столбце **Пароль** .  
  
7.  На странице **Выбор реплик** укажите и настройте одну или несколько реплик для новой группы доступности. Страница содержит четыре вкладки. Эти вкладки представлены в следующей таблице. Дополнительные сведения см. в разделе [Укажите страницу реплик (мастер создания группы доступности: мастер добавления реплики)](../../../database-engine/availability-groups/windows/specify-replicas-page-new-availability-group-wizard-add-replica-wizard.md).  
  
    |Вкладка|Краткое описание|  
    |---------|-----------------------|  
    |**Реплики**|На этой вкладке можно задать каждый экземпляр [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , где будет размещена вторичная реплика. Обратите внимание, что первичная реплика должна быть размещена на экземпляре сервера, с которым в данный момент установлено соединение.|  
    |**Конечные точки**|Эту вкладку можно использовать для проверки существующих конечных точек зеркального отображения баз данных, а также для их автоматического создания в случае, если они отсутствуют на экземпляре сервера, служба которого использует проверку подлинности Windows.<br /><br /> Примечание. Если какой-либо экземпляр сервера запускается под учетной записью, которая не является учетной записью пользователя домена, то необходимо вручную перейти на свой экземпляр сервера, прежде чем продолжать работу с мастером. Дополнительные сведения см. в подразделе [Предварительные условия](#Prerequisites)ранее в этом разделе.|  
    |**Параметры резервного копирования**|Эту вкладку можно использовать для задания настроек резервного копирования для группы доступности в целом, а также для задания приоритетов резервного копирования для отдельных реплик доступности.|  
    |**Средство прослушивания**|Эта вкладка используется для создания прослушивателя группы доступности. По умолчанию мастер не создает прослушиватель.|  
  
8.  На странице **Выбор начальной синхронизации данных** выберите, как именно необходимо создать новые базы данных-получатели и присоединить их к группе доступности. Выберите один из следующих параметров.  
  
    -   **Автоматическое заполнение**  
  
         SQL Server автоматически создает вторичные реплики для каждой базы данных в группе. Для работы автоматического заполнения путь к файлу данных и файлу журнала должен быть одинаковым на каждом экземпляре SQL Server, входящем в группу. Доступно в [!INCLUDE[sssql15-md.md](../../../includes/sssql15-md.md)] и более поздних версиях. См. раздел [Автоматическая инициализация группы доступности AlwaysOn](automatically-initialize-always-on-availability-group.md).
    
    -   **Полное резервное копирование базы данных и журнала**  
  
         Выберите этот режим, если ваша среда удовлетворяет требованиям для автоматического запуска начальной синхронизации данных (дополнительные сведения см. в подразделе [Предварительные условия, ограничения и рекомендации](#Prerequisites)ранее в этом разделе).  
  
         При выборе режима **Полная** после создания группы доступности мастер выполнит резервное копирование всех баз данных-источников из журналов транзакций в сетевую папку и восстановит резервные копии на всех экземплярах серверов, на которых размещены вторичные реплики. После этого мастер выполнит присоединение всех баз данных-получателей к группе доступности.  
  
         В поле **Выберите сетевую папку, доступную для всех реплик:** укажите общую папку резервной копии, к которой имеют доступ на чтение и запись все экземпляры серверов, на которых размещаются реплики. Дополнительные сведения см. в подразделе [Предварительные условия](#Prerequisites)ранее в этом разделе.  На этапе проверки мастер выполнит тест, чтобы убедиться в допустимости заданной сетевой папки. В ходе теста на первичной реплике будет создана база данных с именем "BackupLocDb_", за которым следует идентификатор GUID, выполнено резервное копирование в указанную сетевую папку, а затем — восстановление из резервной копии на вторичных репликах. Рекомендуется удалить эту базу данных вместе с ее журналом резервного копирования и файлом резервной копии в случае, если это не удалось сделать мастеру.
  
    -   **Только присоединение**  
  
         Если вы вручную подготовили базы данных-получатели на экземплярах серверов, на которых будут размещены вторичные реплики, то можно указать этот режим. Мастер выполнит присоединение существующих баз данных-получателей к группе доступности.  
  
    -   **Пропустить начальную синхронизацию данных**  
  
         Выберите этот параметр, если вы хотите использовать собственные резервные копии баз данных-источников и их журналов. Дополнительные сведения см. в статье [Запуск перемещения данных для базы данных-получателя AlwaysOn (SQL Server)](../../../database-engine/availability-groups/windows/start-data-movement-on-an-always-on-secondary-database-sql-server.md).  
  
9. На странице **Проверка** выполняется проверка соответствия значений, заданных в этом мастере, требованиям мастера создания группы доступности. Чтобы внести изменения, нажмите кнопку **Назад** , вернитесь к предыдущей странице мастера и измените одно или несколько значений. Нажмите кнопку **Далее** , чтобы вернуться на страницу **Проверка** , а затем кнопку **Повторить проверку**.  
  
10. На странице **Сводка** проверьте параметры, выбранные для новой группы доступности. Чтобы внести изменения, щелкните **Назад** , чтобы вернуться на нужную страницу. После внесения изменений нажмите кнопку **Далее** , чтобы вернуться на страницу **Сводка** .  
  
    > [!IMPORTANT]  
    >  Если учетная запись службы [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] для экземпляра сервера, на котором будет размещаться новая реплика доступности, еще не существует в качестве имени входа, то мастер создания группы доступности должен создать имя входа. На странице **Сводка** мастер показывает сведения об имени входа, которое будет создано. Если нажать кнопку **Готово**, мастер создаст это имя входа для учетной записи SQL Server и предоставит ему разрешение CONNECT.  
  
     Если параметры выбраны правильно, можно нажать кнопку **Скрипт** , чтобы создать скрипт шагов, которые будут выполняться мастером. Теперь нажмите кнопку **Готово**, чтобы создать и настроить новую группу доступности.  
  
11. На странице **Выполнение установки** отображается ход выполнения этапов создания группы доступности (настройка конечных точек, создание группы доступности и присоединение к группе вторичной реплики).  
  
12. После завершения выполнения этих шагов на странице **Результаты** отображаются результаты выполнения каждого шага. Если эти шаги завершатся успешно, новая группа доступности будет полностью настроена. Если один из шагов завершится ошибкой, то может потребоваться завершение настройки вручную или использование мастера для ошибочного шага. Сведения о причинах данной ошибки можно отобразить, перейдя по соответствующей ссылке «Ошибка» в столбце **Результат** .  
  
     По завершении работы мастера нажмите кнопку **Закрыть** , чтобы выйти из него.  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> Связанные задачи  
 **Завершение настройки группы доступности**  
  
-   [Присоединение вторичной реплики к группе доступности (SQL Server)](../../../database-engine/availability-groups/windows/join-a-secondary-replica-to-an-availability-group-sql-server.md)  
  
-   [Подготовка базы данных-получателя для присоединения к группе доступности вручную (SQL Server)](../../../database-engine/availability-groups/windows/manually-prepare-a-secondary-database-for-an-availability-group-sql-server.md)  
  
-   [Присоединение базы данных-получателя к группе доступности (SQL Server)](../../../database-engine/availability-groups/windows/join-a-secondary-database-to-an-availability-group-sql-server.md)  
  
-   [Создание или настройка прослушивателя группы доступности (SQL Server)](../../../database-engine/availability-groups/windows/create-or-configure-an-availability-group-listener-sql-server.md)  
  
 **Другие способы создания группы доступности**  
  
-   [Использование диалогового окна "Создание группы доступности" (среда SQL Server Management Studio)](../../../database-engine/availability-groups/windows/use-the-new-availability-group-dialog-box-sql-server-management-studio.md)  
  
-   [Создание группы доступности (Transact-SQL)](../../../database-engine/availability-groups/windows/create-an-availability-group-transact-sql.md)  
  
-   [Создание группы доступности (SQL Server PowerShell)](../../../database-engine/availability-groups/windows/create-an-availability-group-sql-server-powershell.md)  
  
 **Включение функции "Группы доступности AlwaysOn"**  
  
-   [Включение и отключение групп доступности AlwaysOn (SQL Server)](../../../database-engine/availability-groups/windows/enable-and-disable-always-on-availability-groups-sql-server.md)  
  
 **Настройка конечной точки зеркального отображения базы данных**  
  
-   [Создание конечной точки зеркального отображения базы данных для групп доступности AlwaysOn (SQL Server PowerShell)](../../../database-engine/availability-groups/windows/database-mirroring-always-on-availability-groups-powershell.md)  
  
-   [Создание конечной точки зеркального отображения базы данных с проверкой подлинности Windows (Transact-SQL)](../../../database-engine/database-mirroring/create-a-database-mirroring-endpoint-for-windows-authentication-transact-sql.md)  
  
-   [Использование сертификатов для конечной точки зеркального отображения базы данных (Transact-SQL)](../../../database-engine/database-mirroring/use-certificates-for-a-database-mirroring-endpoint-transact-sql.md)  
  
-   [Укажите URL-адрес конечной точки при добавлении или изменении реплики доступности (SQL Server)](../../../database-engine/availability-groups/windows/specify-endpoint-url-adding-or-modifying-availability-replica.md)  
  
 **Устранение неполадок с конфигурацией групп доступности AlwaysOn**  
  
-   [Поиск и устранение неисправностей конфигурации групп доступности AlwaysOn (SQL Server)](../../../database-engine/availability-groups/windows/troubleshoot-always-on-availability-groups-configuration-sql-server.md)  
  
-   [Устранение неполадок с операцией добавления файла, давшей сбой (группы доступности AlwaysOn)](../../../database-engine/availability-groups/windows/troubleshoot-a-failed-add-file-operation-always-on-availability-groups.md)  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> См. также  
  
-   **Блоги**  
  
     [Обучающая серия AlwaysOn — HADRON: использование рабочего пула для баз данных с поддержкой HADRON](/archive/blogs/psssql/alwayson-hadron-learning-series-worker-pool-usage-for-hadron-enabled-databases)  
  
     [Блоги команды разработчиков SQL Server AlwaysOn: официальный блог по SQL Server AlwaysOn](/archive/blogs/sqlalwayson/)  
  
     [Блоги инженеров CSS SQL Server](/archive/blogs/psssql/)  
  
-   **Видеоролики**  
  
     [Microsoft SQL Server с рабочим названием Denali AlwaysOn, часть 1. Вводные сведения о решении следующего поколения по обеспечению высокого уровня доступности](https://channel9.msdn.com/Events/TechEd/NorthAmerica/2011/DBI302)  
  
     [Microsoft SQL Server с рабочим названием Denali AlwaysOn, часть 2. Создание критически важного решения по обеспечению высокого уровня доступности с использованием AlwaysOn](https://channel9.msdn.com/Events/TechEd/NorthAmerica/2011/DBI404)  
  
-   **Технические документы**  
  
     [Руководство по решениям режима AlwaysOn в Microsoft SQL Server для обеспечения высокой доступности и аварийного восстановления](/previous-versions/sql/sql-server-2012/hh781257(v=msdn.10))  
  
     [Технические документы Майкрософт Microsoft по SQL Server 2012](https://msdn.microsoft.com/library/hh403491.aspx)  
  
     [Технические документы группы консультантов по SQL Server](https://techcommunity.microsoft.com/t5/DataCAT/bg-p/DataCAT/)  
  
## <a name="alternate-ways-to-create-availability-groups"></a>Другие способы создания групп доступности

Вместо мастера создания групп доступности можно использовать [!INCLUDE[tsql](../../../includes/tsql-md.md)] или командлеты [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] PowerShell. Дополнительные сведения см. в разделе [Создание группы доступности (Transact-SQL)](../../../database-engine/availability-groups/windows/create-an-availability-group-transact-sql.md) или командлеты [Создание группы доступности (SQL Server PowerShell)](../../../database-engine/availability-groups/windows/create-an-availability-group-sql-server-powershell.md).  


## <a name="see-also"></a>См. также:  
 [Конечная точка зеркального отображения базы данных (SQL Server)](../../../database-engine/database-mirroring/the-database-mirroring-endpoint-sql-server.md)   
 [Обзор групп доступности AlwaysOn (SQL Server)](../../../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md)   
 [Предварительные требования, ограничения и рекомендации для групп доступности AlwaysOn (SQL Server)](../../../database-engine/availability-groups/windows/prereqs-restrictions-recommendations-always-on-availability.md)  
