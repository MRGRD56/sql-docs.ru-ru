---
title: Переход на другой ресурс группы доступности
description: Описание выполнения планового или принудительного перевода группы доступности Always On вручную на другой ресурс с помощью SQL Server Management Studio, Transact-SQL или SQL PowerShell.
ms.custom: seo-lt-2019
ms.date: 05/17/2016
ms.prod: sql
ms.reviewer: ''
ms.technology: availability-groups
ms.topic: conceptual
f1_keywords:
- sql13.swb.failoverwizard.connecttoreplicas.f1
- sql13.swb.failoverwizard.progress.f1
- sql13.swb.failoverwizard.selectnewprimary.f1
- sql13.swb.failoverwizard.f1
- sql13.swb.failoverwizard.confirmdataloss.f1
helpviewer_keywords:
- failover [SQL Server], failover
- Availability Groups [SQL Server], wizards
- Availability Groups [SQL Server], configuring
ms.assetid: 4a602584-63e4-4322-aafc-5d715b82b834
author: cawrites
ms.author: chadam
ms.openlocfilehash: 9da271a07fbce3e730e1eb5594dc7c1f2114ad24
ms.sourcegitcommit: 370cab80fba17c15fb0bceed9f80cb099017e000
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/17/2020
ms.locfileid: "97641781"
---
# <a name="use-the-fail-over-availability-group-wizard-sql-server-management-studio"></a>Использование мастера отработки отказа группы доступности (Среда SQL Server Management Studio)
[!INCLUDE [SQL Server](../../../includes/applies-to-version/sqlserver.md)]
  В этом разделе описано выполнение планового перехода на другой ресурс вручную или принудительный переход на другой ресурс вручную (принудительная отработка отказа) в группе доступности AlwaysOn с помощью среды [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../../includes/tsql-md.md)]или PowerShell в [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)]. Группа доступности выполняет переход на другой ресурс на уровне реплики доступности. Если переход выполняется на вторичную реплику, находящуюся в состоянии SYNCHRONIZED, мастер выполнит плановый переход на другой ресурс вручную (без потери данных). Если переход выполняется на вторичную реплику, находящуюся в состоянии UNSYNCHRONIZED или NOT SYNCHRONIZING, мастер выполнит принудительный переход на другой ресурс вручную, который также называется *принудительный переход на другой ресурс* (с возможной потерей данных). При использовании обеих этих форм перехода на другой ресурс вручную вторичная реплика, с которой установлено подключение, переводится в роль первичной. В настоящее время при выполнении планового перехода на другой ресурс вручную прежняя первичная реплика принимает роль вторичной. После принудительной отработки отказа, когда прежняя первичная реплика переходит в режим «в сети» она принимает роль вторичной.  

##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> Перед началом  
 Перед первым выполнением запланированного перехода на другой ресурс вручную ознакомьтесь с пунктом "Перед началом" в разделе [Выполнение запланированного перехода на другой ресурс вручную для группы доступности (SQL Server)](../../../database-engine/availability-groups/windows/perform-a-planned-manual-failover-of-an-availability-group-sql-server.md).  
  
 Перед первой принудительной отработкой отказа впервые см. разделы "Перед началом работы" и "Дальнейшие действия. Основные задачи после принудительной отработки отказа" статьи [Выполнение принудительного перехода на другой ресурс вручную для группы доступности &#40;SQL Server&#41;](../../../database-engine/availability-groups/windows/perform-a-forced-manual-failover-of-an-availability-group-sql-server.md).  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> Ограничения  
  
-   Команда отработки отказа завершает работу сразу после того, как целевая вторичная реплика примет команду. Однако восстановление базы данных происходит асинхронно после того, как группа доступности закончит отработку отказа.  
    
###  <a name="prerequisites-for-using-the-failover-availability-group-wizard"></a><a name="Prerequisites"></a> Необходимые условия для использования мастера отработки отказа группой доступности  
  
-   Необходимо иметь подключение к экземпляру сервера, на котором размещена реплика доступности, работающая в настоящий момент.  
  
###  <a name="security"></a><a name="Security"></a> безопасность  
  
####  <a name="permissions"></a><a name="Permissions"></a> Permissions  
 Необходимо разрешение ALTER AVAILABILITY GROUP для группы доступности, разрешение CONTROL AVAILABILITY GROUP, разрешение ALTER ANY AVAILABILITY GROUP или разрешение CONTROL SERVER.  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> Использование среды SQL Server Management Studio  
 **Использование мастера отработки отказа группой доступности**  
  
1.  В обозревателе объектов подключитесь к экземпляру сервера, на котором размещена вторичная реплика группы доступности, на которую нужно выполнить отработку отказа, и разверните дерево сервера.  
  
2.  Разверните узел **Высокий уровень доступности AlwaysOn** и узел **Группы доступности** .  
  
3.  Чтобы запустить мастер отработки отказа группой доступности, щелкните правой кнопкой мыши группу доступности, отработку отказа которой требуется выполнить, и выберите команду **Отработка отказа**.  
  
4.  Сведения, представленные на странице **Введение** зависят от того, является ли вторичная реплика допустимой для запланированной отработки отказа. Если на этой странице указано «**Выполнить запланированной отработки отказа для этой группы доступности**», то группу доступности можно переключить без потери данных.  
  
5.  На странице **Выбор новой первичной реплики** отображается состояние текущей первичной реплики и кворума WSFC перед тем, как выбрать вторичную реплику, которая станет новой первичной репликой ( *цель отработки отказа*). При выполнении запланированного перехода на другой ресурс вручную необходимо выбрать вторичную реплику, значение **Готовность к отработке отказа** которой равно «**Без потери данных**». При выполнении принудительной отработки отказа это значение для всех возможных целей отработки отказа будет "**Потери данных, предупреждения (** _#_ **)** ", где *#* указывает число предупреждений, существующих для данной вторичной реплики. Чтобы просмотреть предупреждения для данной цели отработки отказа, щелкните значение "Готовность к отработке отказа".  
  
     Дополнительные сведения см. в пункте [Страница «Выбор новой первичной реплики»](#SelectNewPrimaryReplica)далее в этом разделе.  
  
6.  На странице **Подключение к реплике** подключитесь к цели отработки отказа. Дополнительные сведения см. в пункте [Страница «Подключение к реплике»](#ConnectToReplica)далее в этом разделе.  
  
7.  Если выполняется принудительная отработка отказа переход, мастер выводит на экран страницу **Подтверждение возможной потери данных** . Чтобы выполнить отработку отказа, необходимо выбрать **Щелкните здесь, чтобы подтвердить отработку отказа с возможной потерей данных**. Дополнительные сведения см. в пункте[Страница «Подтверждение возможной потери данных»](#ConfirmPotentialDataLoss)далее в этом разделе.  
  
8.  На странице **Сводка** ознакомьтесь с последствиями переключения на выбранную вторичную реплику.  
  
     Если параметры выбраны правильно, можно нажать кнопку **Скрипт** , чтобы создать скрипт шагов, которые будут выполняться мастером. Затем, чтобы отработать отказ группы доступности на выбранную вторичную реплику, нажмите кнопку **Готово**.  
  
9. На экране появится страница **Ход выполнения** , на которой будет отображен ход выполнения переключения группы доступности.  
  
10. По завершении операции отработки отказа на странице **Результаты** будет показан ее результат. По завершении работы мастера нажмите кнопку **Закрыть** , чтобы выйти из него.  
  
     Дополнительные сведения см. в статье [Страница "Результаты" (мастера групп доступности AlwaysOn)](../../../database-engine/availability-groups/windows/results-page-always-on-availability-group-wizards.md).  
  
11. После принудительной отработки отказа см. раздел "Дальнейшие действия. После принудительной отработки отказа" статьи [Выполнение принудительного перехода на другой ресурс вручную для группы доступности &#40;SQL Server&#41;](../../../database-engine/availability-groups/windows/perform-a-forced-manual-failover-of-an-availability-group-sql-server.md).  
  
## <a name="help-for-pages-that-are-exclusive-to-this-wizard"></a>Помощь для страниц, которые имеются только в этом мастере  
 В этом разделе описываются страницы, которые являются уникальными для [!INCLUDE[ssAoFoAgWiz](../../../includes/ssaofoagwiz-md.md)].  
  
 **В этом разделе**  
  
-   [Страница "Выбор новой первичной реплики"](#SelectNewPrimaryReplica)  
  
-   [Страница "подключение к реплике"](#ConnectToReplica)  
  
-   [Страниц "Подтверждение возможной потери данных"](#ConfirmPotentialDataLoss)  
  
 Справка по другим страницам этого мастера такая же, как у одного или нескольких других мастеров групп доступности AlwaysOn. Она содержится в отдельных разделах, открывающихся при нажатии справки F1.  
  
###  <a name="select-new-primary-replica-page"></a><a name="SelectNewPrimaryReplica"></a> Select New Primary Replica Page  
 В этом разделе описываются параметры, имеющиеся на странице **Выбрать новой первичной реплики** . Эта страница служит для выбора вторичной реплики (цели отработки отказа), на которую перейдет группа доступности. Это реплика станет новой первичной репликой.  
  
#### <a name="page-options"></a>Параметры страницы  
 **Текущая первичная реплика**  
 Отображает имя текущей первичной реплики, если она находится в режиме «в сети».  
  
 **Состояние первичной реплики**  
 Отображает состояние текущей первичной реплики, если она находится в режиме «в сети».  
  
 **Состояние кворума**  
 Для типа кластера WSFC отображает одно из следующих значений состояния кворума реплики доступности.  
  
   |Значение|Описание|  
   |-----------|-----------------|  
   |**Нормальный кворум**|Кластер запущен с нормальным кворумом.|  
   |**Принудительный кворум**|Кластер запущен с принудительным кворумом.|  
   |**Неизвестный кворум**|Состояние кворума кластера недоступно.|  
   |**Неприменимо**|Узел, на котором размещена реплика доступности, не имеет кворума.|  
  
 Дополнительные сведения см. в статье [Режимы кворума и конфигурация голосования WSFC (SQL Server)](../../../sql-server/failover-clusters/windows/wsfc-quorum-modes-and-voting-configuration-sql-server.md).  

 Для типа кластера NONE состояние кворума не применяется.

 Для типа кластера EXTERNAL состояние кворума управляется с помощью диспетчера кластеров и не отображается для SQL Server.
  
 **Выберите новую первичную реплику**  
 Эта сетка используется для выбора вторичной реплики, которая станет первичной. Сетка содержит следующие столбцы.  
  
 **Экземпляр сервера**  
 Отображает имя экземпляра сервера, на котором размещается вторичная реплика.  
  
 **Режим доступности**  
 Отображает одно из следующих значений режима доступности экземпляра сервера.  
  
|Значение|Описание|  
|-----------|-----------------|  
|**Синхронная фиксация**|В режиме синхронной фиксации, прежде чем фиксировать транзакции, первичная реплика синхронной фиксации ждет, чтобы вторичная реплика синхронной фиксации подтвердила, что запись журнала на диск завершена. В режиме синхронной фиксации после синхронизации базы данных-получателя с базой данных-источником зафиксированные транзакции полностью защищены.|  
|**Асинхронная фиксация**|В режиме асинхронной фиксации первичная реплика фиксирует транзакции, не ожидая подтверждения, что вторичная реплика асинхронной фиксации записала журнал на диск. Режим асинхронной фиксации минимизирует задержку транзакций в базах данных-получателях, но позволяет им не успевать за базами данных-источниками, что создает риск возможной потери данных.|  
  
 Дополнительные сведения см. в разделе [Режимы доступности (группы доступности AlwaysOn)](../../../database-engine/availability-groups/windows/availability-modes-always-on-availability-groups.md).  
  
 **Режим отработки отказа**  
 Отображает одно из следующих значений режима отработки отказа экземпляра сервера.  
  
|Значение|Описание|  
|-----------|-----------------|  
|**Автоматически**|Вторичная реплика, настроенная для автоматического перехода на другой ресурс, также поддерживает запланированный переход на другой ресурс вручную в любое время, когда вторичная реплика синхронизирована с первичной.|  
|**Вручную**|Есть два типа перехода на другой ресурс вручную: запланированный (без потери данных) и принудительный (с возможной потерей данных). Любая данная вторичная реплика доступности поддерживает только один из этих типов, в зависимости от режима доступности, а при использовании режима синхронной фиксации, в зависимости от состояния синхронизации вторичной реплики. Чтобы определить, какой вариант перехода на другой ресурс вручную поддерживается данной вторичной репликой, см. столбец сетки **Готовность к отработке отказа** .|  
  
 Дополнительные сведения см. далее в подразделе [Отработка отказа и режимы отработки отказа (группы доступности AlwaysOn)](../../../database-engine/availability-groups/windows/failover-and-failover-modes-always-on-availability-groups.md).  
  
 **Готовность к отработке отказа**  
 Отображает одно из следующих значений готовности к отработке отказа вторичной реплики.  
  
|Значение|Описание|  
|-----------|-----------------|  
|**Без потери данных**|Эта вторичная реплика в настоящее время поддерживает запланированная отработка отказа. Это значение отображается только, когда вторичная реплика, работающая в режиме синхронной фиксации, в данный момент синхронизирована с первичной репликой.|  
|**Потери данных, предупреждения(** _#_ **)**|Эта вторичная реплика в настоящее время поддерживает принудительную отработку отказа (с возможной потерей данных). Это значение отображается тогда, когда вторичная реплика не синхронизирована с первичной репликой. Чтобы ознакомиться со сведениями о возможной потере данных щелкните ссылку с предупреждениями потере данных.|  
  
 **Обновить**  
 Щелкните, чтобы обновить сетку.  
  
 **Отмена**  
 Щелкните эту кнопку, чтобы отменить запуск мастера. Отмена работы мастера на странице **Выбор новой первичной реплики** приводит к его закрытию без выполнения каких-либо действий.  
  
###  <a name="confirm-potential-data-loss-page"></a><a name="ConfirmPotentialDataLoss"></a> Confirm Potential Data Loss Page  
 В этом разделе описываются параметры, имеющиеся на странице **Подтверждение возможной потери данных** , которая отображается только при выполнении принудительной отработки отказа. Этот раздел относится только к [!INCLUDE[ssAoFoAgWiz](../../../includes/ssaofoagwiz-md.md)]. На этой странице указывается, готовы ли вы пойти на риск возможной потери данных, чтобы принудительно выполнить отработку отказа группы доступности.  
  
#### <a name="confirm-potential-data-loss-options"></a>Параметры на странице «Подтверждение возможной потери данных»  
 Если выбранная вторичная реплика не синхронизирована с первичной репликой, мастер отобразит предупреждение о том, что переход на эту вторичную реплику может привести к потере данных.  
  
 **Щелкните здесь, чтобы подтвердить отработку отказа с возможной потерей данных.**  
 Установите этот флажок, если вы готовы пойти на риск потери данных, чтобы обеспечить доступ пользователей к базам данных из этой группы доступности. Если вы не хотите рисковать потерей данных, нажмите кнопку **Назад** , чтобы вернуться на страницу **Выбор новой первичной реплики** , либо нажмите кнопку **Отмена** , чтобы закрыть мастер без перехода на другую реплику доступности.  
  
 **Отмена**  
 Щелкните эту кнопку, чтобы отменить запуск мастера. Отмена работы мастера на странице **Подтверждение возможной потери данных** приводит к его закрытию без выполнения каких-либо действий.  
  
###  <a name="connect-to-replica-page"></a><a name="ConnectToReplica"></a> Connect to Replica Page  
 В этом разделе описываются параметры, имеющиеся на странице **Подключение к реплике** мастера [!INCLUDE[ssAoFoAgWiz](../../../includes/ssaofoagwiz-md.md)]. Эта страница отображается, только если вы не подключены к целевой вторичной реплике. Эта страница служит для подключения к вторичной реплике, выбранной в качестве новой первичной реплики.  
  
#### <a name="page-options"></a>Параметры страницы  
 **Столбцы сетки**  
 **Экземпляр сервера**  
 Отображает имя экземпляра сервера, на котором будет размещена реплика доступности.  
  
 **Подключение от имени**  
 Показывает учетную запись, подключенную к экземпляру сервера после установления соединения. Если в этом столбце для данного экземпляра сервера отображается **Не подключено**, потребуется нажать кнопку **Подключить** .  
  
 **Подключить**  
 Нажмите, если данный экземпляр сервера работает под учетной записью, отличной от учетной записи экземпляров сервера, к которым нужно подключиться.  
  
 **Отмена**  
 Щелкните эту кнопку, чтобы отменить запуск мастера. Отмена работы мастера на странице **Подключение к реплике** приводит к его закрытию без выполнения каких-либо действий.  
  
## <a name="see-also"></a>См. также:  
 [Обзор групп доступности AlwaysOn (SQL Server)](../../../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md)   
 [Режимы доступности (группы доступности AlwaysOn)](../../../database-engine/availability-groups/windows/availability-modes-always-on-availability-groups.md)   
 [Отработка отказа и режимы отработки отказа (группы доступности AlwaysOn)](../../../database-engine/availability-groups/windows/failover-and-failover-modes-always-on-availability-groups.md)   
 [Выполнение запланированного перехода на другой ресурс вручную для группы доступности (SQL Server)](../../../database-engine/availability-groups/windows/perform-a-planned-manual-failover-of-an-availability-group-sql-server.md)   
 [Выполнение принудительного перехода на другой ресурс вручную для группы доступности (SQL Server)](../../../database-engine/availability-groups/windows/perform-a-forced-manual-failover-of-an-availability-group-sql-server.md)   
 [Аварийное восстановление WSFC через принудительный кворум (SQL Server)](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md)  
  
