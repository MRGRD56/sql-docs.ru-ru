---
title: IBCPSession::BCPColFmt (драйвер OLE DB) | Документация Майкрософт
description: Узнайте, как метод IBCPSession::BCPColFmt создает привязку между переменными программы и столбцами SQL Server в OLE DB Driver for SQL Server.
ms.custom: ''
ms.date: 05/25/2020
ms.prod: sql
ms.prod_service: database-engine, sql-database, sql-data-warehouse, pdw
ms.reviewer: ''
ms.technology: connectivity
ms.topic: reference
apiname:
- IBCPSession::BCPColFmt (OLE DB)
apitype: COM
helpviewer_keywords:
- BCPColFmt method
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: ca716067da3947337d27fea9e3422dc6ce93f8cc
ms.sourcegitcommit: c7f40918dc3ecdb0ed2ef5c237a3996cb4cd268d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/05/2020
ms.locfileid: "91727047"
---
# <a name="ibcpsessionbcpcolfmt-ole-db"></a>IBCPSession::BCPColFmt (OLE DB)
[!INCLUDE [SQL Server](../../../includes/applies-to-version/sql-asdb-asdbmi-asa-pdw.md)]

[!INCLUDE[Driver_OLEDB_Download](../../../includes/driver_oledb_download.md)]

  Создает привязку между переменными программы и столбцами [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .  
  
## <a name="syntax"></a>Синтаксис  
  
```  
  
HRESULT BCPColFmt(   
      DBORDINAL idxUserDataCol,  
      int eUserDataType,  
      int cbIndicator,  
      int cbUserData,  
      BYTE *pbUserDataTerm,  
      int cbUserDataTerm,  
      DBORDINAL idxServerCol);  
```  
  
## <a name="remarks"></a>Remarks  
 Метод **BCPColFmt** используется для создания привязки между полями файла данных BCP и столбцами [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]. В качестве параметров он принимает длину, тип, признак конца и длину префикса столбца, а также задает каждое из этих свойств для отдельных полей.  
  
 Если пользователь работает в интерактивном режиме, этот метод вызывается дважды для каждого столбца: один раз, чтобы задать формат столбца согласно значениям по умолчанию (которые соответствуют типу столбца на сервере), а второй раз, чтобы задать формат согласно типу столбца, выбранному клиентом в интерактивном режиме.  
  
 В неинтерактивном режиме этот метод вызывается только один раз для каждого столбца, чтобы задать ему символьный или собственный тип, а также задать признаки конца столбца и строк.  
  
 При помощи метода **BCPColFmt** можно указывать формат файла пользователя для операций массового копирования. Формат для массового копирования состоит из следующих частей:  
  
-   Сопоставление полей файла пользователя со столбцами базы данных.  
  
-   Тип данных каждого поля в файле пользователя.  
  
-   Длина дополнительного признака для каждого поля.  
  
-   Максимальная длина данных в каждом поле файла пользователя.  
  
-   Дополнительная последовательность байтов, служащая признаком конца для каждого поля <a href="#terminator_note"><sup>**1**</sup></a>.  
  
-   Длина дополнительной последовательности байт, служащей признаком конца <a href="#terminator_note"><sup>**1**</sup></a>.  
  

> [!IMPORTANT]
> <b id="terminator_note">[1].</b> Использование последовательности признака конца в сценариях, в которых в качестве кодовой страницы файла данных выбрано UTF-8, не поддерживается. В таких случаях параметр **pbUserDataTerm** должен быть установлен в значение `nullptr`, а **cbUserDataTerm** — в значение `0`.

 При каждом вызове метода **BCPColFmt** задается формат для одного поля в файле пользователя. Например, чтобы изменить значения по умолчанию трех полей в файле данных пользователя, состоящем из пяти полей, сначала вызовите метод `BCPColumns(5)`, а затем метод **BCPColFmt** пять раз и в трех из этих вызовов задайте нужный формат. При оставшихся двух вызовах для параметра *eUserDataType* установите значение BCP_TYPE_DEFAULT, а параметрам *cbIndicator*, *cbUserData*и *cbUserDataTerm* присвойте значения 0, BCP_VARIABLE_LENGTH и 0 соответственно. Эта процедура копирует все пять столбцов. Для трех применяется заданный измененный формат, а для двух оставшихся — формат по умолчанию.  
  
> [!NOTE]  
>  Необходимо вызывать метод [IBCPSession::BCPColumns](../../oledb/ole-db-interfaces/ibcpsession-bcpcolumns-ole-db.md) перед любым вызовом метода **BCPColFmt**. Метод **BCPColFmt** необходимо вызывать по одному разу для каждого столбца из файла пользователя. При вызове метода **BCPColFmt** более одного раза для любого столбца из файла пользователя возникает ошибка.  
  
 Копировать все данные из файла пользователя в таблицу [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] не обязательно. Чтобы пропустить столбец, укажите формат данных для этого столбца, установив параметр idxServerCol в значение 0. Чтобы поле было пропущено, по-прежнему необходимо добавить все необходимые данные для метода, чтобы он работал правильно.  
  
 **Примечание**. С помощью функции [IBCPSession::BCPWriteFmt](../../oledb/ole-db-interfaces/ibcpsession-bcpwritefmt-ole-db.md) можно сохранить спецификацию формата, предоставленную с помощью метода **BCPColFmt**.  
  
## <a name="arguments"></a>Аргументы  
 *idxUserDataCol*[in]  
 Индекс поля из файла данных пользователя.  
  
 *eUserDataType*[in]  
 Тип данных поля из файла данных пользователя. Допустимые типы данных перечислены в файле заголовка OLE DB Driver for SQL Server (msoledbsql.h) в формате BCP_TYPE_XXX, например: BCP_TYPE_SQLINT4. Если задано значение BCP_TYPE_DEFAULT, поставщик попытается использовать тот же тип, к которому принадлежит столбец таблицы или представления. При массовом копировании из [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] в файл, когда аргументу **eUserDataType** присвоено значение BCP_TYPE_SQLDECIMAL или BCP_TYPE_SQLNUMERIC, выполняются указанные ниже условия.  
  
-   Если тип исходного столбца отличается от decimal и numeric, то используются точность и масштаб по умолчанию.  
  
-   Если исходный столбец имеет тип decimal или numeric, то используются точность и масштаб исходного столбца.  
  
 *cbIndicator*[in]  
 Длина префикса поля. По умолчанию — BCP_PREFIX_DEFAULT. Допустимая длина префикса — 0, 1, 2, 4 или 8. Размер префикса 8 чаще всего используется для указания на то, что поле является фрагментированным. Фрагментация используется для повышения эффективности массового копирования столбцов типов с большими значениями.  
  
 *cbUserData*[in]  
 Максимальная длина в байтах данных этого поля в файле пользователя без учета длины любого признака длины или признака конца.  
  
 Если параметру **cbUserData** присвоено значение BCP_LENGTH_NULL, это указывает, что все значения в полях файла данных равны NULL или должны быть установлены в NULL. Если параметру **cbUserData** присвоено значение BCP_LENGTH_VARIABLE, это указывает, что система должна определить длину данных для каждого поля. Для некоторых полей это может означать, что создаваемые признаки длины и допустимости значений NULL предваряют данные при копировании из [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]или ожидается наличие этих признаков в данных, копируемых в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].  
  
 Для символьных и двоичных типов данных [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] параметр **cbUserData** может иметь значение BCP_LENGTH_VARIABLE, BCP_LENGTH_NULL, 0 или любое положительное значение. Если параметру **cbUserData** присвоено значение BCP_LENGTH_VARIABLE, то для определения длины данных система использует либо признак длины при его наличии, либо последовательность с признаком конца. Если задан и признак длины, и последовательность признака конца, то при массовом копировании используется значение, применение которого вызывает копирование данных наименьшего объема. Если параметру **cbUserData** присвоено значение BCP_LENGTH_VARIABLE, то данные принадлежат к символьному или двоичному типу [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], а если не указаны ни признак длины, ни последовательность с признаком конца, система возвращает сообщение об ошибке.  
  
 Если значение **cbUserData** больше или равно 0, то система рассматривает значение **cbUserData** как максимальную длину данных. Но если в дополнение к положительному значению для **cbUserData**указан признак длины или последовательность признака конца, то система определяет объем данных методом, который приведет к копированию наименьшего объема данных.  
  
 Значение **cbUserData** представляет объем данных в байтах. Если символьные данные представлены строкой знаков в Юникоде, то положительное значение параметра **cbUserData** представляет количество символов, умноженное на размер символа в байтах.  
  
 *pbUserDataTerm*[size_is][in]  
 Последовательность с признаком конца, которая должна использоваться для поля. Этот параметр предназначен главным образом для символьных типов данных, поскольку все другие типы имеют фиксированную длину или, как в случае с двоичными данными, требуют наличия признака длины, в котором записано точное число присутствующих байтов.  
  
 Чтобы исключить обработку признака конца в извлекаемых данных или указать, что данные в файле пользователя не имеют признака конца, установите этот параметр в значение NULL.  
  
 Если для столбца файла пользователя используется несколько способов задания длины (например, признак конца и признак длины или признак конца и максимальная длина столбца), то для массового копирования выбирается способ, применение которого вызывает копирование данных наименьшего объема.  
  
 При необходимости API-интерфейс массового копирования выполнит преобразование символов из Юникода в многобайтовую кодировку (MBCS). Обратите особое внимание, правильно ли задана строка байтов, служащая признаком конца, а также ее длина. Сведения об ограничениях кодировки UTF-8 см. в разделе [Замечания](#remarks) выше.

 *cbUserDataTerm*[in]  
 Длина в байтах последовательности с признаком конца, которая должна использоваться для столбца. Если в данных признак конца отсутствует или нежелателен, то установите это значение в 0. Сведения об ограничениях кодировки UTF-8 см. в разделе [Замечания](#remarks) выше.

 *idxServerCol*[in]  
 Порядковый номер столбца в таблице базы данных. Первый столбец имеет номер 1. Порядковый номер столбца сообщается методом **IColumnsInfo::GetColumnInfo** либо подобными методами. Если это значение равно 0, то при массовом копировании это поле в файле данных будет пропущено.  
  
## <a name="return-code-values"></a>Значения кода возврата  
 S_OK  
 Метод выполнен успешно.  
  
 E_FAIL  
 Произошла ошибка, связанная с поставщиком. Подробные сведения можно получить с помощью интерфейса [ISQLServerErrorInfo](./isqlservererrorinfo-geterrorinfo-ole-db.md?view=sql-server-ver15).  
  
 E_UNEXPECTED  
 Непредвиденный вызов метода. Например, перед вызовом этого метода не был вызван метод [IBCPSession::BCPInit](../../oledb/ole-db-interfaces/ibcpsession-bcpinit-ole-db.md).  
  
 E_INVALIDARG  
 Недопустимое значение аргумента.  
  
 E_OUTOFMEMORY  
 Ошибка, связанная с нехваткой памяти.  
  
## <a name="see-also"></a>См. также:  
 [IBCPSession (OLE DB)](../../oledb/ole-db-interfaces/ibcpsession-ole-db.md)   
 [Выполнение операций массового копирования](../../oledb/features/performing-bulk-copy-operations.md)  
  
