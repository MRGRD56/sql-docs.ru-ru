---
title: Основные сведения о поддержке шифрования
description: Узнайте, как убедиться, что драйвер JDBC использует шифрование TLS для защиты подключений к базе данных SQL.
ms.custom: ''
ms.date: 04/01/2021
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: vanto
ms.technology: connectivity
ms.topic: conceptual
ms.assetid: 073f3b9e-8edd-4815-88ea-de0655d0325e
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: 51d44e7fad3b554c35ec342c0a198c82e9cf3009
ms.sourcegitcommit: 14f2051d329b69a7b5ff7bce1d136cf7f25bb219
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/02/2021
ms.locfileid: "106232041"
---
# <a name="understanding-encryption-support"></a>Основные сведения о поддержке шифрования

[!INCLUDE[Driver_JDBC_Download](../../includes/driver_jdbc_download.md)]

При подключении к [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], если приложение запрашивает шифрование и в экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] настроена поддержка шифрования TLS, то [!INCLUDE[jdbcNoVersion](../../includes/jdbcnoversion_md.md)] инициирует TLS-подтверждение. Подтверждение обеспечивает возможность согласования сервером и клиентом алгоритмов шифрования, используемых для защиты данных. TLS-подтверждение обеспечивает защищенную передачу данных между клиентом и сервером. Во время TLS-подтверждения сервер отправляет свой сертификат открытого ключа клиенту. Поставщик сертификата открытого ключа называется центром сертификации (ЦС). Клиент несет ответственность за проверку надежности используемого центра сертификации.

Если приложение не запрашивает шифрование, [!INCLUDE[jdbcNoVersion](../../includes/jdbcnoversion_md.md)] не будет требовать поддержку TLS-шифрования в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Если в экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] не настроено принудительное TLS-шифрование, подключение устанавливается без шифрования. Если в экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] настроено принудительное TLS-шифрование, драйвер автоматически включит TLS-шифрование при запуске на корректно настроенной виртуальной машине Java (JVM). В противном случае соединение будет прервано, а драйвер выдаст ошибку.

> [!NOTE]
> Для успешного установления TLS-подключения передаваемое в **serverName** значение должно в точности совпадать с общим именем (CN) или DNS-именем в альтернативном имени субъекта (SAN) сертификата сервера.
>
> Дополнительные сведения о настройке TLS для [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] см. в статье [Включение зашифрованных соединений для ядра СУБД](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).

## <a name="remarks"></a>Remarks

Чтобы разрешить приложениям использовать TLS-шифрование, в [!INCLUDE[jdbcNoVersion](../../includes/jdbcnoversion_md.md)] начиная с версии 1.2 добавлены следующие свойства подключений: **encrypt**, **trustServerCertificate**, **trustStore**, **trustStorePassword** и **hostNameInCertificate**. Дополнительные сведения см. в статье о [настройке свойств подключения](setting-the-connection-properties.md).

В следующей таблице приведены режимы работы версии [!INCLUDE[jdbcNoVersion](../../includes/jdbcnoversion_md.md)] в различных сценариях TLS-подключений. Во всех вариантах используются различные наборы свойств TLS-соединений. В таблицу входят:

- **blank**: "Свойство отсутствует в строке подключения".
- **value**: "Свойство существует в строке соединения и имеет допустимое значение".
- **any**: "Существование свойства в строке подключения и наличие у него допустимого значения не играют никакой роли".

> [!NOTE]
> Эти режимы работы также относятся к проверке подлинности пользователей [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и встроенной проверке подлинности Windows.

<!-- Do not remove the extra &nbsp;'s in the column1 heading. They keep column1 from wrapping and improve readability of the table. -->
| Параметры&nbsp;свойств&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | Поведение |
| ----------------- | -------- |
| **encrypt** = false или blank<br/> **trustServerCertificate** = any<br/> **hostNameInCertificate** = any<br/> **trustStore** = any<br/> **trustStorePassword** = any<br/> | Драйвер не будет требовать от сервера поддержки TLS-шифрования. Если на сервере имеется самозаверяющий сертификат, драйвер запускает обмен TLS-сертификатами. TLS-сертификат не будет проверяться, а шифроваться будут только учетные данные (в пакете входа).<br /><br /> Если сервер требует от клиента поддержки TLS-шифрования, драйвер запускает обмен TLS-сертификатами. TLS-сертификат не будет проверяться, но будет выполняться шифрование всего сеанса связи. |
| **encrypt** = true<br/> **trustServerCertificate** = true<br/> **hostNameInCertificate** = any<br/> **trustStore** = any<br/> **trustStorePassword** = any<br/> | Драйвер требует использовать TLS-шифрование для сервера.<br /><br /> Если сервер требует от клиента поддерживать TLS-шифрование или сам поддерживает шифрование, драйвер запускает обмен TLS-сертификатами. Если свойство **trustServerCertificate** имеет значение true, драйвер не будет проверять TLS-сертификат.<br /><br /> Если на сервере не настроена поддержка шифрования, то драйвер создаст ошибку и разорвет соединение. |
| **encrypt** = true<br/> **trustServerCertificate** = false или blank<br/> **hostNameInCertificate** = blank<br/> **trustStore** = blank<br/> **trustStorePassword** = blank<br/> | Драйвер требует использовать TLS-шифрование для сервера.<br /><br /> Если сервер требует от клиента поддерживать TLS-шифрование или сам поддерживает шифрование, драйвер запускает обмен TLS-сертификатами.<br /><br /> Драйвер будет проверять TLS-сертификат с помощью свойства **serverName**, указанного в URL-адресе подключения, а выбор используемого хранилища сертификатов будет зависеть от правил поиска в фабрике менеджера доверия.<br /><br /> Если на сервере не настроена поддержка шифрования, то драйвер создаст ошибку и разорвет соединение. |
| **encrypt** = true<br/> **trustServerCertificate** = false или blank<br/> **hostNameInCertificate** = value<br/> **trustStore** = blank<br/> **trustStorePassword** = blank<br/> | Драйвер требует использовать TLS-шифрование для сервера.<br /><br /> Если сервер требует от клиента поддерживать TLS-шифрование или сам поддерживает шифрование, драйвер запускает обмен TLS-сертификатами.<br /><br /> Драйвер проверяет значение субъекта TLS-сертификата с помощью значения, указанного в свойстве **hostNameInCertificate**.<br /><br /> Если на сервере не настроена поддержка шифрования, то драйвер создаст ошибку и разорвет соединение. |
| **encrypt** = true<br/> **trustServerCertificate** = false или blank<br/> **hostNameInCertificate** = blank<br/> **trustStore** = value<br/> **trustStorePassword** = value<br/> | Драйвер требует использовать TLS-шифрование для сервера.<br /><br /> Если сервер требует от клиента поддерживать TLS-шифрование или сам поддерживает шифрование, драйвер запускает обмен TLS-сертификатами.<br /><br /> Драйвер использует значение свойства **trustStore**, чтобы найти файл trustStore сертификата, и значение свойства **trustStorePassword**, чтобы проверить целостность этого файла.<br /><br /> Если на сервере не настроена поддержка шифрования, то драйвер создаст ошибку и разорвет соединение. |
| **encrypt** = true<br/> **trustServerCertificate** = false или blank<br/> **hostNameInCertificate** = blank<br/> **trustStore** = blank<br/> **trustStorePassword** = value<br/> | Драйвер требует использовать TLS-шифрование для сервера.<br /><br /> Если сервер требует от клиента поддерживать TLS-шифрование или сам поддерживает шифрование, драйвер запускает обмен TLS-сертификатами.<br /><br /> Драйвер использует значение свойства **trustStorePassword** для проверки целостности файла trustStore, выбранного по умолчанию.<br /><br /> Если на сервере не настроена поддержка шифрования, то драйвер создаст ошибку и разорвет соединение. |
| **encrypt** = true<br/> **trustServerCertificate** = false или blank<br/> **hostNameInCertificate** = blank<br/> **trustStore** = value<br/> **trustStorePassword** = blank<br/> | Драйвер требует использовать TLS-шифрование для сервера.<br /><br /> Если сервер требует от клиента поддерживать TLS-шифрование или сам поддерживает шифрование, драйвер запускает обмен TLS-сертификатами.<br /><br /> Драйвер использует значение свойства **trustStore** для поиска файла trustStore.<br /><br /> Если на сервере не настроена поддержка шифрования, то драйвер создаст ошибку и разорвет соединение. |
| **encrypt** = true<br/> **trustServerCertificate** = false или blank<br/> **hostNameInCertificate** = value<br/> **trustStore** = blank<br/> **trustStorePassword** = value<br/> | Драйвер требует использовать TLS-шифрование для сервера.<br /><br /> Если сервер требует от клиента поддерживать TLS-шифрование или сам поддерживает шифрование, драйвер запускает обмен TLS-сертификатами.<br /><br /> Драйвер использует значение свойства **trustStorePassword** для проверки целостности файла trustStore, выбранного по умолчанию. Кроме того, драйвер использует значение свойства **hostNameInCertificate** для проверки TLS-сертификата.<br /><br /> Если на сервере не настроена поддержка шифрования, то драйвер создаст ошибку и разорвет соединение. |
| **encrypt** = true<br/> **trustServerCertificate** = false или blank<br/> **hostNameInCertificate** = value<br/> **trustStore** = value<br/> **trustStorePassword** = blank<br/> | Драйвер требует использовать TLS-шифрование для сервера.<br /><br /> Если сервер требует от клиента поддерживать TLS-шифрование или сам поддерживает шифрование, драйвер запускает обмен TLS-сертификатами.<br /><br /> Драйвер использует значение свойства **trustStore** для поиска файла trustStore. Кроме того, драйвер использует значение свойства **hostNameInCertificate** для проверки TLS-сертификата.<br /><br /> Если на сервере не настроена поддержка шифрования, то драйвер создаст ошибку и разорвет соединение. |
| **encrypt** = true<br/> **trustServerCertificate** = false или blank<br/> **hostNameInCertificate** = value<br/> **trustStore** = value<br/> **trustStorePassword** = value<br/> | Драйвер требует использовать TLS-шифрование для сервера.<br /><br /> Если сервер требует от клиента поддерживать TLS-шифрование или сам поддерживает шифрование, драйвер запускает обмен TLS-сертификатами.<br /><br /> Драйвер использует значение свойства **trustStore**, чтобы найти файл trustStore сертификата, и значение свойства **trustStorePassword**, чтобы проверить целостность этого файла. Кроме того, драйвер использует значение свойства **hostNameInCertificate** для проверки TLS-сертификата.<br /><br /> Если на сервере не настроена поддержка шифрования, то драйвер создаст ошибку и разорвет соединение. |

Если для свойства "encrypt" задано значение **true**, то [!INCLUDE[jdbcNoVersion](../../includes/jdbcnoversion_md.md)] использует настроенный по умолчанию поставщик безопасности JSSE в виртуальной машине Java, чтобы согласовать TLS-шифрование с [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Поставщик безопасности по умолчанию может не поддерживать все функции, необходимые для успешного согласования TLS-шифрования. Например, поставщик безопасности по умолчанию может не поддерживать размер открытого ключа RSA, используемого в TLS-сертификате [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. В этом случае поставщик безопасности по умолчанию может вызвать ошибку, в результате которой драйвер JDBC разорвет соединение. Чтобы устранить эту проблему, выполните одно из следующих действий.

- Настройте [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] с сертификатом сервера, имеющим открытый ключ RSA меньшего размера
- Настройте в виртуальной машине Java другой поставщик безопасности JSSE в файле свойств безопасности \<java-home>/lib/security/java.security.
- Используйте другой JVM

## <a name="validating-server-tls-certificate"></a>Проверка TLS-сертификата сервера

Во время TLS-подтверждения сервер отправляет свой сертификат открытого ключа клиенту. Драйвер JDBC или клиент должны проверить и подтвердить, что сертификат сервера выдан центром сертификации, которому доверяет клиент. Драйвер требует соответствия сертификата сервера следующим условиям:

- Сертификат должен быть выдан доверенным центром сертификации.
- Сертификат должен быть выдан для проверки подлинности серверов.
- Срок действия сертификата не завершился.
- Общее имя (CN) в субъекте или DNS-имя в альтернативном имени субъекта (SAN) сертификата точно соответствует значению **serverName**, указанному в строке подключения, или значению свойства **hostNameInCertificate**, если оно задано.
- DNS-имя может содержать подстановочные знаки. В версиях [!INCLUDE[jdbcNoVersion](../../includes/jdbcnoversion_md.md)] до 7.2 подстановочные знаки не поддерживаются. Это значит, что abc.com не будет соответствовать \*.com, но \*.com будет соответствовать \*.com. В версии 7.2 и выше поддерживается сопоставление с подстановочными знаками стандартного сертификата.

## <a name="see-also"></a>См. также раздел

[Использование шифрования](using-ssl-encryption.md)  
[Защита приложений JDBC Driver](securing-jdbc-driver-applications.md)  
