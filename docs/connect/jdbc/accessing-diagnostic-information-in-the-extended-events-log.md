---
title: Доступ к диагностическим сведениям в журнале расширенных событий
description: Узнайте, как получить доступ к расширенным событиям на сервере, связанным с событиями из Microsoft JDBC Driver for SQL Server.
ms.custom: ''
ms.date: 05/06/2020
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
ms.assetid: a79e9468-2257-4536-91f1-73b008c376c3
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: b42d175fcc9a3cf10563b647756e8619d45b5dd3
ms.sourcegitcommit: 524a0f0cc9533188f4b14d2e78ba1cfe816b3b9a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2021
ms.locfileid: "105633259"
---
# <a name="accessing-diagnostic-information-in-the-extended-events-log"></a>Доступ к диагностическим сведениям в журнале расширенных событий

[!INCLUDE[Driver_JDBC_Download](../../includes/driver_jdbc_download.md)]

В [!INCLUDE[jdbc_40](../../includes/jdbc_40_md.md)] трассировка (функция [Трассировка операций драйвера](tracing-driver-operation.md)) упрощает сопоставление событий клиентов с диагностическими сведениями. Можно отслеживать, к примеру, ошибки подключения из кольцевого буфера подключений сервера, а также сведения о производительности приложения в журнале расширенных событий. Дополнительные сведения о чтении журнала расширенных событий см. в разделе [Расширенные события](../../relational-databases/extended-events/extended-events.md).

## <a name="details"></a>Сведения

При выполнении операций соединения [!INCLUDE[jdbcNoVersion](../../includes/jdbcnoversion_md.md)] передает идентификатор соединения клиента. Если подключение завершилось ошибкой, то в кольцевом буфере подключений можно найти поле **ClientConnectionID** и получить диагностические данные по ошибке подключения. Дополнительные сведения о кольцевом буфере см. в статье об [устранении неполадок с подключением в SQL Server 2008 с помощью кольцевого буфера подключения](/archive/blogs/sql_protocols/connectivity-troubleshooting-in-sql-server-2008-with-the-connectivity-ring-buffer). Идентификаторы подключений клиентов регистрируются в кольцевом буфере только при возникновении ошибки. Если подключение завершилось сбоем до отправки предварительного пакета входа, то идентификатор подключения клиента не формируется.

Идентификатор клиентского соединения — это 16-байтовый идентификатор GUID. Если действие **client_connection_id** добавляется к событиям в сеансе расширенных событий, идентификатор подключения клиента можно найти выходных данных расширенных событий. Если необходима дополнительная диагностика драйвера клиента, можно включить трассировку, повторно выполнить команду подключения и проверить в трассировке значение поля **ClientConnectionID**.

Идентификатор подключения клиента можно получить программными средствами с помощью [интерфейса ISQLServerConnection](reference/isqlserverconnection-interface.md). Идентификатор соединения также содержится во всех связанных с соединением исключениях.

В случае ошибки соединения идентификатор соединения клиента в трассировочной информации встроенной диагностики (BID) сервера и в кольцевом буфере соединений поможет сопоставить клиентские соединения с соединениями на сервере. Дополнительные сведения о трассировке BID на сервере см. в разделе [Трассировка доступа к данным](/previous-versions/sql/sql-server-2008/cc765421(v=sql.100)). Обратите внимание, что в статье о трассировке доступа к данным также содержатся соответствующие сведения, неприменимые к [!INCLUDE[jdbcNoVersion](../../includes/jdbcnoversion_md.md)]. См. статью о [трассировке операций драйвера с использованием [!INCLUDE[jdbcNoVersion](../../includes/jdbcnoversion_md.md)]](tracing-driver-operation.md).

Драйвер JDBC также отсылает идентификатор действия определенного процесса. Если сеанс запущен со включенным параметром TRACK_CAUSAILITY, идентификатор действия регистрируется в сеансах расширенных событий. В случае проблем с производительностью активного соединения получить идентификатор действия можно из трассировки клиента (поле ActivityID), а затем найти этот идентификатор действия в выходных данных расширенных событий.

Идентификатором действия в расширенных событиях является 16-байтовый идентификатор GUID (который отличается от идентификатора GUID соединения клиента), к которому добавляется порядковый номер из четырех байт. Этот порядковый номер представляет порядок запроса в потоке. Значение ActivityId отправляется для пакетных инструкций SQL и запросов RPC. Чтобы включить отправку значения ActivityId на сервер, укажите в файле Logging.Properties следующую пару "ключ-значение":

```java
com.microsoft.sqlserver.jdbc.traceactivity = on
```

Любое значение больше `on` (учитывается регистр) отключает отправку ActivityId.

Дополнительные сведения см. в статье о [трассировке операций драйвера](tracing-driver-operation.md). Этот флаг трассировки используется совместно с соответствующими средствами ведения журнала объектов JDBC для определения того, следует ли выполнять трассировку и отправку значения ActivityId в драйвере JDBC. Помимо обновления файла Logging.Properties включите средство ведения журнала com.microsoft.sqlserver.jdbc на уровне FINER или более высоком уровне. Чтобы отправлять значение ActivityId на сервер в отношении запросов, выполняемых определенным классом, включите средство ведения журнала соответствующего класса на уровне FINER или FINEST. Например, если классом является класс SQLServerStatement, включите средство ведения журнала com.microsoft.sqlserver.jdbc.SQLServerStatement.

В следующем примере код [!INCLUDE[tsql](../../includes/tsql-md.md)] используется для запуска сеанса расширенных событий, который будет сохраняться в кольцевом буфере и регистрировать идентификаторы активности, отправляемые с клиента при выполнении операций RPC и пакетных операций:

```sql
create event session MySession on server
add event connectivity_ring_buffer_recorded,
add event sql_statement_starting (action (client_connection_id)),
add event sql_statement_completed (action (client_connection_id)),
add event rpc_starting (action (client_connection_id)),
add event rpc_completed (action (client_connection_id))
add target ring_buffer with (track_causality=on)
```

## <a name="see-also"></a>См. также раздел

[Диагностика проблем с JDBC Driver](diagnosing-problems-with-the-jdbc-driver.md)
