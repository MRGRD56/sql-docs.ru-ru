---
title: Настройка шифрования на клиенте
description: Сведения о шифровании на стороне клиента и доверии на основе сертификатов для обеспечения безопасности клиентов с помощью драйвера Microsoft JDBC Driver для SQL Server.
ms.custom: ''
ms.date: 03/31/2021
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: vanto
ms.technology: connectivity
ms.topic: conceptual
ms.assetid: ae34cd1f-3569-4759-80c7-7c9b33b3e9eb
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: cc0d713f3e7b2f1cb508d1a6f366d7c1a97617e9
ms.sourcegitcommit: ebe81e2daa544f41c8ababb66a91c218ad0c2a0a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/01/2021
ms.locfileid: "106176965"
---
# <a name="configuring-the-client-for-encryption"></a>Настройка шифрования на клиенте

[!INCLUDE[Driver_JDBC_Download](../../includes/driver_jdbc_download.md)]

[!INCLUDE[jdbcNoVersion](../../includes/jdbcnoversion_md.md)] или клиент должны проверить правильность сервера, а также убедиться, что его сертификат выдан центром сертификации, которому доверяет клиент. Чтобы проверить сертификат сервера, при соединении следует предоставить данные о доверии. Также поставщиком сертификата сервера должен быть центр сертификации, которому клиент доверяет.

В начале этой статьи описано, как передать данные о доверии на клиентском компьютере. Далее описывается, как импортировать сертификат сервера в хранилище доверия клиентского компьютера, если экземпляр сертификата TLS для SQL Server выдан частным центром сертификации.

Сведения о проверке TLS-сертификата сервера см. в [общих сведениях о поддержке шифрования](../../connect/jdbc/understanding-ssl-support.md).

## <a name="configuring-the-client-trust-store"></a>Настройка клиентского хранилища доверия

Для проверки сертификата сервера требуется, чтобы данные о доверии были предоставлены во время подключения либо с помощью явно заданных свойств соединения **trustStore** и **trustStorePassword**, либо с помощью неявно заданного хранилища доверия по умолчанию для базовой виртуальной машины Java. Дополнительные сведения о том, как задавать свойства **trustStore** и **trustStorePassword** в строке подключения, см. в статье [Подключение с шифрованием](connecting-with-ssl-encryption.md).

Если свойство **trustStore** не задано или имеет значение NULL, то [!INCLUDE[jdbcNoVersion](../../includes/jdbcnoversion_md.md)] полагается на поставщик безопасности базовой виртуальной машины Java, то есть расширение защищенных сокетов Java (SunJSSE). Поставщик SunJSSE предоставляет по умолчанию TrustManager, который используется для проверки сертификатов X.509, возвращенных SQL Server, по материалу доверия, предоставленному в хранилище доверия.

TrustManager предпринимает попытки найти предусмотренное по умолчанию свойство trustStore в следующем порядке поиска.

- Если системное свойство "javax.net.ssl.trustStore" определено, то TrustManager пытается найти файл trustStore по умолчанию с помощью имени файла, указанного этим системным свойством.
- Если системное свойство javax.net.ssl.trustStore не было указано и существует файл \<java-home>/lib/security/jssecacerts, то используется этот файл.
- Если файл \<java-home>/lib/security/cacerts существует, то используется именно он.

Дополнительные сведения см. в документации интерфейса SUNX509 TrustManager на веб-сайте Sun Microsystems.

Среда выполнения Java позволяет задавать системные свойства trustStore и trustStorePassword следующим образом.

```java
java -Djavax.net.ssl.trustStore=C:\MyCertificates\storeName
java -Djavax.net.ssl.trustStorePassword=storePassword
```

В этом случае любое приложение, запущенное на данной виртуальной машине JVM, будет использовать данные параметры по умолчанию. Чтобы переопределить параметры по умолчанию в приложении, нужно задать свойства соединения **trustStore** и **trustStorePassword** в строке подключения или в соответствующем методе задания класса [SQLServerDataSource](reference/sqlserverdatasource-class.md).

Кроме того, можно настроить и поддерживать файлы хранилища доверия по умолчанию, например \<java-home>/lib/security/jssecacerts и \<java-home>/lib/security/cacerts. Для этого предназначена программа JAVA «keytool», которая устанавливается вместе со средой выполнения Java (JRE). Дополнительные сведения о программе keytool см. в [документации по keytool на веб-сайте Oracle](https://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html).

### <a name="importing-the-server-certificate-to-trust-store"></a>Импорт сертификата сервера в хранилище доверия

Во время TLS-подтверждения сервер отправляет свой сертификат открытого ключа клиенту. Поставщик сертификата открытого ключа называется центром сертификации (ЦС). Клиент должен убедиться, что центр сертификации является для него доверенным. Для этого следует заранее изучить открытые ключи доверенных центров сертификации. JVM обычно поставляется со стандартным набором доверенных центров сертификации.

Если используемый экземпляр сертификата TLS для SQL Server выдан закрытым центром сертификации, то необходимо добавить этот сертификат центра сертификации к списку доверенных сертификатов в хранилище доверия клиентского компьютера.

Для этого предназначена программа JAVA «keytool», которая устанавливается вместе со средой выполнения Java (JRE). В следующей командной строке показано, как использовать программу «keytool» для импорта сертификата из файла.

```java
keytool -import -v -trustcacerts -alias myServer -file caCert.cer -keystore truststore.ks
```

В этом примере в качестве файла сертификата используется файл «caCert.cer». Этот файл сертификата необходимо получить с сервера. Следующие шаги показывают, как экспортировать сертификат сервера в файл.

1. Нажмите "Пуск", затем "Выполнить" и введите MMC. (MMC — сокращение от Microsoft Management Console, консоль управления Microsoft.)
2. В программе MMC откройте окно «Сертификаты».
3. Разверните элемент «Личный», затем «Сертификаты».
4. Щелкните правой кнопкой мыши сертификат сервера и выберите «Все задачи/Экспорт».
5. Щелкните "Далее", чтобы пропустить диалоговое окно приветствия в мастере экспорта сертификатов.
6. Убедитесь, что выбран вариант `No, do not export the private key`, и щелкните "Далее".
7. Убедитесь, что выбран двоичный файл X.509 в кодировке DER (.CER) или файл X.509 в кодировке Base-64 (.CER), затем щелкните "Далее".
8. Введите имя файла для экспорта.
9. Щелкните "Далее" и "Готово", чтобы экспортировать сертификат.

## <a name="see-also"></a>См. также раздел

[Использование шифрования](using-ssl-encryption.md)  
[Защита приложений JDBC Driver](securing-jdbc-driver-applications.md)  
