---
title: Заполнение набора данных DataSet с помощью DataAdapter
description: Узнайте, как заполнить объект DataSet из DataAdapter в ADO.NET, который предоставляет постоянную согласованную реляционную программную модель, независимую от источника данных.
ms.date: 11/30/2020
dev_langs:
- csharp
ms.assetid: 3fa0ac7d-e266-4954-bfac-3fbe2f913153
ms.prod: sql
ms.prod_service: connectivity
ms.technology: connectivity
ms.topic: conceptual
author: David-Engel
ms.author: v-daenge
ms.reviewer: v-chmalh
ms.openlocfilehash: c632d83b092f5f68ce5bbca32d4315821252603c
ms.sourcegitcommit: c127c0752e84cccd38a7e23ac74c0362a40f952e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/07/2020
ms.locfileid: "96772299"
---
# <a name="populate-a-dataset-from-a-dataadapter"></a>Заполнение набора данных DataSet с помощью DataAdapter

[!INCLUDE[appliesto-netfx-netcore-netst-md](../../includes/appliesto-netfx-netcore-netst-md.md)]

[!INCLUDE[Driver_ADONET_Download](../../includes/driver_adonet_download.md)]

Объект ADO.NET <xref:System.Data.DataSet> является находящимся в оперативной памяти представлением данных, обеспечивающим согласованную реляционную программную модель, независимо от источника данных. Набор данных `DataSet` представляет собой полную совокупность данных, которая включает таблицы, ограничения и связи между таблицами. Набор данных `DataSet` является независимым от источника данных, поэтому `DataSet` может включать данные, локальные по отношению к приложению, а также данные из нескольких источников данных. Управление взаимодействием с существующими источниками данных осуществляется с помощью `DataAdapter`.

Свойство `SelectCommand` объекта `DataAdapter` представляет собой объект `Command` , получающий данные из источника данных. Свойства `InsertCommand`, `UpdateCommand`и `DeleteCommand` , принадлежащие `DataAdapter` , являются объектами `Command` , которые управляют обновлением данных в источнике данных в соответствии с изменениями данных в `DataSet`. Эти свойства более подробно описаны в разделе [Обновление источников данных с помощью объектов DataAdapter](update-data-sources-with-dataadapters.md).

Метод `Fill` объекта `DataAdapter` служит для заполнения набора данных `DataSet` результатами выполнения метода `SelectCommand` объекта `DataAdapter`. Метод`Fill` принимает в качестве аргумента подлежащий заполнению набор данных `DataSet` , а также объект `DataTable` или имя объекта `DataTable` , который должен быть заполнен строками, возвращенными методом `SelectCommand`.

> [!NOTE]
> Использование `DataAdapter` для получения всей таблицы требует времени, особенно при наличии в ней большого числа строк. Это происходит вследствие того, что обращение к базе данных, обнаружение и обработка данных, а также передача данных клиенту занимают длительное время. Передача по запросу всей таблицы клиенту приводит также к блокировке всех строк на сервере. Для повышения производительности можно использовать предложение `WHERE` , что позволяет значительно уменьшить количество строк, возвращаемых клиенту. Можно также уменьшить количество данных, возвращаемых клиенту, с помощью явно заданного списка требуемых столбцов в инструкции `SELECT` . Еще одним хорошим решением проблемы является получение строк в пакетах (например, содержащих несколько сотен строк одновременно), а также получение следующего пакета только после завершения обработки текущего.

Метод `Fill` неявно использует объект `DataReader` для возврата имен и типов столбцов, используемых для создания таблиц в `DataSet`, и данных для заполнения строк таблиц в `DataSet`. Таблицы и столбцы создаются только в том случае, если они еще не существуют. В противном случае метод `Fill` использует существующую схему `DataSet` . Типы столбцов создаются как типы .NET Framework в соответствии с таблицами, приведенными в разделе [Сопоставление типов данных в ADO.NET](data-type-mappings-ado-net.md). Первичные ключи создаются, только если они существуют в источнике данных и свойство `DataAdapter` **.** `MissingSchemaAction` имеет значение `MissingSchemaAction` **.** `AddWithKey`. Если `Fill` обнаруживает, что для таблицы существует первичный ключ, то данные в `DataSet` для строк, в которых значения столбцов первичного ключа совпадают со значениями в строках, возвращенных из источника данных, будут перезаписаны данными из источника данных. Если первичный ключ не найден, то данные добавляются в таблицы `DataSet`. `Fill` использует любые сопоставления, которые могут существовать при заполнении объекта `DataSet` (см. раздел [Сопоставление DataAdapter, DataTable и DataColumn](dataadapter-datatable-datacolumn-mappings.md)).

> [!NOTE]
> Если `SelectCommand` возвращает результаты OUTER JOIN, то `DataAdapter` не задает значение `PrimaryKey` для результирующего объекта `DataTable`. Чтобы обеспечить правильное обнаружение повторяющихся строк, пользователь должен определить первичный ключ, `PrimaryKey` .

В следующем примере кода создается экземпляр <xref:Microsoft.Data.SqlClient.SqlDataAdapter> , в котором используется соединение <xref:Microsoft.Data.SqlClient.SqlConnection> для базы данных `Northwind` Microsoft SQL Server и заполняется <xref:System.Data.DataTable> в наборе данных `DataSet` списком клиентов. Инструкция SQL и аргументы <xref:Microsoft.Data.SqlClient.SqlConnection> , переданные в конструктор <xref:Microsoft.Data.SqlClient.SqlDataAdapter> , используются для создания свойства <xref:Microsoft.Data.SqlClient.SqlDataAdapter.SelectCommand%2A> объекта <xref:Microsoft.Data.SqlClient.SqlDataAdapter>.

## <a name="example"></a>Пример

[!code-csharp[SqlDataAdapter_FillDataSet#1](~/../sqlclient/doc/samples/SqlDataAdapter_FillDataSet.cs#1)]

> [!NOTE]
> Код, показанный в данном примере, не открывает и закрывает `Connection`явным образом. Если соединение еще не открыто, то метод `Fill` неявно открывает `Connection` , которое используется `DataAdapter` . Если операция `Fill` открыла соединение, она также закрывает его при завершении `Fill` . Это позволяет упростить код при использовании отдельной операции, такой как `Fill` или `Update`. Однако при выполнении нескольких операций, требующих открытого соединения, можно повысить производительность приложения путем явного вызова метода `Open` объекта `Connection`, выполнения операций с источником данных и последующего вызова метода `Close` объекта `Connection`. Необходимо сохранять соединения с источником данных лишь на такое короткое время, насколько это возможно, освобождая ресурсы для использования другими клиентскими приложениями.

## <a name="multiple-result-sets"></a>Множество результирующих наборов

Если объект `DataAdapter` обнаруживает несколько результирующих наборов, то создает несколько таблиц в `DataSet`. Таблицы получают добавочное имя по умолчанию Table *N*, для Table0 начинающееся с «Table». Если имя таблицы передается в качестве аргумента методу `Fill` , то таблицы получают по умолчанию имя TableName *N* с последовательно увеличивающимся суффиксом, но начиная с «TableName», а не с TableName0.  
  
## <a name="populating-a-dataset-from-multiple-dataadapters"></a>Заполнение DataSet из нескольких DataAdapter  

 С `DataSet` можно использовать любое количество объектов `DataAdapter`. Каждый объект `DataAdapter` может использоваться для заполнения одного или более объектов `DataTable` и разрешения обновлений в соответствующем источнике данных. Объекты`DataRelation` и `Constraint` могут быть добавлены к `DataSet` локально, что позволяет связывать данные из разнородных источников данных. Например, `DataSet` может содержать данные из базы данных Microsoft SQL Server, из базы данных IBM DB2, доступ к которой предоставляется с помощью OLE DB, и источника данных, предназначенного для получения XML-данных в виде потока. Один или несколько объектов `DataAdapter` могут обрабатывать соединение с каждым источником данных.  
  
### <a name="example"></a>Пример  

 В следующем примере кода заполняется список клиентов из базы данных `Northwind` Microsoft SQL Server и список заказов из базы данных `Northwind` , который хранится в Microsoft Access 2000. Заполненные таблицы связываются с помощью `DataRelation`, и список клиентов отображает заказы данного клиента.

[!code-csharp[SqlDataAdapter_FillDataSet#2](~/../sqlclient/doc/samples/SqlDataAdapter_FillDataSet.cs#2)]

## <a name="sql-server-decimal-type"></a>Тип decimal в SQL Server

По умолчанию `DataSet` сохраняет данные с помощью типов данных .NET. Для большинства приложений благодаря этому появляется удобный способ представления сведений об источнике данных. Однако данное представление может вызвать проблему, если типом данных в источнике данных является применяемый в SQL Server тип decimal или numeric. Тип данных `decimal` платформы .NET позволяет использовать максимум 28 значащих цифр, тогда как тип данных `decimal` в SQL Server позволяет использовать 38 значащих цифр. Если во время операции `SqlDataAdapter``Fill` определяет, что точность поля `decimal` SQL Server больше 28 символов, текущая строка не добавляется в `DataTable`. Вместо этого происходит событие `FillError` , которое позволяет определить, произойдет ли потеря точности, и предпринять соответствующие действия. Дополнительные сведения о событии `FillError` см. в разделе [Обработка событий DataAdapter](handle-dataadapter-events.md). Для получения значения типа `decimal` SQL Server можно также использовать объект <xref:Microsoft.Data.SqlClient.SqlDataReader> и вызывать метод <xref:Microsoft.Data.SqlClient.SqlDataReader.GetSqlDecimal%2A> .

ADO.NET имеет улучшенную поддержку для <xref:System.Data.SqlTypes> в `DataSet`. Дополнительные сведения см. в разделе [SqlTypes and the DataSet](./sql/sqltypes-dataset.md).

## <a name="see-also"></a>См. также

- [Объекты DataAdapter и DataReader](dataadapters-datareaders.md)
- [Сопоставления типов данных в ADO.NET](data-type-mappings-ado-net.md)
- [Режим MARS](./sql/multiple-active-result-sets-mars.md)
- [Microsoft ADO.NET для SQL Server](microsoft-ado-net-sql-server.md)
