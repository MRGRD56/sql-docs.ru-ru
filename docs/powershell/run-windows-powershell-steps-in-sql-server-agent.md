---
title: Использование Windows PowerShell в шагах агента SQL Server
description: Узнайте, как выполнить шаги Windows PowerShell в задании агента SQL Server.
ms.prod: sql
ms.technology: sql-server-powershell
ms.topic: conceptual
author: markingmyname
ms.author: maghan
ms.reviewer: matteot, drskwier
ms.custom: seo-lt-2019
ms.date: 03/16/2017
ms.openlocfilehash: 8029d18dee3dd49342c3c029fc78992900394ed4
ms.sourcegitcommit: 9413ddd8071da8861715c721b923e52669a921d8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2021
ms.locfileid: "101839411"
---
# <a name="run-windows-powershell-steps-in-sql-server-agent"></a>Использование Windows PowerShell в шагах агента SQL Server

[!INCLUDE[appliesto-ss-xxxx-asdw-pdw-md](../includes/appliesto-ss-xxxx-asdw-pdw-md.md)]

Агент SQL Server применяется для запуска скриптов SQL Server PowerShell в запланированное время.

[!INCLUDE[sql-server-powershell-version](../includes/sql-server-powershell-version.md)]

[!INCLUDE[sql-server-powershell-no-sqlps](../includes/sql-server-powershell-no-sqlps.md)]

## <a name="to-run-powershell-from-sql-server-agent"></a>Запуск PowerShell из агента SQL Server

Есть несколько типов шагов заданий агента SQL Server. Каждый тип связан с некоторой подсистемой, в которой реализуется определенная среда, например агент репликации или среда командной строки. Можно создавать скрипты Windows PowerShell, а затем использовать агент SQL Server, чтобы включить скрипты в задания, которые выполняются в запланированное время или в ответ на события агента SQL Server. Скрипты Windows PowerShell можно запускать либо с помощью шагов задания командной строки, либо с помощью шагов задания PowerShell.

- Используйте шаги задания PowerShell для запуска подсистемой агента SQL Server служебной программы **sqlps**, запускающей PowerShell и импортирующей модуль **sqlps**. Если вы используете SQL Server 2019 или более поздней версии, мы рекомендуем использовать модуль **[SqlServer](sql-server-powershell.md#sql-server-agent)** в шаге задания Агента SQL.

- Используйте шаг задания командной строки для запуска PowerShell.exe и укажите скрипт, импортирующий модуль **sqlps** .

### <a name="caution-about-memory-consumption"></a><a name="LimitationsRestrictions"></a> Предупреждение, касающееся потребления памяти

Каждый шаг задания агента SQL Server, запускающий PowerShell с модулем **sqlps**, запускает процесс, которому требуется приблизительно **20 МБ** памяти. Одновременный запуск большого числа шагов задания Windows PowerShell может иметь негативное влияние на производительность.

## <a name="create-a-powershell-job-step"></a><a name="PShellJob"></a> Создание шага задания PowerShell

### <a name="to-create-a-powershell-job-step"></a>Создание шага задания PowerShell

1. Разверните раздел **Агент SQL Server**, создайте задание или щелкните правой кнопкой мыши существующее задание и выберите **Свойства**. Дополнительные сведения о создании заданий см. в разделе [Создание заданий](../ssms/agent/create-jobs.md).

2. В диалоговом окне **Свойства задания** выберите страницу **Шаги** и щелкните **Создать**.

3. В диалоговом окне **Новый шаг задания** введите **имя шага** задания.

4. В раскрывающемся списке **Тип** выберите **PowerShell**.

5. В списке **Выполнять как** выберите учетную запись-посредник с учетными данными, используемыми в задании.

6. В поле **Команда** введите синтаксис скрипта PowerShell, который будет выполняться в данном шаге. Или щелкните **Открыть** и выберите файл, содержащий скрипт.

7. Выберите страницу **Дополнительно**, чтобы задать следующие параметры шага задания: какие действия будут предприняты в случае успешного или неуспешного выполнения шага задания, сколько раз агенту SQL Server пытаться его выполнить и как нужно часто повторять эти попытки.

## <a name="create-a-command-prompt-job-step"></a><a name="CmdExecJob"></a> Создание шага задания командной строки

### <a name="to-create-a-cmdexec-job-step"></a>Создание шага задания CmdExec

1. Разверните раздел **Агент SQL Server**, создайте задание или щелкните правой кнопкой мыши существующее задание и выберите **Свойства**. Дополнительные сведения о создании заданий см. в разделе [Создание заданий](../ssms/agent/create-jobs.md).

2. В диалоговом окне **Свойства задания** выберите страницу **Шаги** и щелкните **Создать**.

3. В диалоговом окне **Новый шаг задания** введите **имя шага** задания.

4. В списке **Тип** выберите **Операционная система (CmdExec)** .

5. В списке **Выполнять как** выберите учетную запись-посредник с учетными данными, используемыми в задании. По умолчанию шаги задания CmdExec выполняются под учетной записью службы агента SQL Server.

6. В поле **Код завершения процесса успешной команды** введите значение от 0 до 999999.

7. В поле **Команда** введите powershell.exe с параметрами, указывающими скрипт PowerShell для запуска.

8. Выберите страницу **Дополнительно**, чтобы задать следующие параметры шага задания: какие действия будут предприняты в случае успешного или неуспешного выполнения шага задания, сколько раз агенту SQL Server пытаться его выполнить и в какой файл агент SQL Server может записывать результат выполнения шага задания. Только члены предопределенной роли сервера **sysadmin** могут записывать выходные данные шага задания в файл операционной системы.

## <a name="see-also"></a>См. также:

- [SQL Server PowerShell](sql-server-powershell.md)
- [Агент SQL Server и PowerShell](sql-server-powershell.md#sql-server-agent)