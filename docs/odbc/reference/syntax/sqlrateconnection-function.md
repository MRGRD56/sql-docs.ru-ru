---
description: Функция SQLRateConnection
title: Функция Склратеконнектион | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: reference
helpviewer_keywords:
- SQLRateConnection function [ODBC]
ms.assetid: e8da2ffb-d6ef-4ca7-824f-57afd29585d8
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: 40aec3459e43d2684bd80f0ced55171314551d92
ms.sourcegitcommit: 33f0f190f962059826e002be165a2bef4f9e350c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/30/2021
ms.locfileid: "99192551"
---
# <a name="sqlrateconnection-function"></a>Функция SQLRateConnection
**Соответствия**  
 Представленная версия: соответствие стандартам ODBC 3,81: ODBC  
  
 **Сводка**  
 **Склратеконнектион** определяет, может ли драйвер повторно использовать существующее подключение в пуле соединений.  
  
## <a name="syntax"></a>Синтаксис  
  
```cpp
  
SQLRETURN  SQLRateConnection(  
                SQLHDBC_INFO_TOKEN   hRequest,  
                SQLHDBC              hCandidateConnection,  
                BOOL                 fRequiredTransactionEnlistment,  
                TRANSID              transId,  
                DWORD *              pRating );  
```  
  
## <a name="arguments"></a>Аргументы  
 *хрекуест*  
 Входной Маркер маркера, представляющий новый запрос на подключение приложения.  
  
 *хкандидатеконнектион*  
 Входной Существующее соединение в пуле соединений. Соединение должно находиться в открытом состоянии.  
  
 *фрекуиредтрансактионенлистмент*  
 Входной Если значение — TRUE, повторное использование существующего *хкандидатеконнектион* соединения для нового запроса на подключение (*хрекуест*) требует дополнительного зачисления.  
  
 *трансид*  
 Входной Если *фрекуиредтрансактионенлистмент* имеет значение true, *ТрансИд* представляет транзакцию DTC, которую будет прикреплять запрос. Если *фрекуиредтрансактионенлистмент* имеет значение false, *ТрансИд* будет игнорироваться.  
  
 *пратинг*  
 Проверки Оценка повторного использования *хкандидатеконнектион* для *хрекуест*. Эта оценка будет находиться в диапазоне от 0 до 100 (включительно).  
  
## <a name="returns"></a>Возвращаемое значение  
 SQL_SUCCESS, SQL_ERROR или SQL_INVALID_HANDLE.  
  
## <a name="diagnostics"></a>Диагностика  
 Диспетчер драйверов не будет обрабатывать диагностические данные, возвращаемые этой функцией.  
  
## <a name="remarks"></a>Замечания  
 **Склратеконнектион** Возвращает оценку от 0 до 100 (включительно), указывая, насколько хорошо существующее соединение соответствует запросу.  
  
|Оценка|Значение (при возвращении SQL_SUCCESS)|  
|-----------|-----------------------------------------------|  
|0|*хкандидатеконнектион* не должен использоваться повторно для *хрекуест*.|  
|Любые значения от 1 до 98 (включительно)|Чем выше оценка, тем ближе, что *хкандидатеконнектион* соответствует *хрекуест*.|  
|99|В незначащих атрибутах обнаружены только несоответствия.  Диспетчер драйверов должен останавливаться на цикле оценки.|  
|100|Идеальное соответствие.  Диспетчер драйверов должен останавливаться на цикле оценки.|  
|Любое другое значение больше 100|*хкандидатеконнектион* помечается как мертвая и не будет повторно использоваться даже в будущем запросе на подключение.|  
  
 Диспетчер драйверов помечает соединение как недействительное, если код возврата отличается от SQL_SUCCESS (в том числе SQL_SUCCESS_WITH_INFO) или оценки больше 100. Это неиспользуемое соединение не будет повторно использоваться (даже в будущих запросах на подключение), и в конечном итоге будет превышено время ожидания после Кптимеаут. Диспетчер драйверов продолжит поиск другого подключения из пула, чтобы оценить его.  
  
 Если диспетчер драйверов повторно использовал подключение, показатель которого строго меньше 100 (включая 99), диспетчер драйверов вызовет SQLSetConnectAttr (SQL_ATTR_DBC_INFO_TOKEN) для сброса подключения к состоянию, запрошенному приложением. Драйвер не должен сбрасывать соединение при вызове этой функции.  
  
 Если *фрекуиредтрансактионенлистмент* имеет значение true, то повторное использование *хкандидатеконнектион* требует дополнительного зачисления (*ТрансИд* ! = null) или открепления (*ТрансИд* = = null). Это указывает на затраты на повторное использование соединения и то, должен ли драйвер прикреплять или отменять подключение к соединению, если он будет использовать подключение заново. Если *фрекуиретрансактионенлистмент* имеет значение false, драйвер должен игнорировать значение *ТрансИд*.  
  
 Диспетчер драйверов гарантирует, что родительский дескриптор ХЕНВ *хрекуест* и *хкандидатеконнектион* одинаков. Диспетчер драйверов гарантирует, что идентификатор пула, связанный с *хрекуест* и *хкандидатеконнектион* , будет одинаковым.  
  
 Приложения не должны вызывать эту функцию напрямую. Драйвер ODBC, поддерживающий пулы соединений с учетом драйверов, должен реализовывать эту функцию.  
  
 Включите склспи. h для разработки драйвера ODBC.  
  
## <a name="see-also"></a>См. также:  
 [Разработка драйвера ODBC](../../../odbc/reference/develop-driver/developing-an-odbc-driver.md)   
 [Организация пулов соединений с учетом драйверов](../../../odbc/reference/develop-app/driver-aware-connection-pooling.md)   
 [Разработка драйвера ODBC с поддержкой пула подключений](../../../odbc/reference/develop-driver/developing-connection-pool-awareness-in-an-odbc-driver.md)
