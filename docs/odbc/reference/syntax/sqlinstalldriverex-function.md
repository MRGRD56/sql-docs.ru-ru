---
description: Функция SQLInstallDriverEx
title: Функция Склинсталлдриверекс | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: reference
apiname:
- SQLInstallDriverEx
apilocation:
- sqlsrv32.dll
apitype: dllExport
f1_keywords:
- SQLInstallDriverEx
helpviewer_keywords:
- SQLInstallDriverEx function [ODBC]
ms.assetid: 1dd74544-f4e9-46e1-9b5f-c11d84fdab4c
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: 3ebdfa732ba9c5a4a539009600749563daff4a35
ms.sourcegitcommit: 33f0f190f962059826e002be165a2bef4f9e350c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/30/2021
ms.locfileid: "99189704"
---
# <a name="sqlinstalldriverex-function"></a>Функция SQLInstallDriverEx
**Соответствия**  
 Введенная версия: ODBC 3,0  
  
 **Сводка**  
 **Склинсталлдриверекс** добавляет сведения о драйвере в запись Odbcinst.ini в сведениях о системе и увеличивает *усажекаунт* драйвера на 1. Однако если версия драйвера уже существует, но значение *усажекаунт* для драйвера не существует, новое значение *усажекаунт* задается равным 2.  
  
 Эта функция фактически не копирует какие бы то ни было файлы. Для правильного копирования файлов драйвера в целевой каталог отвечает вызывающая программа.  
  
 Функциональность **склинсталлдриверекс** также можно получить с помощью [ODBCCONF.EXE](../../../odbc/odbcconf-exe.md).  
  
## <a name="syntax"></a>Синтаксис  
  
```cpp  
  
BOOL SQLInstallDriverEx(  
     LPCSTR    lpszDriver,  
     LPCSTR    lpszPathIn,  
     LPSTR     lpszPathOut,  
     WORD      cbPathOutMax,  
     WORD *    pcbPathOut,  
     WORD      fRequest,  
     LPDWORD   lpdwUsageCount);  
```  
  
## <a name="arguments"></a>Аргументы  
 *лпсздривер*  
 Входной Описание драйвера (обычно имя связанной СУБД), представленное пользователям вместо физического имени драйвера. Аргумент *лпсздривер* должен содержать разделенный символом NULL список пар "ключевое слово-значение", описывающих драйвер. Дополнительные сведения о парах "ключевое слово-значение" см. в разделе [подразделы спецификации драйвера](../../../odbc/reference/install/driver-specification-subkeys.md). Дополнительные сведения о строке с удвоенным значением, завершающимся символом NULL, см. в разделе [функция ConfigDSN](../../../odbc/reference/syntax/configdsn-function.md).  
  
 *лпсзпасин*  
 Входной Полный путь к целевому каталогу установки или пустой указатель. Если *лпсзпасин* является пустым указателем, драйверы будут установлены в системный каталог.  
  
 *лпсзпасаут*  
 Проверки Путь к целевому каталогу, в котором должен быть установлен драйвер. Если драйвер не был установлен ранее, *лпсзпасаут* должен быть таким же, как и *лпсзпасин*. Если драйвер был ранее установлен, *лпсзпасаут* — путь к предыдущей установке.  
  
 *кбпасаутмакс*  
 Входной Длина *лпсзпасаут*.  
  
 *пкбпасаут*  
 Проверки Общее число байтов (за исключением символа завершения null), доступного для возврата в *лпсзпасаут*. Если число возвращаемых байт больше или равно *кбпасаутмакс*, путь вывода в *лпсзпасаут* усекается до *кбпасаутмакс* минус символ завершения null. Аргумент *пкбпасаут* может быть пустым указателем.  
  
 *фрекуест*  
 Входной Тип запроса. Аргумент *фрекуест* должен содержать одно из следующих значений:  
  
 ODBC_INSTALL_INQUIRY: запрос о том, где можно установить драйвер.  
  
 ODBC_INSTALL_COMPLETE: завершите запрос на установку.  
  
 *лпдвусажекаунт*  
 Проверки Число использований драйвера после вызова этой функции.  
  
 Приложения не должны устанавливать счетчик использования. Этот счетчик будет поддерживаться в ODBC.  
  
## <a name="returns"></a>Возвращаемое значение  
 Функция возвращает TRUE, если она успешна, и FALSE в случае сбоя.  
  
## <a name="diagnostics"></a>Диагностика  
 Когда **склинсталлдриверекс** возвращает значение false, связанное значение *\* пферроркоде* может быть получено путем вызова **склинсталлереррор**. В следующей таблице перечислены значения *\* пферроркоде* , которые могут быть возвращены **склинсталлереррор** , и объясняется каждый из них в контексте этой функции.  
  
|*\*пферроркоде*|Ошибка|Описание|  
|---------------------|-----------|-----------------|  
|ODBC_ERROR_GENERAL_ERR|Общая ошибка установщика|Произошла ошибка, для которой не возникала конкретная ошибка установщика.|  
|ODBC_ERROR_INVALID_BUFF_LEN|Недопустимая длина буфера|Аргумент *лпсзпасаут* недостаточно велик для размещения пути вывода. Буфер содержит усеченный путь.<br /><br /> Аргумент *кбпасаутмакс* был равен 0, а *фрекуест* — ODBC_INSTALL_COMPLETE.|  
|ODBC_ERROR_INVALID_REQUEST_TYPE|Недопустимый тип запроса|Аргумент *фрекуест* не является одним из следующих:<br /><br /> ODBC_INSTALL_INQUIRY ODBC_INSTALL_COMPLETE|  
|ODBC_ERROR_INVALID_KEYWORD_VALUE|Недопустимые пары "ключевое слово-значение"|Аргумент *лпсздривер* содержал синтаксическую ошибку.|  
|ODBC_ERROR_INVALID_PATH|Недопустимый путь установки|Аргумент *лпсзпасин* содержит недопустимый путь.|  
|ODBC_ERROR_LOAD_LIBRARY_FAILED|Не удалось загрузить драйвер или библиотеку установки переводчика|Не удалось загрузить библиотеку установки драйверов.|  
|ODBC_ERROR_INVALID_PARAM_SEQUENCE|Недопустимая последовательность параметров|Аргумент *лпсздривер* не содержит список пар "ключевое слово-значение".|  
|ODBC_ERROR_USAGE_UPDATE_FAILED|Не удалось увеличить или уменьшить счетчик использования компонентов|Установщику не удалось увеличить счетчик использования драйвера.|  
  
## <a name="comments"></a>Комментарии  
 Аргумент *лпсздривер* представляет собой список атрибутов в виде пар «ключевое слово-значение». Каждая пара завершается нулевым байтом, а весь список завершается нулевым байтом. (То есть, в конце списка отмечаются два нуль-байта.) Этот список имеет следующий формат:  
  
 _драйвер — DESC_ **\\** **=**_драйвер 0DRIVER-DLL-filename_ **\\** 0 [Программа установки Setup **=** _-DLL-имя_файла_ <b>\\</b> 0]  
  
 [_драйвер-attr-keyword1_ **=** _Значение1_ <b>\\</b> 0] [_драйвер-attr-keyword2_ **=** _Значение2_ <b>\\</b> 0]... <b>\\</b> 0,0  
  
 где \ 0 является нулевым байтом и *Driver-attr-кэйвордн* — любое ключевое слово атрибута Driver. Ключевые слова должны располагаться в указанном порядке. Например, предположим, что драйвер для форматированных текстовых файлов имеет отдельные библиотеки DLL драйвера и программы установки и может использовать файлы с расширениями txt и CSV. Аргумент *лпсздривер* для этого драйвера может выглядеть следующим образом:  
  
```  
Text\0Driver=TEXT.DLL\0Setup=TXTSETUP.DLL\0FileUsage=1\0  
FileExtns=*.txt,*.csv\0\0  
```  
  
 Предположим, что драйвер для SQL Server не имеет отдельной библиотеки DLL установки и не имеет ключевых слов атрибутов драйвера. Аргумент *лпсздривер* для этого драйвера может выглядеть следующим образом:  
  
```  
SQL Server\0Driver=SQLSRVR.DLL\0\0  
```  
  
 После того как **склинсталлдриверекс** извлекает сведения о драйвере из аргумента *лпсздривер* , он добавляет Описание драйвера в раздел [ODBC drivers] записи Odbcinst.ini в разделе "сведения о системе". Затем он создает раздел с описанием драйвера и добавляет полные пути библиотеки DLL драйвера и библиотеки DLL установки. Наконец, он возвращает путь к целевому каталогу установки, но не копирует в него файлы драйвера. Вызывающая программа должна фактически копировать файлы драйверов в целевой каталог.  
  
 **Склинсталлдриверекс** увеличивает счетчик использования компонентов для установленного драйвера на 1. Если версия драйвера уже существует, но счетчик использования компонентов для драйвера не существует, то новое значение счетчика использования компонентов устанавливается равным 2.  
  
 Программа установки приложения несет ответственность за физическое копирование файла драйвера и на поддержание счетчика использования файлов. Если файл драйвера ранее не был установлен, программа установки приложения должна скопировать файл в *лпсзпасин* путь и создать счетчик использования файла. Если файл был ранее установлен, программа установки увеличивает счетчик использования файлов и возвращает путь к предыдущей установке в аргументе *лпсзпасаут* .  
  
> [!NOTE]  
>  Дополнительные сведения о счетчиках использования компонентов и счетчиках использования файлов см. в разделе [Инвентаризация использования](../../../odbc/reference/install/usage-counting.md).  
  
 Если предыдущая версия файла драйвера была ранее установлена приложением, необходимо удалить драйвер, а затем повторно установить его, чтобы счетчик использования компонентов драйвера был допустимым. Сначала необходимо вызвать **склконфигдривер** (с *фрекуест* ODBC_REMOVE_DRIVER), а затем вызвать **склремоведривер** , чтобы уменьшить число использованных компонентов. Чтобы переустановить драйвер, необходимо вызвать **склинсталлдриверекс** , увеличивая число использованных компонентов. Программа установки приложения должна заменить старый файл новым. Количество использованных файлов останется прежним, а любое другое приложение, в котором использовался файл старой версии, теперь будет использовать более новую версию.  
  
> [!NOTE]  
>  Если драйвер был ранее установлен и **склинсталлдриверекс** вызывается для установки драйвера в другом каталоге, функция возвратит значение true, но *лпсзпасаут* будет содержать каталог, в котором уже установлен драйвер. Он не будет включать каталог, указанный в аргументе *лпсздривер* .  
  
 Длина пути в *лпсзпасаут* в **склинсталлдриверекс** позволяет установить двухэтапный процесс установки, поэтому приложение может определить, что должно быть *кбпасаутмакс* , вызвав **склинсталлдриверекс** с *фрекуест* режимом ODBC_INSTALL_INQUIRY. Будет возвращено общее число байтов, доступных в буфере *пкбпасаут* . Затем **склинсталлдриверекс** можно вызвать с *фрекуест* ODBC_INSTALL_COMPLETE, а аргумент *кбпасаутмакс* — со значением в буфере *пкбпасаут* , а также с завершающим символом NULL.  
  
 Если вы решили не использовать двустороннюю модель для **склинсталлдриверекс**, необходимо задать *кбпасаутмакс*, который определяет размер хранилища для пути к целевому каталогу, значение _MAX_PATH, как определено в STDLIB. h, чтобы предотвратить усечение.  
  
 Если *фрекуест* имеет ODBC_INSTALL_COMPLETE, **склинсталлдриверекс** не допускает, чтобы *Лпсзпасаут* было NULL (или *кбпасаутмакс* в значение 0). Если *фрекуест* имеет ODBC_INSTALL_COMPLETE, то возвращается значение false, если число возвращаемых байт больше или равно *кбпасаутмакс*, и результат усечения.  
  
 После того как **склинсталлдриверекс** был вызван и программа установки приложения скопировала файл драйвера (при необходимости), Библиотека DLL установки драйвера должна вызвать **склконфигдривер** , чтобы задать конфигурацию для драйвера.  
  
## <a name="related-functions"></a>Связанные функции  
  
|Сведения о|См.|  
|---------------------------|---------|  
|Установка диспетчера драйверов|[склинсталлдриверманажер](../../../odbc/reference/syntax/sqlinstalldrivermanager-function.md)|
