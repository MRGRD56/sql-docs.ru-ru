---
description: Функция SQLCancel
title: Функция SQLCancel | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: reference
apiname:
- SQLCancel
apilocation:
- sqlsrv32.dll
apitype: dllExport
f1_keywords:
- SQLCancel
helpviewer_keywords:
- SQLCancel function [ODBC]
ms.assetid: ac0b5972-627f-4440-8c5a-0e8da728726d
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: c1d630af340bf676deda8c18f415b85aba15403c
ms.sourcegitcommit: 33f0f190f962059826e002be165a2bef4f9e350c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/30/2021
ms.locfileid: "99185800"
---
# <a name="sqlcancel-function"></a>Функция SQLCancel
**Соответствия**  
 Представленная версия: соответствие стандартам ODBC 1,0: ISO 92  
  
 **Сводка**  
 **SQLCancel** Отменяет обработку инструкции.  
  
 Чтобы отменить обработку соединения или инструкции, используйте [функцию склканцелхандле](../../../odbc/reference/syntax/sqlcancelhandle-function.md).  
  
## <a name="syntax"></a>Синтаксис  
  
```cpp  
  
SQLRETURN SQLCancel(  
     SQLHSTMT     StatementHandle);  
```  
  
## <a name="arguments"></a>Аргументы  
 *статеменсандле*  
 Входной Маркер инструкции.  
  
## <a name="returns"></a>Возвращаемое значение  
 SQL_SUCCESS, SQL_SUCCESS_WITH_INFO, SQL_ERROR или SQL_INVALID_HANDLE.  
  
## <a name="diagnostics"></a>Диагностика  
 Когда **SQLCancel** возвращает SQL_ERROR или SQL_SUCCESS_WITH_INFO, связанное значение SQLSTATE может быть получено путем вызова **SQLGetDiagRec** с *параметром handletype* SQL_HANDLE_STMT и *маркером* *статеменсандле*. В следующей таблице перечислены значения SQLSTATE, обычно возвращаемые функцией **SQLCancel** , и объясняется каждый из них в контексте этой функции. Нотация "(DM)" предшествует описаниям SQLSTATE, возвращаемым диспетчером драйверов. Код возврата, связанный с каждым значением SQLSTATE, имеет SQL_ERROR, если не указано иное.  
  
|SQLSTATE|Ошибка|Описание|  
|--------------|-----------|-----------------|  
|01000|Общее предупреждение|Информационное сообщение для конкретного драйвера. (Функция возвращает SQL_SUCCESS_WITH_INFO.)|  
|HY000|Общая ошибка|Произошла ошибка, для которой нет определенного SQLSTATE и для которого не определен SQLSTATE для конкретной реализации. Сообщение об ошибке, возвращенное функцией [SQLGetDiagRec](../../../odbc/reference/syntax/sqlgetdiagrec-function.md) в буфере *\* MessageText* , описывает ошибку и ее причину.|  
|HY001|Ошибка выделения памяти|Драйверу не удалось выделить память, необходимую для поддержки выполнения или завершения функции.|  
|HY010|Ошибка последовательности функций|(DM) вызвана асинхронно исполняемая функция для маркера соединения, связанного с *статеменсандле*. Эта асинхронная функция все еще выполнялась при вызове функции **SQLCancel** .<br /><br /> Не удалось выполнить операцию отмены (DM), так как выполняется асинхронная операция над маркером соединения, связанным с *статеменсандле*.|  
|HY013|Ошибка управления памятью|Не удалось обработать вызов функции, так как не удалось получить доступ к базовым объектам памяти, возможно, из-за нехватки памяти.|  
|HY018|Сервер отклонил запрос на отмену|Сервер отклонил запрос на отмену.|  
|HY117|Подключение приостановлено из-за неизвестного состояния транзакции. Допускаются только функции отключения и только для чтения.|(DM) Дополнительные сведения о состоянии SUSPENDED см. в разделе [функция SQLEndTran](../../../odbc/reference/syntax/sqlendtran-function.md).|  
|HYT01|Время ожидания подключения истекло|Время ожидания соединения истекло до ответа источника данных на запрос. Время ожидания соединения задается через **SQLSetConnectAttr**, SQL_ATTR_CONNECTION_TIMEOUT.|  
|IM001|Драйвер не поддерживает эту функцию|(DM) драйвер, связанный с *статеменсандле* , не поддерживает функцию.|  
  
## <a name="comments"></a>Комментарии  
 **SQLCancel** может отменить следующие типы обработки в инструкции:  
  
-   Функция, выполняющаяся асинхронно в инструкции.  
  
-   Функция в операторе, для которой требуются данные.  
  
-   Функция, выполняемая в операторе в другом потоке.  
  
 В ODBC 2. *x*, если приложение вызывает **SQLCancel** , когда в инструкции не выполняется обработка, **SQLCancel** действует так же, как **SQLFreeStmt** с параметром SQL_CLOSE; Это поведение определено только для полноты, и приложения должны вызывать **SQLFreeStmt** или **SQLCloseCursor** для закрытия курсоров.  
  
 При вызове **SQLCancel** для отмены функции, выполняемой в асинхронном режиме в инструкции или функции в инструкции, для которой требуются данные, записи диагностики, переданные в отмененной функции, очищаются, и **SQLCancel** отправляет собственные записи диагностики. Однако при вызове **SQLCancel** для отмены функции, выполняющейся в инструкции в другом потоке, она не очищает диагностические записи функции, которая была отменена, и не выполняет запись собственных диагностических записей.  
  
## <a name="canceling-asynchronous-processing"></a>Отмена асинхронной обработки  
 После того как приложение вызывает функцию асинхронно, оно вызывает функцию повторно, чтобы определить, завершена ли обработка. Если функция все еще обрабатывается, она возвращает SQL_STILL_EXECUTING. Если функция завершила обработку, она возвращает другой код.  
  
 После любого вызова функции, возвращающей SQL_STILL_EXECUTING, приложение может вызвать **SQLCancel** для отмены функции. Если запрос на отмену выполнен успешно, драйвер возвращает SQL_SUCCESS. Это сообщение не указывает на фактическую отмену функции. Указывает, что запрос отмены обработан. Если или если функция фактически отменена, зависит от драйвера и от источника данных. Приложение должно продолжать вызывать исходную функцию, пока не будет SQL_STILL_EXECUTING код возврата. Если функция была успешно отменена, код возврата будет SQL_ERROR и SQLSTATE HY008 (операция отменена). Если функция завершила нормальную обработку, код возврата SQL_SUCCESS или SQL_SUCCESS_WITH_INFO, если функция была успешно выполнена, или SQL_ERROR, а также значение SQLSTATE, отличное от HY008 (операция отменена), если функция завершилась ошибкой.  
  
> [!NOTE]  
>  В ODBC 3,5 вызов **SQLCancel** , если не выполняется обработка в инструкции, не рассматривается как **SQLFreeStmt** с параметром SQL_CLOSE, но не оказывает никакого воздействия. Чтобы закрыть курсор, приложение должно вызвать **SQLCloseCursor**, а не **SQLCancel**.  
  
 Дополнительные сведения об асинхронной обработке см. в разделе [асинхронное выполнение](../../../odbc/reference/develop-app/asynchronous-execution-polling-method.md).  
  
## <a name="canceling-functions-that-need-data"></a>Отмена функций, которым требуются данные  
 После того как **SQLExecute** или **SQLExecDirect** возвращает SQL_NEED_DATA и перед отправкой данных для всех параметров, выполняемых во время выполнения, приложение может вызвать **SQLCancel** для отмены выполнения инструкции. После отмены инструкции приложение может снова вызвать **SQLExecute** или **SQLExecDirect** . Дополнительные сведения см. в разделе [SQLBindParameter](../../../odbc/reference/syntax/sqlbindparameter-function.md).  
  
 После того как **SQLBulkOperations** или **SQLSetPos** возвращает SQL_NEED_DATA и перед отправкой данных для всех столбцов данных в ходе выполнения, приложение может вызвать **SQLCancel** для отмены операции. После отмены операции приложение может снова вызвать **SQLBulkOperations** или **SQLSetPos** ; Отмена не влияет на состояние курсора или текущую позицию курсора. Дополнительные сведения см. в разделе [SQLBulkOperations](../../../odbc/reference/syntax/sqlbulkoperations-function.md) или [SQLSetPos](../../../odbc/reference/syntax/sqlsetpos-function.md).  
  
## <a name="canceling-functions-executing-on-another-thread"></a>Отмена функций, выполняемых в другом потоке  
 В многопоточном приложении Приложение может отменить функцию, которая выполняется в другом потоке. Чтобы отменить функцию, приложение вызывает **SQLCancel** с тем же маркером инструкции, который использовался целевой функцией, но в другом потоке. Процедура отмены функции зависит от драйвера и операционной системы. Как и в случае отмены функции, выполняемой асинхронно, код возврата **SQLCancel** указывает только на то, что драйвер успешно обработал запрос. Могут возвращаться только SQL_SUCCESS и SQL_ERROR; диагностическая информация не возвращается. Если исходная функция отменяется, она возвращает SQL_ERROR и SQLSTATE HY008 (операция отменена).  
  
 Если инструкция SQL выполняется при вызове **SQLCancel** в другом потоке для отмены выполнения инструкции, выполнение может быть успешным и возвращать SQL_SUCCESS в то время как отмена также завершается успешно. В этом случае диспетчер драйверов предполагает, что курсор, Открытый выполнением инструкции, закрывается отменой, поэтому приложение не сможет использовать курсор.  
  
 Дополнительные сведения о потоках [см. в разделе Многопоточность](../../../odbc/reference/develop-app/multithreading.md).  
  
## <a name="related-functions"></a>Связанные функции  
  
|Сведения о|См.|  
|---------------------------|---------|  
|Привязка буфера к параметру|[Функция SQLBindParameter](../../../odbc/reference/syntax/sqlbindparameter-function.md)|  
|Выполнение операций с массовыми вставками или обновлениями|[Функция SQLBulkOperations](../../../odbc/reference/syntax/sqlbulkoperations-function.md)|  
|Отменяет функцию, выполняющуюся асинхронно, в обработчике соединения в дополнение к функциональным возможностям **SQLCancel**.|[Функция SQLCancelHandle](../../../odbc/reference/syntax/sqlcancelhandle-function.md)|  
|Исполнение инструкции SQL|[Функция SQLExecDirect](../../../odbc/reference/syntax/sqlexecdirect-function.md)|  
|Исполнение подготовленной инструкции SQL|[Функция SQLExecute](../../../odbc/reference/syntax/sqlexecute-function.md)|  
|Освобождение маркера инструкции|[Функция SQLFreeStmt](../../../odbc/reference/syntax/sqlfreestmt-function.md)|  
|Получение поля диагностической записи или поля заголовка диагностики|[Функция SQLGetDiagField](../../../odbc/reference/syntax/sqlgetdiagfield-function.md)|  
|Получение нескольких полей структуры диагностических данных|[Функция SQLGetDiagRec](../../../odbc/reference/syntax/sqlgetdiagrec-function.md)|  
|Возврат следующего параметра для отправки данных|[Функция SQLParamData](../../../odbc/reference/syntax/sqlparamdata-function.md)|  
|Отправка данных параметров во время выполнения|[SQLPutData, функция](../../../odbc/reference/syntax/sqlputdata-function.md)|  
|Размещение курсора в наборе строк, обновление данных в наборе строк, обновление или удаление данных в результирующем наборе|[Функция SQLSetPos](../../../odbc/reference/syntax/sqlsetpos-function.md)|  
  
## <a name="see-also"></a>См. также:  
 [Справочник по API ODBC](../../../odbc/reference/syntax/odbc-api-reference.md)   
 [Файлы заголовков ODBC](../../../odbc/reference/install/odbc-header-files.md)
