---
title: Архитектура расширяемости в расширениях языка SQL Server
titleSuffix: ''
description: Сведения об архитектуре расширяемости, используемой для расширений языка SQL Server и позволяющей выполнять внешний код в SQL Server. В SQL Server 2019 поддерживаются Java, R и Python. Код выполняется в языковой среде как расширение основного ядра СУБД.
author: dphansen
ms.author: davidph
ms.date: 11/05/2019
ms.topic: conceptual
ms.prod: sql
ms.technology: language-extensions
monikerRange: '>=sql-server-ver15||>=sql-server-linux-ver15'
ms.openlocfilehash: 344e5f35e35202b6a44a4932db8a27424fdb8753
ms.sourcegitcommit: 1a544cf4dd2720b124c3697d1e62ae7741db757c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/14/2020
ms.locfileid: "97471805"
---
# <a name="extensibility-architecture-in-sql-server-language-extensions"></a>Архитектура расширяемости в расширениях языка SQL Server

[!INCLUDE [SQL Server 2019 and later](../../includes/applies-to-version/sqlserver2019.md)]

Сведения об архитектуре расширяемости, используемой для расширений языка SQL Server и позволяющей выполнять внешний код в SQL Server. В SQL Server 2019 поддерживаются Java, R и Python. Код выполняется в языковой среде как расширение основного ядра СУБД.

## <a name="background"></a>Историческая справка

Целью платформы расширяемости является предоставление интерфейса между SQL Server и внешними языками. Выполняя доверенный язык на безопасной платформе, управляемой SQL Server, администраторы баз данных могут поддерживать безопасность, обеспечивая анализаторам данных доступ к корпоративным данным.

<!-- We need to get a diagram like the one below.
The following diagram visually describes opportunities and benefits of the extensible architecture.

  ![Goals of integration with SQL Server](../media/ml-service-value-add.png "Machine Learning Services Value Add")
-->

Любой поддерживаемый внешний язык может быть запущен путем вызова хранимой процедуры, после чего табличные результаты возвращаются непосредственно в SQL Server. Это упрощает использование внешнего языка из любого приложения, которое может отправлять SQL-запрос и обрабатывать результаты.

## <a name="architecture-diagrams"></a>Схемы архитектуры

Архитектура разработана таким образом, что внешний код выполнялся в отдельном от SQL Server процессе, но с компонентами, которые внутренне управляют цепочкой запросов на данные и операции в SQL Server. 
  
  ***Архитектура компонентов в Windows:** _

  ![Архитектура компонентов в Windows](../media/generic-architecture-windows.png "Архитектура компонентов в Windows")
  
  _*_Архитектура компонентов в Linux:_*_
  
  ![Архитектура компонентов в Linux](../media/generic-architecture-linux.png "Архитектура компонентов в WindowsLinux")
  
Компоненты включают службу _ *панели запуска**, которая используется для вызова внешних сред выполнения (например, Java) и логики, зависящей от библиотеки, для загрузки интерпретаторов и библиотек.

<a name="launchpad"></a>

## <a name="launchpad"></a>Панель запуска

[!INCLUDE[rsql_launchpad_md](../../includes/rsql-launchpad-md.md)] — это служба, которая управляет временем жизни, ресурсами и границами безопасности внешнего процесса, отвечающего за выполнение скрипта. Это похоже на то, как служба полнотекстового индексирования и обработки запросов запускает отдельный узел для обработки полнотекстовых запросов. Служба панели запуска может запускать только доверенные средства запуска, опубликованные или сертифицированные корпорацией Майкрософт как соответствующие требованиям к управлению ресурсами и производительностью.

Служба [!INCLUDE[rsql_launchpad_md](../../includes/rsql-launchpad-md.md)] работает в **SQLRUserGroup**, которая использует [AppContainers](/windows/desktop/secauthz/appcontainer-isolation) для изоляции выполнения.

Для каждого экземпляра ядра СУБД, к которому были добавлены службы машинного обучения SQL Server, создается отдельная служба [!INCLUDE[rsql_launchpad_md](../../includes/rsql-launchpad-md.md)]. Для каждого экземпляра ядра СУБД существует одна служба панели запуска, поэтому при наличии нескольких экземпляров с поддержкой внешних сценариев для каждой из них будет установлена служба панели запуска. Экземпляр ядра СУБД привязан к созданной для нее службе панели запуска. Все вызовы внешнего скрипта в хранимой процедуре или T-SQL приводят к тому, что служба SQL Server вызывает службу панели запуска, созданную для того же экземпляра.

Для выполнения задач на определенном поддерживаемом языке панель запуска получает защищенную рабочую учетную запись из пула и запускает вспомогательный процесс для управления внешней средой выполнения. Каждый вспомогательный процесс наследует учетную запись пользователя панели запуска и использует эту учетную запись в течение времени выполнения сценария. Если в сценарии используются параллельные процессы, они создаются под одной рабочей учетной записью.

## <a name="communication-channels-between-components"></a>Каналы связи между компонентами

В этом разделе описаны протоколы связи между компонентами и платформами данных.

+ **TCP/IP**

  По умолчанию для внутренней связи между SQL Server и вспомогательным соединением SQL используется протокол TCP/IP.

+ **ODBC**

  Взаимодействие между внешними клиентами обработки и анализа данных и удаленным экземпляром SQL Server происходит с помощью ODBC. Учетная запись, отправляющая задания в рамках сценариев в SQL Server, должна иметь разрешения и для подключения к экземпляру, и для выполнения внешних скриптов.

  Кроме того, в зависимости от задачи учетной записи могут потребоваться следующие разрешения:

  + Чтение данных, используемых заданием
  + Запись данных в таблицы. Например, при сохранении результатов в таблицу.
  + Создание объектов базы данных. Например, при сохранении внешнего сценария как части новой хранимой процедуры.

  Когда SQL Server используется как контекст вычислений для выполняемого сценария, отправленного с удаленного клиента, а исполняемый сценарий должен получать данные из внешнего источника, для обратной записи используется ODBC. SQL Server сопоставляет идентификатор пользователя, вызывающего удаленную команду, с идентификатором пользователя в текущем экземпляре и выполняет команду ODBC, используя учетные данные этого пользователя. Строка подключения, необходимая для выполнения этого вызова ODBC, получается из клиентского кода.

+ **Другие протоколы**

  Процессы, которые могут потребоваться для работы в блоках или передачи данных обратно удаленному клиенту, также могут использовать формат файла [Xdf-File](/machine-learning-server/r/concept-what-is-xdf). Фактический перенос данных осуществляется через закодированные BLOB-объекты.

## <a name="next-steps"></a>Дальнейшие действия

+ [Общие сведения о расширении языка](../language-extensions-overview.md)