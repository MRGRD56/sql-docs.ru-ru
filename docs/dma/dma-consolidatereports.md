---
title: Оценка уровня предприятия и консолидация отчетов по оценке с помощью Помощник по миграции данных
description: Узнайте, как использовать DMA для оценки предприятия и консолидации отчетов об оценке перед обновлением SQL Server или миграции в базу данных SQL Azure.
ms.date: 06/21/2019
ms.prod: sql
ms.prod_service: dma
ms.reviewer: ''
ms.technology: dma
ms.topic: conceptual
keywords: ''
helpviewer_keywords:
- Data Migration Assistant, Assess
ms.assetid: ''
author: rajeshsetlem
ms.author: rajpo
ms.custom: seo-lt-2019
ms.openlocfilehash: 4d1bcf2cdc9997ea33be87184c38447b7cd62973
ms.sourcegitcommit: a9e982e30e458866fcd64374e3458516182d604c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/11/2021
ms.locfileid: "98091610"
---
# <a name="assess-an-enterprise-and-consolidate-assessment-reports-with-dma"></a>Оценка предприятия и объединение оценки с помощью DMA

Следующие пошаговые инструкции помогут вам использовать Помощник по миграции данных для успешной масштабируемой оценки обновления локальной SQL Server или SQL Server, выполняющихся на виртуальных машинах Azure, или для миграции в базу данных SQL Azure.

## <a name="prerequisites"></a>Предварительные условия

- Укажите компьютер средств в сети, с которого будет инициирован канал DMA. Убедитесь, что этот компьютер подключен к SQL Serverным целям.
- Скачайте и установите следующие компоненты:
  - [Помощник по миграции данных](https://www.microsoft.com/download/details.aspx?id=53595) версии 3.6 или выше.
  - [PowerShell](https://aka.ms/wmf5download) версии 5.0 или более поздней.
  - [.NET Framework](https://www.microsoft.com/download/details.aspx?id=30653) версии 4.5 или выше.
  - [SSMS](../ssms/download-sql-server-management-studio-ssms.md) 17,0 или более поздней версии.
  - [Power BI Desktop](/power-bi/fundamentals/desktop-get-the-desktop).
  - [Модули Azure PowerShell](/powershell/azure/install-az-ps).
- Скачайте и извлеките:
  - [Power BI шаблон отчетов DMA](https://techcommunity.microsoft.com/gxcuf89792/attachments/gxcuf89792/MicrosoftDataMigration/161/4/PowerBI-Reports.zip).
  - [Скрипт лоадварехаусе](https://techcommunity.microsoft.com/gxcuf89792/attachments/gxcuf89792/MicrosoftDataMigration/161/3/LoadWarehouse1.zip).

## <a name="loading-the-powershell-modules"></a>Загрузка модулей PowerShell

Сохранение модулей PowerShell в каталоге модулей PowerShell позволяет вызывать модули без необходимости их явной загрузки перед использованием.

Чтобы загрузить модули, выполните следующие действия.

1. Перейдите к папке C:\Program Филес\виндовсповершелл\модулес и создайте папку с именем **датамигратионассистант**.
2. Откройте [модули PowerShell](https://techcommunity.microsoft.com/gxcuf89792/attachments/gxcuf89792/MicrosoftDataMigration/161/1/PowerShell-Modules2.zip)и сохраните их в созданной папке.

      ![Модули PowerShell](../dma/media//dma-consolidatereports/dma-powershell-modules.png)

    Каждая папка содержит связанный файл PSM1, как показано на следующем рисунке:

   ![Модули PowerShell PSM1 файлы](../dma/media//dma-consolidatereports/dma-powershell-modules-psm1-files.png)

   > [!NOTE]
   > Файл Folder и PSM1, который он содержит, должен иметь одно и то же имя.

   > [!IMPORTANT]
   > Возможно, потребуется разблокировать файлы PowerShell после их сохранения в каталоге WindowsPowerShell, чтобы обеспечить правильную загрузку модулей. Чтобы разблокировать файл PowerShell, щелкните его правой кнопкой мыши, выберите пункт **Свойства**, щелкните текстовое поле **разблокировать** и нажмите кнопку **ОК**.

   ![Свойства файла PSM1](../dma/media//dma-consolidatereports/dma-psm1-file-properties.png)

    Теперь PowerShell должен загружать эти модули автоматически при запуске нового сеанса PowerShell.

## <a name="create-an-inventory-of-sql-servers"></a><a name="create-inventory"></a> Создание инвентаризации серверов SQL Server

Перед запуском сценария PowerShell для оценки серверов SQL необходимо создать инвентаризацию серверов SQL Server, которые необходимо оценить.

Эта инвентаризация может быть в одной из двух форм:

- CSV-файл Excel
- Таблица SQL Server

### <a name="if-using-a-csv-file"></a>При использовании CSV-файла

> [!IMPORTANT]
> Убедитесь, что файл инвентаризации сохранен в виде файла с разделителями-запятыми (CSV).
>
> Для экземпляров по умолчанию задайте для имени экземпляра значение MSSQLServer.

При использовании CSV-файла для импорта данных убедитесь, что существует только два столбца: **имя экземпляра** данных и **имя базы данных**, а столбцы не содержат строк заголовка.

 ![Содержимое CSV-файла](../dma/media//dma-consolidatereports/dma-csv-file-contents.png)

### <a name="if-using-a-sql-server-table"></a>При использовании таблицы SQL Server

> [!IMPORTANT]
> Для экземпляров по умолчанию задайте для имени экземпляра значение MSSQLServer.

Создайте базу данных с именем **естатеинвентори** и таблицу с именем **датабасеинвентори**. Таблица, содержащая эти данные инвентаризации, может содержать любое количество столбцов, если существует четыре столбца:

- ServerName
- InstanceName
- имя_базы_данных
- ассессментфлаг

![Снимок экрана SQL Server содержимого таблицы, если вы используете SQL Server таблицу.](../dma/media//dma-consolidatereports/dma-sql-server-table-contents-database-inventory.png)

Если эта база данных не находится на компьютере со средствами, убедитесь, что компьютер с инструментами имеет сетевое подключение к этому экземпляру SQL Server.

Преимущество использования SQL Serverной таблицы с CSV-файлом заключается в том, что можно использовать столбец флагов оценки для управления экземпляром или базой данных, который выбирается для оценки, что упрощает разделение оценок на небольшие фрагменты.  Затем можно охватывать несколько оценок (см. раздел об использовании оценки далее в этой статье), что проще, чем поддерживать несколько CSV-файлов.

Помните, что в зависимости от количества объектов и их сложности оценка может занять очень много времени (часы +), поэтому разумно разделить оценку на управляемые фрагменты.

### <a name="if-using-an-instance-inventory"></a>При использовании инвентаризации экземпляра

Создайте базу данных с именем **естатеинвентори** и таблицу с именем **инстанцеинвентори**. Таблица, содержащая эти данные инвентаризации, может содержать любое количество столбцов, если существует четыре столбца:

- ServerName
- InstanceName
- Port
- ассессментфлаг

![Снимок экрана SQL Server содержимого таблицы при использовании инвентаризации экземпляра.](../dma/media//dma-consolidatereports/dma-sql-server-table-contents-instance-inventory.png)

## <a name="running-a-scaled-assessment"></a>Выполнение масштабируемой оценки

После загрузки модулей PowerShell в каталог modules и создания инвентаризации необходимо выполнить масштабированную оценку, открыв PowerShell и выполнив функцию Дмадатаколлектор.

  ![Списки функций Дмадатаколлектор](../dma/media//dma-consolidatereports/dma-dmaDataCollector-function-listing.png)

Параметры, связанные с функцией Дмадатаколлектор, описаны в следующей таблице.

|Параметр  |Описание |
|---------|---------|
|**жетсерверлистфром** | Ваш инвентарный список. Возможными значениями являются **SQLServer** и **CSV**.<br/>Дополнительные сведения см. в разделе [Создание инвентаризации серверов SQL Server](#create-inventory). |
|**ксвпас** | Путь к файлу инвентаризации CSV.  Используется, только если для **жетсерверлистфром** задано значение  **CSV**. |
|**serverName** | SQL Server имя экземпляра инвентаризации при использовании **SQLServer** в параметре **жетсерверлистфром** . |
|**databaseName** | База данных, в которой размещена таблица инвентаризации. |
|**усеинстанцесонли** | Битовый флаг, указывающий, следует ли использовать список экземпляров для оценки.  Если задано значение 0, то для построения списка целевых объектов оценки будет использоваться таблица Датабасеинвентори. |
|**AssessmentName** | Имя оценки DMA. |
|**TargetPlatform** | Тип целевого объекта оценки, который требуется выполнить.  Возможные значения: **AzureSQLDatabase**, **манажедсклсервер**, **SQLServer2012**, **SQLServer2014**, **SQLServer2016**, **SQLServerLinux2017**, **SQLServerWindows2017**,  **SqlServerWindows2019** и **SqlServerLinux2019**.  |
|**AuthenticationMethod** | Метод проверки подлинности для подключения к SQL Server целям, которые необходимо оценить. Возможными значениями являются **SQLAuth** и **WindowsAuth**. |
|**аутпутлокатион** | Каталог, в котором хранится выходной файл оценки JSON. В зависимости от числа оцениваемых баз данных и количества объектов в базах данных оценка может занять очень много времени. После завершения всех оценок файл будет записан. |

Если возникает непредвиденная ошибка, то командное окно, инициированное этим процессом, будет прервано.  Проверьте журнал ошибок, чтобы определить причину сбоя.

  ![Расположение журнала ошибок](../dma/media//dma-consolidatereports/dma-error-log-file-location.png)

## <a name="consuming-the-assessment-json-file"></a>Использование JSON – файла оценки

После завершения оценки вы можете импортировать данные в SQL Server для анализа. Чтобы использовать JSON файла оценки, откройте PowerShell и выполните функцию Дмапроцессор.

  ![список функций Дмапроцессор](../dma/media//dma-consolidatereports/dma-dmaProcessor-function-listing.png)

Параметры, связанные с функцией Дмапроцессор, описаны в следующей таблице.

|Параметр  |Описание |
|---------|---------|
|**процессто** | Расположение, в котором будет обрабатываться JSON файл. Возможными значениями являются **SQLServer** и **AzureSQLDatabase**. |
|**serverName** | SQL Server экземпляр, в который будут обработаны данные.  Если для параметра **процессто** задано значение **AzureSQLDatabase** , включите только имя SQL Server (не включайте. Database.Windows.NET). При использовании базы данных SQL Azure вам будет предложено два имени входа. Первый — это учетные данные клиента Azure, а вторая — имя входа администратора для SQL Server Azure. |
|**креатедмарепортинг** | Промежуточная база данных, создаваемая для обработки JSON файла.  Если указанная база данных уже существует и для этого параметра задано значение, то объекты не будут созданы.  Этот параметр полезен для повторного создания одного объекта, который был удален. |
|**креатедатаварехаусе** | Создает хранилище данных, которое будет использоваться отчетом Power BI. |
|**databaseName** | Имя базы данных Дмарепортинг. |
|**варехаусенаме** | Имя базы данных хранилища данных. |
|**жсондиректори** | Каталог, содержащий файл оценки JSON.  Если в каталоге имеется несколько файлов JSON, они обрабатываются по одному. |

Для обработки одного файла функция Дмапроцессор должна занять несколько секунд.

## <a name="loading-the-data-warehouse"></a>Загрузка хранилища данных

После завершения обработки файлов оценки Дмапроцессор данные будут загружены в базу данных Дмарепортинг в таблице Репортдата. На этом этапе необходимо загрузить хранилище данных.

1. Используйте скрипт Лоадварехаусе для заполнения отсутствующих значений в измерениях.

    Сценарий принимает данные из таблицы Репортдата в базе данных Дмарепортинг и загружает их в хранилище.  Если во время этого процесса загрузки возникнут ошибки, они, скорее всего, являются результатом отсутствия записей в таблицах измерений.

2. Загрузите хранилище данных.

  ![Содержимое Лоадварехаусе Загружено](../dma/media//dma-consolidatereports/dma-load-warehouse-loaded.png)

## <a name="set-your-database-owners"></a>Настройка владельцев базы данных

Хотя это не обязательно, для получения наибольшего значения из отчетов рекомендуется задать владельцев базы данных в измерении **димдбовнер** , а затем обновить **Дбовнеркэй** в таблице **фактассессмент** .  После выполнения этого процесса можно выполнить срез и фильтрацию отчета Power BI на основе определенных владельцев базы данных.

Можно также использовать сценарий Лоадварехаусе, чтобы предоставить основные инструкции TSQL для задания владельцев базы данных.

  ![Владельцы параметров Лоадварехаусе](../dma/media//dma-consolidatereports/dma-load-warehouse-set-owners.png)

## <a name="dma-reports"></a>Отчеты DMA

1. Откройте Power BI шаблон отчетов DMA в Power BI Desktop.
2. Введите сведения о сервере, которые указывают на базу данных **дмаварехаусе** , а затем нажмите кнопку **загрузить**.

   ![Отчеты DMA Power BI шаблон загружен](../dma/media//dma-consolidatereports/dma-reports-powerbi-template-loaded.png)

   После того как отчет обновил данные из базы данных **дмаварехаусе** , отобразится отчет, аналогичный приведенному ниже.

   ![Дмаварехаусе, представление отчетов](../dma/media//dma-consolidatereports/dma-DMAWarehouse-report1.png)

   > [!TIP]
   > Если ожидаемые данные не отображаются, попробуйте изменить активную закладку.  Дополнительные сведения см. в следующем разделе.

## <a name="working-with-dma-reports"></a>Работа с отчетами DMA

Для работы с отчетами DMA используйте закладки и срезы для фильтрации по:

- Типы оценки (база данных SQL Azure, Управляемый экземпляр Azure SQL, SQL Server) 
- Имя экземпляра
- Имя базы данных
- Имя команды

Чтобы открыть колонку "закладки и фильтры", выберите закладку фильтры на главной странице отчета:

![Закладки и фильтры отчета DMA](../dma/media//dma-consolidatereports/dma-report-bookmarks-filters.png)

При выборе закладки фильтры включается следующая колонка:

![Колонка "представления отчетов" в режиме DMA](../dma/media//dma-consolidatereports/dma-report-views-blade.png)

Закладки можно использовать для переключения контекста отчетов между:

- Оценки облака базы данных SQL Azure
- Azure SQL Управляемый экземпляр оценки облака
- Оценки в локальной среде

![Закладки представления отчетов DMA](../dma/media//dma-consolidatereports/dma-report-bookmarks1.png)

Чтобы скрыть колонку фильтры, нажмите КЛАВИШу «назад».

![Кнопка возврата представлений отчетов DMA](../dma/media//dma-consolidatereports/dma-report-bookmarks-back.png)

В нижнем левом углу страницы отчета появится запрос, показывающий, применен ли фильтр к любому из следующих элементов:

- Фактассессмент — имя_экземпляра
- Фактассессмент — DatabaseName
- Димдбовнер — DBOwner

![Запрос на применение фильтра](../dma/media//dma-consolidatereports/dma-filter-applied-prompt.png)

> [!NOTE]
> Если вы выполняете только оценку базы данных SQL Azure, будут заполнены только облачные отчеты. И наоборот, если выполняется только локальная оценка, заполняются только локальные отчеты. Однако если вы выполняете как Azure, так и локальную оценку, а затем загружаете обе оценки в хранилище, вы можете переключаться между облачными отчетами и локальными отчетами, удерживая нажатой клавишу CTRL, щелкнув соответствующий значок.

## <a name="reports-visuals"></a>Визуальные элементы отчетов

Подробные сведения, отображаемые в отчетах Power BI, приведены в следующих разделах.

### <a name="readiness-"></a>Готовность

  ![Процент готовности к переходу на DMA](../dma/media//dma-consolidatereports/dma-readiness-percentage.png)

Этот визуальный элемент обновляется на основе контекста выбора (все, экземпляр, база данных [кратность]).

### <a name="readiness-count"></a>Число готовностей

  ![Число готовности DMA](../dma/media//dma-consolidatereports/dma-readiness-count.png)

Этот визуальный элемент показывает число баз данных, готовых к переносу количества баз данных, которые еще не готовы к миграции.

### <a name="readiness-bucket"></a>Контейнер готовности

  ![Контейнер готовности DMA](../dma/media//dma-consolidatereports/dma-readiness-bucket.png)

Этот визуальный элемент показывает разбивку баз данных по следующим контейнерам готовности:

- 100% ГОТОВО
- 75-99% ГОТОВО
- 50-75% ГОТОВО
- НЕ ГОТОВО

### <a name="issues-word-cloud"></a>Проблемы с приложением Word Cloud

  ![Проблемы DMA Вордклауд](../dma/media//dma-consolidatereports/dma-issues-word-cloud.png)

Этот визуальный элемент показывает проблемы, которые в данный момент происходят в контексте выбора (все, экземпляр, база данных [кратность]). Чем больше это слово отображается на экране, тем больше число проблем в этой категории. При наведении указателя мыши на слово отображается число ошибок, возникающих в этой категории.

### <a name="database-readiness"></a>Готовность базы данных

  ![Отчет о готовности базы данных DMA](../dma/media//dma-consolidatereports/dma-database-readiness-report.png)

Этот раздел является основной частью отчета, который показывает готовность экземпляра базы данных. В этом отчете есть иерархия детализации:

- инстанцедатабасе
- ChangeCategory
- Заголовок
- ObjectType
- импактедобжектнаме

 ![Детализация отчета о готовности базы данных DMA](../dma/media//dma-consolidatereports/dma-database-readiness-report-drilldown.png)

Этот отчет также служит точкой фильтра для создания отчета о плане исправления.

Чтобы просмотреть отчет о плане исправления, щелкните правой кнопкой мыши точку данных на этом графике, наведите указатель на пункт **Детализация**, а затем выберите пункт **планы исправления**.

Эта задача фильтрует отчет по плану исправления на текущий уровень иерархии на основе точки, в которой вы выбрали параметр Детализация.

  ![Детализация отчета о готовности базы данных DMA отфильтрована](../dma/media//dma-consolidatereports/dma-database-readiness-report-drilldown-filtered.png)

  ![Отчет по плану исправления DMA](../dma/media//dma-consolidatereports/dma-remediation-plan-report.png)

Отчет о плане исправления можно также использовать самостоятельно для создания пользовательского плана исправления с помощью фильтров в колонке **Фильтры визуализации** .

  ![Параметры фильтра отчетов по плану исправления DMA](../dma/media//dma-consolidatereports/dma-remediation-plan-report-filter-options.png)

### <a name="script-disclaimer"></a>Заявление об отказе сценария

*Примеры сценариев, приведенные в этой статье, не поддерживаются ни в одной из программ или служб поддержки Microsoft Standard. Все сценарии предоставляются как есть без каких-либо гарантий. Microsoft дополнительно отказывается от всех подразумеваемых гарантий, включая, без ограничений, любых подразумеваемых гарантий, связанных с товарной пригодностью или пригодности для конкретной цели. Все риски, возникающие из – за использования или производительности примеров сценариев и документации, остаются с вами. В противном случае корпорация Майкрософт, ее авторы или кто угодно не участвовал в создании, производство или доставка сценариев несет ответственность за любые убытки (включая отсутствие ограничений, ущерба для потери прибыли бизнеса, прерывание бизнеса, потери бизнес-информации или другие потери пекуниари), из-за которых в работе или невозможности использовать образцы сценариев или документации, даже если корпорация Майкрософт рекомендовала возможность таких убытков.  Выполните поиск разрешения, прежде чем переносить эти скрипты на другие сайты, репозитории и блоги.*