---
description: sp_spaceused (Transact-SQL)
title: sp_spaceused (Transact-SQL) | Документация Майкрософт
ms.custom: ''
ms.date: 08/14/2017
ms.prod: sql
ms.prod_service: database-engine, sql-database, sql-data-warehouse, pdw
ms.reviewer: ''
ms.technology: system-objects
ms.topic: reference
f1_keywords:
- sp_spaceused_TSQL
- sp_spaceused
dev_langs:
- TSQL
helpviewer_keywords:
- sp_spaceused
ms.assetid: c6253b48-29f5-4371-bfcd-3ef404060621
author: markingmyname
ms.author: maghan
monikerRange: '>=aps-pdw-2016||=azuresqldb-current||=azure-sqldw-latest||>=sql-server-2016||>=sql-server-linux-2017||=azuresqldb-mi-current'
ms.openlocfilehash: 480b61493dc38ea91679e590f3abe63bde3a48c0
ms.sourcegitcommit: 33f0f190f962059826e002be165a2bef4f9e350c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/30/2021
ms.locfileid: "99189307"
---
# <a name="sp_spaceused-transact-sql"></a>sp_spaceused (Transact-SQL)
[!INCLUDE [sql-asdb-asdbmi-asa-pdw](../../includes/applies-to-version/sql-asdb-asdbmi-asa-pdw.md)]

  Выводит количество строк, зарезервированное место на диске и место на диске, которое используется таблицей, индексированным представлением или очередью компонента [!INCLUDE[ssSB](../../includes/sssb-md.md)] в текущей базе данных, либо выводит место на диске, зарезервированное и используемое всей базой данных.  
  
 ![Значок ссылки на раздел](../../database-engine/configure-windows/media/topic-link.gif "Значок ссылки на раздел") [Синтаксические обозначения в Transact-SQL](../../t-sql/language-elements/transact-sql-syntax-conventions-transact-sql.md)  
  
## <a name="syntax"></a>Синтаксис  
  
```syntaxsql  
sp_spaceused [[ @objname = ] 'objname' ]   
[, [ @updateusage = ] 'updateusage' ]  
[, [ @mode = ] 'mode' ]  
[, [ @oneresultset = ] oneresultset ]  
[, [ @include_total_xtp_storage = ] include_total_xtp_storage ]
```  
[!INCLUDE[synapse-analytics-od-unsupported-syntax](../../includes/synapse-analytics-od-unsupported-syntax.md)]
  
## <a name="arguments"></a>Аргументы  

Для [!INCLUDE[sssdw-md](../../includes/sssdw-md.md)] и [!INCLUDE[sspdw-md](../../includes/sspdw-md.md)] `sp_spaceused` должны указывать именованные параметры (например, вместо того, чтобы `sp_spaceused (@objname= N'Table1');` полагаться на порядковые номера параметров). 

`[ @objname = ] 'objname'`
   
 Полное или неполное имя таблицы, индексированного представления или очереди, для которых были запрошены сведения по использованию места на диске. Кавычки необходимы только в том случае, если указано уточненное имя объекта. Если указано полностью уточненное имя, включающее имя базы данных, именем базы данных должно быть имя текущей базы данных.  
Если значение *objname* не задано, возвращаются результаты для всей базы данных.  
*objname* имеет тип **nvarchar (776)** и значение по умолчанию NULL.  
> [!NOTE]  
> [!INCLUDE[sssdw-md](../../includes/sssdw-md.md)] и [!INCLUDE[sspdw-md](../../includes/sspdw-md.md)] поддерживают только объекты базы данных и таблицы.
  
`[ @updateusage = ] 'updateusage'` Указывает, что для обновления сведений об использовании пространства следует запустить DBCC UPDATEUSAGE. Если параметр *objname* не указан, инструкция выполняется для всей базы данных. в противном случае инструкция выполняется в *objname*. Могут принимать значения **true** или **false**. параметр *updateusage* имеет тип **varchar (5)** и значение по умолчанию **false**.  
  
`[ @mode = ] 'mode'` Указывает область результатов. Для растянутой таблицы или базы данных параметр *mode* позволяет включить или исключить удаленную часть объекта. Дополнительные сведения см. в разделе [Stretch Database](../../sql-server/stretch-database/stretch-database.md).  
  
 Аргумент *mode* может иметь следующие значения:  
  
|Значение|Описание|  
|-----------|-----------------|  
|ALL|Возвращает статистику хранилища объекта или базы данных, включая локальную и удаленную части.|  
|LOCAL_ONLY|Возвращает статистику хранилища только для локальной части объекта или базы данных. Если объект или база данных не включены в Stretch, возвращает ту же статистику, что и значение @mode = ALL.|  
|REMOTE_ONLY|Возвращает статистику хранилища только удаленной части объекта или базы данных. Этот параметр вызывает ошибку, если выполняется одно из следующих условий.<br /><br /> Таблица не включена для переноса.<br /><br /> Таблица включена для переноса, но вы никогда не включили перенос данных. В этом случае у удаленной таблицы еще нет схемы.<br /><br /> Пользователь вручную удалил удаленную таблицу.<br /><br /> Подготовка удаленного архива данных вернула состояние Success, но на самом деле это не удалось.|  
  
 *mode* имеет тип **varchar (11)** и значение по умолчанию **N'ALL**.  
  
`[ @oneresultset = ] oneresultset` Указывает, следует ли возвращать один результирующий набор. Аргумент *онересултсет* может иметь следующие значения:  
  
|Значение|Описание|  
|-----------|-----------------|  
|0|Если значение *\@ objname* равно null или не указано, возвращаются два результирующих набора. Два результирующих набора — это поведение по умолчанию.|  
|1|Если *\@ objname* = null или не указан, возвращается один результирующий набор.|  
  
 *онересултсет* имеет **бит** и значение по умолчанию **0**.  

`[ @include_total_xtp_storage] 'include_total_xtp_storage'`
**Применимо к:** [!INCLUDE[sssql17-md](../../includes/sssql17-md.md)] , [!INCLUDE[sssds-md](../../includes/sssds-md.md)] .  
  
 Если @oneresultset = 1, параметр @include_total_xtp_storage определяет, включает ли один результирующий набор столбцы для хранилища MEMORY_OPTIMIZED_DATA. Значение по умолчанию равно 0, т. е. по умолчанию (если параметр не указан), столбцы XTP не включаются в результирующий набор.  

## <a name="return-code-values"></a>Значения кода возврата  
 0 (успешное завершение) или 1 (неуспешное завершение)  
  
## <a name="result-sets"></a>Результирующие наборы  
 Если аргумент *objname* опущен и значение *онересултсет* равно 0, возвращаются следующие результирующие наборы для предоставления сведений о текущем размере базы данных.  
  
|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**database_name**|**nvarchar(128)**|Имя текущей базы данных.|  
|**database_size**|**varchar (18)**|Размер текущей базы данных в мегабайтах. **database_size** включает файлы данных и журналов.|  
|**unallocated space**|**varchar (18)**|Место в базе данных, не зарезервированное для объектов базы данных.|  
  
|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**процессу**|**varchar (18)**|Общий объем пространства, выделенный объектам в базе данных.|  
|**data**|**varchar (18)**|Общий объем пространства, используемый данными.|  
|**index_size**|**varchar (18)**|Общий объем пространства, используемый индексами.|  
|**использующ**|**varchar (18)**|Общий объем пространства, зарезервированный для объектов в базе данных, но пока не используемый.|  
  
 Если аргумент *objname* опущен и значение *онересултсет* равно 1, то возвращается следующий единый результирующий набор для предоставления сведений о текущем размере базы данных.  
  
|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**database_name**|**nvarchar(128)**|Имя текущей базы данных.|  
|**database_size**|**varchar (18)**|Размер текущей базы данных в мегабайтах. **database_size** включает файлы данных и журналов.|  
|**unallocated space**|**varchar (18)**|Место в базе данных, не зарезервированное для объектов базы данных.|  
|**процессу**|**varchar (18)**|Общий объем пространства, выделенный объектам в базе данных.|  
|**data**|**varchar (18)**|Общий объем пространства, используемый данными.|  
|**index_size**|**varchar (18)**|Общий объем пространства, используемый индексами.|  
|**использующ**|**varchar (18)**|Общий объем пространства, зарезервированный для объектов в базе данных, но пока не используемый.|  
  
 Если задано значение *objname* , то для указанного объекта возвращается следующий результирующий набор.  
  
|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**name**|**nvarchar(128)**|Имя объекта, для которого были запрошены сведения об используемом пространстве.<br /><br /> Имя схемы объекта не возвращается. Если имя схемы является обязательным, используйте динамические административные представления [sys.dm_db_partition_stats](../../relational-databases/system-dynamic-management-views/sys-dm-db-partition-stats-transact-sql.md) или [sys.dm_db_index_physical_stats](../../relational-databases/system-dynamic-management-views/sys-dm-db-index-physical-stats-transact-sql.md) для получения эквивалентных сведений о размере.|  
|**rows**|**char (20)**|Количество существующих строк в таблице. Если объект указан как очередь компонента [!INCLUDE[ssSB](../../includes/sssb-md.md)], этот столбец указывает число сообщений в очереди.|  
|**процессу**|**varchar (18)**|Общий объем зарезервированного пространства для объекта *objname*.|  
|**data**|**varchar (18)**|Общий объем пространства, занятого данными в *objname*.|  
|**index_size**|**varchar (18)**|Общий объем пространства, используемый индексами объекта *objname*.|  
|**использующ**|**varchar (18)**|Общий объем пространства, зарезервированного для объекта *objname* , но еще не использованных.|  
 
Этот режим используется по умолчанию, если параметры не указаны. Следующие результирующие наборы возвращаются подробным сведениями о размере базы данных на диске. 

|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**database_name**|**nvarchar(128)**|Имя текущей базы данных.|  
|**database_size**|**varchar (18)**|Размер текущей базы данных в мегабайтах. **database_size** включает файлы данных и журналов. Если база данных содержит MEMORY_OPTIMIZED_DATA файловую группу, то сюда входит общий размер всех файлов контрольных точек в файловой группе.|  
|**unallocated space**|**varchar (18)**|Место в базе данных, не зарезервированное для объектов базы данных. Если база данных содержит MEMORY_OPTIMIZED_DATA файловую группу, то она включает общий размер на диске файлов контрольных точек с состоянием, СОЗДАНным в файловой группе.|  

Пространство, используемое таблицами в базе данных: (этот набор результатов не отражает оптимизированные для памяти таблицы, так как для каждого табличного учета использования диска не существует таблиц.) 

|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**процессу**|**varchar (18)**|Общий объем пространства, выделенный объектам в базе данных.|  
|**data**|**varchar (18)**|Общий объем пространства, используемый данными.|  
|**index_size**|**varchar (18)**|Общий объем пространства, используемый индексами.|  
|**использующ**|**varchar (18)**|Общий объем пространства, зарезервированный для объектов в базе данных, но пока не используемый.|

Следующий результирующий набор возвращается только в том **случае, если** база данных содержит MEMORY_OPTIMIZED_DATA файловую группу по крайней мере с одним контейнером: 

|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**xtp_precreated**|**varchar (18)**|Общий размер файлов контрольных точек с СОЗДАНным состоянием в КБ. Подсчитывает количество нераспределенного пространства в базе данных в целом. [Например, если имеется 600 000 КБ созданных файлов контрольных точек, этот столбец содержит "600000 КБ"]|  
|**xtp_used**|**varchar (18)**|Общий размер файлов контрольных точек с состояниями в разделе Создание, активный и целевой объект слияния, в КБ. Это место на диске, активно используемое для данных в оптимизированных для памяти таблицах.|  
|**xtp_pending_truncation**|**varchar (18)**|Общий размер файлов контрольных точек с WAITING_FOR_LOG_TRUNCATION состояния, в КБ. Это место на диске, используемое для файлов контрольных точек, ожидающих очистки, после усечения журнала.|

Если аргумент *objname* опущен, значение онересултсет равно 1, а *include_total_xtp_storage* — 1, для предоставления сведений о текущем размере базы данных возвращается следующий единый результирующий набор. Если `include_total_xtp_storage` значение равно 0 (по умолчанию), последние три столбца опускаются. 

|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**database_name**|**nvarchar(128)**|Имя текущей базы данных.|  
|**database_size**|**varchar (18)**|Размер текущей базы данных в мегабайтах. **database_size** включает файлы данных и журналов. Если база данных содержит MEMORY_OPTIMIZED_DATA файловую группу, то сюда входит общий размер всех файлов контрольных точек в файловой группе.|
|**unallocated space**|**varchar (18)**|Место в базе данных, не зарезервированное для объектов базы данных. Если база данных содержит MEMORY_OPTIMIZED_DATA файловую группу, то она включает общий размер на диске файлов контрольных точек с состоянием, СОЗДАНным в файловой группе.|  
|**процессу**|**varchar (18)**|Общий объем пространства, выделенный объектам в базе данных.|  
|**data**|**varchar (18)**|Общий объем пространства, используемый данными.|  
|**index_size**|**varchar (18)**|Общий объем пространства, используемый индексами.|  
|**использующ**|**varchar (18)**|Общий объем пространства, зарезервированный для объектов в базе данных, но пока не используемый.|
|**xtp_precreated**|**varchar (18)**|Общий размер файлов контрольных точек с СОЗДАНным состоянием в КБ. Это подсчитывает нераспределенное пространство в базе данных в целом. Возвращает значение NULL, если база данных не имеет memory_optimized_data файловой группы, имеющей по крайней мере один контейнер. *Этот столбец включается, только если @include_total_xtp_storage = 1*.| 
|**xtp_used**|**varchar (18)**|Общий размер файлов контрольных точек с состояниями в разделе Создание, активный и целевой объект слияния, в КБ. Это место на диске, активно используемое для данных в оптимизированных для памяти таблицах. Возвращает значение NULL, если база данных не имеет memory_optimized_data файловой группы, имеющей по крайней мере один контейнер. *Этот столбец включается, только если @include_total_xtp_storage = 1*.| 
|**xtp_pending_truncation**|**varchar (18)**|Общий размер файлов контрольных точек с WAITING_FOR_LOG_TRUNCATION состояния, в КБ. Это место на диске, используемое для файлов контрольных точек, ожидающих очистки, после усечения журнала. Возвращает значение NULL, если база данных не имеет memory_optimized_data файловой группы, имеющей по крайней мере один контейнер. Этот столбец включается только в том случае `@include_total_xtp_storage=1` , если.|

## <a name="remarks"></a>Замечания  
 **database_size** обычно превышает сумму **зарезервированного**  +  **нераспределенного пространства** , так как она включает размер файлов журнала, но **зарезервированные** и **unallocated_space** рассматривайте только страницы данных. В некоторых случаях с помощью Azure синапсе Analytics эта инструкция может оказаться недействительной. 
  
 Страницы, используемые XML-индексами и полнотекстовыми индексами, включаются в **index_size** обоих результирующих наборов. Если задано значение *objname* , страницы для XML-индексов и полнотекстовых индексов для объекта также учитываются в общем количестве **зарезервированных** и **index_sizeных** результатов.  
  
 Если для базы данных или объекта, имеющего пространственный индекс, вычисляется использование пространства, то столбцы размера пространства, такие как **database_size**, **зарезервированные** и **index_size**, включают размер пространственного индекса.  
  
 Если указан параметр *updateusage* , то [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] проверяет страницы данных в базе данных и вносит необходимые исправления в представления каталога **sys.allocation_units** и **sys. partitions** , относящиеся к объему хранилища, используемому каждой таблицей. Иногда возникают ситуации, например после удаления индекса, когда сведения о занимаемом таблицей месте могут устареть. для работы с большими таблицами или базами данных в *updateusage* может потребоваться некоторое время. Используйте *updateusage* только в том случае, если вы считаете, что возвращаются неверные значения, и когда процесс не окажет негативного воздействия на других пользователей или процессы в базе данных. При необходимости инструкцию DBCC UPDATEUSAGE можно запускать отдельно.  
  
> [!NOTE]  
>  При удалении или перестройке больших индексов либо удалении или усечении больших таблиц компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] откладывает фактическое освобождение страниц и связанных блокировок до момента фиксации транзакции. Отложенные операции удаления не освобождают выделенное место немедленно. Таким образом, значения, возвращаемые **sp_spaceused** сразу после удаления или усечения большого объекта, могут не отражать фактическое свободное место на диске.  
  
## <a name="permissions"></a>Разрешения  
 Разрешение на выполнение процедуры **sp_spaceused** предоставлено роли **public** . Параметр **\@updateusage** могут указывать только члены предопределенной роли базы данных **db_owner**.  
  
## <a name="examples"></a>Примеры  
  
### <a name="a-displaying-disk-space-information-about-a-table"></a>A. Вывод сведений о занимаемом месте на диске для таблицы  
 В следующем примере предоставляются сведения о месте на диске для таблицы `Vendor` и ее индексах.  
  
```sql  
USE AdventureWorks2012;  
GO  
EXEC sp_spaceused N'Purchasing.Vendor';  
GO  
```  
  
### <a name="b-displaying-updated-space-information-about-a-database"></a>Б. Вывод обновленных сведений о занимаемом месте на диске для базы данных  
 В следующем примере приводятся итоговые сведения об использовании места на диске текущей базой данных с применением необязательного параметра `@updateusage`, чтобы получить достоверные текущие значения.  
  
```sql  
USE AdventureWorks008R2;  
GO  
EXEC sp_spaceused @updateusage = N'TRUE';  
GO  
```  
  
### <a name="c-displaying-space-usage-information-about-the-remote-table-associated-with-a-stretch-enabled-table"></a>В. Отображение сведений об использовании пространства для удаленной таблицы, связанной с таблицей с поддержкой Stretch  
 В следующем примере показано пространство, используемое удаленной таблицей, связанной с таблицей с поддержкой растяжения, с помощью аргумента **\@ mode** для указания удаленной цели. Дополнительные сведения см. в разделе [Stretch Database](../../sql-server/stretch-database/stretch-database.md).  
  
```sql  
USE StretchedAdventureWorks2016  
GO  
EXEC sp_spaceused N'Purchasing.Vendor', @mode = 'REMOTE_ONLY'  
```  
  
### <a name="d-displaying-space-usage-information-for-a-database-in-a-single-result-set"></a>Г. Отображение сведений об использовании пространства для базы данных в одном результирующем наборе  
 В следующем примере показана сводка использования пространства для текущей базы данных в одном результирующем наборе.  
  
```sql  
USE AdventureWorks2016  
GO  
EXEC sp_spaceused @oneresultset = 1  
```  

### <a name="e-displaying-space-usage-information-for-a-database-with-at-least-one-memory_optimized-file-group-in-a-single-result-set"></a>Д. Отображение сведений об использовании пространства для базы данных по крайней мере одной MEMORY_OPTIMIZED файловой группы в одном результирующем наборе 
 В следующем примере показана сводка использования пространства для текущей базы данных по крайней мере одной MEMORY_OPTIMIZED файловой группы в одном результирующем наборе.
 
```sql
USE WideWorldImporters
GO
EXEC sp_spaceused @updateusage = 'FALSE', @mode = 'ALL', @oneresultset = '1', @include_total_xtp_storage = '1';
GO
``` 

### <a name="f-displaying-space-usage-information-for-a-memory_optimized-table-object-in-a-database"></a>Е. Отображение сведений об использовании пространства для объекта MEMORY_OPTIMIZED таблицы в базе данных.
 В следующем примере показано использование пространства для объекта MEMORY_OPTIMIZED таблицы в текущей базе данных по крайней мере одной MEMORY_OPTIMIZED группе файлов.
 
```sql
USE WideWorldImporters
GO
EXEC sp_spaceused
@objname = N'VehicleTemparatures',
@updateusage = 'FALSE',
@mode = 'ALL',
@oneresultset = '0',
@include_total_xtp_storage = '1';
GO
```  

## <a name="see-also"></a>См. также  
 [CREATE INDEX (Transact-SQL)](../../t-sql/statements/create-index-transact-sql.md)   
 [CREATE TABLE (Transact-SQL)](../../t-sql/statements/create-table-transact-sql.md)   
 [DBCC UPDATEUSAGE &#40;Transact-SQL&#41;](../../t-sql/database-console-commands/dbcc-updateusage-transact-sql.md)   
 [SQL Server Service Broker](../../database-engine/configure-windows/sql-server-service-broker.md)   
 [sys.allocation_units (Transact-SQL)](../../relational-databases/system-catalog-views/sys-allocation-units-transact-sql.md)   
 [sys.indexes (Transact-SQL)](../../relational-databases/system-catalog-views/sys-indexes-transact-sql.md)   
 [sys.index_columns (Transact-SQL)](../../relational-databases/system-catalog-views/sys-index-columns-transact-sql.md)   
 [sys.objects (Transact-SQL)](../../relational-databases/system-catalog-views/sys-objects-transact-sql.md)   
 [sys.partitions (Transact-SQL)](../../relational-databases/system-catalog-views/sys-partitions-transact-sql.md)   
 [Системные хранимые процедуры (Transact-SQL)](../../relational-databases/system-stored-procedures/system-stored-procedures-transact-sql.md)  
  
  
