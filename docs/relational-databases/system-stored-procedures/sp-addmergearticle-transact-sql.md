---
description: sp_addmergearticle (Transact-SQL)
title: sp_addmergearticle (Transact-SQL) | Документация Майкрософт
ms.custom: ''
ms.date: 03/14/2017
ms.prod: sql
ms.prod_service: database-engine
ms.reviewer: ''
ms.technology: replication
ms.topic: reference
f1_keywords:
- sp_addmergearticle
- sp_addmergearticle_TSQL
helpviewer_keywords:
- sp_addmergearticle
ms.assetid: 0df654ea-24e2-4c61-a75a-ecaa7a140a6c
author: markingmyname
ms.author: maghan
ms.openlocfilehash: 52e59c1c4c7a75c209be99cbb6caacc425bd39f3
ms.sourcegitcommit: 33f0f190f962059826e002be165a2bef4f9e350c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/30/2021
ms.locfileid: "99192362"
---
# <a name="sp_addmergearticle-transact-sql"></a>sp_addmergearticle (Transact-SQL)
[!INCLUDE [SQL Server SQL MI](../../includes/applies-to-version/sql-asdbmi.md)]

  Добавляет статью к существующей публикации слиянием. Эта хранимая процедура выполняется на издателе в базе данных публикации.  
  
 ![Значок ссылки на раздел](../../database-engine/configure-windows/media/topic-link.gif "Значок ссылки на раздел") [Синтаксические обозначения в Transact-SQL](../../t-sql/language-elements/transact-sql-syntax-conventions-transact-sql.md)  
  
## <a name="syntax"></a>Синтаксис  
  
```  
  
sp_addmergearticle [ @publication = ] 'publication'   
        , [ @article = ] 'article'   
        , [ @source_object = ] 'source_object'   
    [ , [ @type = ] 'type' ]   
    [ , [ @description = ] 'description' ]   
    [ , [ @column_tracking = ] 'column_tracking' ]   
    [ , [ @status = ] 'status' ]   
    [ , [ @pre_creation_cmd = ] 'pre_creation_cmd' ]   
    [ , [ @creation_script = ] 'creation_script' ]   
    [ , [ @schema_option = ] schema_option ]   
    [ , [ @subset_filterclause = ] 'subset_filterclause' ]   
    [ , [ @article_resolver = ] 'article_resolver' ]   
    [ , [ @resolver_info = ] 'resolver_info' ]   
    [ , [ @source_owner = ] 'source_owner' ]   
    [ , [ @destination_owner = ] 'destination_owner' ]   
    [ , [ @vertical_partition = ] 'vertical_partition' ]   
    [ , [ @auto_identity_range = ] 'auto_identity_range' ]   
    [ , [ @pub_identity_range = ] pub_identity_range ]   
    [ , [ @identity_range = ] identity_range ]   
    [ , [ @threshold = ] threshold ]   
    [ , [ @verify_resolver_signature = ] verify_resolver_signature ]   
    [ , [ @destination_object = ] 'destination_object' ]   
    [ , [ @allow_interactive_resolver = ] 'allow_interactive_resolver' ]   
    [ , [ @fast_multicol_updateproc = ] 'fast_multicol_updateproc' ]   
    [ , [ @check_permissions = ] check_permissions ]   
    [ , [ @force_invalidate_snapshot = ] force_invalidate_snapshot ]  
    [ , [ @published_in_tran_pub = ] 'published_in_tran_pub' ]  
    [ , [ @force_reinit_subscription = ] force_reinit_subscription ]  
    [ , [ @logical_record_level_conflict_detection = ] 'logical_record_level_conflict_detection' ]  
    [ , [ @logical_record_level_conflict_resolution = ] 'logical_record_level_conflict_resolution' ]  
    [ , [ @partition_options = ] partition_options ]  
    [ , [ @processing_order = ] processing_order ]  
    [ , [ @subscriber_upload_options = ] subscriber_upload_options ]  
    [ , [ @identityrangemanagementoption = ] 'identityrangemanagementoption' ]  
    [ , [ @delete_tracking = ] delete_tracking ]  
    [ , [ @compensate_for_errors = ] 'compensate_for_errors' ]   
    [ , [ @stream_blob_columns = ] 'stream_blob_columns' ]  
```  
  
## <a name="arguments"></a>Аргументы  
`[ @publication = ] 'publication'` Имя публикации, содержащей статью. Аргумент *publication* имеет тип **sysname** и не имеет значения по умолчанию.  
  
`[ @article = ] 'article'` Имя статьи. Имя должно быть уникальным в пределах публикации. Аргумент *article* имеет тип **sysname** и не имеет значения по умолчанию. *статья* должна быть на локальном компьютере, на котором работает [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , и должна соответствовать правилам для идентификаторов.  
  
`[ @source_object = ] 'source_object'` Публикуемый объект базы данных. Аргумент *source_object* имеет тип **sysname** и не имеет значения по умолчанию. Дополнительные сведения о типах объектов, которые могут быть опубликованы с помощью репликации слиянием, см. в разделе [Публикация данных и объектов базы данных](../../relational-databases/replication/publish/publish-data-and-database-objects.md).  
  
`[ @type = ] 'type'` Тип статьи. Аргумент *Type имеет тип* **sysname** и значение по умолчанию **Table** и может принимать одно из следующих значений.  
  
|Значение|Описание|  
|-----------|-----------------|  
|**Таблица** (по умолчанию)|Таблица со схемой и данными. Репликация проверяет таблицу, определяя данные, которые должны реплицироваться.|  
|**func schema only**|Только функция со схемой.|  
|**только схема** **индексированного представления**|Только индексированное представление со схемой.|  
|**proc schema only**|Только хранимая процедура со схемой.|  
|**только схема синонима**|Только синоним со схемой.|  
|**view schema only**|Только представление со схемой.|  
  
`[ @description = ] 'description'` Описание статьи. *Description* имеет тип **nvarchar (255)** и значение по умолчанию NULL.  
  
`[ @column_tracking = ] 'column_tracking'` Параметр для отслеживания на уровне столбцов. *column_tracking* имеет тип **nvarchar (10)** и значение по умолчанию false. **значение true** включает отслеживание столбцов. **значение false** отключает отслеживание столбцов и оставляет обнаружение конфликтов на уровне строк. Если таблица уже опубликована в других публикациях слиянием, необходимо использовать для параметра отслеживания столбца то же значение, что и для существующих статей, основанных на данной таблице. Этот параметр применим только для статей таблиц.  
  
> [!NOTE]  
>  Если для обнаружения конфликтов применяется трассировка на уровне строк (по умолчанию), базовая таблица может содержать не более 1 024 столбцов, однако столбцы из статьи должны быть отфильтрованы, чтобы было опубликовано не более 246 столбцов. Если применяется трассировка на уровне столбцов, базовая таблица может содержать не более 246 столбцов.  
  
`[ @status = ] 'status'` — Это состояние статьи. *состояние* имеет тип **nvarchar (10)** и значение по умолчанию не **синхронизировано**. Если этот параметр **активен**, выполняется сценарий начальной обработки для публикации таблицы. Если не **синхронизироваться**, сценарий начальной обработки для публикации таблицы выполняется при следующем запуске агент моментальных снимков.  
  
`[ @pre_creation_cmd = ] 'pre_creation_cmd'` Указывает, что должна делать система, если таблица существует на подписчике при применении моментального снимка. *pre_creation_cmd* имеет тип **nvarchar (10)** и может принимать одно из следующих значений.  
  
|Значение|Описание|  
|-----------|-----------------|  
|**Нет**|Если таблица на подписчике уже существует, не выполняется никаких действий.|  
|**delete**|Выполняет удаление, используя предложение WHERE, указанное в фильтре подмножества.|  
|**Drop** (по умолчанию)|Удаляет таблицу перед ее повторным созданием. Необходим для поддержки подписчиков [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssEW](../../includes/ssew-md.md)].|  
|**truncate**|Усекает целевую таблицу.|  
  
`[ @creation_script = ] 'creation_script'` Путь и имя необязательного скрипта схемы статьи, используемого для создания статьи в базе данных подписки. *creation_script* имеет тип **nvarchar (255)** и значение по умолчанию NULL.  
  
> [!NOTE]  
>  Скрипты создания не запускаются на подписчиках [!INCLUDE[ssEW](../../includes/ssew-md.md)].  
  
`[ @schema_option = ] schema_option` Битовая карта параметра создания схемы для данной статьи. *schema_option* является **двоичным (8)** и может иметь значение [| (Побитовое или)](../../t-sql/language-elements/bitwise-or-transact-sql.md) произведение одного или нескольких из этих значений.  
  
|Значение|Описание|  
|-----------|-----------------|  
|**0x00**|Отключает скрипты агент моментальных снимков и использует предоставленный в *creation_script* скрипт создания схемы.|  
|**0x01**|Формирует создание объекта (CREATE TABLE, CREATE PROCEDURE и т.п.). Это значение по умолчанию для статей хранимых процедур.|  
|**0x10**|Создает соответствующий кластеризованный индекс. Даже если этот параметр не установлен, индексы, связанные с первичными ключами и ограничениями уникальности, создаются при условии, что они уже определены в опубликованной таблице.|  
|**0x20**|Преобразует определяемые пользователем типы данных (UDT) в базовые типы данных подписчика. Этот параметр не может использоваться, если на столбец UDT наложено ограничение CHECK или DEFAULT, если столбец UDT является частью первичного ключа или если вычисляемый столбец ссылается на столбец UDT.|  
|**0x40**|Создает соответствующие некластеризованные индексы. Даже если этот параметр не установлен, индексы, связанные с первичными ключами и ограничениями уникальности, создаются при условии, что они уже определены в опубликованной таблице.|  
|**0x80**|Реплицирует ограничения PRIMARY KEY. Все индексы, связанные с ограничением, также реплицируются, даже если параметры **0x10** и **0x40** не включены.|  
|**0x100**|Реплицирует пользовательские триггеры для статьи таблицы, если заданы.|  
|**0x200**|Реплицирует ограничения FOREIGN KEY. Если таблица, к которой происходит обращение, не является частью публикации, все ограничения FOREIGN KEY в опубликованной таблице не реплицируются.|  
|**0x400**|Реплицирует ограничения CHECK.|  
|**0x800**|Реплицирует значения по умолчанию.|  
|**0x1000**|Реплицирует параметры сортировки на уровне столбцов.|  
|**0x2000**|Реплицирует расширенные свойства, связанные с исходным объектом опубликованной статьи.|  
|**0x4000**|Реплицирует ограничения UNIQUE. Все индексы, связанные с ограничением, также реплицируются, даже если параметры **0x10** и **0x40** не включены.|  
|**0x8000**|Данный параметр недопустим для издателей, использующих [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] или более поздние версии.|  
|**0x10000**|Реплицирует ограничения CHECK как NOT FOR REPLICATION, чтобы они не применялись при синхронизации.|  
|**0x20000**|Реплицирует ограничения FOREIGN KEY как NOT FOR REPLICATION, чтобы они не применялись при синхронизации.|  
|**0x40000**|Реплицирует файловые группы, связанные с секционированной таблицей или индексом.|  
|**0x80000**|Реплицирует схему секционирования для секционированной таблицы.|  
|**0x100000**|Реплицирует схему секционирования для секционированного индекса.|  
|**0x200000**|Реплицирует статистику таблицы.|  
|**0x400000**|Реплицирует привязки к значениям по умолчанию.|  
|**0x800000**|Реплицирует привязки к правилам.|  
|**0x1000000**|Реплицирует полнотекстовый индекс.|  
|**0x2000000**|Коллекции XML-схем, привязанные к **XML-** столбцам, не реплицируются.|  
|**0x4000000**|Реплицирует индексы по **XML-** столбцам.|  
|**0x8000000**|Создает любые схемы, кроме уже существующих на подписчике.|  
|**0x10000000**|Преобразует **XML-** столбцы в **ntext** на подписчике.|  
|**0x20000000**|Преобразует типы данных больших объектов (**nvarchar (max)**, **varchar (max)** и **varbinary (max)**), введенные в [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] , в типы данных, поддерживаемые в [!INCLUDE[ssVersion2000](../../includes/ssversion2000-md.md)] .|  
|**0x40000000**|Реплицирует разрешения.|  
|**0x80000000**|Пытается удалять зависимости для всех объектов, не входящих в публикацию.|  
|**0x100000000**|Используйте этот параметр, чтобы реплицировать атрибут FILESTREAM, если он указан в столбцах типа **varbinary (max)** . Не указывайте этот параметр, если выполняется репликация таблиц на подписчики [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)]. Репликация таблиц, которые имеют столбцы FILESTREAM для [!INCLUDE[ssVersion2000](../../includes/ssversion2000-md.md)] подписчиков, не поддерживается независимо от того, как задан этот параметр схемы. См. соответствующий параметр **0x800000000**.|  
|**0x200000000**|Преобразует типы данных даты и времени (**Date**, **time**, **DateTimeOffset** и **datetime2**), появившиеся в, в [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] типы данных, которые поддерживаются в более ранних версиях [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .|  
|**0x400000000**|Проводит репликацию параметра сжатия для данных и индексов. Дополнительные сведения см. в разделе [Data Compression](../../relational-databases/data-compression/data-compression.md).|  
|**0x800000000**|Задайте этот параметр для сохранения данных атрибута FILESTREAM в его файловой группе на подписчике. Если этот параметр не задан, данные атрибута FILESTREAM сохраняются в файловой группе по умолчанию. Репликация не создает файловые группы, поэтому, если этот параметр задан, необходимо создать файловую группу до применения моментального снимка на подписчике. Дополнительные сведения о создании объектов перед применением моментального снимка см. [в разделе Выполнение скриптов до и после применения моментального](../../relational-databases/replication/snapshot-options.md#execute-scripts-before-and-after-snapshot-is-applied)снимка.<br /><br /> См. соответствующий параметр **0x100000000**.|  
|**0x1000000000**|Преобразует определяемые пользователем типы среды CLR в тип **varbinary (max)** , чтобы столбцы типа UDT могли реплицироваться на подписчики, на которых выполняется [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] .|  
|**0x2000000000**|Преобразует тип данных **hierarchyid** в **varbinary (max)** , чтобы столбцы типа **hierarchyid** могли реплицироваться на подписчики, на которых выполняется [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] . Дополнительные сведения об использовании столбцов **hierarchyid** в реплицированных таблицах см. в разделе [hierarchyid &#40;Transact-SQL&#41;](../../t-sql/data-types/hierarchyid-data-type-method-reference.md).|  
|**0x4000000000**|Проводит репликацию всех фильтруемых индексов для таблицы. Дополнительные сведения об фильтруемых индексах см. в разделе [CREATE Filtered indexes](../../relational-databases/indexes/create-filtered-indexes.md).|  
|**0x8000000000**|Преобразует типы данных **Geography** и **Geometry** в тип **varbinary (max)** , чтобы столбцы этих типов можно было реплицировать на подписчики, на которых выполняется [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] .|  
|**0x10000000000**|Реплицирует индексы по столбцам типа **Geography** и **Geometry**.|  
  
 Если это значение равно NULL, система автоматически создает допустимый параметр схемы для данной статьи. В таблице **параметров схемы по умолчанию** в разделе "Примечания" отображается значение, выбранное на основе типа статьи. Кроме того, не все значения *schema_option* допустимы для каждого типа репликации и типа статьи. В таблице **допустимых параметров схемы** , заданной в примечаниях, отображаются параметры, которые можно указать для данного типа статьи.  
  
> [!NOTE]  
>  Параметр *schema_option* влияет только на параметры репликации для исходного моментального снимка. После того как начальная схема сформирована агент моментальных снимков и применена на подписчике, репликация изменений схемы публикации на подписчик происходит на основе правил репликации изменений схемы и параметра *replicate_ddl* , указанного в [sp_addmergepublication](../../relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql.md). Дополнительные сведения см. в статье [Внесение изменений в схемы баз данных публикации](../../relational-databases/replication/publish/make-schema-changes-on-publication-databases.md).  
  
`[ @subset_filterclause = ] 'subset_filterclause'` Предложение WHERE, задающее горизонтальную фильтрацию статьи таблицы без слова WHERE. *subset_filterclause* имеет тип **nvarchar (1000)** и значение по умолчанию пустой строки.  
  
> [!IMPORTANT]  
>  По соображениям производительности не рекомендуется применять функции к именам столбцов в предложениях параметризованных фильтров строк, например `LEFT([MyColumn]) = SUSER_SNAME()`. При использовании [HOST_NAME](../../t-sql/functions/host-name-transact-sql.md) в предложении фильтра и переопределении значения HOST_NAME может потребоваться преобразовать типы данных с помощью функции [Convert](../../t-sql/functions/cast-and-convert-transact-sql.md). Дополнительные сведения о рекомендациях для этого случая см. в подразделе «Переопределение значения HOST_NAME ()» в [параметризованных фильтрах строк](../../relational-databases/replication/merge/parameterized-filters-parameterized-row-filters.md).  
  
`[ @article_resolver = ] 'article_resolver'` — Это сопоставитель на основе COM, используемый для разрешения конфликтов в статье таблицы или сборки платформа .NET Framework, вызванной для выполнения пользовательской бизнес-логики в статье таблицы. *article_resolver* имеет тип **varchar (255)** и значение по умолчанию NULL. Доступные значения для этого параметра перечислены в списке [!INCLUDE[msCoName](../../includes/msconame-md.md)] пользовательские арбитры конфликтов. Если указанное значение не является одним из [!INCLUDE[msCoName](../../includes/msconame-md.md)] арбитров конфликтов, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] использует указанный сопоставитель вместо арбитра, предоставляемого системой. Для перечисления списка доступных пользовательских арбитров конфликтов используйте **sp_enumcustomresolvers** . Дополнительные сведения см. в статьях [выполнение бизнес-логики во время синхронизации слиянием](../../relational-databases/replication/merge/execute-business-logic-during-merge-synchronization.md) и [Расширенное обнаружение и разрешение конфликтов при репликации слиянием](../../relational-databases/replication/merge/advanced-merge-replication-conflict-detection-and-resolution.md).  
  
`[ @resolver_info = ] 'resolver_info'` Используется для указания дополнительных сведений, необходимых пользовательскому распознавателю. Некоторым из сопоставителей конфликтов [!INCLUDE[msCoName](../../includes/msconame-md.md)] в качестве входного параметра требуется столбец. *resolver_info* имеет тип **nvarchar (255)** и значение по умолчанию NULL. Дополнительные сведения см. в статье [Сопоставители на базе технологии Microsoft COM](../../relational-databases/replication/merge/advanced-merge-replication-conflict-com-based-resolvers.md).  
  
`[ @source_owner = ] 'source_owner'` Имя владельца *source_object*. Аргумент *source_owner* имеет тип **sysname** и значение по умолчанию NULL. Если значение равно NULL, то предполагается, что владельцем является текущий пользователь.  
  
`[ @destination_owner = ] 'destination_owner'` Владелец объекта в базе данных подписки, если не является dbo. Аргумент *destination_owner* имеет тип **sysname** и значение по умолчанию NULL. Если значение аргумента равно NULL, то предполагается, что владельцем является dbo.  
  
`[ @vertical_partition = ] 'column_filter'` Включает и отключает фильтрацию столбцов для статьи таблицы. *vertical_partition* имеет тип **nvarchar (5)** и значение по умолчанию false.  
  
 **значение false** указывает, что вертикальная фильтрация не выполняется и публикуются все столбцы.  
  
 **значение true** очищает все столбцы, кроме объявленного первичного ключа и столбцов ROWGUID. Столбцы добавляются с помощью **sp_mergearticlecolumn**.  
  
`[ @auto_identity_range = ] 'automatic_identity_range'` Включает и отключает автоматическую обработку диапазона идентификаторов для этой статьи таблицы на момент создания публикации. *auto_identity_range* имеет тип **nvarchar (5)** и значение по умолчанию false. **значение true** включает автоматическую обработку диапазона идентификаторов, а **значение false** отключает ее.  
  
> [!NOTE]  
>  *auto_identity_range* является устаревшим и предоставляется только для обратной совместимости. Для указания параметров управления диапазонами идентификаторов следует использовать *identityrangemanagementoption* . Дополнительные сведения см. в статье [Репликация столбцов идентификаторов](../../relational-databases/replication/publish/replicate-identity-columns.md).  
  
`[ @pub_identity_range = ] pub_identity_range` Управляет размером диапазона идентификаторов, выделенного подписчику с серверной подпиской при использовании автоматического управления диапазонами идентификаторов. Этот диапазон идентификаторов резервируется переиздающему подписчику для выделения собственным подписчикам. *pub_identity_range* имеет тип **bigint** и значение по умолчанию NULL. Этот параметр необходимо указать, если *identityrangemanagementoption* имеет значение **Auto** , или если *auto_identity_range* равно **true**.  
  
`[ @identity_range = ] identity_range` Управляет размером диапазона идентификаторов, выделенного как издателю, так и подписчику при использовании автоматического управления диапазонами идентификаторов. *identity_range* имеет тип **bigint** и значение по умолчанию NULL. Этот параметр необходимо указать, если *identityrangemanagementoption* имеет значение **Auto** , или если *auto_identity_range* равно **true**.  
  
> [!NOTE]  
>  *identity_range* определяет размер диапазона идентификаторов при повторной публикации подписчиков с использованием предыдущих версий [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .  
  
`[ @threshold = ] threshold` Значение в процентах, определяющее, когда агент слияния назначает новый диапазон идентификаторов. При использовании процента значений, указанных в *пороговом значении* , агент слияния создает новый диапазон идентификаторов. *пороговое значение* — **int** и значение по умолчанию NULL. Этот параметр необходимо указать, если *identityrangemanagementoption* имеет значение **Auto** , или если *auto_identity_range* равно **true**.  
  
`[ @verify_resolver_signature = ] verify_resolver_signature` Указывает, проверяется ли цифровая подпись перед использованием распознавателя в репликации слиянием. *verify_resolver_signature* имеет **тип int** и значение по умолчанию 1.  
  
 **0** указывает, что подпись не будет проверена.  
  
 значение **1** указывает, что подпись будет проверена, чтобы узнать, является ли она доверенным источником.  
  
`[ @destination_object = ] 'destination_object'` Имя объекта в базе данных подписки. Аргумент *destination_object* имеет тип **sysname** и значение по умолчанию, равное значению в **\@ source_object**. Этот аргумент может быть указан только для статей типа «только схема», например для статей хранимых процедур, представлений или пользовательских функций. Если указанная статья является статьей таблицы, значение в *\@ source_object* переопределяет значение в *destination_object*.  
  
`[ @allow_interactive_resolver = ] 'allow_interactive_resolver'` Включает или отключает использование интерактивного арбитра конфликтов в статье. *allow_interactive_resolver* имеет тип **nvarchar (5)** и значение по умолчанию false. **значение true** разрешает использовать интерактивный сопоставитель в статье; **значение false** отключает его.  
  
> [!NOTE]  
>  Интерактивный сопоставитель конфликтов не поддерживается подписчиками [!INCLUDE[ssEW](../../includes/ssew-md.md)].  
  
`[ @fast_multicol_updateproc = ] 'fast_multicol_updateproc'` Этот параметр является устаревшим и поддерживается для обратной совместимости скриптов.  
  
`[ @check_permissions = ] check_permissions` Битовая карта разрешений уровня таблицы, которые проверяются, когда агент слияния применяет изменения к издателю. Если имя входа или пользовательская учетная запись на издателе, от имени которой выполняется процесс слияния, не обладает необходимыми разрешениями на таблицы, недопустимые изменения регистрируются в журнале как конфликты. *check_permissions* имеет **тип int** и может иметь значение [| (Побитовое или)](../../t-sql/language-elements/bitwise-or-transact-sql.md) произведение одного или нескольких из следующих значений.  
  
|Значение|Описание|  
|-----------|-----------------|  
|**0x00** (по умолчанию)|Разрешения не проверяются.|  
|**0x10**|Проверяет разрешения на издателе перед передачей операций вставки, выполняемых на подписчике.|  
|**0x20**|Проверяет разрешения на издателе перед передачей операций обновления, выполняемых на подписчике.|  
|**0x40**|Проверяет разрешения на издателе перед передачей операций удаления, выполняемых на подписчике.|  
  
`[ @force_invalidate_snapshot = ] force_invalidate_snapshot` Подтверждает, что действие, выполняемое этой хранимой процедурой, может сделать существующий моментальный снимок недействительным. *force_invalidate_snapshot* является **битом** и имеет значение по умолчанию 0.  
  
 **0** указывает, что добавление статьи не приводит к недействительности моментального снимка. Если хранимая процедура определяет, что изменение требует создания нового моментального снимка, возникает ошибка и изменения не выполняются.  
  
 **1** указывает, что добавление статьи может привести к недействительности моментального снимка, и если существуют подписки, для которых требуется новый моментальный снимок, предоставляет разрешение на пометку существующего моментального снимка как устаревшего и создание нового моментального снимка. *force_invalidate_snapshot* имеет значение **1** при добавлении статьи в публикацию с существующим моментальным снимком.  
  
`[ @published_in_tran_pub = ] 'published_in_tran_pub'` Указывает, что статья в публикации слиянием также публикуется в публикации транзакций. *published_in_tran_pub* имеет тип **nvarchar (5)** и значение по умолчанию false. **значение true** указывает, что статья также опубликована в публикации транзакций.  
  
`[ @force_reinit_subscription = ] force_reinit_subscription` Подтверждает, что действие, выполняемое этой хранимой процедурой, может потребовать повторной инициализации существующих подписок. *force_reinit_subscription* является **битом** и имеет значение по умолчанию 0.  
  
 **0** указывает, что добавление статьи не приводит к повторной инициализации подписки. Если хранимая процедура определяет, что изменения потребуют повторной инициализации подписок, возникает ошибка, и изменения не выполняются.  
  
 **1** означает, что изменения в статье слияния приводят к повторной инициализации существующих подписок и предоставляют разрешение на повторную инициализацию подписки. *force_reinit_subscription* имеет значение **1** , когда *subset_filterclause* задает параметризованный фильтр строк.  
  
`[ @logical_record_level_conflict_detection = ] 'logical_record_level_conflict_detection'` Задает уровень обнаружения конфликтов для статьи, которая является членом логической записи. *logical_record_level_conflict_detection* имеет тип **nvarchar (5)** и значение по умолчанию false.  
  
 **значение true** указывает, что конфликт будет обнаружен, если изменения вносятся в любом месте логической записи.  
  
 **значение false** указывает, что обнаружение конфликтов по умолчанию используется, как указано в *column_tracking*. Дополнительные сведения см. в статье [Группирование изменений в связанных строках с помощью логических записей](../../relational-databases/replication/merge/group-changes-to-related-rows-with-logical-records.md).  
  
> [!NOTE]  
>  Так как логические записи не поддерживаются [!INCLUDE[ssEW](../../includes/ssew-md.md)] подписчиками, необходимо указать значение **false** для *Logical_record_level_conflict_detection* для поддержки этих подписчиков.  
  
`[ @logical_record_level_conflict_resolution = ] 'logical_record_level_conflict_resolution'` Задает уровень разрешения конфликтов для статьи, которая является членом логической записи. *logical_record_level_conflict_resolution* имеет тип **nvarchar (5)** и значение по умолчанию false.  
  
 **значение true** указывает, что вся логическая запись, победившая выигрыш, перезаписывает потерянную логическую запись.  
  
 **значение false** указывает, что победившие строки не ограничиваются логической записью. Если *logical_record_level_conflict_detection* имеет **значение true**, то *logical_record_level_conflict_resolution* также должно иметь значение **true**. Дополнительные сведения см. в статье [Группирование изменений в связанных строках с помощью логических записей](../../relational-databases/replication/merge/group-changes-to-related-rows-with-logical-records.md).  
  
> [!NOTE]  
>  Так как логические записи не поддерживаются [!INCLUDE[ssEW](../../includes/ssew-md.md)] подписчиками, необходимо указать значение **false** для *Logical_record_level_conflict_resolution* для поддержки этих подписчиков.  
  
`[ @partition_options = ] partition_options` Определяет способ секционирования данных в статье, что позволяет оптимизировать производительность, когда все строки находятся только в одной секции или только в одной подписке. *partition_options* имеет тип **tinyint** и может принимать одно из следующих значений.  
  
|Значение|Описание|  
|-----------|-----------------|  
|**0** (по умолчанию)|Фильтрация для статьи либо статическая, либо не возвращает уникальное подмножество данных для каждой из секций, то есть перекрывающаяся секция.|  
|**1**|Секции перекрываются, и обновления языка обработки данных DML, выполняемые на подписчике, не могут изменить секцию, к которой принадлежит строка.|  
|**2**|Фильтрация для статьи дает неперекрывающиеся секции, но несколько подписчиков могут получить одну и ту же секцию.|  
|**3**|Фильтрация для статьи дает неперекрывающиеся секции, уникальные для каждой из подписок.|  
  
> [!NOTE]  
>  Если исходная таблица для статьи уже опубликована в другой публикации, то значение *partition_options* должно быть одинаковым для обеих статей.  
  
`[ @processing_order = ] processing_order` Указывает порядок обработки статей в публикации слиянием. *processing_order* имеет **тип int** и значение по умолчанию 0. **0** указывает, что статья не упорядочена, а любое другое значение представляет порядковое значение порядка обработки для этой статьи. Статьи обрабатываются по номерам, от меньших к большим. Если две статьи имеют одинаковое значение, порядок обработки определяется порядком псевдонима статьи в системной таблице [sysmergearticles](../../relational-databases/system-tables/sysmergearticles-transact-sql.md) . Дополнительные сведения см. в разделе [Указание свойств репликации слиянием](../../relational-databases/replication/merge/specify-merge-replication-properties.md).  
  
`[ @subscriber_upload_options = ] subscriber_upload_options` Определяет ограничения на обновления, сделанные на подписчике с клиентской подпиской. Дополнительные сведения см. в статье [Оптимизация производительности репликации слиянием при работе со статьями, доступными только для загрузки](../../relational-databases/replication/merge/optimize-merge-replication-performance-with-download-only-articles.md). *subscriber_upload_options* имеет тип **tinyint** и может принимать одно из следующих значений.  
  
|Значение|Описание|  
|-----------|-----------------|  
|**0** (по умолчанию)|Без ограничений. Изменения, произведенные на подписчике, передаются на издатель.|  
|**1**|Изменения на подписчике разрешены, но они не передаются на издатель.|  
|**2**|Изменения на подписчике не разрешены.|  
  
 Для изменения *subscriber_upload_options* требуется повторная инициализация подписки путем вызова [sp_reinitmergepullsubscription &#40;Transact-SQL&#41;](../../relational-databases/system-stored-procedures/sp-reinitmergepullsubscription-transact-sql.md).  
  
> [!NOTE]  
>  Если исходная таблица для статьи уже опубликована в другой публикации, то значение *subscriber_upload_options* должно быть одинаковым для обеих статей.  
  
`[ @identityrangemanagementoption = ] identityrangemanagementoption` Указывает способ обработки управления диапазонами идентификаторов для статьи. *identityrangemanagementoption* имеет тип **nvarchar (10)** и может принимать одно из следующих значений.  
  
|Значение|Описание|  
|-----------|-----------------|  
|**Нет**|Запрещает управление диапазонами идентификаторов.|  
|**Вручную**|Помечает столбец идентификаторов как NOT FOR REPLICATION, чтобы разрешить ручное управление диапазонами идентификаторов.|  
|**auto**|Задает автоматическое управление диапазонами идентификаторов.|  
|NULL (по умолчанию)|Если значение *auto_identity_range* не равно **true**, по умолчанию используется **None**.|  
  
 Для обеспечения обратной совместимости, если значение *identityrangemanagementoption* равно null, проверяется значение *auto_identity_range* . Однако если значение *identityrangemanagementoption* не равно null, значение *auto_identity_range* игнорируется. Дополнительные сведения см. в статье [Репликация столбцов идентификаторов](../../relational-databases/replication/publish/replicate-identity-columns.md).  
  
`[ @delete_tracking = ] 'delete_tracking'` Указывает, реплицируются ли операции удаления. *delete_tracking* имеет тип **nvarchar (5)** и значение по умолчанию true. **значение false** указывает, что операции удаления не реплицируются, а **значение true** указывает на то, что операции удаления реплицируются, что является обычным поведением для репликации слиянием. Если *delete_tracking* имеет значение **false**, строки, удаленные на стороне подписчика, должны быть вручную удалены на издателе, а строки, удаленные на издателе, должны быть удалены вручную на подписчике.  
  
> [!IMPORTANT]  
>  Установка значения **false** для *delete_tracking* приводит к неконвергенции. Если исходная таблица для статьи уже опубликована в другой публикации, то значение *delete_tracking* должно быть одинаковым для обеих статей.  
  
> [!NOTE]  
>  параметры *delete_tracking* не могут быть заданы с помощью **мастера создания публикаций** или диалогового окна « **Свойства публикации** ».  
  
`[ @compensate_for_errors = ] 'compensate_for_errors'` Указывает, выполняются ли компенсирующие действия при обнаружении ошибок во время синхронизации. *compensate_for_errors i* **nvarchar (5)** и значение по умолчанию false. Если задано **значение true**, изменения, которые не могут быть применены на подписчике или издателе во время синхронизации, всегда ведут к компенсирующих действиям для отмены изменений. Однако один неправильно настроенный подписчик, создающий ошибку, может вызвать отмену изменений на других подписчиках и издателях. **значение false** отключает эти компенсирующие действия, однако ошибки по-прежнему регистрируются с помощью компенсации, и последующие слияния продолжают пытаться применить изменения до успешного выполнения.  
  
> [!IMPORTANT]  
>  Даже если в данных в измененных строках отсутствует конвергенция, то, если исправить все ошибки, изменения можно применить и добиться конвергенции данных. Если исходная таблица для статьи уже опубликована в другой публикации, то значение *compensate_for_errors* должно быть одинаковым для обеих статей.  
  
`[ @stream_blob_columns = ] 'stream_blob_columns'` Указывает, что при репликации столбцов больших двоичных объектов следует использовать оптимизацию потока данных. *stream_blob_columns* имеет тип **nvarchar (5)** и значение по умолчанию false. **значение true** означает, что будет предпринята повторная оптимизация. *stream_blob_columns* имеет значение true, если включен FILESTREAM. Это позволяет оптимально выполнять репликацию данных FILESTREAM и уменьшить использование памяти. Чтобы заставить статьи таблицы FILESTREAM не использовать потоковую передачу BLOB-объектов, используйте **sp_changemergearticle** , чтобы присвоить *stream_blob_columns* значение false.  
  
> [!IMPORTANT]  
>  Включение данного режима оптимизации памяти может уменьшить производительность агента слияния во время синхронизации. Этот параметр должен использоваться только при репликации столбцов, содержащих мегабайты данных.  
  
> [!NOTE]  
>  Некоторые функциональные возможности репликации слиянием, такие как логические записи, по-прежнему могут препятствовать применению оптимизации потока при репликации больших двоичных объектов, даже если для *stream_blob_columns* задано значение **true**.  
  
## <a name="return-code-values"></a>Значения кода возврата  
 0 (успешное завершение) или 1 (неуспешное завершение)  
  
## <a name="remarks"></a>Замечания  
 **sp_addmergearticle** используется в репликации слиянием.  
  
 При публикации объектов их определения копируются на подписчики. При публикации объекта базы данных, который зависит от одного или нескольких других объектов, обязательна публикация всех объектов, на которые он ссылается. Например, при публикации представления, зависящего от таблицы, необходимо также опубликовать и таблицу.  
  
 Если для *partition_options* указано значение **3** , то для каждой секции данных в этой статье может существовать только одна подписка. Если создается вторая подписка, в которой условие фильтрации сводится к той же секции, что и в существующей подписке, то существующая подписка удаляется.  
  
 При указании значения 3 для *partition_options* метаданные очищаются при каждом запуске агент слияния, а срок действия секционированного моментального снимка истекает быстрее. При использовании этого параметра следует разрешить запрошенный подписчиком секционированный снимок. Дополнительные сведения см. в статье [Snapshots for Merge Publications with Parameterized Filters](../../relational-databases/replication/create-a-snapshot-for-a-merge-publication-with-parameterized-filters.md).  
  
 Добавление статьи со статическим горизонтальным фильтром с помощью *subset_filterclause* к существующей публикации с статьями с параметризованными фильтрами требует повторной инициализации подписок.  
  
 При указании *processing_order* рекомендуется использовать зазоры между значениями порядка статей, что упрощает задание новых значений в будущем. Например, если у вас есть три статьи Article1, Article2 и Article3, установите *processing_order* равными 10, 20 и 30, а не 1, 2 и 3. Дополнительные сведения см. в разделе [Указание свойств репликации слиянием](../../relational-databases/replication/merge/specify-merge-replication-properties.md).  
  
## <a name="default-schema-option-table"></a>Таблица «Параметры схемы по умолчанию»  
 В этой таблице описывается значение по умолчанию, которое задается хранимой процедурой, если для *schema_option* задано значение null, которое зависит от типа статьи.  
  
|Тип статьи|Значение параметра схемы|  
|------------------|-------------------------|  
|**func schema only**|**0x01**|  
|**indexed view schema only**|**0x01**|  
|**proc schema only**|**0x01**|  
|**table**|**0x0C034FD1**  -  [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] и более поздние совместимые публикации с моментальным снимком в собственном режиме.<br /><br /> **0x08034FF1**  -  [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] и более поздние совместимые публикации с моментальным снимком символьного режима.|  
|**view schema only**|**0x01**|  
  
> [!NOTE]  
>  Если публикация поддерживает более ранние версии [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , параметр схемы по умолчанию для **Table** имеет значение **0x30034FF1**.  
  
## <a name="valid-schema-option-table"></a>Таблица «Допустимые параметры схемы»  
 В следующей таблице описаны допустимые значения *schema_option* в зависимости от типа статьи.  
  
|Тип статьи|Значения параметра схемы|  
|------------------|--------------------------|  
|**func schema only**|**0x01** и **0x2000**|  
|**indexed view schema only**|**0x01**, **0x040**, **0x0100**, **0x2000**, **0x40000**, **0x1000000** и **0x200000**|  
|**proc schema only**|**0x01** и **0x2000**|  
|**table**|Все параметры.|  
|**view schema only**|**0x01**, **0x040**, **0x0100**, **0x2000**, **0x40000**, **0x1000000** и **0x200000**|  
  
## <a name="example"></a>Пример  
 [!code-sql[HowTo#sp_AddMergeArticle](../../relational-databases/replication/codesnippet/tsql/sp-addmergearticle-trans_1.sql)]  
  
## <a name="permissions"></a>Разрешения  
 Необходимо быть членом предопределенной роли сервера **sysadmin** или предопределенной роли базы данных **db_owner** .  
  
## <a name="see-also"></a>См. также:  
 [Define an Article](../../relational-databases/replication/publish/define-an-article.md)   
 [Публикация данных и объектов базы данных](../../relational-databases/replication/publish/publish-data-and-database-objects.md)   
 [Репликация столбцов идентификаторов](../../relational-databases/replication/publish/replicate-identity-columns.md)   
 [sp_changemergearticle (Transact-SQL)](../../relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql.md)   
 [sp_dropmergearticle (Transact-SQL)](../../relational-databases/system-stored-procedures/sp-dropmergearticle-transact-sql.md)   
 [sp_helpmergearticle (Transact-SQL)](../../relational-databases/system-stored-procedures/sp-helpmergearticle-transact-sql.md)   
 [Хранимые процедуры репликации (Transact-SQL)](../../relational-databases/system-stored-procedures/replication-stored-procedures-transact-sql.md)  
  
  
