---
description: sp_changepublication (Transact-SQL)
title: sp_changepublication (Transact-SQL) | Документация Майкрософт
ms.custom: ''
ms.date: 08/29/2017
ms.prod: sql
ms.prod_service: database-engine
ms.reviewer: ''
ms.technology: replication
ms.topic: reference
f1_keywords:
- sp_changepublication
- sp_changepublication_TSQL
helpviewer_keywords:
- sp_changepublication
ms.assetid: c36e5865-25d5-42b7-b045-dc5036225081
author: markingmyname
ms.author: maghan
ms.openlocfilehash: a0e183d97b17936d5d7e1b414c2d492910a8a8b3
ms.sourcegitcommit: 33f0f190f962059826e002be165a2bef4f9e350c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/30/2021
ms.locfileid: "99207076"
---
# <a name="sp_changepublication-transact-sql"></a>sp_changepublication (Transact-SQL)
[!INCLUDE [SQL Server SQL MI](../../includes/applies-to-version/sql-asdbmi.md)]

  Изменяет свойства публикации. Эта хранимая процедура выполняется на издателе в базе данных публикации.  
  
 ![Значок ссылки на раздел](../../database-engine/configure-windows/media/topic-link.gif "Значок ссылки на раздел") [Синтаксические обозначения в Transact-SQL](../../t-sql/language-elements/transact-sql-syntax-conventions-transact-sql.md)  
  
## <a name="syntax"></a>Синтаксис  
  
```  
sp_changepublication [ [ @publication = ] 'publication' ]  
    [ , [ @property = ] 'property' ]  
    [ , [ @value = ] 'value' ]  
    [ , [ @force_invalidate_snapshot = ] force_invalidate_snapshot ]  
    [ , [ @force_reinit_subscription = ] force_reinit_subscription ]  
    [ , [ @publisher = ] 'publisher' ]  
```  
  
## <a name="arguments"></a>Аргументы  
`[ @publication = ] 'publication'` Имя публикации. Аргумент *publication* имеет тип **sysname** и значение по умолчанию NULL.  
  
`[ @property = ] 'property'` Изменяемое свойство публикации. *свойство* имеет тип **nvarchar (255)**.  
  
`[ @value = ] 'value'` Новое значение свойства. *value* имеет тип **nvarchar (255)** и значение по умолчанию NULL.  
  
 В данной таблице описаны свойства публикации, доступные для изменения, а также ограничения на значения этих свойств.  
  
|Свойство|Значение|Описание|  
|--------------|-----------|-----------------|  
|**allow_anonymous**|**true**|Для данной публикации можно создать анонимные подписки, а *immediate_sync* также должны иметь **значение true**. Невозможно изменить для одноранговых публикаций.|  
||**false**|На данную публикацию нельзя создавать анонимные подписки. Невозможно изменить для одноранговых публикаций.|  
|**allow_initialize_from_backup**|**true**|Подписчики могут инициализировать подписку на эту публикацию из резервной копии, а не из исходного моментального снимка. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
||**false**|Подписчики должны использовать исходный моментальный снимок. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|**allow_partition_switch**|**true**|ИЗМЕНИТЬ ТАБЛИЦУ... Операторы SWITCH можно выполнять в опубликованной базе данных. Дополнительные сведения см. в статье [Replicate Partitioned Tables and Indexes](../../relational-databases/replication/publish/replicate-partitioned-tables-and-indexes.md) (Репликация секционированных таблиц и индексов).|  
||**false**|ИЗМЕНИТЬ ТАБЛИЦУ... Невозможно выполнить инструкции SWITCH для опубликованной базы данных.|  
|**allow_pull**|**true**|Подписки по запросу на данную публикацию разрешены. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
||**false**|Подписки по запросу на данную публикацию не разрешены. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|**allow_push**|**true**|Принудительные подписки на данную публикацию разрешены.|  
||**false**|Принудительные подписки на данную публикацию не разрешены.|  
|**allow_subscription_copy**|**true**|Включает возможность копирования баз данных, подписанных на эту публикацию. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
||**false**|Отключает возможность копирования баз данных, подписанных на эту публикацию. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|**alt_snapshot_folder**||Расположение альтернативной папки для моментального снимка.|  
|**centralized_conflicts**|**true**|Конфликтующие записи хранятся на издателе. Можно изменить только в том случае, если нет активных подписок. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
||**false**|Конфликтные записи хранятся как на издателе, так и на подписчике, вызвавшем конфликт. Можно изменить только в том случае, если нет активных подписок. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|**compress_snapshot**|**true**|Моментальный снимок в альтернативной папке моментальных снимков сжимается в формате CAB. Сжатие моментального снимка в папке моментальных снимков по умолчанию невозможно.|  
||**false**|Моментальный снимок не сжат, это режим по умолчанию для репликации.|  
|**conflict_policy**|**pub wins**|Политика устранения конфликтов, возникающих при обновлении подписчиков, когда преимущество имеет издатель. Это свойство можно изменить только при отсутствии активных подписок. Не поддерживается для издателей Oracle.|  
||**sub reinit**|Для обновления подписчиков. Если происходит конфликт, подписку необходимо инициализировать повторно. Это свойство можно изменить только при отсутствии активных подписок. Не поддерживается для издателей Oracle.|  
||**sub wins**|Политика устранения конфликтов, возникающих при обновлении подписчиков, при которой преимущество имеет подписчик. Это свойство можно изменить только при отсутствии активных подписок. Не поддерживается для издателей Oracle.|  
|**conflict_retention**||**целое** число, указывающее срок хранения конфликтов в днях. Значение по умолчанию — 14 суток. значение **0** означает, что очистка конфликтов не требуется. Не поддерживается для издателей Oracle.|  
|**description**||Необязательная запись описания публикации.|  
|**enabled_for_het_sub**|**true**|Позволяет публикации поддерживать подписчиков, не являющихся подписчиками [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. **enabled_for_het_sub** нельзя изменить при наличии подписок на публикацию. Возможно, потребуется выполнить [хранимые процедуры репликации (Transact-SQL)](../../relational-databases/system-stored-procedures/sp-changepublication-transact-sql.md) , чтобы обеспечить соблюдение следующих требований перед установкой **enabled_for_het_sub** в значение true:<br /> - значение **allow_queued_tran** должно быть **равно false**.<br /> - значение **allow_sync_tran** должно быть **равно false**.<br /> Изменение значения **enabled_for_het_sub** на **true** может привести к изменению существующих параметров публикации. Дополнительные сведения см. в статье [Non-SQL Server Subscribers](../../relational-databases/replication/non-sql/non-sql-server-subscribers.md). Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
||**false**|Публикация не поддерживает подписчиков, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|**enabled_for_internet**|**true**|Публикация через Интернет разрешена, поэтому для передачи файлов моментальных снимков подписчику может быть использован протокол FTP. Файлы синхронизации для публикации помещаются в следующий каталог: C:\Program Files\Microsoft SQL Сервер\мсскл\реплдата\фтп. *ftp_address* не может иметь значение null. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
||**false**|Публикация через Интернет не разрешена. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|**enabled_for_p2p**|**true**|Публикация поддерживает одноранговую репликацию. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].<br /> Чтобы задать  для enabled_for_p2p **значение true**, применяются следующие ограничения.<br /> - значение **allow_anonymous** должно быть **равно false**<br /> - значение **allow_dts** должно быть **равно false**.<br /> - значение **allow_initialize_from_backup** должно быть **true**<br /> - значение **allow_queued_tran** должно быть **равно false**.<br /> - значение **allow_sync_tran** должно быть **равно false**.<br /> - значение **enabled_for_het_sub** должно быть **равно false**.<br /> - значение **independent_agent** должно быть **true**.<br /> - **repl_freq** должны быть **непрерывными**.<br /> - **replicate_ddl** должен быть равен **1**.|  
||**false**|Публикация не поддерживает одноранговую репликацию. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|**ftp_address**||Доступное по протоколу FTP расположение файлов моментальных снимков публикации. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|**ftp_login**||Имя пользователя, используемое для подключения к службе FTP, и значение ANONYMOUS, если оно разрешено. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|**ftp_password**||Пароль для имени пользователя при подключении к службе FTP. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|**ftp_port**||Номер порта службы FTP для распространителя. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|**ftp_subdirectory**||Указывает, где создаются файлы моментальных снимков, если публикация поддерживает распространение моментальных снимков по протоколу FTP. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|**immediate_sync**|**true**|Файлы синхронизации для публикации создаются или повторно создаются при каждом выполнении агента моментальных снимков. Подписчики могут получать файлы синхронизации сразу после подписки, если агент моментальных снимков завершил работу перед подпиской. Новые подписки получают самые свежие файлы синхронизации, сформированные при последнем выполнении агента моментальных снимков. *independent_agent* также должно иметь **значение true**. Дополнительные сведения о **immediate_sync** см. в разделе "Примечания".|  
||**false**|Файлы синхронизации создаются только для новых подписок. Подписчики могут получать файлы синхронизации после подписки при условии, что агент моментальных снимков был запущен и завершил работу.|  
|**independent_agent**|**true**|Публикация имеет собственный выделенный агент распространителя.|  
||**false**|Публикация использует общий агент распространителя, а каждая пара баз данных публикации и подписки имеет общий агент.|  
|**p2p_continue_onconflict**|**true**|Агент распространителя продолжает обрабатывать изменения при обнаружении конфликта.<br /> **Внимание!** Рекомендуется использовать значение по умолчанию `FALSE` . Если этот параметр имеет значение `TRUE` , агент распространения пытается выполнить согласование данных в топологии, применяя конфликтующую строку из узла с наибольшим идентификатором инициатора. Этот метод не гарантирует конвергенции. После обнаружения конфликта следует убедиться, что топология остается согласованной. Дополнительные сведения см. в подразделе «Обработка конфликтов» раздела [Conflict Detection in Peer-to-Peer Replication](../../relational-databases/replication/transactional/peer-to-peer-conflict-detection-in-peer-to-peer-replication.md).|  
||**false**|Агент распространителя прекращает обрабатывать изменения при обнаружении конфликта.|  
|**post_snapshot_script**||Указывает расположение файла скрипта на языке [!INCLUDE[tsql](../../includes/tsql-md.md)], который агент распространителя запускает после применения всех остальных скриптов и данных объектов репликации во время исходной синхронизации.|  
|**pre_snapshot_script**||Указывает расположение файла скрипта на языке [!INCLUDE[tsql](../../includes/tsql-md.md)], который агент распространителя запускает перед применением всех остальных скриптов и данных объектов репликации во время исходной синхронизации.|  
|**publish_to_ActiveDirectory**|**true**|Этот аргумент устарел и поддерживается только для обратной совместимости скриптов. Больше нельзя добавлять данные публикации в службу [!INCLUDE[msCoName](../../includes/msconame-md.md)] Active Directory.|  
||**false**|Удаляет сведения о публикации из службы Active Directory.|  
|**queue_type**|**sql**|Для хранения транзакций используется [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Это свойство можно изменить только при отсутствии активных подписок.<br /><br /> Примечание. Поддержка использования [!INCLUDE[msCoName](../../includes/msconame-md.md)] очереди сообщений была прекращена. Указание значения **MSMQ** для *value* приводит к ошибке.|  
|**repl_freq**|**обеспечения**|Публикует выход всех транзакций, основанных на журнале.|  
||**обновляем**|Публикует только запланированные события синхронизации.|  
|**replicate_ddl**|**1**|Реплицируются инструкции языка определения данных (DDL), которые выполняются на издателе. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
||**0**|Репликация инструкций DDL не производится. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Невозможно отключить репликацию изменений схемы при использовании одноранговой репликации.|  
|**replicate_partition_switch**|**true**|ИЗМЕНИТЬ ТАБЛИЦУ... Инструкции SWITCH, которые выполняются в опубликованной базе данных, должны реплицироваться на подписчики. Этот параметр допустим, только если *allow_partition_switch* имеет значение true. Дополнительные сведения см. в статье [Replicate Partitioned Tables and Indexes](../../relational-databases/replication/publish/replicate-partitioned-tables-and-indexes.md) (Репликация секционированных таблиц и индексов).|  
||**false**|ИЗМЕНИТЬ ТАБЛИЦУ... Операторы SWITCH не должны реплицироваться на подписчики.|  
|**хранения**||**целое** число, представляющее срок хранения в часах для действия подписки. Если подписка не активна в течение указанного срока хранения, она удаляется.|  
|**snapshot_in_defaultfolder**|**true**|Файлы моментального снимка сохранены в папке для моментальных снимков по умолчанию. Если также указан параметр *alt_snapshot_folder*, файлы моментальных снимков хранятся как в расположениях по умолчанию, так и в альтернативных.|  
||**false**|Файлы моментальных снимков хранятся в альтернативном расположении, заданном *alt_snapshot_folder*.|  
|**status**|**active**|Данные публикации становятся доступными подписчику сразу после создания публикации. Не поддерживается для издателей Oracle.|  
||**inactive**|Данные публикации недоступны подписчику сразу после создания публикации. Не поддерживается для издателей Oracle.|  
|**sync_method**|**native**|При синхронизации подписок выполняется массовое копирование таблиц в собственном режиме.|  
||**character**|При синхронизации подписок выполняется массовое копирование таблиц в символьном режиме.|  
||**одновременных**|Используется собственный программный вывод для массового копирования всех таблиц, не блокирующий таблицы во время формирования моментальных снимков. Недопустимо для репликации моментальных снимков.|  
||**concurrent_c**|Используется символьный программный вывод для массового копирования всех таблиц, не блокирующий таблицы во время формирования моментальных снимков. Недопустимо для репликации моментальных снимков.|  
|**taskid**||Это свойство устарело и больше не поддерживается.|  
|**allow_drop**|**true**|Включает `DROP TABLE` поддержку DLL для статей, которые являются частью репликации транзакций. Минимальная поддерживаемая версия: [!INCLUDE[ssSQL14](../../includes/sssql14-md.md)] с пакетом обновления 2 или выше, с [!INCLUDE[ssSQL15](../../includes/sssql16-md.md)] пакетом обновления 1 или более поздней версии. Дополнительная ссылка: [KB 3170123](https://support.microsoft.com/help/3170123/supports-drop-table-ddl-for-articles-that-are-included-in-transactional-replication-in-sql-server-2014-or-in-sql-server-2016-sp1)|
||**false**|Отключает `DROP TABLE` поддержку библиотек DLL для статей, которые являются частью репликации транзакций. Это значение **по умолчанию** для этого свойства.|
|**Null** (по умолчанию)||Возвращает список поддерживаемых значений для *Свойства*.|  
  
`[ @force_invalidate_snapshot = ] force_invalidate_snapshot` Подтверждает, что действие, выполняемое этой хранимой процедурой, может сделать существующий моментальный снимок недействительным. *force_invalidate_snapshot* является **битом** и имеет значение по умолчанию **0**.  
  - **0** указывает, что изменения в статье не приводят к недействительности моментального снимка. Если хранимая процедура определяет, что изменение требует создания нового моментального снимка, возникает ошибка и изменения не выполняются.  
  - **1** указывает, что изменения в статье могут привести к недействительности моментального снимка. Если имеются подписки, требующие нового моментального снимка, это значение дает разрешение пометить существующий моментальный снимок как устаревший и сформировать новый моментальный снимок.   
Сведения о свойствах, при изменении которых требуется формирование нового моментального снимка, см. в разделе «Примечания».  
  
[**@force_reinit_subscription =** ] *force_reinit_subscription*  
 Подтверждает, что действие, выполняемое данной хранимой процедурой, может сделать необходимой повторную инициализацию текущих подписок. *force_reinit_subscription* является **битом** со значением по умолчанию **0**.  
  - **0** указывает, что изменения в статье не приводят к повторной инициализации подписки. Если хранимая процедура определяет, что изменения потребуют повторной инициализации подписок, возникает ошибка, и изменения не выполняются.  
  - **1** указывает, что изменения в статье приводят к повторной инициализации существующей подписки и предоставляют разрешение на повторную инициализацию подписки.  
  
`[ @publisher = ] 'publisher'` Указывает издателя, отличного от [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Аргумент *Publisher* имеет тип **sysname** и значение по умолчанию NULL.  
  
  > [!NOTE]  
  >  При изменении свойств статьи издателя не следует использовать *Издатель* [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .  
  
## <a name="return-code-values"></a>Значения кода возврата  
 **0** (успешное завершение) или **1** (сбой)  
  
## <a name="remarks"></a>Замечания  
 **sp_changepublication** используется в репликации моментальных снимков и репликации транзакций.  
  
 После изменения любого из следующих свойств необходимо создать новый моментальный снимок, а для параметра *force_invalidate_snapshot* необходимо указать значение **1** .  
-   **alt_snapshot_folder**  
-   **compress_snapshot**  
-   **enabled_for_het_sub**  
-   **ftp_address**  
-   **ftp_login**  
-   **ftp_password**  
-   **ftp_port**  
-   **ftp_subdirectory**  
-   **post_snapshot_script**  
-   **pre_snapshot_script**  
-   **snapshot_in_defaultfolder**  
-   **sync_mode**  
  
Чтобы получить список объектов публикации в Active Directory с помощью параметра **publish_to_active_directory** , этот [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] объект уже должен быть создан в Active Directory.  
  
## <a name="impact-of-immediate-sync"></a>Влияние свойства «immediate sync»  
 При включенном свойстве «immediate sync» все изменения отслеживаются в журнале сразу же после создания исходного моментального снимка, даже если отсутствуют подписки. Зарегистрированные изменения используются, когда клиент использует резервное копирование для добавления нового однорангового узла. После восстановления резервной копии одноранговые узлы синхронизируются с другими изменениями, происходящими после создания резервной копии. Так как команды отправляются в базу данных распространителя, логика синхронизации может просмотреть последний зарезервированный номер LSN и использовать его в качестве отправной точки, зная, что команда доступна, если резервная копия была сделана в течение максимального срока хранения. (Значение по умолчанию для минимального срока хранения составляет 0 часов, а максимальный срок хранения — 24 часа.)  
  
 При выключенном свойстве «immediate sync» изменения сохраняются по меньшей мере на минимальный срок хранения и удаляются сразу же для всех реплицированных транзакций. Если свойство «immediate sync» отключено и настроено на срок хранения по умолчанию, скорее всего, необходимые изменения после создания резервной копии были очищены, а новый одноранговый узел не был инициализирован надлежащим образом. Остался единственный параметр — замораживание топологии. Установка свойства «immediate sync» в положение «включено» предоставляет большую гибкость и рекомендуется для репликации P2P.  
  
## <a name="example"></a>Пример  
 [!code-sql[HowTo#sp_changepublication](../../relational-databases/replication/codesnippet/tsql/sp-changepublication-tra_1.sql)]  
  
## <a name="permissions"></a>Разрешения  
 Только члены предопределенной роли сервера **sysadmin** или предопределенной роли базы данных **db_owner** могут выполнять **sp_changepublication**.  
  
## <a name="see-also"></a>См. также:  
 [Просмотр и изменение свойств публикации](../../relational-databases/replication/publish/view-and-modify-publication-properties.md)   
 [Изменение свойств публикации и статьи](../../relational-databases/replication/publish/change-publication-and-article-properties.md)   
 [sp_addpublication &#40;Transact-SQL&#41;](../../relational-databases/system-stored-procedures/sp-addpublication-transact-sql.md)   
 [sp_droppublication &#40;Transact-SQL&#41;](../../relational-databases/system-stored-procedures/sp-droppublication-transact-sql.md)   
 [sp_helppublication (Transact-SQL)](../../relational-databases/system-stored-procedures/sp-helppublication-transact-sql.md)   
 [Хранимые процедуры репликации (Transact-SQL)](../../relational-databases/system-stored-procedures/replication-stored-procedures-transact-sql.md)  
  
  
