---
description: sysmail_unsentitems (Transact-SQL)
title: sysmail_unsentitems (Transact-SQL) | Документация Майкрософт
ms.custom: ''
ms.date: 03/14/2017
ms.prod: sql
ms.prod_service: database-engine
ms.reviewer: ''
ms.technology: system-objects
ms.topic: language-reference
f1_keywords:
- sysmail_unsentitems_TSQL
- sysmail_unsentitems
dev_langs:
- TSQL
helpviewer_keywords:
- sysmail_unsentitems database mail view
ms.assetid: 993c12da-41e5-4e53-a188-0323feb70c67
author: WilliamDAssafMSFT
ms.author: wiassaf
ms.openlocfilehash: 0e8ffcc7ae60096de1b0355ed113ffb55e02e286
ms.sourcegitcommit: a9e982e30e458866fcd64374e3458516182d604c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/11/2021
ms.locfileid: "98100126"
---
# <a name="sysmail_unsentitems-transact-sql"></a>sysmail_unsentitems (Transact-SQL)
[!INCLUDE [SQL Server - ASDBMI](../../includes/applies-to-version/sql-asdbmi.md)]

  Содержит по одной строке для каждого Database Mail сообщения с **неотправленным** или **повторным** выполнением. Сообщения в неотправленном состоянии или состоянии повторной попытки все еще находятся в очереди и могут быть отправлены в любой момент. Сообщения могут иметь состояние " **неотправлено** " по следующим причинам.  
  
-   Сообщение является новым, и, хотя оно было поставлено в очередь сообщений, компонент Database Mail работает над другими сообщениями и еще не дошел до данного сообщения.  
  
-   Компонент Database Mail не запущен, и никакие сообщения не отправляются.  
  
 Сообщения могут иметь состояние **повтора** по следующим причинам.  
  
-   Компонент Database Mail совершил попытку отправки сообщения, но отсутствует связь с почтовым SMTP-сервером. Компонент Database Mail продолжит попытку отправки сообщения, используя другие учетные записи компонента Database Mail, назначенные профилю, который отправляет сообщение. Если ни одна из учетных записей не может отправить сообщение, Database Mail будет ждать времени, настроенного для параметра **"Задержка повторной попытки учетной записи"** , и попытаться снова отправить сообщение. Database Mail использует параметр **повторных попыток учетной записи** , чтобы определить, сколько раз следует попытаться отправить сообщение. Сообщения отправляют состояние **повтора** , пока Database Mail пытается отправить сообщение.  
  
 Используйте это представление, если хотите увидеть, сколько сообщений ожидает отправки и как долго они находятся в очереди. Обычно количество **неотправленных** сообщений будет низким. Проведите оценку производительности во время обычной работы, чтобы определить подходящее для данной конфигурации число сообщений в очереди.  
  
 Чтобы просмотреть все сообщения, обрабатываемые Database Mail, используйте [sysmail_allitems &#40;Transact-SQL&#41;](../../relational-databases/system-catalog-views/sysmail-allitems-transact-sql.md). Чтобы просмотреть только сообщения с состоянием сбоя, используйте [sysmail_faileditems &#40;Transact-SQL&#41;](../../relational-databases/system-catalog-views/sysmail-faileditems-transact-sql.md). Чтобы просмотреть только отправленные сообщения, используйте [sysmail_sentitems &#40;Transact-SQL&#41;](../../relational-databases/system-catalog-views/sysmail-sentitems-transact-sql.md).  
  
|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**mailitem_id**|**int**|Идентификатор почтового отправления в очереди почты.|  
|**profile_id**|**int**|Идентификатор профиля, использованного для передачи сообщения.|  
|**пользу**|**varchar(max)**|Электронные адреса получателей сообщения.|  
|**copy_recipients**|**varchar(max)**|Электронные адреса получателей копий сообщения.|  
|**blind_copy_recipients**|**varchar(max)**|Электронные адреса получателей копий сообщения, чьи имена не будут отображаться в заголовке сообщения.|  
|**subject**|**nvarchar (510)**|Строка темы сообщения.|  
|**body**|**varchar(max)**|Тело сообщения.|  
|**body_format**|**varchar (20)**|Формат тела сообщения. Возможные значения: **Text** и **HTML**.|  
|**importance**|**varchar (6)**|Параметр **важности** сообщения.|  
|**чувствительности**|**varchar (12)**|Параметр **чувствительности** сообщения.|  
|**file_attachments**|**varchar(max)**|Список имен файлов, разделенных точкой с запятой, который прикреплен к сообщению электронной почты.|  
|**attachment_encoding**|**varchar (20)**|Тип вложения.|  
|**запрос**|**varchar(max)**|Запрос, выполненный почтовой программой.|  
|**execute_query_database**|**sysname**|Контекст базы данных, в котором почтовая программа выполнила запрос.|  
|**attach_query_result_as_file**|**bit**|Если значение равно 0, результаты запроса были включены в тело сообщения после его содержимого. Если значение равно 1, результаты были возвращены в виде вложения.|  
|**query_result_header**|**bit**|Если значение равно 1, результаты запроса содержали заголовки столбцов. Если значение равно 0, результаты запроса не включали заголовков столбцов.|  
|**query_result_width**|**int**|Параметр **query_result_width** сообщения.|  
|**query_result_separator**|**char(1)**|Символ, используемый для разделения столбцов в выходных данных запроса.|  
|**exclude_query_output**|**bit**|Параметр **exclude_query_output** сообщения. Дополнительные сведения см. в разделе [sp_send_dbmail &#40;Transact-SQL&#41;](../../relational-databases/system-stored-procedures/sp-send-dbmail-transact-sql.md).|  
|**append_query_error**|**bit**|Параметр **append_query_error** сообщения. 0 означает, что компонент Database Mail не отсылает электронное сообщение, если в запросе содержится ошибка.|  
|**send_request_date**|**datetime**|Дата и время помещения сообщения в очередь почты.|  
|**send_request_user**|**sysname**|Пользователь, отправивший сообщение. Это пользовательский контекст процедуры компонента Database Mail, а не поле **from** сообщения.|  
|**sent_account_id**|**int**|Идентификатор учетной записи компонента Database Mail, используемой для отсылки этого сообщения. Всегда NULL для этого представления.|  
|**sent_status**|**varchar (8)**|Будет **отправлен** , если Database Mail не попытался отправить почту. Будет **повторяться, если Database Mail** не удалось отправить сообщение, но он повторит попытку.|  
|**sent_date**|**datetime**|Дата и время, когда компонент Database Mail последний раз пытался отправить сообщение. Имеет значение NULL, если компонент Database Mail не производил попытки отправки сообщения.|  
|**last_mod_date**|**datetime**|Дата и время последнего изменения строки.|  
|**last_mod_user**|**sysname**|Пользователь, внесший последнее изменение в строку.|  
  
## <a name="remarks"></a>Комментарии  
 При поиске и устранении неполадок в компоненте Database Mail это представление может помочь установить природу проблемы путем отображения числа ожидающих отправки сообщений и продолжительности их ожидания. Если в данный момент сообщения не отправляются, компонент Database Mail может быть не запущен или могут быть проблемы с сетью, что не позволяет компоненту связаться с SMTP-серверами. Если многие неотправленные сообщения имеют одинаковые **profile_id**, возможно, возникла проблема с SMTP-сервером. Попробуйте добавить дополнительные учетные записи в профиль. Если сообщения отправляются, но на ожидание в очереди тратится много времени, возможно, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] требуется больше ресурсов для обработки необходимого объема сообщений.  
  
## <a name="permissions"></a>Разрешения  
 Предоставлено предопределенной роли сервера **sysadmin** и роли базы данных **DatabaseMailUserRole** . При выполнении членом предопределенной роли сервера **sysadmin** в этом представлении отображаются все **неотправленные** или **повторные** сообщения. Все остальные пользователи видят только **неотправленные** и **повторно** отправленные сообщения.  
  
  
