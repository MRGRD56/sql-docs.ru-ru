---
title: Оптимизированная для памяти файловая группа | Документация Майкрософт
description: Узнайте, как создать оптимизированную для памяти файловую группу, которая содержит контейнеры для файлов данных и разностных файлов, прежде чем создавать оптимизированные для памяти таблицы в SQL Server.
ms.custom: ''
ms.date: 03/01/2017
ms.prod: sql
ms.prod_service: database-engine
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: 14106cc9-816b-493a-bcb9-fe66a1cd4630
author: markingmyname
ms.author: maghan
ms.openlocfilehash: ed269ebe81cb70feff22fd0d2c3e3bf006ccbc9c
ms.sourcegitcommit: dd36d1cbe32cd5a65c6638e8f252b0bd8145e165
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/08/2020
ms.locfileid: "89538005"
---
# <a name="the-memory-optimized-filegroup"></a>Оптимизированная для памяти файловая группа
 [!INCLUDE [SQL Server](../../includes/applies-to-version/sqlserver.md)]
  Для создания оптимизированных для памяти таблиц необходимо сначала создать оптимизированную для памяти файловую группу. Оптимизированная для памяти файловая группа содержит один или несколько контейнеров. В каждом контейнере содержатся файлы данных или разностных файлы (или и те и другие).  
  
 Даже если строки данных из таблиц `SCHEMA_ONLY` не сохраняются, а метаданные оптимизированных для памяти таблиц и компилированных в собственном коде хранимых процедур хранятся в традиционных каталогах, модулю [!INCLUDE[hek_2](../../includes/hek-2-md.md)] все равно требуется оптимизированная для памяти файловая группа для оптимизированных для памяти таблиц `SCHEMA_ONLY`, чтобы обеспечить согласованную работу баз данных, в которых есть оптимизированные для памяти таблицы.  
  
 В основе оптимизированной для памяти файловой группы лежит файловая группа FILESTREAM, но при этом имеются следующие отличия.  
  
-   Можно создать только одну оптимизированную для памяти файловую группу для одной базы данных. Необходимо явно пометить файловую группу как содержащую данные memory_optimized_data. Файловую группу можно создать при создании базы данных или же добавить ее позднее.  
  
    ```sql  
    ALTER DATABASE imoltp ADD FILEGROUP imoltp_mod CONTAINS MEMORY_OPTIMIZED_DATA  
    ```  
  
-   В файловую группу `MEMORY_OPTIMIZED_DATA` нужно добавить один или несколько контейнеров. Пример:  
  
    ```sql  
    ALTER DATABASE imoltp ADD FILE (name='imoltp_mod1', filename='c:\data\imoltp_mod1') TO FILEGROUP imoltp_mod  
    ```  
  
-   Для создания оптимизированной для памяти файловой группы не требуется включать файловый поток ([Включение и настройка FILESTREAM](../../relational-databases/blob/enable-and-configure-filestream.md)). Сопоставление с файловым потоком выполняется модулем [!INCLUDE[hek_2](../../includes/hek-2-md.md)] .  
  
-   В оптимизированную для памяти файловую группу можно добавлять новые контейнеры. Необходимость развернуть новый контейнер может возникнуть, когда требуется расширить хранилище, которое нужно надежной, оптимизированной для памяти таблице, а также для распределения ввода-вывода по нескольким контейнерам.  
  
-   Перемещение данных в оптимизированной для памяти файловой группе оптимизировано в конфигурации группы доступности AlwaysOn. В отличие от файлов FILESTREAM, которые отправляются во вторичные реплики, файлы контрольных точек (файлы данных и разностные файлы) из оптимизированной для памяти файловой группы не отправляются во вторичные реплики. Файлы данных и разностные файлы формируются на вторичной реплике с помощью журнала транзакций.  
  
Ниже приведены ограничения, применяемые к оптимизированной для памяти файловой группе:  
  
-   После использования оптимизированной для памяти файловой группы удалить ее можно только путем удаления базы данных. В рабочей среде возникновение необходимости в удалении оптимизированной для памяти файловой группы маловероятно.  
  
-   Невозможно удалить контейнер, который не является пустым, или перемещать пары, состоящие из файла данных и разностного файла, в другой контейнер в оптимизированной для памяти файловой группе.    
  
## <a name="configuring-a-memory-optimized-filegroup"></a>Настройка оптимизированной для памяти файловой группы  
Рекомендуется создать несколько контейнеров в оптимизированной для памяти файловой группе и разместить их на разных дисках, чтобы получить большую пропускную способность по потоковой передаче данных в память. 
 
При использовании нескольких контейнеров, размещенных на нескольких дисках, файлы данных и разностные файлы распределяются по контейнерам путем циклического перебора. Первый файл данных выделяется из первого контейнера, разностный файл — из следующего контейнера, после чего дальнейшее выделение производится таким же образом. Эта схема выделения позволяет равномерно распределять файлы данных и разностные файлы по контейнерам при наличии нечетного числа дисков, каждый из которых сопоставлен с одним контейнером. Однако при наличии четного числа дисков, каждый из которых сопоставлен с одним контейнером, хранилище может получиться несбалансированным, когда файлы данных будут сопоставляться с нечетными дисками, а разностные файлы — с четными. Для получения сбалансированного потока ввода-вывода при восстановлении рекомендуется размещать пары файлов данных и разностных файлов на одном и том же шпинделе (или в хранилище).
  
При настройке хранилища необходимо обеспечить наличие свободного места на диске, которое будет в четыре раза больше размера надежных, оптимизированных для памяти таблиц. Также удостоверьтесь, что подсистема ввода-вывода поддерживает необходимое число операций в секунду для вашей рабочей нагрузки. Если пары файлов данных и разностных файлов заполняются при данном IOPS, необходимо в три раза увеличить IOPS с учетом операций сортировки и объединения. Можно увеличить объем хранилища и IOPS путем добавления в оптимизированную для памяти файловую группу одного или нескольких контейнеров.  
 
> [!CAUTION]
> Если значение `MAXSIZE` задается для оптимизированной для памяти файловой группы и файлы контрольных точек превышают максимальный размер контейнера, база данных будет помечена как подозрительная (SUSPECT).   
> В этом случае не пытайтесь задать для базы данных режим OFFLINE и ONLINE, так как это приведет к переходу базы данных в состояние RECOVERY_PENDING.
  
## <a name="see-also"></a>См. также:  
[Создание и управление хранилищем для оптимизированных для памяти объектов](../../relational-databases/in-memory-oltp/creating-and-managing-storage-for-memory-optimized-objects.md)  
[Database Files and Filegroups](../../relational-databases/databases/database-files-and-filegroups.md)    
[Параметры инструкции ALTER DATABASE для файлов и файловых групп (Transact-SQL)](../../t-sql/statements/alter-database-transact-sql-file-and-filegroup-options.md) 

