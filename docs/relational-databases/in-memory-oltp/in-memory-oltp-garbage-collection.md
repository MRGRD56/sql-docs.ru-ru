---
title: Сборка мусора для выполняемой в памяти OLTP | Документация Майкрософт
description: Сведения о сборке мусора в выполняющейся в памяти OLTP в SQL Server. Если транзакция, которая больше не активна, удаляет строку, она подпадает под сбор мусора.
ms.custom: ''
ms.date: 03/17/2017
ms.prod: sql
ms.prod_service: database-engine, sql-database
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: 940140a7-4785-46fc-8bf4-151435dccd3c
author: markingmyname
ms.author: maghan
monikerRange: =azuresqldb-current||>=sql-server-2016||>=sql-server-linux-2017||=azuresqldb-mi-current
ms.openlocfilehash: b5b9060049965e9a826d3f9f22a1e6eb341ca0dc
ms.sourcegitcommit: 1a544cf4dd2720b124c3697d1e62ae7741db757c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/14/2020
ms.locfileid: "97485296"
---
# <a name="in-memory-oltp-garbage-collection"></a>Сборка мусора модулем In-Memory OLTP
[!INCLUDE [SQL Server Azure SQL Database](../../includes/applies-to-version/sql-asdb.md)]
  Строка данных считается устаревшей, если она была удалена транзакцией, которая больше не активна. Для устаревших строк применяется сборка мусора. Далее следуют характеристики сборки мусора в [!INCLUDE[hek_2](../../includes/hek-2-md.md)].  
  
-   Без блокировки. Сборка мусора распространяется равномерно со временем с минимальным влиянием на рабочую нагрузку.  
  
-   Совместная. Пользовательские транзакции задействованы в сборке мусора вместе с основным потоком сборки мусора.  
  
-   Эффективная. Пользовательские транзакции удаляют ссылки на устаревшие строки в используемом пути доступа (индексе). Это снижает необходимо рабочую нагрузку после окончательного удаления строки.  
  
-   Реагирование. Дефицит памяти приводит к агрессивной сборке мусора.  
  
-   Масштабируемый. Пользовательские транзакции после фиксации выполняют часть работы по сборке мусора. Чем больше выполняется транзакций, тем больше транзакций удаляют ссылки на устаревшие строки.  
  
 Сборкой мусора управляет главный поток сборки мусора. Основной поток сборки мусора запускается каждую минуту или при достижении определенного числа запущенных фиксированных транзакций. Задачи сборщика мусора:  
  
-   Определение транзакций, которые удалили или обновили набор строк и были зафиксированы ранее самых старых активных транзакций.  
  
-   Определение версий строк, созданных этими старыми транзакциями.  
  
-   Группирование старых строк в одну или несколько группировок, каждая из которых состоит из 16 строк. Это необходимо для того, чтобы разделить работу сборщика мусора на более мелкие этапы.  
  
-   Перемещение этих рабочих единиц в очередь сборки мусора по одному для каждого планировщика. Дополнительные сведения см. в динамических административных представлениях сборщика мусора: [sys.dm_xtp_gc_stats (Transact-SQL)](../../relational-databases/system-dynamic-management-views/sys-dm-xtp-gc-stats-transact-sql.md), [sys.dm_db_xtp_gc_cycle_stats (Transact-SQL)](../../relational-databases/system-dynamic-management-views/sys-dm-db-xtp-gc-cycle-stats-transact-sql.md) и [sys.dm_xtp_gc_queue_stats (Transact-SQL)](../../relational-databases/system-dynamic-management-views/sys-dm-xtp-gc-queue-stats-transact-sql.md).  
  
 После фиксации пользовательской транзакции она определяет все элементы, помещенные в очередь, связанную с их выполнением планировщиком, а затем освобождает память. Если очередь в планировщике сборки мусора пуста, то он выполняет поиск всех непустых очередей в текущем узле NUMA. При низкой активности транзакций или дефиците памяти главный поток сборщика мусора может включить в сбор мусора строки из любой очереди. Если после, например, удаления большого числа строк транзакций нет и память не потребляется, сборщик мусора не будет трогать удаленные строки до возобновления транзакций или формирования потребности в памяти.  
  
## <a name="see-also"></a>См. также:  
 [Управление памятью для компонента "Выполняющаяся в памяти OLTP"](/previous-versions/sql/sql-server-2016/dn465872(v=sql.130))  
  
