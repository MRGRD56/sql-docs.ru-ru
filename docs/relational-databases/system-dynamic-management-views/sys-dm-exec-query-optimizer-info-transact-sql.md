---
description: sys.dm_exec_query_optimizer_info (Transact-SQL)
title: sys.dm_exec_query_optimizer_info (Transact-SQL) | Документация Майкрософт
ms.custom: ''
ms.date: 03/15/2017
ms.prod: sql
ms.prod_service: database-engine, sql-database, synapse-analytics, pdw
ms.reviewer: ''
ms.technology: system-objects
ms.topic: reference
f1_keywords:
- dm_exec_query_optimizer_info_TSQL
- dm_exec_query_optimizer_info
- sys.dm_exec_query_optimizer_info_TSQL
- sys.dm_exec_query_optimizer_info
dev_langs:
- TSQL
helpviewer_keywords:
- sys.dm_exec_query_optimizer_info dynamic management view
ms.assetid: 1d72cef1-22d8-4ae0-91db-6694fe918c9e
author: WilliamDAssafMSFT
ms.author: wiassaf
monikerRange: '>=aps-pdw-2016||=azuresqldb-current||=azure-sqldw-latest||>=sql-server-2016||>=sql-server-linux-2017||=azuresqldb-mi-current'
ms.openlocfilehash: a3e769d427581ea888fc0f6a226f5072c93bc3e8
ms.sourcegitcommit: 0310fdb22916df013eef86fee44e660dbf39ad21
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "104750574"
---
# <a name="sysdm_exec_query_optimizer_info-transact-sql"></a>sys.dm_exec_query_optimizer_info (Transact-SQL)
[!INCLUDE [sql-asdb-asdbmi-asa-pdw](../../includes/applies-to-version/sql-asdb-asdbmi-asa-pdw.md)]

  Возвращает подробные статистики по операциям оптимизатора запросов [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Это представление можно использовать для настройки рабочей нагрузки при обнаружении проблем, связанных с оптимизацией запросов, или для улучшения производительности обработки запросов. Например, можно использовать общее число оптимизаций, значение затрачиваемого времени и значение конечной стоимости для сравнения с оптимизацией запросов текущей рабочей нагрузки и любыми изменениями во время процесса настройки. Некоторые счетчики предоставляют данные, которые могут быть использованы только для внутренней диагностики [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Эти счетчики помечены атрибутом «Только для внутреннего использования.».  
  
> [!NOTE]  
>  Чтобы вызвать эту функцию из [!INCLUDE[ssSDWfull](../../includes/sssdwfull-md.md)] или [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] , используйте имя **sys.dm_pdw_nodes_exec_query_optimizer_info**.  
  
|Имя|Тип данных|Описание|  
|----------|---------------|-----------------|  
|**подписан**|**nvarchar(4000)**|Имя события статистики оптимизатора.|  
|**occurrence**|**bigint**|Количество вхождений события оптимизации для этого счетчика.|  
|**value**|**float**|Среднее значение свойства для вхождения события.|  
|**pdw_node_id**|**int**|**Применимо к**: [!INCLUDE[ssSDWfull](../../includes/sssdwfull-md.md)] , [!INCLUDE[ssPDW](../../includes/sspdw-md.md)]<br /><br /> Идентификатор узла, на котором находится данное распределение.|  
  
## <a name="permissions"></a>Разрешения  

В [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] необходимо `VIEW SERVER STATE` разрешение.   
В базах данных SQL Basic, S0 и S1, а также для баз данных в эластичных пулах требуется учетная запись [администратора сервера](/azure/azure-sql/database/logins-create-manage#existing-logins-and-user-accounts-after-creating-a-new-database) или учетная запись [администратора Azure Active Directory](/azure/azure-sql/database/authentication-aad-overview#administrator-structure) . Для всех остальных целей службы базы данных SQL `VIEW DATABASE STATE` разрешение требуется в базе данных.   
    
## <a name="remarks"></a>Remarks  
 **sys.dm_exec_query_optimizer_info** содержит следующие свойства (счетчики). Все значения частотности рассматриваются совокупно и при перезапуске системы устанавливаются в 0. Все значения полей значений при перезапуске системы устанавливаются в NULL. Все значения значимых столбцов, по которым определяется среднее, используют значение частотности из той же строки, что и знаменатель в вычислении среднего. Все оптимизации запросов измеряются, когда [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] определяет изменения в **dm_exec_query_optimizer_info**, включая запросы, создаваемые пользователями и системой. Выполнение уже кэшированного плана не изменяет значения в **dm_exec_query_optimizer_info**, учитываются только оптимизации.  
  
|Счетчик|Наличие|Значение|  
|-------------|----------------|-----------|  
|оптимизации|Общее число операций оптимизации.|Неприменимо|  
|затраченное время|Общее число операций оптимизации.|Среднее время, затраченное на оптимизацию отдельной инструкции (запроса), в секундах.|  
|окончательные затраты|Общее число операций оптимизации.|Средняя оценка затрат для оптимизированного плана во внутренних единицах затрат.|  
|обычный план|Только для внутреннего использования.|Только для внутреннего использования.|  
|задачи|Только для внутреннего использования.|Только для внутреннего использования.|  
|без плана|Только для внутреннего использования.|Только для внутреннего использования.|  
|search 0|Только для внутреннего использования.|Только для внутреннего использования.|  
|search 0 time|Только для внутреннего использования.|Только для внутреннего использования.|  
|search 0 tasks|Только для внутреннего использования.|Только для внутреннего использования.|  
|search 1|Только для внутреннего использования.|Только для внутреннего использования.|  
|search 1 time|Только для внутреннего использования.|Только для внутреннего использования.|  
|search 1 tasks|Только для внутреннего использования.|Только для внутреннего использования.|  
|поиск 2|Только для внутреннего использования.|Только для внутреннего использования.|  
|время поиска 2|Только для внутреннего использования.|Только для внутреннего использования.|  
|задачи поиска 2|Только для внутреннего использования.|Только для внутреннего использования.|  
|gain stage 0 to stage 1|Только для внутреннего использования.|Только для внутреннего использования.|  
|выигрыш при переходе от стадии 1 к стадии 2|Только для внутреннего использования.|Только для внутреннего использования.|  
|timeout|Только для внутреннего использования.|Только для внутреннего использования.|  
|превышение предела памяти|Только для внутреннего использования.|Только для внутреннего использования.|  
|инструкции insert|Количество операций оптимизации для инструкций INSERT.|Неприменимо|  
|инструкции delete|Количество операций оптимизации для инструкций DELETE.|Неприменимо|  
|инструкции update|Количество операций оптимизации для инструкций UPDATE.|Неприменимо|  
|содержащие вложенный запрос|Количество операций оптимизации для запросов, содержащих как минимум один вложенный запрос.|Неприменимо|  
|сбой устранения вложенности|Только для внутреннего использования.|Только для внутреннего использования.|  
|таблицы|Общее число операций оптимизации.|Среднее число таблиц, на которые ссылается оптимизированный запрос.|  
|указания|Количество раз, когда было задано указание. Подсчитанные подсказки включают в себя указания запросов соединения, ГРУППИРОВАНия, объединения и ПРИНУДИТЕЛЬного УПОРЯДОЧЕНия, параметр ПРИНУДИТЕЛЬного задания плана и указания соединения.|Неприменимо|  
|указание упорядочивания|Количество раз, когда было задано указание принудительного упорядочивания.|Неприменимо|  
|указание соединения|Количество раз, когда по указанию соединения принудительно вызывался алгоритм соединения.|Неприменимо|  
|обращение к представлению|Количество раз, когда производилось обращение к представлению в запросе.|Неприменимо|  
|удаленный запрос|Количество операций оптимизации, при которых запрос обращался как минимум к одному удаленному источнику данных, например к таблице с четырехкомпонентным именем или результату инструкции OPENROWSET.|Неприменимо|  
|максимальное DOP|Общее число операций оптимизации.|Среднее эффективное значение MAXDOP для оптимизированного плана. По умолчанию действующее значение MAXDOP определяется параметром конфигурации сервера **max degree of parallelism** и может быть переопределено для конкретного запроса по значению подсказки запроса MAXDOP.|  
|максимальный уровень рекурсии|Количество операций оптимизации, в которых был задан уровень MAXRECURSION больше 0 в рамках указания запроса.|Средний уровень MAXRECURSION в операциях оптимизации, для которых был задан максимальный уровень рекурсии в рамках указания запроса.|  
|загруженные индексированные представления|Только для внутреннего использования.|Только для внутреннего использования.|  
|сопоставленные индексированные представления|Количество операций оптимизации, в которых было сопоставлено одно или несколько индексированных представлений.|Среднее количество сопоставленных представлений.|  
|использованные индексированные представления|Количество операций оптимизации, для которых в выходном плане было использовано одно или несколько индексированных представлений после согласования.|Среднее количество использованных представлений.|  
|обновленные индексированные представления|Количество операций оптимизации DML-инструкции, выдающих план, обслуживающий одно или несколько индексированных представлений.|Среднее количество обслуженных представлений.|  
|запрос динамического курсора|Количество операций оптимизации, для которых был указан запрос динамического курсора.|Неприменимо|  
|запрос быстрого перемещения курсора вперед|Количество операций оптимизации, для которых был указан запрос однопроходного курсора.|Неприменимо|  
|merge stmt|Количество операций оптимизации для инструкций MERGE.|Неприменимо|  
  
## <a name="examples"></a>Примеры  
  
### <a name="a-viewing-statistics-on-optimizer-execution"></a>A. Просмотр статистики выполнения оптимизатора  
 Каковы текущие статистики выполнения оптимизатора для данного экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]?  
  
```  
SELECT * FROM sys.dm_exec_query_optimizer_info;  
```  
  
### <a name="b-viewing-the-total-number-of-optimizations"></a>Б. Просмотр общего количества операций оптимизации  
 Количество выполняемых операций оптимизации.  
  
```  
SELECT occurrence AS Optimizations FROM sys.dm_exec_query_optimizer_info  
WHERE counter = 'optimizations';  
```  
  
### <a name="c-average-elapsed-time-per-optimization"></a>В. Среднее время, затраченное на операцию оптимизации  
 Каково среднее время, затраченное на операцию оптимизации?  
  
```  
SELECT ISNULL(value,0.0) AS ElapsedTimePerOptimization  
FROM sys.dm_exec_query_optimizer_info WHERE counter = 'elapsed time';  
```  
  
### <a name="d-fraction-of-optimizations-that-involve-subqueries"></a>Г. Доля операций оптимизации, в которых задействованы вложенные запросы  
 Доля оптимизированных запросов, содержащих вложенные запросы.  
  
```  
SELECT (SELECT CAST (occurrence AS float) FROM sys.dm_exec_query_optimizer_info WHERE counter = 'contains subquery') /  
       (SELECT CAST (occurrence AS float)   
        FROM sys.dm_exec_query_optimizer_info WHERE counter = 'optimizations')  
        AS ContainsSubqueryFraction;  
```  
  
## <a name="see-also"></a>См. также:  
 [Динамические административные представления и функции (Transact-SQL)](~/relational-databases/system-dynamic-management-views/system-dynamic-management-views.md)   
 [Динамические административные представления и функции, связанные с выполнением (Transact-SQL)](../../relational-databases/system-dynamic-management-views/execution-related-dynamic-management-views-and-functions-transact-sql.md)  
  
