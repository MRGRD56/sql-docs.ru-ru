---
description: sys.dm_resource_governor_resource_pools_history_ex (Transact-SQL)
title: sys.dm_resource_governor_resource_pools_history_ex (Transact-SQL) | Документация Майкрософт
ms.custom: ''
ms.date: 01/05/2021
ms.prod: sql
ms.prod_service: sql-database
ms.reviewer: ''
ms.technology: system-objects
ms.topic: language-reference
f1_keywords:
- sys.resource_governor
- sys.resource_governor_TSQL
- resource_governor
- resource_governor_TSQL
dev_langs:
- TSQL
helpviewer_keywords:
- sys.resource_governor catalog view
ms.assetid: ''
author: joesackmsft
ms.author: josack
monikerRange: =azuresqldb-current
ms.openlocfilehash: 32082b09a5e583e68f2f06794d80d1d3f21b4e76
ms.sourcegitcommit: 11ca2305a8d7e420daf772eb97861706c9e08e31
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "97928443"
---
# <a name="sysdm_resource_governor_resource_pools_history_ex-transact-sql"></a>sys.dm_resource_governor_resource_pools_history_ex (Transact-SQL)

[!INCLUDE[appliesto-xx-asdb-xxxx-xxx-md](../../includes/appliesto-xx-asdb-xxxx-xxx-md.md)]

Каждая строка представляет периодический моментальный снимок статистики пула ресурсов в базе данных SQL Azure. Моментальный снимок создается, когда ядро СУБД запускается и каждые несколько секунд после этого. Интервал между текущим и предыдущим снимками может быть разным и указан в `duration_ms` столбце. Возвращаются последние доступные моментальные снимки, до 128 моментальных снимков для каждого пула ресурсов.

|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**pool_id**|INT|Идентификатор пула ресурсов. Не допускает значение NULL.
|**name**|sysname|Имя пула ресурсов. Не допускает значение NULL.|
|**snapshot_time**|datetime2|Дата и время создания моментального снимка статистики пула ресурсов|
|**duration_ms**|INT|Длительность между текущим и предыдущим снимками|
|**statistics_start_time**|datetime2|Время, когда была очищена статистика для данного пула. Не допускает значение NULL.|
|**active_session_count**|INT|Общее число активных сеансов в текущем моментальном снимке|
|**active_worker_count**|INT|Всего рабочих ролей в текущем моментальном снимке|
|**delta_cpu_usage_ms**|INT|Загрузка ЦП в миллисекундах с момента создания последнего моментального снимка. Не допускает значение NULL.|
|**delta_cpu_usage_preemptive_ms**|INT|Вызовы Win32 с вытеснением, не управляемые RG ЦП SQL, с момента создания последнего моментального снимка|
|**used_data_space_kb**|BIGINT|Общее пространство, используемое в пользовательских базах данных, связанных с пулом пользователей|
|**allocated_disk_space_kb**|BIGINT|Общий размер файла данных пользовательских баз данных в связанном с ним пуле пользователей|
|**target_memory_kb**|BIGINT|Целевой объем памяти, в килобайтах, который пытается заполучить пул ресурсов. Это основано на текущих настройках и состоянии сервера. Не допускает значение NULL.|
|**used_memory_kb**|BIGINT|Объем используемой памяти, в килобайтах, для пула ресурсов. Не допускает значение NULL.|
|**cache_memory_kb**|BIGINT|Текущее общее использование памяти кэша, в килобайтах. Не допускает значение NULL.|
|**compile_memory_kb**|BIGINT|Текущее общее использование заимствованной памяти, в килобайтах (КБ). Основная доля этого использования приходится на компиляцию и оптимизацию, но может также включать и других пользователей памяти. Не допускает значение NULL.|
|**active_memgrant_count**|BIGINT|Текущее количество операций предоставления памяти. Не допускает значение NULL.|
|**active_memgrant_kb**|BIGINT|Сумма, в килобайтах (КБ), предоставленной в настоящее время памяти. Не допускает значение NULL.|
|**used_memgrant_kb**|BIGINT|Текущий общий объем используемой (заимствованной) памяти, полученной в результате операций предоставления памяти. Не допускает значение NULL.|
|**delta_memgrant_timeout_count**|INT|число истечений времени ожидания предоставления памяти в этом пуле ресурсов в этот период. Не допускает значение NULL.|
|**delta_memgrant_waiter_count**|INT|Количество запросов, в настоящий момент ожидающих предоставления памяти. Не допускает значение NULL.|
|**delta_out_of_memory_count**|INT|Число сбоев выделения памяти в пуле с момента создания последнего моментального снимка. Не допускает значение NULL.|
|**delta_read_io_queued**|INT|Общее количество операций чтения, поставленных в очередь с момента последнего моментального снимка. Допускает значение NULL. NULL, если пул ресурсов не управляется в аспекте операций ввода-вывода.|
|**delta_read_io_issued**|INT|Общее количество операций чтения с момента последнего моментального снимка. Допускает значение NULL. NULL, если пул ресурсов не управляется в аспекте операций ввода-вывода.|
|**delta_read_io_completed**|INT|Общее чтение с IOs завершено с момента создания последнего моментального снимка. Не допускает значение NULL.|
|**delta_read_io_throttled**|INT|Общее количество операций чтения с момента создания моментального снимка. Допускает значение NULL. NULL, если пул ресурсов не управляется в аспекте операций ввода-вывода.|
|**delta_read_bytes**|BIGINT|Общее число байтов, считанных с момента создания последнего моментального снимка. Не допускает значение NULL.|
|**delta_read_io_stall_ms**|INT|Общее время (в миллисекундах) между получением ввода-вывода при чтении и завершением с момента последнего моментального снимка. Не допускает значение NULL.|
|**delta_read_io_stall_queued_ms**|INT|Общее время (в миллисекундах) между получением ввода-вывода при чтении и проблемой с момента последнего моментального снимка. Допускает значение NULL. NULL, если пул ресурсов не управляется в аспекте операций ввода-вывода. Ненулевое delta_read_io_stall_queued_ms означает, что RG влияет на операции ввода-вывода.|
|**delta_write_io_queued**|INT|Общее число операций записи IOs, поставленных в очередь с момента последнего моментального снимка. Допускает значение NULL. NULL, если пул ресурсов не управляется в аспекте операций ввода-вывода.|
|**delta_write_io_issued**|INT|Общее число операций записи для IOs с момента последнего моментального снимка. Допускает значение NULL. NULL, если пул ресурсов не управляется в аспекте операций ввода-вывода.|
|**delta_write_io_completed**|INT|Общая операция записи на IOs завершена с момента создания последнего моментального снимка. Не допускает значение NULL.|
|**delta_write_io_throttled**|INT|Общее количество операций записи, отрегулированное с момента последнего моментального снимка. Не допускает значение NULL.|
|**delta_write_bytes**|BIGINT|Общее число байтов, записанных с момента создания последнего моментального снимка. Не допускает значение NULL.|
|**delta_write_io_stall_ms**|INT|Общее время (в миллисекундах) между получением и завершением операций ввода-вывода с момента последнего моментального снимка. Не допускает значение NULL.|
|**delta_write_io_stall_queued_ms**|INT|Общее время (в миллисекундах) между получением ввода-вывода и проблемой с момента последнего моментального снимка. Допускает значение NULL. NULL, если пул ресурсов не управляется в аспекте операций ввода-вывода.|
|**delta_io_issue_delay_ms**|INT|Общее время (в миллисекундах) между запланированной проблемой и фактической выпуском операций ввода-вывода с момента последнего моментального снимка. Допускает значение NULL. NULL, если пул ресурсов не управляется в аспекте операций ввода-вывода.|
|**max_iops_per_volume**|INT|Параметр максимального числа операций ввода-вывода в секунду на диск для этого пула. Допускает значение NULL. NULL, если пул ресурсов не управляется в аспекте операций ввода-вывода.|
|**max_memory_kb**|BIGINT|Максимальный объем памяти, в килобайтах, который может быть получен пулом ресурсов. Это основано на текущих настройках и состоянии сервера. Не допускает значение NULL.
|**max_log_rate_kb**|BIGINT|Максимальная частота ведения журнала (килобайтах-байт/с) на уровне пула ресурсов.|
|**max_data_space_kb**|BIGINT|Максимальный размер хранилища эластичного пула для этого пула эластичных БД в килобайтах.|
|**max_session**|INT|Ограничение сеанса для пула|
|**max_worker**|INT|Ограничение рабочей роли для пула|
|**min_cpu_percent**|INT|Текущая конфигурация гарантированной средней пропускной способности ЦП для всех запросов в пуле ресурсов при возникновении состязания использования ЦП. Не допускает значение NULL.|
|**max_cpu_percent**|INT|Текущая конфигурация максимальной средней пропускной способности ЦП, разрешенной для всех запросов в пуле ресурсов при возникновении состязания использования ЦП. Не допускает значение NULL.|
|**cap_cpu_percent**|INT|Жесткое ограничение пропускной способности ЦП, которая предоставляется всем запросам в пуле ресурсов. Ограничивает максимальный уровень пропускной способности ЦП заданным значением. Диапазон допустимых значений — от 1 до 100. Не допускает значение NULL.|
|**min_vcores**|Decimal (5, 2)|Текущая конфигурация гарантированной средней пропускной способности ЦП для всех запросов в пуле ресурсов при возникновении состязания использования ЦП.  В единицах виртуальных ядер|
|**max_vcores**|Decimal (5, 2)|Текущая конфигурация максимальной средней пропускной способности ЦП, разрешенной для всех запросов в пуле ресурсов при возникновении состязания использования ЦП.  В единице виртуальных ядер|
|**cap_vcores**|Decimal (5, 2)|Жесткое ограничение пропускной способности ЦП, которая предоставляется всем запросам в пуле ресурсов.  В единице на виртуальных ядер|
|**instance_cpu_count**|INT|Количество ЦП, настроенное для экземпляра|
|**instance_cpu_percent**|Decimal (5, 2)|Процент использования ЦП, настроенный для экземпляра|
|**instance_vcores**|Decimal (5, 2)|Число виртуальных ядер, настроенных для экземпляра|
|**delta_log_bytes_used**|Decimal (5, 2)|Общее создание журнала (в байтах) на уровне пула с момента последнего моментального снимка|
|**avg_login_rate_percent**|Decimal (5, 2)|Число входов с момента последнего моментального снимка по сравнению с ограничением на число входов|
|**delta_vcores_used**|Decimal (5, 2)|Использование вычислений в количестве виртуальных ядер с момента последнего моментального снимка.|
|**cap_vcores_used_percent**|Decimal (5, 2)|Среднее использование вычислительных ресурсов в процентах от предела пула.|
|**instance_vcores_used_percent**|Decimal (5, 2)|Среднее использование вычислительных ресурсов в процентах от пределов экземпляра SQL.|
|**avg_data_io_percent**|Decimal (5, 2)|Среднее использование ввода-вывода в процентах от предела пула.|
|**avg_log_write_percent**|Decimal (5, 2)|Среднее использование записи ресурсов в процентах от предела пула.|
|**avg_storage_percent**|Decimal (5, 2)|Среднее использование хранилища в процентах от предела пула.|
|**avg_allocated_storage_percent**|Decimal (5, 2)|Процент пространства данных, выделенного всеми базами данных в эластичном пуле. Это отношение пространства данных, выделенного для максимального размера данных для эластичного пула. Дополнительные сведения см. в разделе Управление пространством файлов в базе данных SQL.|
|**max_worker_percent**|Decimal (5, 2)|Максимальное число одновременных рабочих ролей (запросов) в процентах от предела пула.|
|**max_session_percent**|Decimal (5, 2)|Максимальное число одновременных сеансов в процентах от предела пула.|
|||

## <a name="permissions"></a>Разрешения

Для этого представления требуется разрешение VIEW SERVER STATE.

## <a name="remarks"></a>Remarks

Пользователи могут получить доступ к этому динамическому административному представлению, чтобы отслеживать потребление ресурсов практически в реальном времени для пула рабочей нагрузки пользователей, а также системных внутренних пулов экземпляра базы данных SQL Azure.

> [!IMPORTANT]
> Большая часть данных, предоставляемых этим динамическим административным представлением, предназначена для внутреннего использования и может изменяться.

## <a name="examples"></a>Примеры

В следующем примере возвращаются данные о максимальной скорости ведения журнала и потреблении для каждого моментального снимка по пулу пользователей.  

```sql
select snapshot_time, name, max_log_rate_kb, delta_log_bytes_used from sys.dm_resource_governor_resource_pools_history_ex where name like 'UserPool%' order by snapshot_time desc
```

В следующем примере возвращаются аналогичные сведения, такие как sys.elastic_pool_resource_stats без подключения к логической базе данных master.

```sql
select snapshot_time, name, cap_vcores_used_percent,
  avg_data_io_percent,  
  avg_log_write_percent,
  avg_storage_percent,
  avg_allocated_storage_percent,
  max_data_space_kb,
  max_worker_percent,
  max_session_percent
    from sys.dm_resource_governor_resource_pools_history_ex where name like 'UserPool%' order by snapshot_time desc
```

## <a name="see-also"></a>См. также:

- [Управление частотой ведения журнала перевода](/azure/sql-database/sql-database-resource-limits-database-server#transaction-log-rate-governance)
- [Ограничения ресурсов на основе DTU для эластичного пула](/azure/sql-database/sql-database-dtu-resource-limits-elastic-pools)
- [Ограничения ресурсов виртуального ядра для эластичного пула](/azure/sql-database/sql-database-vcore-resource-limits-elastic-pools)