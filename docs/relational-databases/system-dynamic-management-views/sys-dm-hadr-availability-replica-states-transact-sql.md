---
description: sys.dm_hadr_availability_replica_states (Transact-SQL)
title: sys.dm_hadr_availability_replica_states (Transact-SQL) | Документация Майкрософт
ms.custom: ''
ms.date: 10/16/2017
ms.prod: sql
ms.reviewer: ''
ms.technology: system-objects
ms.topic: reference
f1_keywords:
- dm_hadr_availability_replica_states
- sys.dm_hadr_availability_replica_states_TSQL
- sys.dm_hadr_availability_replica_states
- dm_hadr_availability_replica_states_TSQL
dev_langs:
- TSQL
helpviewer_keywords:
- Availability Groups [SQL Server], monitoring
- sys.dm_hadr_availability_replica_states dynamic management view
ms.assetid: d2e678bb-51e8-4a61-b223-5c0b8d08b8b1
author: WilliamDAssafMSFT
ms.author: wiassaf
ms.openlocfilehash: ab171b0adfe6497520ba55d94ec6a1435cc6678a
ms.sourcegitcommit: 33f0f190f962059826e002be165a2bef4f9e350c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/30/2021
ms.locfileid: "99179315"
---
# <a name="sysdm_hadr_availability_replica_states-transact-sql"></a>sys.dm_hadr_availability_replica_states (Transact-SQL)
[!INCLUDE [SQL Server](../../includes/applies-to-version/sqlserver.md)]

  Возвращает по строке для каждой локальной реплики и каждой удаленной реплики, входящей в ту же группу доступности AlwaysOn, что и локальная реплика. Каждая строка содержит сведения о состоянии конкретной реплики.  
  
> [!IMPORTANT]  
>  Чтобы получить сведения о каждой реплике в данной группе доступности, запросите **sys.dm_hadr_availability_replica_states** на экземпляре сервера, на котором размещается первичная реплика. На экземпляре сервера, где размещена вторичная реплика группы доступности, это динамическое административное представление возвращает лишь локальные сведения о группе доступности.  
  
|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**replica_id**|**uniqueidentifier**|Уникальный идентификатор реплики.|  
|**group_id**|**uniqueidentifier**|Уникальный идентификатор группы доступности.|  
|**is_local**|**bit**|Является ли реплика локальной, одна из следующих:<br /><br /> 0 = указывает удаленную вторичную реплику в группе доступности, первичная реплика которой размещена на локальном экземпляре сервера. Это значение появляется только в расположении первичной реплики.<br /><br /> 1 = указывает на локальную реплику. Во вторичных репликах это единственное доступное значение для группы доступности, к которой принадлежит реплика.|  
|**role**|**tinyint**|Текущая [!INCLUDE[ssHADR](../../includes/sshadr-md.md)] роль локальной реплики или подключенной удаленной реплики, одна из следующих:<br /><br /> 0 = разрешается<br /><br /> 1 = первичная<br /><br /> 2 = вторичная<br /><br /> Дополнительные сведения о ролях [!INCLUDE[ssHADR](../../includes/sshadr-md.md)] см. в разделе [Обзор групп доступности AlwaysOn (SQL Server)](../../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md).|  
|**role_desc**|**nvarchar(60)**|Описание **роли**, одно из следующих:<br /><br /> RESOLVING<br /><br /> PRIMARY<br /><br /> SECONDARY|  
|**operational_state**|**tinyint**|Текущее рабочее состояние реплики, одно из следующих:<br /><br /> 0 = ожидание отработки отказа<br /><br /> 1 = Ожидание<br /><br /> 2 = в сети<br /><br /> 3 = вне сети<br /><br /> 4 = сбой<br /><br /> 5 = ошибка, нет кворума<br /><br /> NULL = реплика не является локальной<br /><br /> Дополнительные сведения см. в подразделе [роли и операционные состояния](#RolesAndOperationalStates)далее в этой статье.|  
|**desc операционного \_ состояния \_**|**nvarchar(60)**|Описание **операционного \_ состояния**, одно из следующих:<br /><br /> PENDING_FAILOVER<br /><br /> PENDING<br /><br /> ONLINE<br /><br /> OFFLINE<br /><br /> FAILED<br /><br /> FAILED_NO_QUORUM<br /><br /> NULL|  
|**\_работоспособность восстановления**|**tinyint**|Свертка столбца **\_ состояния базы данных** в динамическом административном представлении [sys.dm_hadr_database_replica_states](../../relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql.md) . Ниже приведены возможные значения и их описания.<br /><br /> 0 — выполняется.  По крайней мере одна присоединенная база данных имеет состояние базы данных, отличное от "в сети" (**\_ состояние базы данных** не равно 0).<br /><br /> 1: в сети. Все соединяемые базы данных имеют состояние базы данных в сети (**database_state** равно 0).<br /><br /> NULL: **is_local** = 0|  
|**recovery_health_desc**|**nvarchar(60)**|Описание **recovery_health**, одно из следующих:<br /><br /> ONLINE_IN_PROGRESS<br /><br /> ONLINE<br /><br /> NULL|  
|**\_работоспособность синхронизации**|**tinyint**|Отражает сводное состояние синхронизации базы данных (**synchronization_state**) всех присоединенных баз данных доступности (также известных как *реплики*) и режима доступности реплики (режим синхронной фиксации или Асинхронная фиксация). Свертка будет отражать наименее работоспособное состояние баз данных в реплике. Ниже приведены возможные значения и их описания.<br /><br /> 0: неработоспособен.   Как минимум одна из присоединенных баз данных находится в состоянии NOT SYNCHRONIZING.<br /><br /> 1: частично работоспособен. Некоторые реплики не находятся в целевом состоянии синхронизации: реплики синхронной фиксации должны быть синхронизированы, а реплики асинхронной фиксации — синхронизировать.<br /><br /> 2: исправен. Все реплики находятся в целевом состоянии синхронизации: реплики синхронной фиксации синхронизированы, реплики асинхронной фиксации синхронизируются.|  
|**synchronization_health_desc**|**nvarchar(60)**|Описание **synchronization_health**, одно из следующих:<br /><br /> NOT_HEALTHY<br /><br /> PARTIALLY_HEALTHY<br /><br /> HEALTHY|  
|**connected_state**|**tinyint**|Подключена ли в данный момент вторичная реплика к первичной реплике. Ниже приведены возможные значения с описаниями.<br /><br /> 0: отключено. Ответ реплики доступности в состояние DISCONNECTED зависит от его роли: на первичной реплике, если вторичная реплика отключена, ее базы данных-получатели помечаются как не СИНХРОНИЗИРОВАНные в первичной реплике, которая ожидает повторного подключения к серверу-получателю. Во вторичной реплике при обнаружении, что она отключена, вторичная реплика пытается повторно подключиться к первичной реплике.<br /><br /> 1: подключено.<br /><br /> Каждая первичная реплика отслеживает состояние соединения для всех вторичных реплик в той же группе доступности. Вторичные реплики отслеживают состояние соединения только первичной реплики.|  
|**connected_state_desc**|**nvarchar(60)**|Описание **connection_state**, одно из следующих:<br /><br /> DISCONNECTED<br /><br /> CONNECTED|  
|**last_connect_error_number**|**int**|Номер последней возникшей ошибки подключения.|  
|**last_connect_error_description**|**nvarchar(1024)**|Текст **last_connect_error_number** сообщения.|  
|**last_connect_error_timestamp**|**datetime**|Отметка времени даты и времени, указывающая, когда произошла **last_connect_error_number** ошибка.|  
  
##  <a name="roles-and-operational-states"></a><a name="RolesAndOperationalStates"></a> Роли и операционные состояния  
 Роль, **роль**, отражает состояние заданной реплики доступности и операционное состояние, **operational_state**, описывает, готова ли реплика к обработке клиентских запросов для всей базы данных реплики доступности. Ниже приведена сводка операционных состояний, которые можно реализовать для каждой роли: разрешение, ПЕРВИЧное и ВТОРИЧное.  
  
 **Разрешение:** Если реплика доступности находится в роли разрешения, возможны следующие операционные состояния, как показано в следующей таблице.  
  
|Рабочее состояние|Описание|  
|-----------------------|-----------------|  
|PENDING_FAILOVER|В группе доступности выполняется команда отработки отказа.|  
|OFFLINE|Все данные конфигурации для реплики доступности были обновлены на кластере WSFC и в локальных метаданных, но в настоящее время в группе доступности отсутствует первичная реплика.|  
|FAILED|При попытке получить информацию из кластера WSFC возникла ошибка чтения.|  
|FAILED_NO_QUORUM|На локальном узле WSFC нет кворума. Это выведенное состояние.|  
  
 **Первичный:** Когда реплика доступности выполняет ПЕРВИЧную роль, она в настоящее время является первичной репликой. Возможные операционные состояния приведены в следующей таблице.  
  
|Рабочее состояние|Описание|  
|-----------------------|-----------------|  
|PENDING|Это переходное состояние, но первичная реплика может «застрять» в этом состоянии при отсутствии рабочих потоков для обработки запросов.|  
|ONLINE|Ресурс группы доступности находится в сети, и все рабочие потоки базы данных задействованы.|  
|FAILED|Реплика доступности не может выполнять операции чтения или записи в кластере WSFC.|  
  
 **Получатель:** Когда реплика доступности выполняет ВТОРИЧную роль, она в настоящее время является вторичной репликой. Возможны следующие операционные состояния, как показано в таблице ниже.  
  
|Рабочее состояние|Описание|  
|-----------------------|-----------------|  
|ONLINE|Локальная вторичная реплика подключена к первичной реплике.|  
|FAILED|Локальная вторичная реплика не может выполнять операции чтения или записи в кластере WSFC.|  
|NULL|В первичной реплике это значение возвращается в том случае, когда строка относится к вторичной реплике.|  
  
## <a name="security"></a>Безопасность  
  
### <a name="permissions"></a>Разрешения  
 необходимо разрешение VIEW SERVER STATE на сервере.  
  
## <a name="see-also"></a>См. также:  
 [Обзор групп доступности AlwaysOn (SQL Server)](../../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md)   
 [Отслеживание групп доступности (Transact-SQL)](../../database-engine/availability-groups/windows/monitor-availability-groups-transact-sql.md)  
  
  
