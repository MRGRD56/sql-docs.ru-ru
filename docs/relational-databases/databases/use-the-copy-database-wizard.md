---
description: Использование мастера копирования базы данных
title: Использование мастера копирования базы данных | Документация Майкрософт
ms.custom: ''
ms.date: 07/26/2016
ms.prod: sql
ms.prod_service: database-engine
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
f1_keywords:
- sql13.swb.cdw.packageconfiguration.f1
- sql13.swb.cdw.schedule.f1
- sql13.swb.cdw.transfermethod.f1
- sql13.swb.cdw.databases.f1
- sql13.swb.cdw.destinationconfiguration.f1
- sql13.swb.cdw.destination.f1
- sql13.swb.cdw.locationofsourcedbfiles.f1
- sql13.swb.cdw.source.f1
- sql13.swb.cdw.selectdatabaseobjects.f1
- sql13.swb.cdw.complete.f1
- sql13.swb.cdw.welcome.f1
helpviewer_keywords:
- Copy Database Wizard
- starting Copy Database Wizard
ms.assetid: 7a999fc7-0a26-4a0d-9eeb-db6fc794f3cb
author: stevestein
ms.author: sstein
ms.openlocfilehash: 6fdb28c8ef89b9c8b79b482b0887f9a0bf40cbb3
ms.sourcegitcommit: c5078791a07330a87a92abb19b791e950672e198
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/26/2020
ms.locfileid: "88487095"
---
# <a name="use-the-copy-database-wizard"></a>Использование мастера копирования базы данных
 [!INCLUDE [SQL Server](../../includes/applies-to-version/sqlserver.md)]
Мастер копирования баз данных легко перемещает или копирует базы данных и определенные объекты серверов из одного экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]  в другой, не вызывая сбои в работе сервера. С помощью этого мастера можно сделать следующее. 
  
-   Выбрать исходный и целевой серверы.  
  
-   Выбрать базы данных для перемещения или копирования.  
  
-   Указать расположение файлов для этих баз данных.  
  
-   Скопировать имена входа для целевого сервера.  
  
-   Копировать дополнительные вспомогательные объекты, задания, пользовательские хранимые процедуры и сообщения об ошибках.  
  
-   Задать расписание перемещения или копирования баз данных.  
  

##  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> Ограничения  
  
-   Мастер копирования баз данных недоступен в выпуске Express.  
  
-   Мастер копирования базы данных нельзя использовать для перемещения или копирования следующих типов баз данных:
  
    -   системные базы данных;
  
    -   базы данных, отмеченные для репликации;
  
    -   базы данных в следующих состояниях: недоступные, в процессе загрузки, в режиме вне сети, в процессе восстановления, подозрительные или в аварийном режиме;
    
    -   базы данных, содержащие данные и файлы журналов в хранилище Microsoft Azure.
  
-   При использовании [FileTables](../../relational-databases/blob/filetables-sql-server.md) нельзя применять мастер копирования базы данных на том же сервере, так как он использует одно и то же имя каталога.

-   Базы данных нельзя копировать и перемещать в более ранние версии SQL Server.
  
-   Если выбран параметр **Переместить** , после перемещения базы данных мастер автоматически удаляет базу данных-источник. При выборе параметра **Копирование** мастер копирования базы данных не выполняет удаление базы данных-источника.  Кроме того, объекты выбранного сервера копируются, а не перемещаются в место назначения; фактически единственным перемещаемым объектом является база данных.
  
-   При использовании метода управляющих объектов [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для перемещения полнотекстового каталога после перемещения необходимо заново заполнить индекс.  
  
-   Метод **отсоединения и присоединения** отсоединяет базу данных, перемещает или копирует ее файлы (MDF, NDF и LDF) и подсоединяет базу данных в новом расположении. При использовании метода **отсоединения и присоединения** во избежание потери или рассогласования данных к копируемой или перемещаемой базе данных нельзя присоединять активные сеансы. Если используется метод управляющих объектов [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , активные сеансы допустимы, так как база данных не переводится в режим «вне сети».  

-    Передача заданий агента SQL Server, который ссылается на базы данных, еще не существующие на целевом сервере, приведет к сбою всей операции.  Прежде чем создавать базу данных, мастер пытается создать задание агента SQL Server.  Обходное решение.
     1. На сервере назначения создайте базу данных оболочки с таким же именем, как у копируемой или перемещаемой базы данных.  См. раздел [Создание базы данных](../../relational-databases/databases/create-a-database.md).
     
     2. На странице **Конфигурация базы данных назначения** выберите пункт **Удалить на целевом сервере любую базу данных с тем же именем, затем продолжить передачу базы данных, перезаписывая существующие файлы базы данных**.

> **ВАЖНО!** При применении метода **отсоединения и присоединения** в качестве владельца базы данных будет задан пользователь, который запустил **мастер копирования базы данных**.  Инструкции по изменению владельца базы данных см. в статье [ALTER AUTHORIZATION (Transact-SQL)](../../t-sql/statements/alter-authorization-transact-sql.md) .
  
  
##  <a name="prerequisites"></a><a name="Prerequisites"></a> Предварительные требования  
-   На сервере назначения должен быть запущен агент SQL Server.  

-   Убедитесь, что каталоги файлов данных и файлов журналов на исходном сервере можно получить с целевого сервера.

-   При использовании метода **отсоединения и присоединения** на сервере назначения должна присутствовать учетная запись-посредник агента SQL Server для подсистемы SSIS, позволяющая получать доступ к файловой системе исходного и целевого серверов. Дополнительные сведения о прокси-серверах см. в статье [Создание учетной записи-посредника агента SQL Server](~/ssms/agent/create-a-sql-server-agent-proxy.md).

> **ВАЖНО!** Если при применении метода **отсоединения и присоединения** не используется учетная запись-посредник служб Integration Services, процесс копирования или перемещения завершится ошибкой.  В некоторых ситуациях база данных-источник не подключается к исходному серверу повторно, а все разрешения безопасности NTFS из файлов данных и файлов журналов вырезаются.  Если это произошло, найдите свои файлы, примените к ним соответствующие разрешения и заново подключите базу данных к своему экземпляру SQL Server.
  
##  <a name="recommendations"></a><a name="Recommendations"></a> Рекомендации  
  
-   Для обеспечения оптимальной производительности обновленной базы данных выполните процедуру [sp_updatestats (Transact-SQL)](../../relational-databases/system-stored-procedures/sp-updatestats-transact-sql.md) (обновление статистики) для обновленной базы данных.  
  
-   Если база данных перемещается или копируется с одного экземпляра сервера на другой, для обеспечения однородности среды для пользователей и приложений может потребоваться повторное создание некоторых (или даже всех) метаданных базы данных: имен входа, заданий и т. д. Дополнительные сведения см. в статье [Управление метаданными при обеспечении доступности базы данных на другом экземпляре сервера (SQL Server)](../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md).  
  

  
###  <a name="permissions"></a><a name="Permissions"></a> Permissions  
 Вы должны быть членом предопределенной роли сервера **sysadmin** как на исходном, так и на целевом сервере.  
  
##  <a name="the-copy-database-wizard-pages"></a><a name="Overview"></a> Страницы мастера копирования баз данных 
Запустите **мастер копирования баз данных** в среде SQL Server Management Studio из **обозревателя объектов** и разверните узел **Базы данных**.  Щелкните базу данных правой кнопкой мыши, наведите указатель мыши на пункт **Задачи** и выберите команду **Копировать базу данных**.  Если откроется всплывающая страница **Добро пожаловать в мастер копирования баз данных** , нажмите кнопку **Далее**.


### <a name="select-a-source-server"></a>Выбор исходного сервера
На этой странице можно указать сервер с базой данных, которую нужно переместить или копировать, а также ввести учетные данные.  После выбора метода проверки подлинности и введения сведений для входа нажмите кнопку **Далее** , чтобы установить соединения с исходным сервером.  Это соединение остается открытым в течение всего сеанса.

-    **Исходный сервер**  
Позволяет указать имя сервера, где находится база данных, которую нужно переместить или скопировать.  Введите имя сервера вручную или щелкните многоточие и выберите нужный сервер.  Версия сервера должна быть не ниже SQL Server 2005.

-    **Использовать проверку подлинности Windows**  
Для подключения можно использовать учетную запись Microsoft Windows.

-    **Использовать проверку подлинности SQL Server**  
Позволяет установить подключение, указав имя пользователя и пароль для проверки подлинности SQL Server.

     -    **User name**  
Позволяет ввести имя пользователя для соединения. Этот параметр доступен только при выборе **проверки подлинности SQL Server**.

     -    **Пароль**  
Позволяет ввести пароль для указанного имени входа. Этот параметр доступен только при выборе **проверки подлинности SQL Server**.

###  <a name="select-a-destination-server"></a>Выбор целевого сервера
Позволяет указать сервер, на который будет перемещена или скопирована база данных.  Если в качестве исходного и целевого сервера выбрать один и тот же экземпляр сервера, будет создана копия базы данных.  В этом случае необходимо задать другое имя для целевой базы данных в мастере.  Имя базы данных-источника может быть использовано в качестве имени скопированной или перемещенной базы данных только в том случае, если на целевом сервере не возникает конфликтов имен.  Если конфликты имен существуют, их необходимо разрешить вручную на целевом сервере, прежде чем там можно будет использовать имя базы данных-источника.
  
-    **Целевой сервер**  
Позволяет указать имя сервера, на который нужно переместить или скопировать базу данных.  Введите имя сервера вручную или щелкните многоточие и выберите нужный сервер.  Версия сервера должна быть не ниже SQL Server 2005.

     >**ПРИМЕЧАНИЕ.** В качестве целевого можно использовать кластеризованный сервер, при этом мастер копирования базы данных должен убедиться, что на кластеризованном целевом сервере выбраны только совместно используемые диски.

-    **Использовать проверку подлинности Windows**  
Для подключения можно использовать учетную запись Microsoft Windows.

-    **Использовать проверку подлинности SQL Server**  
Позволяет установить подключение, указав имя пользователя и пароль для проверки подлинности SQL Server.

     -    **User name**  
Позволяет ввести имя пользователя для соединения. Этот параметр доступен только при выборе **проверки подлинности SQL Server**.

     -    **Пароль**  
Позволяет ввести пароль для указанного имени входа. Этот параметр доступен только при выборе **проверки подлинности SQL Server**.

###  <a name="select-the-transfer-method"></a>Выбор метода передачи
 
-    **Использовать метод отсоединения и присоединения**  
Отключите базу данных от сервера-источника, скопируйте файлы базы данных (MDF-, NDF- и LDF-файлы) на целевой сервер и подключите базу данных на целевом сервере. Обычно это самый быстрый метод, так как основной выполняемой работой является считывание данных с диска источника и запись на целевой диск. Для создания объектов в базе данных или структур хранилищ данных не требуется логика [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Однако этот метод может быть более медленным, если база данных содержит большой объем выделенного, но неиспользуемого пространства. Если экземпляр содержит новую и практически пустую базу данных, под которую при создании было выделено 100 МБ, все эти 100 МБ будут скопированы, даже если заполнено всего 5 МБ.

     > **ПРИМЕЧАНИЕ.** Во время передачи данных этим методом база данных недоступна пользователям.

     -    **В случае ошибки восстановить подключение базы данных-источника**  
     При копировании базы данных файлы исходной базы данных всегда повторно присоединяются к исходному серверу. Установите этот флажок, чтобы заново присоединить исходные файлы к базе данных-источнику, если перемещение базы данных не может быть выполнено. 
  
-    **Использовать метод объектов SMO**  
     Этот метод выполняет чтение определения каждого объекта базы данных-источника и создание каждого из этих объектов в целевой базе данных. После этого происходит перенос данных из исходных таблиц в целевые таблицы с воссозданием индексов и метаданных.
  
     > [!NOTE]
     >  Во время переноса пользователи базы данных могут продолжать обращаться к ней. 
  
###  <a name="select-database"></a>Выбор базы данных
Позволяет выбрать одну или несколько баз данных, которые нужно переместить или скопировать с исходного сервера на целевой.  См. подраздел [Ограничения](#Restrictions) в начале раздела.  
  
-    **Перемещение**  
Переместить базы данных на целевой сервер.

-    **Копировать**  
Копировать базы данных на целевой сервер.

-    **Source**  
Показывает базы данных, присутствующие на исходном сервере.

-    **Состояние**  
Отображает различные сведения о базе данных-источнике.

-    **Обновить**  
Обновить список баз данных.
  
### <a name="configure-destination-database"></a>Конфигурация базы данных назначения
Позволяет изменить имя базы данных и задать размещение и имена файлов базы данных.  Эта страница отображается один раз для каждой перемещаемой или копируемой базы данных.

-    **База данных-источник**  
Определяет имя исходной базы данных.  Это текстовое поле не редактируется.

-    **Целевая база данных**  
Имя создаваемой целевой базы данных (при желании можно изменить).

-    **Файлы целевой базы данных:**  
     
     -    **Имя файла**  
Имя файла создаваемой целевой базы данных (при желании можно изменить).

     -    **Размер (МБ)**  
Размер файла целевой базы данных в мегабайтах.

     -    **Целевая папка**  
При желании папку для размещения файла целевой базы данных на целевом сервере можно изменить.

     -    **Состояние**  
Состояние

-    **Если целевая база данных уже существует:**  
     Укажите, какие действия следует предпринять, если целевая база данных уже существует.

     -    **Прекратить передачу, если в месте назначения существует база данных или файл с тем же именем**

     -    **Удалить на целевом сервере любую базу данных с тем же именем, затем продолжить передачу базы данных, перезаписывая существующие файлы базы данных.**

###  <a name="select-server-objects"></a>Выбор объектов сервера 
Эта страница доступна только в том случае, когда в качестве исходного и целевого серверов используются разные сервера.  
  
-    **Доступные связанные объекты**  
Список объектов, доступных для передачи на целевой сервер.  Чтобы включить объект, выберите имя объекта в поле **Доступные связанные объекты** , затем нажмите кнопку **>>** для перемещения объекта в поле **Выбранные связанные объекты** . 

-    **Выбранные связанные объекты**  
Список объектов, которые будут переданы на целевой сервер.  Чтобы исключить объект, выберите имя объекта в поле **Выбранные связанные объекты** , затем нажмите кнопку **<\<** для перемещения объекта в поле **Доступные связанные объекты** .  По умолчанию переносятся все объекты всех выбранных типов. Для выбора отдельных объектов любого типа нажмите кнопку с многоточием рядом с любым типом объекта в поле **Выбранные связанные объекты** .  Откроется диалоговое окно, в котором можно будет выбрать отдельные объекты.

-    **Список объектов сервера** 

      -    **Имена входа (выбрано по умолчанию)** 
  
     -    **задания агента SQL Server**  
  
     -    **Определяемые пользователем сообщения об ошибках**  
  
     -    **Конечные точки**  
  
     -    **Полнотекстовый каталог** 
  
     -    **Пакет служб SSIS**  
     
     -    **Хранимые процедуры из главной базы данных** 
          >**ПРИМЕЧАНИЕ.** Расширенные хранимые процедуры и связанные с ними DLL-файлы недоступны для автоматического копирования.  
    
  
###   <a name="location-of-source-database-files"></a>Расположение файлов исходной базы данных
Эта страница доступна только в том случае, когда в качестве исходного и целевого серверов используются разные сервера.  Укажите общую папку в файловой системе, содержащую файлы базы данных на исходном сервере.
  
-    **База данных**  
     Отображает имя каждой перемещаемой базы данных.  
  
-    **Местонахождение папки**  
Укажите расположение файлов базы данных на исходном сервере.
Например: `C:\Program Files\Microsoft SQL Server\MSSQL110.MSSQLSERVER\MSSQL\DATA`.

  
-    **Общая папка на исходном сервере**  
Укажите общую папку с файлами базы данных на исходном сервере.  Введите имя общей папки вручную или щелкните многоточие и выберите нужную папку.
Например: `\\server_name\C$\Program Files\Microsoft SQL Server\MSSQL110.MSSQLSERVER\MSSQL\Data`.

### <a name="configure-the-package"></a>Настройка пакета
Мастер копирования баз данных создает пакет служб SSIS для переноса базы данных.

-    **Размещение пакета**  
Указывает, куда будет записан пакет служб SSIS.

-    **Имя пакета**  
Имя по умолчанию для создаваемого пакета служб SSIS (при желании можно изменить).

-    **Параметры ведения журнала**  
Выберите сохранение сведений либо в журнал событий Windows, либо в текстовый файл.

-    **Путь к журналу ошибок**  
Этот параметр доступен только в том случае, если выбрано сохранение журнала в текстовый файл.  Укажите путь размещения файла журнала. 

### <a name="schedule-the-package"></a>Расписание пакета
Позволяет указать, когда должна начаться операция перемещения или копирования.  Если вы не являетесь системным администратором, необходимо указать учетную запись-посредник агента SQL Server, имеющую доступ к подсистеме выполнения пакетов служб Integration Services (SSIS).

> **ВАЖНО!** При применении метода **отсоединения и присоединения** необходимо использовать учетную запись-посредник служб SSIS.  

-    **Run immediately**  
     После завершения работы мастера будет выполнен пакет служб SSIS.
  
-    **Расписание**  
     Пакет служб SSIS будет выполнен по расписанию. 
  
     -    **Изменение расписания**   
Открывает диалоговое окно **Создание расписания задания** .  Настройте расписание желаемым образом.  Щелкните **OK**, когда все будет готово.


-    **Учетная запись-посредник служб SSIS** . Выберите в раскрывающемся списке учетную запись-посредник.  Чтобы задать расписание перемещения, пользователь должен иметь по крайней мере одну учетную запись-посредник, настроенную с разрешением доступа к подсистеме **Выполнение пакетов служб SSIS**.

        Чтобы создать учетную запись-посредник для выполнения пакетов служб SSIS, в **обозревателе объектов** разверните узел **Агент SQL Server**, а затем **Учетная запись-посредник**, щелкните правой кнопкой мыши пункт **Выполнение пакетов служб SSIS** и выберите команду **Создать учетную запись-посредник**.

### <a name="complete-the-wizard"></a>Завершение работы мастера
Отображает сводку выбранных параметров.  Нажмите кнопку **Назад** для изменения параметров.  Чтобы создать пакет SSIS, нажмите кнопку **Готово** . На странице **Выполнение операции** отображаются данные о состоянии выполнения операций, заданных в **мастере копирования баз данных**.

-    **Действие**  
 Отображает список всех выполняемых действий.

-    **Состояние**  
 Указывает, выполнено действие успешно или нет.

-    **Message**  
Предоставляет все сообщения, возвращаемые в каждом шаге.

##  <a name="examples"></a><a name="Examples"></a> Примеры
### <a name="common-steps"></a>**Общие шаги** 
Перечисленные ниже пять шагов выполняются независимо от того, какое выбрано действие — **Перемещение** , **Копирование**, **Присоединение и отсоединение** и **SMO**.  Для краткости эти шаги перечислены однократно, а приводить примеры мы начнем с **шага 6**.

1.  В **обозревателе объектов** подключитесь к экземпляру компонента SQL Server Database Engine и разверните его.

2.  Разверните узел **Базы данных**, щелкните правой кнопкой мыши нужную базу данных, укажите пункт **Задачи** и выберите команду **Копировать базу данных...**

3.  Если откроется всплывающая страница **Добро пожаловать в мастер копирования баз данных** , нажмите кнопку **Далее**.

4.  На странице **Выбор исходного сервера** укажите сервер с базой данных, которую нужно переместить или скопировать.  Выберите метод проверки подлинности.  Если выбран параметр **Проверка подлинности SQL Server** , необходимо ввести учетные данные.  Нажмите **Далее** , чтобы подключиться к исходному серверу.  Это соединение остается открытым в течение всего сеанса.

5.  На странице **Выбор целевого сервера** укажите сервер, на который необходимо переместить или скопировать базу данных.  Выберите метод проверки подлинности.  Если выбран параметр **Проверка подлинности SQL Server** , необходимо ввести учетные данные.  Нажмите **Далее** , чтобы подключиться к исходному серверу.  Это соединение остается открытым в течение всего сеанса.

     > **ПРИМЕЧАНИЕ.** Мастер копирования базы данных можно запустить из любой базы данных.  Мастер можно использовать как на исходном, так и на целевом сервере.
  
### <a name="a--move-database-using-detach-and-attach-method-to-an-instance-on-a-different-physical-server--a-login-and-sql-server-agent-job-will-be-moved-as-well"></a>**А.  Перемещение базы данных в экземпляр на другом физическом сервере с использованием метода отсоединения и присоединения.  Также перемещаются имя входа и задание агента SQL Server.**  
В следующем примере база данных `Sales` , имя входа Windows `contoso\Jennie` и задание агента SQL Server `Jennie's Report` переносятся из экземпляра SQL Server 2008 на сервера `Server1` в экземпляр SQL Server 2016 на сервере `Server2`.  `Jennie's Report` использует базу данных `Sales` .  `Sales` еще не существует на целевом сервере `Server2`.  `Server1` после перемещения базы данных будет назначен другой команде.
  
6.  Как было указано выше в разделе [Ограничения](#Restrictions), при переносе задания агента SQL Server, который ссылается на базу данных, не существующую на целевом сервере, необходимо создать на целевом сервере базу данных оболочки.  Создайте на целевом сервере базу данных оболочки с именем `Sales` . 

7.  Вернитесь в **мастер** на страницу **Выбор метода передачи** . Просмотрите и оставьте значения по умолчанию.  Нажмите кнопку **Далее**.
  
8.  Страница **Выбор баз данных** . Установите флажок **Переместить** напротив соответствующей базы данных `Sales`.  Нажмите кнопку **Далее**.
  
9.  Страница **Настройка целевой базы данных** . **Мастер** указал, что база данных `Sales` уже существует на целевом сервере, поскольку она была создана при выполнении описанного выше **шага 6** , и добавил `_new` к имени **целевой базы данных** .  Удалите `_new` в текстовом поле **Целевая база данных** .  При необходимости измените значения полей **Имя файла** и **Целевая папка**.  Установите переключатель **Удалить на целевом сервере любую базу данных с тем же именем, затем продолжить передачу базы данных, перезаписывая существующие файлы базы данных**.  Нажмите кнопку **Далее**.
  
10. Страница **Выбор объектов сервера** . В области **Выбранные связанные объекты** щелкните кнопку с многоточием в поле **Имя объекта > Имена входа**.  В разделе **Параметры копирования** установите флажок **Копировать только выбранные имена входа:**.  Установите флажок **Показать все имена входа для сервера**.  Установите флажок **Имя входа** напротив `contoso\Jennie`.  Нажмите кнопку **ОК**.  В области **Доступные связанные объекты** установите флажок **Задания агента SQL Server** и нажмите кнопку **>** .  В области **Выбранные связанные объекты** щелкните кнопку с многоточием в поле **Задания агента SQL Server**.  В разделе **Параметры копирования** установите флажок **Копировать только выбранные задания**.  Установите флажок напротив `Jennie's Report`.  Нажмите кнопку **ОК**.  Щелкните **Далее**.  
  
11. Страница **Расположение файлов исходной базы данных** . Щелкните кнопку с многоточием в поле **Общая папка на исходном сервере** и перейдите в заданную папку.  Например, если папка находится по адресу `D:\MSSQL13.MSSQLSERVER\MSSQL\DATA` , укажите `\\Server1\D$\MSSQL13.MSSQLSERVER\MSSQL\DATA` в поле **Общая папка на исходном сервере**.  Нажмите кнопку **Далее**.
  
12. Страница **Настройка пакета** . В текстовом поле **Имя пакета** введите `SalesFromServer1toServer2_Move`.  Установите флажок **Сохранить журнал передачи?** .  В раскрывающемся списке **Параметры ведения журнала** выберите пункт **Текстовый файл**.  Проверьте и при желании измените значение поля **Путь к файлу журнала ошибок**.  Нажмите кнопку **Далее**.  
  
     > **ПРИМЕЧАНИЕ.****Путь к файлу журнала ошибок** — это путь к папке на целевом сервере.
  
13. Страница **Расписание пакета** . Выберите соответствующий прокси-сервер в раскрывающемся списке **Учетная запись-посредник служб SSIS** .  Нажмите кнопку **Далее**.

14. Страница **Завершение работы мастера** . Просмотрите сводку выбранных параметров.  Нажмите кнопку **Назад** для изменения параметров.  Нажмите кнопку **Готово** , чтобы выполнить задачу.  Во время передачи на странице **Выполнение операции** отображаются данные о состоянии выполнения операций, заданных в **мастере**.

15. Страница **Выполняется операция** . После успешного выполнения операции нажмите кнопку **Готово**.  Если операция завершится неудачно, вы можете просмотреть журнал ошибок и нажать кнопку **Назад** для последующего анализа.  Если это не требуется, нажмите кнопку **Закрыть**.
  
16. **Действия после перемещения** . На новом узле `Server2`можно выполнить следующие инструкции T-SQL:
  
     ~~~ tsql 
     ALTER AUTHORIZATION ON DATABASE::Sales TO sa;

     ALTER DATABASE Sales 
     SET COMPATIBILITY_LEVEL = 130;

     USE Sales
     GO

     EXEC sp_updatestats;
     ~~~
 
17. **Действия после перемещения: очистка**  
Поскольку `Server1` перемещается в другую команду, а операция **Перемещение** повторяться не будет, можно выполнить следующие шаги:
     -    Удаление пакета служб SSIS `SalesFromServer1toServer2_Move` на сервере `Server2`.
     -    Удаление задания агента SQL Server `SalesFromServer1toServer2_Move` на сервере `Server2`.
     -    Удаление задания агента SQL Server `Jennie's Report` на сервере `Server1`.
     -    Удаление имени входа `contoso\Jennie` на сервере `Server1`.


### <a name="b-----copy-database-using-detach-and-attach-method-to-the-same-instance-and-set-recurring-schedule"></a>**Б.     Копирование базы данных методом отсоединения и присоединения в тот же экземпляр и настройка повторяющегося расписания.**  
В этом примере база данных `Sales` будет скопирована и создана как база данных `SalesCopy` в том же экземпляре.  После этого база данных `SalesCopy`будут создаваться заново еженедельно.

6.  Страница **Выбор метода передачи** . Просмотрите и оставьте значения по умолчанию.  Нажмите кнопку **Далее**.

7.  Страница **Выбор баз данных** . Установите флажок **Копировать** напротив базы данных `Sales` .  Нажмите кнопку **Далее**.

8.  Страница **Настройка целевой базы данных** . Измените имя **целевой базы данных** на `SalesCopy`.  При необходимости измените значения полей **Имя файла** и **Целевая папка**.  Установите переключатель **Удалить на целевом сервере любую базу данных с тем же именем, затем продолжить передачу базы данных, перезаписывая существующие файлы базы данных**.  Нажмите кнопку **Далее**.

9.  Страница **Настройка пакета** . В текстовом поле **Имя пакета** введите `SalesCopy Weekly Refresh`.  Установите флажок **Сохранить журнал передачи?** .  Нажмите кнопку **Далее**.

10. Страница **Расписание пакета** . Установите переключатель **Расписание:** и нажмите кнопку **Изменить расписание** . 
 
    1. Страница **Создание расписаний заданий** . В текстовом поле **Имя** введите `Weekly on Sunday`. 
          
    2. Нажмите кнопку **ОК**.

11. Выберите соответствующий прокси-сервер в раскрывающемся списке **Учетная запись-посредник служб SSIS** .  Нажмите кнопку **Далее**.

12. Страница **Завершение работы мастера** . Просмотрите сводку выбранных параметров.  Нажмите кнопку **Назад** для изменения параметров.  Нажмите кнопку **Готово** , чтобы выполнить задачу.  Во время создания пакета на странице **Выполнение операции** отображаются данные о состоянии выполнения операций, заданных в **мастере**.

13. Страница **Выполняется операция** . После успешного выполнения операции нажмите кнопку **Готово**.  Если операция завершится неудачно, вы можете просмотреть журнал ошибок и нажать кнопку **Назад** для последующего анализа.  Если это не требуется, нажмите кнопку **Закрыть**.

14. Запустите вновь созданное задание агента SQL Server `SalesCopy weekly refresh`вручную.  Просмотрите журнал заданий и убедитесь, что база данных `SalesCopy` появилась в экземпляре.

  
##  <a name="follow-up-after-upgrading-a-database"></a><a name="FollowUp"></a> Дальнейшие действия. После обновления базы данных  
 После обновления базы данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] до [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]с помощью мастера копирования баз данных эта база данных сразу же становится доступной и обновляется автоматически. Если база данных содержит полнотекстовые индексы, то в процессе обновления будет произведен их импорт, сброс или перестроение в зависимости от установленного значения свойства сервера **Режим обновления полнотекстового каталога** . Если при обновлении выбран режим **Импортировать** или **Перестроить**, то полнотекстовые индексы во время обновления будут недоступны. В зависимости от объема индексируемых данных процесс импорта может занять несколько часов, а перестроение — в несколько (до десяти) раз больше. Обратите внимание, что если при обновлении выбран режим **Импортировать**, а полнотекстовый каталог недоступен, то связанные с ним полнотекстовые индексы будут перестроены. Сведения о просмотре и изменении параметра **Режим обновления полнотекстового поиска** см. в статье [Наблюдение за полнотекстовым поиском для экземпляра сервера и управление им](../../relational-databases/search/manage-and-monitor-full-text-search-for-a-server-instance.md).  
  
 Если уровень совместимости пользовательской базы данных до обновления был 100 или выше, после обновления он останется таким же. Если уровень совместимости был 90, то в обновленной базе данных устанавливается уровень 100, что является минимально поддерживаемым уровнем совместимости в [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]. Дополнительные сведения см. в разделе [Уровень совместимости инструкции ALTER DATABASE (Transact-SQL)](../../t-sql/statements/alter-database-transact-sql-compatibility-level.md).  
 
 ## <a name="post-copy-or-move-considerations"></a><a name="Post"></a> Действия после копирования или перемещения
 После завершения **копирования** или **перемещения** можно выполнить следующее действие:
-    Смена владельца баз данных после применения метода отсоединения и присоединения.
-    Удаление объектов сервера на исходном сервере после **перемещения**.
-    Удаление пакета служб SSIS, созданного с помощью мастера на целевом сервере.
-    Удаление задания агента SQL Server, созданного с помощью мастера на целевом сервере.

  
## <a name="more-information"></a>Дополнительные сведения 
 [Обновление базы данных при помощи отсоединения и присоединения (Transact-SQL)](../../relational-databases/databases/upgrade-a-database-using-detach-and-attach-transact-sql.md)   
 [Создание учетной записи-посредника агента SQL Server](../../ssms/agent/create-a-sql-server-agent-proxy.md)  
  
  

