---
title: Повышение производительности с помощью рекомендаций DTA
description: Сведения о том, как помощник по настройке ядра СУБД может рекомендовать сочетание индексов rowstore и columnstore на основе анализа рабочей нагрузки баз данных в SQL Server.
ms.custom: seo-dt-2019
ms.date: 03/07/2017
ms.prod: sql
ms.reviewer: ''
ms.technology: performance
ms.topic: conceptual
helpviewer_keywords:
- Database Engine Tuning Advisor, performance improvements
ms.assetid: 2e51ea06-81cb-4454-b111-da02808468e6
author: WilliamDAssafMSFT
ms.author: wiassaf
ms.openlocfilehash: e6d392cedebec98c00ca6dac84dcc1d2fee21258
ms.sourcegitcommit: 0e0cd9347c029e0c7c9f3fe6d39985a6d3af967d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/02/2020
ms.locfileid: "96505108"
---
# <a name="performance-improvements-using-database-engine-tuning-advisor-dta-recommendations"></a>Повышение производительности с помощью рекомендаций помощника по настройке ядра СУБД (DTA)
 [!INCLUDE [SQL Server](../../includes/applies-to-version/sqlserver.md)]


---
Использование индексов **columnstore** существенно повышает производительность рабочих нагрузок хранилища данных и анализа, в частности запросов, просматривающих большие таблицы. Индексы **rowstore** (дерево B+) наиболее эффективны для запросов, которые обращаются к относительно небольшим объемам данных для поиска конкретного значения или диапазона значений. Так как индексы rowstore хранят строки в отсортированном порядке, они также могут снизить затраты на сортировку в плане выполнения запросов. Таким образом, выбор сочетания индексов rowstore и columnstore, которые нужно построить, зависит от рабочей нагрузки приложения.

Начиная с SQL Server 2016, помощник по настройке ядра СУБД (DTA) может рекомендовать подходящее **сочетание индексов rowstore и columnstore** на основе анализа рабочей нагрузки баз данных. 

Чтобы продемонстрировать преимущества рекомендаций DTA по повышению производительности рабочей нагрузки, мы поэкспериментировали с несколькими реальными рабочими нагрузками клиентов. DTA проанализировал отдельные запросы, а также полную рабочую нагрузку запросов каждой рабочей нагрузки клиентов. Рассмотрим три альтернативных варианта:
  
  1. **Только columnstore**: построение для всех таблиц только индексов columnstore без использования DTA. 
  2. **DTA (только rowstore)** : выполнение DTA с возможностью рекомендовать только индексы rowstore.
  3. **DTA (rowstore и columnstore)** : выполнение DTA с возможностью рекомендовать индексы rowstore и columnstore.  
   
В каждом случае мы реализовали рекомендованные индексы. Мы сообщили время ЦП (в миллисекундах), усредненное по нескольким запускам запроса или рабочей нагрузки. На графике ниже представлено время ЦП (в миллисекундах) для рабочих нагрузок в двух разных базах данных клиентов. Обратите внимание, что ось У (время ЦП) использует логарифмическую шкалу.   


![Снимок экрана: линейчатая диаграмма производительности columnstore и rowstore DTA.](../../relational-databases/performance/media/dta-columnstore-rowstore-performance.gif)



**Потребность в смешанных физических схемах**. Первая гистограмма соответствует запросу 1 первого клиента. DTA (rowstore и columnstore) рекомендует набор из четырех индексов columnstore и шести rowstore, что позволит сократить время ЦП в 2,5–4 раза в сравнении с использованием только индексов columnstore и DTA (только rowstore). Этот пример демонстрирует преимущества смешанной физической схемы, состоящей из индексов rowstore и columnstore (*даже для одного запроса*). 

**Эффективность рекомендаций индекса rowstore.** Вторая и третья гистограммы (соответствующие запросу 2 первого клиента и запросу 1 второго клиента) демонстрируют запросы, содержащие выборочные фильтры предикатов, выигрывающие от подходящих индексов rowstore. Для обоих этих запросов DTA (только rowstore) и DTA (rowstore и columnstore) рекомендуют использовать только индексы rowstore. В этих примерах также показано, что даже если DTA вызывается с возможностью рекомендовать индексы columnstore, его подход на основе затрат ресурсов гарантирует, что индекс columnstore будет рекомендован, только если он будет действительно полезен для рабочей нагрузки.

**Эффективность рекомендаций индекса columnstore.** Четвертая гистограмма, соответствующая запросу 2 второго клиента, рассматривает случай, когда запрос просматривает большие таблицы, получающие преимущества от индексов columnstore. DTA (только rowstore) формирует рекомендацию, обеспечивающую большее время ЦП по сравнению с тем, когда также используются индексы columnstore. Таким образом, DTA (rowstore и columnstore) рекомендует подходящие индексы columnstore, обеспечивая ту же производительность выполнения запроса, что и при использовании параметра "только columnstore".

**Эффективность рекомендаций для рабочей нагрузки с несколькими запросами.** Конечный набор столбцов, соответствующий полной рабочей нагрузке для второго клиента, служит примером возможности DTA анализировать несколько запросов рабочей нагрузки для рекомендации подходящего набора индексов rowstore и columnstore, который может снизить затраты на выполнение общей рабочей нагрузки. DTA (rowstore и columnstore) рекомендует использовать набор из четырех индексов columnstore и десяти rowstore, в результате чего на порядок будет улучшена производительность рабочей нагрузки в сравнении с параметром, который создает только индексы columnstore, и в 4–5 раз в сравнении с DTA (только rowstore).

Таким образом, в приведенных выше примерах показана возможность DTA правильно использовать индексы rowstore и columnstore, поддерживаемая в ядре СУБД SQL Server, и рекомендуется подходящая комбинация индексов, которая сможет существенно снизить время ЦП для рабочей нагрузки. 

<a name="see-also"></a>См. также:
---
[Database Engine Tuning Advisor](../../relational-databases/performance/database-engine-tuning-advisor.md)

[Рекомендации по индексам сolumnstore в помощнике по настройке ядра СУБД](../../relational-databases/performance/columnstore-index-recommendations-in-database-engine-tuning-advisor-dta.md)

[Руководство по индексам columnstore](~/relational-databases/indexes/columnstore-indexes-overview.md)

[Индексы сolumnstore для хранилищ данных](~/relational-databases/indexes/columnstore-indexes-data-warehouse.md)

[CREATE COLUMNSTORE INDEX (Transact-SQL)](../../t-sql/statements/create-columnstore-index-transact-sql.md)

[Инструкция CREATE INDEX (Transact-SQL)](../../t-sql/statements/create-index-transact-sql.md)



