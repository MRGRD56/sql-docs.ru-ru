---
title: Наблюдение за компонентами SQL Server | Документация Майкрософт
description: Сведения о том, как мониторинг позволяет выявлять тенденции производительности. SQL Server предоставляет службу в динамической среде, поэтому с течением времени может потребоваться внесение изменений.
ms.custom: ''
ms.date: 11/27/2018
ms.prod: sql
ms.reviewer: ''
ms.technology: performance
ms.topic: conceptual
ms.assetid: e8f1b16b-ea40-4e12-886c-967ebda4e6e4
author: WilliamDAssafMSFT
ms.author: wiassaf
ms.openlocfilehash: 518dce515ebf4f89a35dfc960872e4856afc5428
ms.sourcegitcommit: 0e0cd9347c029e0c7c9f3fe6d39985a6d3af967d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/02/2020
ms.locfileid: "96505171"
---
# <a name="monitor-sql-server-components"></a>Наблюдение за компонентами SQL Server
 [!INCLUDE [SQL Server](../../includes/applies-to-version/sqlserver.md)]
  Важность мониторинга обусловлена динамикой среды, в которой выполняется [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Данные приложений постоянно изменяются. Меняется тип доступа, который требуется пользователям. Меняется способ подключения пользователей. Может измениться даже тип приложений, обращающихся к [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , однако [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] автоматически управляет такими системными ресурсами, как память и место на диске, поэтому ручная настройка системы практически не требуется. Мониторинг позволяет администраторам следить за тенденциями изменения производительности и определять ситуации, когда требуются изменения.  
  
Для организации эффективного мониторинга компонентов [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] выполните следующие действия.  
  
1.  Определите цели мониторинга.  
2.  Выберите подходящее средство.    
3.  Определите компоненты, подлежащие мониторингу.  
4.  Выберите метрики для этих компонентов.  
5.  Произведите мониторинг работы сервера.  
6.  Проанализируйте данные.  
  
Ниже подробно описан каждый шаг.  
  
## <a name="determine-your-monitoring-goals"></a>Определение целей мониторинга  
Чтобы обеспечить эффективность мониторинга [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , необходимо четко определить, для чего он нужен. Мониторинг может осуществляться в следующих целях.  
  
-   Формирование основных критериев оценки производительности.  
-   Определение изменений производительности во времени.  
-   Диагностика проблем, связанных с производительностью.  
-   Определение компонентов и процессов, требующих оптимизации.  
-   Сравнение влияния различных клиентских приложений на производительность.  
-   Аудит активности пользователей.  
-   Проверка работы сервера под воздействием различных нагрузок.  
-   Проверка архитектуры базы данных.  
-   Проверка расписания обслуживания.  
-   Проверка планов резервного копирования и восстановления.  
-   Определение необходимости изменения конфигурации оборудования.  
  
## <a name="select-the-appropriate-tool"></a>Выбор подходящего средства  
Определив цели мониторинга, следует выбрать соответствующие средства для этого типа мониторинга: В состав [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и операционной системы Windows входит полный набор средств мониторинга серверов в средах с большим количеством транзакций. Эти средства подробно описывают состояние экземпляра компонента SQL Server Database Engine или экземпляра служб SQL Server Analysis Services.  
  
Windows предоставляет следующие средства мониторинга приложений, запущенных на сервере.  
  
-   [Системный монитор](../../relational-databases/performance/start-system-monitor-windows.md), который позволяет собирать и просматривать данные об использовании памяти, диска и процессора в реальном времени.  
-   Журналы и предупреждения производительности  
-   Диспетчер задач  
  
Дополнительные сведения о средствах Windows Server и Windows см. в документации по операционной системе Windows.  
  
[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] предоставляет следующие средства мониторинга компонентов [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]:  
  
-   [Расширенные события](../../relational-databases/extended-events/extended-events.md)
-   [Трассировка SQL](../../relational-databases/sql-trace/sql-trace.md)  
-   [Приложение SQL Server Profiler](../../tools/sql-server-profiler/sql-server-profiler.md)  
-   [Программа распределенного воспроизведения](../../tools/distributed-replay/sql-server-distributed-replay.md)  
-   [Монитор активности](../../relational-databases/performance-monitor/activity-monitor.md)  
-   [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] Графическое отображение инструкции Showplan  
-   [Системные хранимые процедуры](../../relational-databases/system-stored-procedures/system-stored-procedures-transact-sql.md)
-   [Консольные команды базы данных (DBCC)](../../t-sql/database-console-commands/dbcc-transact-sql.md)  
-   [Динамические административные представления и функции](../../relational-databases/system-dynamic-management-views/system-dynamic-management-views.md)   
-   [Функции](../../t-sql/functions/functions.md)   
-   [Флаги трассировки](../../t-sql/database-console-commands/dbcc-traceon-trace-flags-transact-sql.md)   

> [!IMPORTANT]
> Трассировка SQL и [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] являются устаревшими. Пространство имен *Microsoft.SqlServer.Management.Trace*, которое содержит объекты трассировки Microsoft SQL Server и Replay, также устаревшее. 
> [!INCLUDE[ssNoteDepFutureAvoid](../../includes/ssnotedepfutureavoid-md.md)] 
> Вместо этого используйте расширенные события. Дополнительные сведения о [расширенных событиях](../../relational-databases/extended-events/extended-events.md) см. в разделе [Быстрое начало. Расширенные события в SQL Server](../../relational-databases/extended-events/quick-start-extended-events-in-sql-server.md) и [SSMS XEvent Profiler](../../relational-databases/extended-events/use-the-ssms-xe-profiler.md).

> [!NOTE]
> [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] для рабочей нагрузки служб Analysis Services не устарел и будет по-прежнему поддерживаться.

Дополнительные сведения о средствах наблюдения [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] см. в статье [Средства контроля и настройки производительности](../../relational-databases/performance/performance-monitoring-and-tuning-tools.md).  
  
## <a name="identify-the-components-to-monitor"></a>Определение компонентов, подлежащих мониторингу  
На этом шаге требуется определить компоненты [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , которые нужно контролировать. Например, при трассировке сервера при помощи приложения [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] можно собирать данные об определенных событиях. Кроме того, можно исключить из трассировки события, ненужные в данной конкретной ситуации.  
  
## <a name="select-metrics-for-monitored-components"></a>Выбор метрик для наблюдаемых компонентов  
Определив компоненты, подлежащие мониторингу, укажите метрики. Например, выбрав события для включения в трассировку, можно указать, какие именно данные требуются для анализа. Ограничив круг отслеживаемых данных можно сэкономить ресурсы системы, которые требуются для выполнения трассировки.  
  
## <a name="monitor-the-server"></a>Мониторинг работы сервера  
Для наблюдения за сервером запустите средство мониторинга, настроенное для сбора данных. Например, определив трассировку, запустите ее, чтобы собрать данные о событиях, происходящих на сервере.  

## <a name="analyze-the-data"></a>Анализ данных  
После окончания трассировки проанализируйте данные и попытайтесь понять, достигнута ли цель мониторинга. Если нет, измените компоненты или метрики, которые используются для мониторинга сервера.  
  
Ниже описан процесс сбора данных о событиях и работа с ними.  
  
1.  Примените фильтры, чтобы ограничить объем собираемых данных о событиях.  
  
    Фильтры позволяют системе собирать данные только о тех событиях, которые имеют отношение к поставленной задаче мониторинга. Например, если требуется проконтролировать медленные запросы, с помощью фильтра можно собрать данные только о тех запросах к конкретной базе данных, которые выполняются более 30 секунд. 
    
    Дополнительные сведения о фильтрации расширенных событий см. в разделе [Быстрое начало. Расширенные события в SQL Server](../../relational-databases/extended-events/quick-start-extended-events-in-sql-server.md#demo-of-ssms-integration). 
    
    Дополнительные сведения о фильтрации трассировки SQL см. в статьях [Создание фильтра трассировки (Transact-SQL)](../../relational-databases/sql-trace/set-a-trace-filter-transact-sql.md) и [Фильтрация событий в трассировке (приложение SQL Server Profiler)](../../tools/sql-server-profiler/filter-events-in-a-trace-sql-server-profiler.md).  
  
2.  Соберите данные о событиях.  
  
    После включения мониторинга собираются данные указанного приложения, экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]или операционной системы. Например, при мониторинге активности диска с помощью системного монитора собираются и отображаются на экране данные о событиях чтения и записи. Дополнительные сведения см. в статье [Наблюдение за использованием ресурсов (системный монитор)](../../relational-databases/performance-monitor/monitor-resource-usage-system-monitor.md).  
  
3.  Сохраните собранные данные о событиях.  
  
    Благодаря сохранению эти данные можно позднее проанализировать. Собранные данные о событиях сохраняются в файле, который впоследствии можно загрузить обратно в средство, изначально создавшее этот файл для целей анализа. Возможность сохранения играет важную роль при определении базового уровня производительности. Данные базового уровня производительности сохраняются и используются для сравнения с данными новых событий, что позволяет определить, является ли производительность оптимальной.
    
    Расширенные события позволяют сохранять данные в файл событий, счетчик событий, гистограмму и кольцевой буфер. Дополнительные сведения см. в статье [Целевые объекты для расширенных событий в SQL Server](../../relational-databases/extended-events/targets-for-extended-events-in-sql-server.md).
    
    Данные событий трассировки SQL можно даже воспроизводить с помощью программы распределенного воспроизведения или [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)]. [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] позволяет сохранять данные о событиях в файл или таблицу [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Дополнительные сведения см. в статье [Шаблоны и разрешения приложения SQL Server Profiler](../../tools/sql-server-profiler/sql-server-profiler-templates-and-permissions.md).  
  
4.  Создайте шаблоны трассировки, содержащие параметры сбора событий.  
  
    Шаблоны трассировки включают определения самих событий, данных о событиях и фильтрах, которые применяются для сбора данных. Эти шаблоны применяются для мониторинга определенного набора событий в будущем и не требуют переопределения событий, данных и фильтров. Например, если часто приходится наблюдать за количеством взаимоблокировок и за тем, какие пользователи затронуты этими взаимоблокировками, можно создать шаблон, определив нужные события, данные событий и фильтры, и сохранить его в отдельном файле; впоследствии этот фильтр можно использовать для наблюдения за взаимоблокировками.
    
    Определения сеанса расширенных событий — это шаблон, который можно включить в скрипт и использовать повторно. Сведения о создании сеансов и управлении ими см. в статье [Управление сеансами событий в обозревателе объектов](../../relational-databases/extended-events/manage-event-sessions-in-the-object-explorer.md). Профилировщик XEvent для [!INCLUDE[ssManStudio](../../includes/ssManStudio-md.md)] уже содержит готовые к использованию шаблоны. Дополнительные сведения см. в статье [Использование профилировщика XEvent для SSMS](../../relational-databases/extended-events/use-the-ssms-xe-profiler.md).
       
    [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] для этой цели используются шаблоны трассировки. Дополнительные сведения см. в статьях [Установка определения трассировки по умолчанию (приложение SQL Server Profiler)](../../tools/sql-server-profiler/set-trace-definition-defaults-sql-server-profiler.md) и [Создание шаблона трассировки (приложение SQL Server Profiler)](../../tools/sql-server-profiler/create-a-trace-template-sql-server-profiler.md).  
    
    > [!TIP]
    > Определение трассировки SQL можно преобразовать в сеанс расширенных событий. Дополнительные сведения см. в статье [Преобразование существующего скрипта трассировки SQL в сеанс расширенных событий](../../relational-databases/extended-events/convert-an-existing-sql-trace-script-to-an-extended-events-session.md).
  
5.  Проанализируйте собранные данные о событиях.  
  
     Для анализа сохраненные данные загружаются в приложение, с помощью которого они были собраны. 
     
     Например, собранную трассировку расширенных событий можно повторно загрузить в [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] для просмотра и анализа. Дополнительные сведения см. в разделе [Advanced Viewing of Target Data from Extended Events in SQL Server](../../relational-databases/extended-events/advanced-viewing-of-target-data-from-extended-events-in-sql-server.md)(Расширенный просмотр целевых данных из расширенных событий в SQL Server).

     Данные трассировки SQL можно повторно загрузить в [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] для просмотра и анализа. Дополнительные сведения см. в статье [Просмотр и анализ трассировок с помощью приложения SQL Server Profiler](../../tools/sql-server-profiler/view-and-analyze-traces-with-sql-server-profiler.md).  
  
     Анализ данных подразумевает определение того, что происходит и почему. В зависимости от типа анализа эти сведения позволяют совершить действия, которые могут увеличить производительность, например добавить память, изменить индексы, исправить проблемы в коде инструкций [!INCLUDE[tsql](../../includes/tsql-md.md)] или хранимых процедур и т. п. Например, используя помощник по настройке [!INCLUDE[ssDE](../../includes/ssde-md.md)], можно проанализировать собранную трассировку из расширенных событий или [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)], и на основе результатов сформировать рекомендации.  
  
6.  Воспроизведите собранные данные о событиях (необязательно).  
  
     Возможность воспроизведения позволяет создать копию базы данных, в которой были собраны данные, и повторить события, как будто они произошли в реальной системе. Это возможно только в программе распределенного воспроизведения или в приложении [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)]. События можно воспроизводить с первоначальной скоростью, с максимально возможной скоростью (чтобы загрузить систему) или пошагово (чтобы проанализировать состояние системы после каждого события). Анализ событий в тестовой среде позволяет избежать повреждений в производственной системе. Дополнительные сведения см. в статье [Воспроизведение трассировок](../../tools/sql-server-profiler/replay-traces.md).  
  
  
