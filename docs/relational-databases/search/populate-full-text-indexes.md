---
description: Заполнение полнотекстовых индексов
title: Заполнение полнотекстовых индексов | Документация Майкрософт
ms.date: 03/14/2017
ms.prod: sql
ms.prod_service: search, sql-database
ms.technology: search
ms.topic: conceptual
helpviewer_keywords:
- index populations [full-text search]
- incremental populations [full-text search]
- populations [full-text search]
- full-text search [SQL Server], populations
- crawls [full-text search]
- automatic full-text index updates
- change tracking-based populations [full-text search]
- manual updates [full-text search]
- manual populations [full-text search]
- auto populations [full-text search]
- full-text indexes [SQL Server], key column
- full populations [full-text search]
- full-text indexes [SQL Server], populations
ms.assetid: 76767b20-ef55-49ce-8dc4-e77cb8ff618a
author: pmasl
ms.author: pelopes
ms.reviewer: mikeray
monikerRange: =azuresqldb-current||>=sql-server-2016||>=sql-server-linux-2017||=azuresqldb-mi-current
ms.openlocfilehash: ac09b96cf93144ebf2b615bbd73db36c673eb5ca
ms.sourcegitcommit: 1a544cf4dd2720b124c3697d1e62ae7741db757c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/14/2020
ms.locfileid: "97479465"
---
# <a name="populate-full-text-indexes"></a>Заполнение полнотекстовых индексов
[!INCLUDE [SQL Server Azure SQL Database](../../includes/applies-to-version/sql-asdb.md)]
  Создание и обслуживание полнотекстового индекса включает процесс *заполнения* индекса (которое также называется *сканированием*).  
  
##  <a name="types-of-population"></a><a name="types"></a> Types of population  
Полнотекстовый индекс поддерживает следующие типы заполнения:
-   **полное** заполнение;
-   заполнение на основе **отслеживания изменений** (автоматическое или вручную);
-   добавочное заполнение с использованием **отметок времени**.
  
## <a name="full-population"></a>Полное заполнение  
 Во время полного заполнения индексные записи строятся для всех строк таблицы или индексированного представления. Во время полного заполнения полнотекстового индекса индексные записи строятся для всех строк базовой таблицы или индексированного представления.  
  
По умолчанию [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] полностью заполняет новый полнотекстовый индекс сразу после его создания.
-   С одной стороны, полное заполнение может потреблять значительный объем ресурсов. Поэтому при создании полнотекстовых индексов во время периодов наибольшей потребности в ресурсах часто полезно бывает отложить полное заполнение на период наименьшего потребления ресурсов, особенно если базовая таблица полнотекстового индекса имеет большой размер.
-   С другой стороны, полнотекстовый каталог, к которому относится индекс, нельзя использовать, пока не будут заполнены все его полнотекстовые индексы.

Чтобы создать полнотекстовый индекс, но не заполнять его немедленно, укажите в инструкции `CREATE FULLTEXT INDEX` предложение `CHANGE_TRACKING OFF, NO POPULATION`. Если указать `CHANGE_TRACKING MANUAL`, то средство полнотекстового поиска не будет заполнять новый полнотекстовый индекс до выполнения инструкции `ALTER FULLTEXT INDEX` с предложением `START FULL POPULATION` или `START INCREMENTAL POPULATION`. 

### <a name="example---create-a-full-text-index-without-running-a-full-population"></a>Пример создания полнотекстового индекса без выполнения полного заполнения  
 В следующем примере создается полнотекстовый индекс для таблицы `Production.Document` образца базы данных `AdventureWorks` . В этом примере используется параметр `WITH CHANGE_TRACKING OFF, NO POPULATION` для задержки первоначального полного заполнения.  
  
```sql
CREATE UNIQUE INDEX ui_ukDoc ON Production.Document(DocumentID);  
CREATE FULLTEXT CATALOG AW_Production_FTCat;  
CREATE FULLTEXT INDEX ON Production.Document  
(  
    Document                         --Full-text index column name   
        TYPE COLUMN FileExtension    --Name of column that contains file type information  
        Language 1033                 --1033 is LCID for the English language  
)  
    KEY INDEX ui_ukDoc  
    ON AW_Production_FTCat  
    WITH CHANGE_TRACKING OFF, NO POPULATION;  
GO  
  
```  
  
### <a name="example---run-a-full-population-on-a-table"></a>Пример выполнения полного заполнения в таблице  
 В следующем примере полное заполнение выполняется в таблице `Production.Document` образца базы данных `AdventureWorks` .  
  
```sql
ALTER FULLTEXT INDEX ON Production.Document  
   START FULL POPULATION;  
```  
   
## <a name="population-based-on-change-tracking"></a>Заполнение на основе отслеживания изменений
 Можно также использовать отслеживание изменений для обслуживания полнотекстового индекса после его первоначального полного заполнения. Это вызывает небольшую нагрузку, связанную с отслеживанием изменений, поскольку [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] поддерживает таблицу, в которой выполняется отслеживание изменений в базовой таблице со времени последнего заполнения. При использовании отслеживания изменений [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] поддерживает запись строк базовой таблицы или индексированного представления, измененного операциями обновления, удаления или вставки. Изменения данных, внесенные с помощью инструкций WRITETEXT и UPDATETEXT, не отражаются в полнотекстовом индексе и не отмечаются при отслеживании изменений.  
  
> [!NOTE]  
>  Для таблиц, содержащих столбец **timestamp**, вместо отслеживания изменений можно использовать добавочное заполнение.  
  
 При включении отслеживания изменений во время создания индекса [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] полностью заполняет новый полнотекстовый индекс сразу же после его создания. Таким образом, изменения отслеживаются и распространяются в полнотекстовый индекс.

### <a name="enable-change-tracking"></a>Включить отслеживание изменений
Отслеживания изменений выполняется двумя способами:
-   Автоматически (параметр `CHANGE_TRACKING AUTO`). По умолчанию используется автоматическое отслеживание изменений.
-   Вручную (параметр `CHANGE_TRACKING MANUAL`).   
  
 Способ заполнения полнотекстового индекса определяется типом отслеживания изменений.  
  
-   **Автоматическое заполнение**  
  
     По умолчанию (либо если задан параметр `CHANGE_TRACKING AUTO`) средство полнотекстового поиска использует автоматическое заполнение полнотекстового индекса. После завершения первоначального полного заполнения изменения отслеживаются по мере изменений данных в базовой таблице, а зарегистрированные изменения распространяются автоматически. Полнотекстовый индекс обновляется в режиме вне сети, однако изменения, распространяемые таким образом, могут не отражаться в индексе сразу.  
  
     **Запуск отслеживания изменений с автоматическим заполнением**  
  
    -   [CREATE FULLTEXT INDEX](../../t-sql/statements/create-fulltext-index-transact-sql.md) ... WITH CHANGE_TRACKING AUTO  
  
    -   [ALTER FULLTEXT INDEX](../../t-sql/statements/alter-fulltext-index-transact-sql.md) ... SET CHANGE_TRACKING AUTO  
  
    **Пример переключения полнотекстового индекса на автоматическое отслеживание изменений**  
    В следующем примере полнотекстовый индекс таблицы `HumanResources.JobCandidate` образца базы данных `AdventureWorks` переключается на отслеживание изменений с автоматическим заполнением.  
  
    ```sql  
    USE AdventureWorks;  
    GO  
    ALTER FULLTEXT INDEX ON HumanResources.JobCandidate SET CHANGE_TRACKING AUTO;  
    GO   
    ```  
  
-   **Заполнение вручную**  
  
     Если задан параметр CHANGE_TRACKING MANUAL, то средство полнотекстового поиска использует заполнение полнотекстового индекса вручную. После завершения первоначального полного заполнения изменения отслеживаются по мере изменения данных в базовой таблице. Но изменения не добавляются в полнотекстовый индекс, пока не будет выполнена инструкция ALTER FULLTEXT INDEX … START UPDATE POPULATION . Агент [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] можно использовать для периодического вызова инструкции [!INCLUDE[tsql](../../includes/tsql-md.md)] .  
  
     **Запуск отслеживания изменений с заполнением вручную**  
  
    -   [CREATE FULLTEXT INDEX](../../t-sql/statements/create-fulltext-index-transact-sql.md) ... WITH CHANGE_TRACKING MANUAL  
  
    -   [ALTER FULLTEXT INDEX](../../t-sql/statements/alter-fulltext-index-transact-sql.md) ... SET CHANGE_TRACKING MANUAL  
  
    **Пример создания полнотекстового индекса с отслеживанием изменений вручную**  
    В следующем примере создается полнотекстовый индекс, который будет использовать отслеживание изменений с заполнением вручную в таблице `HumanResources.JobCandidate` образца базы данных `AdventureWorks` .  
  
    ```sql
    USE AdventureWorks;  
    GO  
    CREATE UNIQUE INDEX ui_ukJobCand ON HumanResources.JobCandidate(JobCandidateID);  
    CREATE FULLTEXT CATALOG ft AS DEFAULT;  
    CREATE FULLTEXT INDEX ON HumanResources.JobCandidate(Resume)   
       KEY INDEX ui_ukJobCand   
       WITH CHANGE_TRACKING=MANUAL;  
    GO  
    ```  
  
    **Пример выполнения заполнения вручную**  
    В следующем примере выполняется заполнение вручную на полнотекстовом индексе с отслеживанием изменений для таблицы `HumanResources.JobCandidate` образца базы данных `AdventureWorks` .  
  
    ```sql 
    USE AdventureWorks;  
    GO  
    ALTER FULLTEXT INDEX ON HumanResources.JobCandidate START UPDATE POPULATION;  
    GO  
    ```
   
### <a name="disable-change-tracking"></a>Включение отслеживания изменений 
  
-   [CREATE FULLTEXT INDEX](../../t-sql/statements/create-fulltext-index-transact-sql.md) ... WITH CHANGE_TRACKING OFF  
  
-   [ALTER FULLTEXT INDEX](../../t-sql/statements/alter-fulltext-index-transact-sql.md) ... SET CHANGE_TRACKING OFF  
   
  
## <a name="incremental-population-based-on-a-timestamp"></a>Добавочное заполнение с использованием отметок времени  
 Добавочное заполнение является альтернативным механизмом по отношению к заполнению полнотекстового индекса вручную. Если выполняется большое количество операций вставки в таблицу, то использование добавочного заполнения может быть более эффективным, чем использование заполнения вручную.
 
 Можно запустить добавочное заполнение для полнотекстового индекса, у которого параметру CHANGE_TRACKING присвоено значение MANUAL или OFF. 
  
 Для выполнения добавочного заполнения проиндексированная таблица должна включать столбец типа **timestamp** . Если столбца типа **timestamp** в таблице нет, добавочное заполнение невозможно.   

 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] использует столбец **timestamp** для определения строк, которые изменились со времени последнего заполнения. Затем операция добавочного заполнения обновляет полнотекстовый индекс для строк, добавленных, удаленных или измененных после или во время последнего заполнения. По окончании заполнения служба полнотекстового поиска сохраняет новое значение **timestamp** . Это значение — самое большое значение **timestamp**, которое удалось найти средству сбора данных SQL. Это значение будет использовано в начале следующего добавочного заполнения.  
 
В некоторых случаях попытка выполнить добавочное заполнение приведет к полному заполнению.
-   Попытка выполнить добавочное заполнение для таблицы, не содержащей столбец типа **timestamp** , приведет к полному заполнению.
-   Если первое заполнение полнотекстового индекса является добавочным, то производится индексирование всех строк, что является эквивалентом полного заполнения. 
-   Если за время, прошедшее с момента последнего заполнения, изменились какие-либо метаданные, влияющие на полнотекстовый индекс таблицы, то запросы добавочного заполнения реализуются как полное заполнение. Сюда относятся и изменения в метаданных, вызванные изменениями в определениях любых столбцов, индексов или полнотекстовых индексов. 

### <a name="run-an-incremental-population"></a>Запуск добавочного заполнения
  
 Для запуска добавочного заполнения выполните инструкцию `ALTER FULLTEXT INDEX` с использованием предложения `START INCREMENTAL POPULATION`.  
  
###  <a name="create-or-change-a-schedule-for-incremental-population"></a><a name="create"></a> Создание или изменение расписания для добавочных заполнений   
  
1.  В обозревателе объектов среды Management Studio разверните сервер.  
  
2.  Разверните узел **Базы данных**, а затем базу данных, которая содержит полнотекстовый индекс.  
  
3.  Раскройте узел **Таблицы**.  
  
    Правой кнопкой мыши щелкните таблицу, в которой определен полнотекстовый индекс, выберите **Полнотекстовый индекс**, затем в контекстном меню **Полнотекстовый индекс** выберите **Свойства**. Откроется диалоговое окно **Свойства полнотекстового индекса** .  

    > [!IMPORTANT]  
    >  Если базовая таблица или представление не содержат столбец типа данных **timestamp**, то выполнить добавочное заполнение невозможно.
      
1.  На панели **Выбор страницы** выберите пункт **Расписания**.  
  
     Эта страница используется для создания расписания задания агента SQL Server, которое запускает добавочное заполнение базовой таблицы или индексированного представления полнотекстового индекса, а также для управления таким расписанием.  

     Существуют следующие варианты выбора.  
  
    -   Чтобы **создать** новое расписание, щелкните **Создать**.  
  
        Откроется диалоговое окно **Создание расписания полнотекстового индексирования таблицы** , в котором можно создать расписание. Чтобы сохранить расписание, нажмите кнопку **ОК**.  
  
        > [!IMPORTANT]  
        >  Задание агента SQL Server (запуск добавочного заполнения таблицы на *имя_базы_данных*.*имя_таблицы*) связывается с новым расписанием после выхода из диалогового окна **Свойства полнотекстового индекса** . Если создается несколько расписаний для того же полнотекстового индекса, то все они используют одно и то же задание.  
  
    -   Чтобы **изменить** существующее расписание, выберите существующее расписание и щелкните **Изменить**.  
  
         Откроется диалоговое окно **Создание расписания полнотекстового индексирования таблицы** , в котором можно изменить расписание.  
  
        > [!NOTE]  
        >  Сведения об изменении задания агента SQL Server см. в [этой статье](../../ssms/agent/modify-a-job.md).  
  
    -   Чтобы **удалить** существующее расписание, выберите существующее расписание и щелкните **Удалить**.  
  
2.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]   

##  <a name="troubleshoot-errors-in-a-full-text-population-crawl"></a><a name="crawl"></a> Устранение ошибок в заполнении средства полнотекстового поиска (сканирование)  
При возникновении ошибки во время сканирования модуль протоколирования сканирования, входящий в механизм полнотекстового поиска, создает и обновляет журнал сканирования, хранящийся в текстовом файле. Каждый журнал сканирования соответствует конкретному полнотекстовому каталогу. По умолчанию журналы сканирования для конкретного экземпляра (в нашем случае — для экземпляра по умолчанию) хранятся в папке `%ProgramFiles%\Microsoft SQL Server\MSSQL15.MSSQLSERVER\MSSQL\LOG`.
 
Имена файлов журналов сканирования имеют следующий формат.  
  
`SQLFT<DatabaseID><FullTextCatalogID>.LOG[<n>]`
  
Ниже перечислены переменные части в именах файла журнала сканирования.
-   <**DatabaseID**> — идентификатор базы данных. \<**dbid**> является пятизначным числом с нулем в начале.  
-   <**FullTextCatalogID**> — идентификатор полнотекстового каталога. \<**catid**> – пятизначное число с нулями в начале.  
-   <**n**> — целое число, свидетельствующее о существовании одного или нескольких журналов сканирования одного полнотекстового каталога.  
  
 Например, `SQLFT0000500008.2` является файлом журнала сканирования для базы данных с идентификатором базы данных 5 и идентификатором полнотекстового каталога 8. Двойка в конце имени файла показывает, что этой паре базы данных и каталога соответствуют два файла журналов сканирования.  

## <a name="see-also"></a>См. также:  
 [sys.dm_fts_index_population (Transact-SQL)](../../relational-databases/system-dynamic-management-views/sys-dm-fts-index-population-transact-sql.md)   
 [Приступая к работе с компонентом Full-Text Search](../../relational-databases/search/get-started-with-full-text-search.md)   
 [Создание и управление полнотекстовыми индексами](../../relational-databases/search/create-and-manage-full-text-indexes.md)   
 [CREATE FULLTEXT INDEX (Transact-SQL)](../../t-sql/statements/create-fulltext-index-transact-sql.md)   
 [ALTER FULLTEXT INDEX (Transact-SQL)](../../t-sql/statements/alter-fulltext-index-transact-sql.md)  
  
  
