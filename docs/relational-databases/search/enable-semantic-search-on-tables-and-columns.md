---
description: Включение семантического поиска на таблицы и столбцы
title: Включение семантического поиска по таблицам и столбцам | Документация Майкрософт
ms.custom: ''
ms.date: 03/14/2017
ms.prod: sql
ms.prod_service: search, sql-database
ms.technology: search
ms.topic: conceptual
helpviewer_keywords:
- semantic search [SQL Server], enabling
ms.assetid: 895d220c-6749-4954-9dd3-2ea4c6a321ff
author: pmasl
ms.author: pelopes
ms.reviewer: mikeray
ms.openlocfilehash: d02424e5e33823956977c8b32d1ab4e996df5526
ms.sourcegitcommit: 192f6a99e19e66f0f817fdb1977f564b2aaa133b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/25/2020
ms.locfileid: "96130930"
---
# <a name="enable-semantic-search-on-tables-and-columns"></a>Включение семантического поиска на таблицы и столбцы
 [!INCLUDE [SQL Server](../../includes/applies-to-version/sqlserver.md)]
  Описывает способ включения или отключения статистического семантического индексирования в выбранных столбцах, содержащих документы или текст.  
  
 При выполнении статистического семантического поиска используются индексы, полученные при полнотекстовом поиске, а также создаются дополнительные индексы. Из-за этой зависимости от полнотекстового поиска приходится создавать при определении нового или изменении существующего полнотекстового индекса новый семантический индекс. Вы можете создать новый семантический индекс с помощью инструкций [!INCLUDE[tsql](../../includes/tsql-md.md)] или с помощью мастера полнотекстового индексирования и других диалоговых окон среды [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], как описано в данном разделе.  
  
##  <a name="create-a-semantic-index"></a><a name="BasicEnabling"></a> Создание семантического индекса  
  
###  <a name="requirements-and-restrictions-for-creating-a-semantic-index"></a><a name="reqenable"></a> Требования и ограничения для создания семантического индекса  
  
-   Можно создать индекс для любых объектов базы данных, поддерживаемых для полнотекстового индексирования, включая таблицы и индексированные представления.  
  
-   Прежде чем можно будет включить семантическое индексирование для определенных столбцов, должны быть выполнены следующие предварительные условия:  
  
    -   Для базы данных должен существовать полнотекстовый каталог.  
  
    -   Таблица должна содержать полнотекстовый индекс.  
  
    -   Выбранные столбцы должны быть включены в полнотекстовый индекс.  
  
     Можно создать и включить эти требования одновременно.  
  
-   Можно создать семантический индекс по столбцам с любым типом данных, поддерживаемым для полнотекстового индексирования. Дополнительные сведения см. в разделе [Создание полнотекстовых индексов и управление ими](../../relational-databases/search/create-and-manage-full-text-indexes.md).  
  
-   Для столбцов типа **varbinary(max)** можно указать любой тип документа, в котором поддерживается полнотекстовое индексирование. Дополнительные сведения см. в подразделе [Практическое руководство. Определение того, какие типы документов могут быть проиндексированы](#doctypes) этого раздела.  
  
-   При семантическом индексировании для выбранных столбцов создаются индексы двух типов — индекс ключевых фраз и индекс подобия документов. При включении семантического индексирования нельзя выбрать только один тип индекса из этих двух. Однако можно запрашивать эти индексы по отдельности. Дополнительные сведения см. в разделе [Поиск ключевых фраз в документах с использованием семантического поиска](../../relational-databases/search/find-key-phrases-in-documents-with-semantic-search.md) и [Поиск похожих и связанных документов с использованием семантического поиска](../../relational-databases/search/find-similar-and-related-documents-with-semantic-search.md).  
  
-   Если код языка для семантического индекса не указан явно, при семантическом индексировании будет использоваться только основной язык и связанная с ним статистика.  
  
-   В случае указания языка для столбца, для которого недоступна языковая модель, создание индекса завершится ошибкой и будет возвращено соответствующее сообщение.  
  
##  <a name="create-a-semantic-index-when-there-is-no-full-text-index"></a><a name="HowToEnableCreate"></a> Создание семантического индекса, если нет полнотекстового индекса  
 При создании нового полнотекстового индекса с помощью инструкции **CREATE FULLTEXT INDEX** семантическое индексирование на уровне столбца включается путем указания в определении столбца ключевого слова **STATISTICAL_SEMANTICS** . Семантическое индексирование также можно включить при создании полнотекстового индекса с помощью мастера полнотекстового индексирования.  
  
 ### <a name="create-a-new-semantic-index-by-using-transact-sql"></a>Создание нового семантического индекса с помощью Transact-SQL  
 
 Вызовите инструкцию **CREATE FULLTEXT INDEX** и укажите параметр **STATISTICAL_SEMANTICS** для каждого столбца, на котором требуется создать семантический индекс. Дополнительные сведения обо всех параметрах этой инструкции см. в разделе [CREATE FULLTEXT INDEX (Transact-SQL)](../../t-sql/statements/create-fulltext-index-transact-sql.md).  
  
 **Пример 1. Создание уникального индекса, полнотекстового и семантического индекса**  
  
 В следующем примере создается полнотекстовый каталог по умолчанию **ft**. Затем в примере создается уникальный индекс на столбце **JobCandidateID** таблицы **HumanResources.JobCandidate** образца базы данных AdventureWorks2012. Данный уникальный индекс используется в качестве ключевого столбца полнотекстового индекса. Затем в примере создается полнотекстовый и семантический индексы на столбце **Resume** .  
  
```sql  
CREATE FULLTEXT CATALOG ft AS DEFAULT  
GO  
  
CREATE UNIQUE INDEX ui_ukJobCand  
    ON HumanResources.JobCandidate(JobCandidateID)  
GO  
  
CREATE FULLTEXT INDEX ON HumanResources.JobCandidate  
    (Resume  
        Language 1033  
        Statistical_Semantics  
    )   
    KEY INDEX JobCandidateID   
    WITH STOPLIST = SYSTEM  
GO  
```  
  
 **Пример 2. Создание полнотекстового и семантического индексов на нескольких столбцах с отложенным заполнением**  
  
 В следующем примере в образце базы данных AdventureWorks2012 создается полнотекстовый каталог **documents_catalog**. Следующий пример создает полнотекстовый индекс, который использует этот новый каталог. Полнотекстовый индекс создан на столбцах **Title**, **DocumentSummary** и **Document** таблицы **Production.Document** , а семантических индекс — только на столбце **Document** . Этот полнотекстовый индекс использует вновь созданный полнотекстовый каталог и существующий индекс уникального ключа **PK_Document_DocumentID**. Согласно рекомендациям этот ключ индекса построен на целочисленном столбце **DocumentID**. В примере указан код (LCID) для английского языка 1033, который является языком данных в столбцах.  
  
 В примере также указано, что отслеживание изменений отключено (без заполнения). Позже, в часы с наименьшей загрузкой, будет запущено полное заполнение нового индекса и включено автоматическое отслеживание изменений с помощью инструкции **ALTER FULLTEXT INDEX** .  
  
```sql  
CREATE FULLTEXT CATALOG documents_catalog  
GO  
  
CREATE FULLTEXT INDEX ON Production.Document  
    (   
    Title  
        Language 1033,   
    DocumentSummary  
        Language 1033,   
    Document   
        TYPE COLUMN FileExtension  
        Language 1033  
        Statistical_Semantics  
    )  
    KEY INDEX PK_Document_DocumentID  
        ON documents_catalog  
        WITH CHANGE_TRACKING OFF, NO POPULATION  
GO  
```  
  
 Позже, в часы с наименьшей загрузкой, выполняется заполнение индекса:  
  
```sql  
ALTER FULLTEXT INDEX ON Production.Document SET CHANGE_TRACKING AUTO  
GO  
```  
  
### <a name="create-a-new-semantic-index-by-using-sql-server-management-studio"></a>Создание нового семантического индекса с помощью среды SQL Server Management Studio  
 Запустите мастер полнотекстового индексирования и включите параметр **Статистическая семантика** на странице **Выбор столбцов таблицы** для каждого столбца, на котором требуется создать семантический индекс. Дополнительные сведения, в том числе о запуске мастера полнотекстового индексирования, см. в разделе [Использование мастера полнотекстового индексирования](../../relational-databases/search/use-the-full-text-indexing-wizard.md).  
  
##  <a name="create-a-semantic-index-when-there-is-an-existing-full-text-index"></a><a name="HowToEnableAlter"></a> Создание семантического индекса, если есть полнотекстовый индекс  
 Для добавления семантического индексирования при изменении существующего полнотекстового индекса используется инструкция **ALTER FULLTEXT INDEX** . Также можно добавить семантическое индексирование с помощью различных диалоговых окон в [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].  
  
### <a name="add-a-semantic-index-by-using-transact-sql"></a>Добавление семантического индекса с помощью Transact-SQL  
 Вызовите инструкцию **ALTER FULLTEXT INDEX** с описанными далее параметрами для каждого столбца, для которого требуется добавить семантический индекс. Дополнительные сведения обо всех параметрах этой инструкции см. в разделе [ALTER FULLTEXT INDEX (Transact-SQL)](../../t-sql/statements/alter-fulltext-index-transact-sql.md).  
  
 Если не указано иное, полнотекстовый и семантический индексы после вызова инструкции **ALTER** повторно заполняются.  
  
-   Чтобы добавить в столбец только полнотекстовое индексирование, используйте синтаксис **ADD** .  
  
-   Чтобы добавить в столбец и полнотекстовое и семантическое индексирование, используйте синтаксис **ADD** с параметром **STATISTICAL_SEMANTICS** .  
  
-   Чтобы добавить семантическое индексирование в столбец, для которого уже включено полнотекстовое индексирование, укажите параметр **ADD STATISTICAL_SEMANTICS** . В рамках одной инструкции **ALTER** семантический индекс можно добавить только в один столбец.  
  
 **Пример. Добавление семантического индексирования в столбец, в котором уже есть полнотекстовое индексирование**  
  
 В следующем примере выполняется изменение существующего полнотекстового индекса в таблице **Production.Document** из образца базы данных AdventureWorks2012. Пример добавляет семантический индекс для столбца **Document** таблицы **Production.Document** , для которого уже существует полнотекстовый индекс. В примере указывается, что повторное заполнение индекса не будет выполняться автоматически.  
  
```sql  
ALTER FULLTEXT INDEX ON Production.Document  
    ALTER COLUMN Document  
        ADD Statistical_Semantics  
    WITH NO POPULATION  
GO  
```  
  
### <a name="add-a-semantic-index-by-using-sql-server-management-studio"></a>Добавить семантический индекс с помощью среды SQL Server Management Studio  
 Изменение столбцов, для которых включен семантический или полнотекстовый индекс, выполняется на странице **Столбцы полнотекстового индекса** диалогового окна **Свойства полнотекстового индекса** . Дополнительные сведения см. в разделе [Управление полнотекстовыми индексами](./create-and-manage-full-text-indexes.md).  

## <a name="alter-a-semantic-index"></a>Изменение семантического индекса
  
###  <a name="requirements-and-restrictions-for-altering-an-existing-index"></a><a name="addreq"></a> Требования и ограничения для изменения существующего индекса  
  
-   В процессе заполнения индекса изменять существующий индекс нельзя. Дополнительные сведения о наблюдении за ходом заполнения индекса см. в разделе [Мониторинг семантического поиска и управление им](../../relational-databases/search/manage-and-monitor-semantic-search.md).  
  
-   Нельзя добавить индексирование в столбец и изменить или удалить индексирование из этого же столбца в рамках одного вызова инструкции **ALTER FULLTEXT INDEX** .  
  
##  <a name="drop-a-semantic-index"></a><a name="dropping"></a> Удаление семантического индекса  
Для удаления семантического индексирования при изменении существующего полнотекстового индекса используется инструкция **ALTER FULLTEXT INDEX** . Также можно удалить семантическое индексирование с помощью различных диалоговых окон в [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].  
  
 ### <a name="drop-a-semantic-index-by-using-transact-sql"></a>Удалите семантический индекс с помощью Transact-SQL  
Чтобы удалить семантическое индексирование только из столбца или столбцов, вызовите инструкцию **ALTER FULLTEXT INDEX** с параметром **ALTER COLUMN**_имя\_столбца_**DROP STATISTICAL_SEMANTICS**. С помощью одной инструкции **ALTER** можно удалить индексирование из нескольких столбцов.  
  
```sql  
USE database_name  
GO  

ALTER FULLTEXT INDEX  
    ALTER COLUMN column_name  
    DROP STATISTICAL_SEMANTICS  
GO  
```  
  
Чтобы удалить семантическое и полнотекстовое индексирование из столбца, вызовите инструкцию **ALTER FULLTEXT INDEX** с параметром **ALTER COLUMN**_имя\_столбца_**DROP**.  
  
```sql  
USE database_name  
GO  
  
ALTER FULLTEXT INDEX  
    ALTER COLUMN column_name  
    DROP  
GO  
```  
  
 ### <a name="drop-a-semantic-index-by-using-sql-server-management-studio"></a>Удалите семантический индекс с помощью среды SQL Server Management Studio  
 Изменение столбцов, для которых включен семантический или полнотекстовый индекс, выполняется на странице **Столбцы полнотекстового индекса** диалогового окна **Свойства полнотекстового индекса** . Дополнительные сведения см. в разделе [Управление полнотекстовыми индексами](./create-and-manage-full-text-indexes.md).  
  
###  <a name="requirements-and-restrictions-for-dropping-a-semantic-index"></a><a name="dropreq"></a> Требования и ограничения для удаления семантического индекса  
  
-   Удалить полнотекстовое индексирование из столбца, сохранив при этом семантическое индексирование, невозможно. Для получения результатов о подобии документов семантическое индексирование основывается на полнотекстовом индексировании.  
  
-   Задать параметр **NO POPULATION** при удалении семантического индексирования из последнего столбца таблицы, для которой было включено семантическое индексирование, невозможно. Для удаления ранее индексированных результатов требуется цикл заполнения.  
  
## <a name="check-whether-semantic-search-is-enabled-on-database-objects"></a>Проверка, включен ли семантический поиск по объектам базы данных  
### <a name="is-semantic-search-enabled-for-a-database"></a>Включен ли семантический поиск для базы данных?
  
 Отправьте запрос к свойству **IsFullTextEnabled** функции метаданных [SERVERPROPERTY (Transact-SQL)](../../t-sql/functions/databasepropertyex-transact-sql.md).  
  
 Возвращаемое значение 1 указывает, что полнотекстовый поиск и семантический поиск для базы данных включены; возвращаемое значение 0 указывает, что они не включены.  
  
```sql  
SELECT DATABASEPROPERTYEX('database_name', 'IsFullTextEnabled')  
GO  
```  
  
### <a name="is-semantic-search-enabled-for-a-table"></a>Включен ли семантический поиск для таблицы?  
 
 Выполните запрос к свойству **TableFullTextSemanticExtraction** функции метаданных [OBJECTPROPERTYEX (Transact-SQL)](../../t-sql/functions/objectpropertyex-transact-sql.md).  
  
 Возвращаемое значение 1 указывает, что семантический поиск для таблицы включен; возвращаемое значение 0 указывает, что он не включен.  
  
```scr  
SELECT OBJECTPROPERTYEX(OBJECT_ID('table_name'), 'TableFullTextSemanticExtraction')  
GO  
```  
  
 ### <a name="is-semantic-search-enabled-for-a-column"></a>Включен ли семантический поиск для столбца?
   
 Чтобы определить, включен ли семантический поиск для определенного столбца, выполните следующие действия.  
  
-   Выполните запрос к свойству **StatisticalSemantics** функции метаданных [COLUMNPROPERTY (Transact-SQL)](../../t-sql/functions/columnproperty-transact-sql.md).  
  
     Возвращаемое значение 1 указывает, что семантический поиск для столбца включен; возвращаемое значение 0 указывает, что он не включен.  
  
    ```sql  
    SELECT COLUMNPROPERTY(OBJECT_ID('table_name'), 'column_name', 'StatisticalSemantics')  
    GO  
    ```  
  
-   Запрос к представлению каталога [sys.fulltext_index_columns (Transact-SQL)](../../relational-databases/system-catalog-views/sys-fulltext-index-columns-transact-sql.md) для полнотекстового индекса.  
  
     Значение 1 в столбце **statistical_semantics** указывает, что для данного столбца, кроме полнотекстового индексирования, включено и семантическое индексирование.  
  
    ```sql  
    SELECT * FROM sys.fulltext_index_columns WHERE object_id = OBJECT_ID('table_name')  
    GO  
    ```  
  
-   В обозревателе объектов [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)]щелкните правой кнопкой мыши столбец и выберите пункт **Свойства**. На странице **Общие** диалогового окна **Свойства столбца** проверьте значение свойства **Статистическая семантика** .  
  
     Значение True указывает, что для данного столбца, кроме полнотекстового индексирования, включено и семантическое индексирование.  
  
## <a name="determine-what-can-be-indexed-for-semantic-search"></a>Определение элементов, к которым можно применить индексирование для семантического поиска  
  
###  <a name="check-which-languages-are-supported-for-semantic-search"></a><a name="HowToCheckLanguages"></a> Проверка, какие языки поддерживаются для семантического поиска  
  
> [!IMPORTANT]  
>  Для семантического индексирования поддерживается меньше языков, чем для полнотекстового индексирования. В результате могут существовать столбцы, индексируемые для полнотекстового поиска, но не для семантического поиска.  
  
 Отправьте запрос в представление каталога [sys.fulltext_semantic_languages (Transact-SQL)](../../relational-databases/system-catalog-views/sys-fulltext-semantic-languages-transact-sql.md).  
  
```sql  
SELECT * FROM sys.fulltext_semantic_languages  
GO  
```  
  
 Для семантического индексирования поддерживаются следующие языки. Этот список представляет выходные данные представления каталога [sys.fulltext_semantic_languages (Transact-SQL)](../../relational-databases/system-catalog-views/sys-fulltext-semantic-languages-transact-sql.md), упорядоченные по LCID.  
  
|Язык|LCID|  
|--------------|----------|  
|Немецкий|1031|  
|Английский (США)|1033|  
|Французский|1036|  
|Итальянский|1040|  
|Португальский (Бразилия)|1046|  
|русском языке|1049|  
|Шведский|1053|  
|Английский (Великобритания)|2057|  
|Португальский (Португалия)|2070|  
|Испанский|3082|  
  
###  <a name="determine-which-document-types-can-be-indexed"></a><a name="doctypes"></a> Определение типов документов, которые могут быть проиндексированы  
 Отправьте запрос в представление каталога [sys.fulltext_document_types (Transact-SQL)](../../relational-databases/system-catalog-views/sys-fulltext-document-types-transact-sql.md).  
  
 Если тип документа, который необходимо проиндексировать, отсутствует в списке поддерживаемых типов, то может потребоваться поиск, загрузка и установка дополнительных фильтров. Дополнительные сведения см. в статье [Просмотр или изменение зарегистрированных фильтры и разделители слов](../../relational-databases/search/view-or-change-registered-filters-and-word-breakers.md).  
  
##  <a name="best-practice-consider-creating-a-separate-filegroup-for-the-full-text-and-semantic-indexes"></a><a name="BestPracticeFilegroup"></a> Рекомендация. Создайте отдельную файловую группу для полнотекстового и семантического индексов  
 Если выделение места на диске является серьезной проблемой, рассмотрите возможность создания отдельных файловых групп для полнотекстового и семантического индексов. Семантические индексы создаются в той же файловой группе, что и полнотекстовый индекс. Полностью заполненный семантический индекс может содержать большой объем данных.  
 
##  <a name="issue-searching-on-specific-column-returns-no-results"></a><a name="IssueNoResults"></a> Проблема. Поиск по определенному столбцу не возвращает результатов  
 **Возможно, для языка в Юникоде был указан код языка не в Юникоде.**  
 Имеется возможность включить семантическое индексирование на столбцах не в Юникоде с помощью кода языка, содержащего только слова в Юникоде, например кода 1049, обозначающего русский язык. В этом случае семантические индексы на этом столбце никогда не возвратят каких-либо результатов.  
  
