---
description: Создание и управление полнотекстовыми индексами
title: Создание полнотекстовых индексов и управление ими | Документация Майкрософт
ms.custom: ''
ms.date: 03/31/2020
ms.prod: sql
ms.prod_service: search, sql-database
ms.technology: search
ms.topic: conceptual
helpviewer_keywords:
- full-text indexes [SQL Server], about
ms.assetid: f8a98486-5438-44a8-b454-9e6ecbc74f83
author: pmasl
ms.author: pelopes
ms.reviewer: mikeray
monikerRange: =azuresqldb-current||>=sql-server-2016||>=sql-server-linux-2017||=azuresqldb-mi-current
ms.openlocfilehash: 8a3c3792fa2aca009e02fc8fcdce6bf613b5e370
ms.sourcegitcommit: 917df4ffd22e4a229af7dc481dcce3ebba0aa4d7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/10/2021
ms.locfileid: "100341684"
---
# <a name="create-and-manage-full-text-indexes"></a>Создание и управление полнотекстовыми индексами
[!INCLUDE [SQL Server Azure SQL Database](../../includes/applies-to-version/sql-asdb.md)]
Здесь описывается создание и заполнение полнотекстовых индексов, а также управление ими в SQL Server.
  
## <a name="prerequisite---create-a-full-text-catalog"></a>Предварительное требование — создание полнотекстового каталога
Необходимо создать полнотекстовый каталог, прежде чем создавать полнотекстовый индекс. Каталог — это виртуальный контейнер для одного или нескольких полнотекстовых индексов. Дополнительные сведения см. в статье [Создание полнотекстовых каталогов и управление ими](../../relational-databases/search/create-and-manage-full-text-catalogs.md).
  
##  <a name="create-alter-or-drop-a-full-text-index"></a><a name="tasks"></a> Создание, изменение или удаление полнотекстового индекса  
### <a name="create-a-full-text-index"></a>Создание полнотекстового индекса  
  
-   [CREATE FULLTEXT INDEX (Transact-SQL)](../../t-sql/statements/create-fulltext-index-transact-sql.md)  
  
### <a name="alter-a-full-text-index"></a>Изменение полнотекстового индекса
  
-   [ALTER FULLTEXT INDEX (Transact-SQL)](../../t-sql/statements/alter-fulltext-index-transact-sql.md)  
  
### <a name="drop-a-full-text-index"></a>Удаление полнотекстового индекса 
  
-   [DROP FULLTEXT INDEX (Transact-SQL)](../../t-sql/statements/drop-fulltext-index-transact-sql.md)

## <a name="populate-a-full-text-index"></a>Заполнение полнотекстового индекса
Процесс создания и сопровождения полнотекстового индекса называется *заполнением* (а также *сканированием*). Существует три типа заполнения полнотекстового индекса:
-   Полное заполнение
-   Заполнение на основе отслеживания изменений
-   добавочное заполнение с использованием отметки времени.

Дополнительные сведения см. в статье [Заполнение полнотекстовых индексов](../../relational-databases/search/populate-full-text-indexes.md).

##  <a name="view-the-properties-of-a-full-text-index"></a><a name="view"></a> Просмотр свойств полнотекстового индекса
### <a name="view-the-properties-of-a-full-text-index-with-transact-sql"></a>Просмотр свойств полнотекстового индекса с помощью Transact-SQL

|Каталог или динамическое административное представление|Описание|  
|----------------------------------------|-----------------|  
|[sys.fulltext_index_catalog_usages (Transact-SQL)](../../relational-databases/system-catalog-views/sys-fulltext-index-catalog-usages-transact-sql.md)|Возвращает строку для каждого полнотекстового каталога, ссылающегося на полнотекстовый индекс.|  
|[sys.fulltext_index_columns (Transact-SQL)](../../relational-databases/system-catalog-views/sys-fulltext-index-columns-transact-sql.md)|Содержит по одной строке для каждого столбца, являющегося частью полнотекстового индекса.|  
|[sys.fulltext_index_fragments (Transact-SQL)](../../relational-databases/system-catalog-views/sys-fulltext-index-fragments-transact-sql.md)|Полнотекстовый индекс использует внутренние таблицы, называемые фрагментами полнотекстового индекса, для хранения данных инвертированного индекса. Это представление может использоваться для запросов к метаданным об этих фрагментах. Представление содержит строку для каждого фрагмента полнотекстового индекса в каждой таблице, содержащей полнотекстовый индекс.|  
|[sys.fulltext_indexes (Transact-SQL)](../../relational-databases/system-catalog-views/sys-fulltext-indexes-transact-sql.md)|Содержит по одной строке для каждого полнотекстового индекса табличного объекта.|  
|[sys.dm_fts_index_keywords (Transact-SQL)](../../relational-databases/system-dynamic-management-views/sys-dm-fts-index-keywords-transact-sql.md)|Возвращает сведения о содержимом полнотекстового индекса для указанной таблицы.|  
|[sys.dm_fts_index_keywords_by_document (Transact-SQL)](../../relational-databases/system-dynamic-management-views/sys-dm-fts-index-keywords-by-document-transact-sql.md)|Возвращает сведения о содержимом полнотекстового индекса на уровне документа для указанной таблицы. Данное ключевое слово может встречаться в нескольких документах.|  
|[sys.dm_fts_index_population (Transact-SQL)](../../relational-databases/system-dynamic-management-views/sys-dm-fts-index-population-transact-sql.md)|Возвращает сведения о выполняющихся в настоящий момент процессах заполнения полнотекстовых индексов.|  
 
### <a name="view-the-properties-of-a-full-text-index-with-management-studio"></a>Просмотр свойств полнотекстового индекса с помощью Management Studio 
1.  В обозревателе объектов среды Management Studio разверните сервер.  
  
2.  Разверните узел **Базы данных**, а затем базу данных, которая содержит полнотекстовый индекс.  
  
3.  Раскройте узел **Таблицы**.  
  
4.  Правой кнопкой мыши щелкните таблицу, в которой определен полнотекстовый индекс, выберите **Полнотекстовый индекс**, затем в контекстном меню **Полнотекстовый индекс** выберите **Свойства**. Откроется диалоговое окно **Свойства полнотекстового индекса** .  
  
5.  На панели **Выбор страницы** можно выбрать любую из приведенных ниже страниц.  
  
    |Страница|Описание|  
    |----------|-----------------|  
    |**Общие сведения**|Отображаются основные свойства полнотекстового индекса. Сюда относятся несколько изменяемых свойств и несколько неизменяемых, например имя базы данных, имя таблицы и имя полнотекстового ключевого столбца. Изменяемыми являются следующие свойства.<br /><br /> **Список стоп-слов полнотекстового индекса**.<br /><br /> **Полнотекстовое индексирование включено**.<br /><br /> **Отслеживание изменений**<br /><br /> **Поиск в списке свойств**.|  
    |**Столбцы**|Отображаются столбцы таблицы, доступные для полнотекстового индексирования. Выбранные столбцы включаются в полнотекстовый индекс. Можно выбрать столько доступных столбцов, сколько нужно включить в полнотекстовый индекс. Дополнительные сведения см. в статье [Заполнение полнотекстовых индексов](populate-full-text-indexes.md).|
    |**Расписания**|Эта страница используется для создания расписаний задания агента SQL Server, которое запускает добавочное заполнение таблицы для заполнения полнотекстового индекса или для управления такими расписаниями. Дополнительные сведения см. в статье [Заполнение полнотекстовых индексов](../../relational-databases/search/populate-full-text-indexes.md).<br /><br /> Примечание. После выхода из диалогового окна **Свойства полнотекстового индекса** любое вновь созданное расписание связывается с заданием агента SQL Server (запуск добавочного заполнения таблицы в *имя_базы_данных*.*имя_таблицы*).|  
  
6.  [!INCLUDE[clickOK](../../includes/clickok-md.md)], чтобы сохранить изменения и выйти из диалогового окна **Свойства полнотекстового индекса**.  
  
##  <a name="view-the-properties-of-indexed-tables-and-columns"></a><a name="props"></a> Просмотр свойств индексированных таблиц и столбцов  
 Могут использоваться некоторые функции [!INCLUDE[tsql](../../includes/tsql-md.md)], такие как OBJECTPROPERTYEX, для получения значений различных свойств полнотекстового индексирования. Эти сведения полезны для администрирования и устранения нарушений в работе средств полнотекстового поиска.  
  
 В следующей таблице перечислены свойства полнотекстового поиска, связанные с индексированными таблицами и столбцами, и относящиеся к ним функции [!INCLUDE[tsql](../../includes/tsql-md.md)].  
  
|Свойство|Описание|Компонент|  
|--------------|-----------------|--------------|  
|**FullTextTypeColumn**|TYPE COLUMN в таблице, которая содержит информацию о типе документа столбца.|[COLUMNPROPERTY](../../t-sql/functions/columnproperty-transact-sql.md)|  
|**IsFulltextIndexed**|Указывает, включено ли в столбце полнотекстовое индексирование.|COLUMNPROPERTY|  
|**IsFulltextKey**|Указывает, является ли индекс полнотекстовым ключом таблицы.|[INDEXPROPERTY](../../t-sql/functions/indexproperty-transact-sql.md)|  
|**TableFulltextBackgroundUpdateIndexOn**|Указывает, имеется ли в таблице фоновое полнотекстовое индексирование обновлений.|[OBJECTPROPERTYEX](../../t-sql/functions/objectpropertyex-transact-sql.md)|  
|**TableFulltextCatalogId**|Идентификатор полнотекстового каталога, где находятся данные полнотекстового индекса таблицы.|OBJECTPROPERTYEX|  
|**TableFulltextChangeTrackingOn**|Указывает, включено ли в таблице полнотекстовое отслеживание изменений.|OBJECTPROPERTYEX|  
|**TableFulltextDocsProcessed**|Количество строк, обработанных с начала полнотекстового индексирования.|OBJECTPROPERTYEX|  
|**TableFulltextFailCount**|Количество строк, для которых полнотекстовый поиск не выявил индекса.|OBJECTPROPERTYEX|  
|**TableFulltextItemCount**|Количество строк, для которых было успешно выполнено полнотекстовое индексирование.|OBJECTPROPERTYEX|  
|**TableFulltextKeyColumn**|Идентификатор столбца полнотекстового уникального ключевого столбца.|OBJECTPROPERTYEX|  
|**TableFullTextMergeStatus**|Определяет, участвует ли в настоящий момент полнотекстовый индекс для таблицы в процессе слияния.|OBJECTPROPERTYEX|  
|**TableFulltextPendingChanges**|Количество ожидающих отслеженных изменений к обработке.|OBJECTPROPERTYEX|  
|**TableFulltextPopulateStatus**|Указывает состояние заполнения полнотекстовой таблицы.|OBJECTPROPERTYEX|  
|**TableHasActiveFulltextIndex**|Указывает, содержит ли таблица активный полнотекстовый индекс.|OBJECTPROPERTYEX|  
  
##  <a name="get-info-about-the-full-text-key-column"></a><a name="key"></a> Получение информации о столбце полнотекстового ключа  
 Обычно результат функций, возвращающих наборы строк CONTAINSTABLE или FREETEXTTABLE, необходимо соединить с базовой таблицей. В таких случаях необходимо знать уникальное имя ключевого столбца. Можно уточнить, используется ли данный уникальный индекс как полнотекстовый ключ, а также получить идентификатор полнотекстового ключевого столбца.  
  
### <a name="determine-whether-a-given-unique-index-is-used-as-the-full-text-key-column"></a>Определение использования данного уникального индекса в качестве полнотекстового ключевого столбца  
  
Вызовите функцию [INDEXPROPERTY](../../t-sql/queries/select-transact-sql.md) с помощью инструкции [SELECT](../../t-sql/functions/indexproperty-transact-sql.md) . В вызове функции используйте функцию OBJECT_ID, чтобы преобразовать имя таблицы (*имя_таблицы*) в идентификатор таблицы, укажите имя уникального индекса для таблицы и укажите свойство **IsFulltextKey** индекса следующим образом:  
  
```sql  
SELECT INDEXPROPERTY( OBJECT_ID('table_name'), 'index_name',  'IsFulltextKey' );  
```  
  
 Если индекс принудительно обеспечивает уникальность столбца полнотекстового ключа, будет возвращено значение 1, в противном случае запрос возвратит 0.  
  
 **Пример**  
  
 Следующий пример уточняет, используется ли индекс `PK_Document_DocumentNode` для обеспечения уникальности столбца полнотекстового ключа:  
  
```sql  
USE AdventureWorks  
GO  
SELECT INDEXPROPERTY ( OBJECT_ID('Production.Document'), 'PK_Document_DocumentNode',  'IsFulltextKey' )  
```  
  
 Если индекс `PK_Document_DocumentNode` используется для обеспечения уникальности столбца полнотекстового ключа, будет возвращено значение 1. В противном случае возвращается значение 0 или NULL. NULL означает, что используется недопустимое имя индекса, имя индекса не соответствует таблице, таблица не существует и пр.  
  
### <a name="find-the-identifier-of-the-full-text-key-column"></a>Поиск идентификатора столбца полнотекстового ключа  
  
Каждая таблица, поддерживающая полнотекстовый поиск, имеет столбец, который обеспечивает принудительное применение уникальных строк в таблице (*уникальный**ключевой столбец*). Свойство **TableFulltextKeyColumn** , возвращаемое функцией OBJECTPROPERTYEX, содержит идентификатор уникального ключевого столбца.  
 
Для получения идентификатора можно вызвать функцию OBJECTPROPERTYEX с помощью инструкции SELECT. Чтобы преобразовать имя таблицы (*имя_таблицы*) в идентификатор таблицы и задать свойство **TableFulltextKeyColumn** , воспользуйтесь функцией OBJECT_ID:  
  
```sql  
SELECT OBJECTPROPERTYEX(OBJECT_ID( 'table_name'), 'TableFulltextKeyColumn' ) AS 'Column Identifier';  
```  
  
 **Примеры**  
  
 В следующем примере возвращается идентификатор столбца полнотекстового ключа или значение NULL. NULL означает, что используется недопустимое имя индекса, имя индекса не соответствует таблице, таблица не существует и пр.  
  
```sql
USE AdventureWorks;  
GO  
SELECT OBJECTPROPERTYEX(OBJECT_ID('Production.Document'), 'TableFulltextKeyColumn');  
GO  
```  
  
 Следующий пример показывает, как использовать идентификатор уникального ключевого столбца для получения имени столбца.  
  
```sql  
USE AdventureWorks;  
GO  
DECLARE @key_column sysname  
SET @key_column = Col_Name(Object_Id('Production.Document'),  
ObjectProperty(Object_id('Production.Document'),  
'TableFulltextKeyColumn')   
)  
SELECT @key_column AS 'Unique Key Column';  
GO  
```  
  
 В этом примере возвращается столбец результирующего набора с именем `Unique Key Column`, в котором отображается одна строка с именем уникального ключевого столбца таблицы Document, DocumentNode. Обратите внимание, что если этот запрос содержал недопустимое имя индекса, имя индекса не соответствует таблице, таблица не существует и пр., то будет возвращено значение NULL.  

## <a name="index-varbinarymax-and-xml-columns"></a>Индексирование столбцов varbinary(max) и xml  
 Если для столбца типа **varbinary(max)** , **varbinary** или **xml** создан полнотекстовый индекс, то обращаться к нему с запросами можно при использовании полнотекстовых предикатов (CONTAINS и FREETEXT) и функций (CONTAINSTABLE и FREETEXTTABLE), как и к любым другим столбцам с полнотекстовым индексом.
   
### <a name="index-varbinarymax-or-varbinary-data"></a>Индексирование данных типа varbinary(max) и varbinary  
 В одном столбце типа **varbinary(max)** или **varbinary** могут храниться документы различных типов. [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] поддерживает любые типы документов, для которых в операционной системе доступен установленный фильтр. Тип каждого документа определяется по расширению имени файла этого документа. Например, при работе с DOC-файлом при полнотекстовом поиске будет использоваться фильтр, который поддерживает документы Microsoft Word. Чтобы получить список доступных типов документов, выполните запрос к представлению каталога [sys.fulltext_document_types](../../relational-databases/system-catalog-views/sys-fulltext-document-types-transact-sql.md) .  
  
Учтите, что средство полнотекстового поиска может использовать имеющиеся фильтры, которые установлены в операционной системе. Перед использованием фильтров операционной системы, средств разбиения по словам и парадигматических модулей их необходимо загрузить на экземпляр сервера следующим образом.  
  
```sql  
EXEC sp_fulltext_service @action='load_os_resources', @value=1  
```  
  
Чтобы создать полнотекстовый индекс для столбца типа **varbinary(max)** , средству полнотекстового поиска требуется доступ к расширениям файлов документов в столбце типа **varbinary(max)** . Эта информация должна быть сохранена в столбце таблицы, который называется столбцом типов и должен быть связан со столбцом **varbinary(max)** в полнотекстовом индексе. Во время индексирования документа средство полнотекстового поиска по расширению файла в столбце типа определяет, какой фильтр следует использовать.  
   
### <a name="index-xml-data"></a>Индексирование XML-данных  
 Столбец с данными типа **xml** содержит только документы и фрагменты XML, и для таких документов используется только фильтр XML. Поэтому столбец типов не требуется. Для столбцов типа **xml** можно создать полнотекстовый индекс, который индексирует содержимое XML-элементов, но пропускает XML-разметку. К значениям атрибута, если они не являются числовыми значениями, применяется полнотекстовый индекс. Теги элементов используются в качестве границ токенов. Поддерживаются XML- или HTML-документы и фрагменты правильного формата, содержащие несколько языков.  
  
 Дополнительные сведения о создании запросов к столбцу типа **xml** и его индексировании см. в статье [Полнотекстовый поиск в XML-столбцах](../../relational-databases/xml/use-full-text-search-with-xml-columns.md).  
  
##  <a name="disable-or-re-enable-full-text-indexing-for-a-table"></a><a name="disable"></a> Отключение и повторное включение полнотекстовой индексации для таблицы   
 В [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]во всех созданных пользователями базах данных полнотекстовый поиск включен по умолчанию. Кроме того, отдельная таблица автоматически включается для полнотекстового индексирования, как только для нее создается полнотекстовый индекс, и в этот индекс добавляется столбец. Таблица автоматически выключается для полнотекстового индексирования, как только из ее полнотекстового индекса удаляется последний столбец.  
  
 В таблице с полнотекстовым индексом можно вручную отключить и повторно включить полнотекстовое индексирование, используя среду [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].  

1.  Разверните группу серверов, узел **Базы данных** и базу данных, содержащую таблицу, для которой нужно включить полнотекстовое индексирование.  
  
2.  Разверните узел **Таблицы** и щелкните правой кнопкой мыши таблицу, которую нужно отключить или повторно включить для полнотекстового индексирования.  
  
3.  Выберите **Полнотекстовый индекс** и щелкните **Отключить полнотекстовое индексирование** или **Включить полнотекстовое индексирование**.  
  
##  <a name="remove-a-full-text-index-from-a-table"></a><a name="remove"></a> Удаление полнотекстового индекса из таблицы  
  
1.  В обозревателе объектов щелкните правой кнопкой мыши таблицу, содержащую полнотекстовый индекс, который необходимо удалить.  
  
2.  Выберите **Удалить полнотекстовый индекс**.  
  
3.  В окне для подтверждения удаления полнотекстового индекса нажмите кнопку **ОК** .  
  
  
