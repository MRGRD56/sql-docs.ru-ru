---
description: Репликация секционированных таблиц и индексов
title: Репликация секционированных таблиц и индексов | Документация Майкрософт
ms.custom: ''
ms.date: 09/10/2015
ms.prod: sql
ms.prod_service: database-engine
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- partitioned indexes [SQL Server], replicating
- partitioned tables [SQL Server], replicating
- replication [SQL Server], partitioned tables
- publishing [SQL Server replication], partitioned tables
- transactional replication, partitioned tables
ms.assetid: c9fa81b1-6c81-4c11-927b-fab16301a8f5
author: MashaMSFT
ms.author: mathoma
monikerRange: =azuresqldb-mi-current||>=sql-server-2016
ms.openlocfilehash: 70df27b530fe6afb40f296afdc012ac2c40500a9
ms.sourcegitcommit: 1a544cf4dd2720b124c3697d1e62ae7741db757c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/14/2020
ms.locfileid: "97468945"
---
# <a name="replicate-partitioned-tables-and-indexes"></a>Репликация секционированных таблиц и индексов
[!INCLUDE[sql-asdbmi](../../../includes/applies-to-version/sql-asdbmi.md)]
  Секционирование делает большие таблицы и индексы более управляемыми, так как позволяет быстро и эффективно получать доступ к подмножествам данных и управлять ими, при этом сохраняя целостность всей коллекции данных. Дополнительные сведения см. в разделе [Partitioned Tables and Indexes](../../../relational-databases/partitions/partitioned-tables-and-indexes.md). Репликация поддерживает секционирование, предоставляя набор свойств, которые указывают, как работать с секционированными таблицами и индексами.  
  
## <a name="article-properties-for-transactional-and-merge-replication"></a>Свойства статьи для репликации слиянием и репликации транзакций  
 В таблице перечислены объекты, применяемые для секционирования данных.  
  
|Объект|Создан с помощью|  
|------------|----------------------|  
|Секционированная таблица или индекс|CREATE TABLE или CREATE INDEX|  
|Функция секционирования|CREATE PARTITION FUNCTION|  
|Схема секционирования|CREATE PARTITION SCHEME|  
  
 Первый набор свойств, связанных с секционированием, — параметры схемы статьи, определяющие, следует ли копировать объекты секционирования в экземпляр подписчика. Эти параметры схемы могут быть установлены следующими способами.  
  
-   На странице **Свойства статьи** мастера создания публикаций или в диалоговом окне «Свойства публикации». Чтобы копировать объекты, перечисленные в предыдущей таблице, задайте значение **true** для свойств **Копировать схемы секционирования таблиц** и **Копировать схемы секционирования индекса**. Сведения о доступе к странице **Свойства статьи** см. в статье [Просмотр и изменение свойств публикации](../../../relational-databases/replication/publish/view-and-modify-publication-properties.md).  
  
-   С помощью параметра *schema_option* одной из следующих хранимых процедур:  
  
    -   [sp_addarticle](../../../relational-databases/system-stored-procedures/sp-addarticle-transact-sql.md) или [sp_changearticle](../../../relational-databases/system-stored-procedures/sp-changearticle-transact-sql.md) для репликации транзакций;  
  
    -   [sp_addmergearticle](../../../relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql.md) или [sp_changemergearticle](../../../relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql.md) для репликации слиянием.  
  
     Чтобы копировать объекты, перечисленные в предыдущей таблице, выберите соответствующие значения параметров схемы. Дополнительные сведения об указании параметров схемы см. в разделе [Specify Schema Options](../../../relational-databases/replication/publish/specify-schema-options.md).  
  
 Репликация копирует объекты на подписчик во время начальной синхронизации. Если схема секционирования использует файловые группы, отличные от PRIMARY, эти файловые группы должны существовать на подписчике до начальной синхронизации.  
  
 После инициализации подписчика изменения данных распространяются на подписчик и применяются к соответствующим секциям. Однако изменения схемы секционирования не поддерживаются. Репликация транзакций и репликация слиянием не поддерживают репликацию следующих команд: ALTER PARTITION FUNCTION, ALTER PARTITION SCHEME, а также инструкции REBUILD WITH PARTITION команды ALTER INDEX. Изменения, связанные с ними, не будут автоматически реплицироваться на подписчика. Пользователь должен вручную внести соответствующие изменения.  
  
## <a name="replication-support-for-partition-switching"></a>Поддержка переключения секций при репликации  
 Одно из главных преимуществ секционирования — способность быстро и эффективно перемещать подмножества данных между секциями. Данные перемещаются командой SWITCH PARTITION. По умолчанию, если таблица включена для репликации, операции SWITCH PARTITION блокированы по следующим причинам.  
  
-   Если данные перемещаются в таблицу или из таблицы, которая существует на издателе, но не на подписчике, издатель и подписчик могут оказаться несогласованными друг с другом. Эта проблема обычно возникает при перемещении данных в промежуточную таблицу или из нее.  
  
-   Если определение секционированной таблицы отличается на подписчике и издателе, агент распространителя завершит свою работу ошибкой при попытке применить изменения на подписчике.  
  
 Несмотря на эти возможные проблемы, переключение секций можно включить при репликации транзакций. Прежде чем включить переключение секций, убедитесь, что все таблицы, участвующие в переключении секций, существуют на издателе и на подписчике и что определения таблиц и разделов совпадают.  
  
 Если все секции имеют одинаковую схему на издателях и подписчиках, можно включить параметр *allow_partition_switch* вместе с *replication_partition_switch* , что позволит выполнить репликацию только инструкции о смене секции для подписчика. Можно также включить параметр *allow_partition_switch* без репликации DDL. Это полезно, когда из раздела требуется убрать сведения за прошлые месяцы, однако сохранить реплицированную секцию в течение следующего года в целях резервного копирования на подписчике.  
  
 При включении переключения секций в SQL Server 2008 R2 через текущую версию вам могут также потребоваться операции разбиения и слияния в ближайшем будущем. Перед выполнением разбиения или слияния секций в реплицированной таблице убедитесь, что нужная секция не содержит реплицированные команды в режиме ожидания. Также следует учитывать, что при разбиении или слиянии в секции не должны выполняться операции DML. Наличие транзакций, не обработанных агентом чтения журнала, или выполнение операций DML в секции реплицируемой таблицы во время выполнения операции разбиения или слияния (с использованием одной секции) может привести к ошибке обработки агентом чтения журнала. Чтобы ее исправить , может потребоваться повторная инициализация подписки.  
  
> [!WARNING]  
>  Не нужно включать переключения секций для одноранговых публикаций из-за наличия скрытых столбцов, используемых для обнаружения и разрешения конфликтов.  
  
### <a name="enabling-partition-switching"></a>Включение переключения секций  
 Следующие свойства публикации транзакций позволяют пользователям управлять переключением секций в реплицируемой среде.  
  
-   `@allow_partition_switch`. Если его значение равно `true`, команду SWITCH PARTITION можно выполнять в базе данных публикации.  
  
-   `@replicate_partition_switch` определяет, реплицировать ли инструкцию DDL SWITCH PARTITION на подписчик. Этот параметр доступен, если свойство `@allow_partition_switch` имеет значение `true`.  
  
 Эти свойства можно задать с помощью хранимой процедуры [sp_addpublication](../../../relational-databases/system-stored-procedures/sp-addpublication-transact-sql.md) при создании публикации или с помощью процедуры [sp_changepublication](../../../relational-databases/system-stored-procedures/sp-changepublication-transact-sql.md) после создания публикации. Как уже отмечалось, репликация слиянием не поддерживает переключение секций. Чтобы выполнить команду SWITCH PARTITION для таблицы, для которой включена репликация слиянием, удалите эту таблицу из публикации.  
  
## <a name="see-also"></a>См. также  
 [Публикация данных и объектов базы данных](../../../relational-databases/replication/publish/publish-data-and-database-objects.md)  
  
  
