---
description: Инициализация подписки с помощью моментального снимка для новой публикации
title: Инициализация подписки с помощью моментального снимка
ms.custom: ''
ms.date: 03/23/2020
ms.prod: sql
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- snapshots [SQL Server replication], initializing subscriptions
- initializing subscriptions [SQL Server replication], snapshots
ms.assetid: 77a9ade2-cdc0-4ae9-a02d-6e29d7c2ada0
author: MashaMSFT
ms.author: mathoma
monikerRange: = azuresqldb-mi-current || >= sql-server-2016
ms.openlocfilehash: 2936d9c53f3dd99bcd112de3743107128da25fc2
ms.sourcegitcommit: 1a544cf4dd2720b124c3697d1e62ae7741db757c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/14/2020
ms.locfileid: "97479925"
---
# <a name="initialize-a-subscription-with-a-snapshot-for-a-new-publication"></a>Инициализация подписки с помощью моментального снимка для новой публикации

[!INCLUDE [SQL Server SQL MI](../../includes/applies-to-version/sql-asdbmi.md)]

В этой статье описываются процессы, выполняемые при инициализации публикации репликации. К подписчикам применяется исходный моментальный снимок.

## <a name="snapshot-for-a-new-publication"></a>Моментальный снимок для новой публикации

По умолчанию моментальный снимок записывается после создания публикации.
Моментальный снимок копируется в папку моментальных снимков. Это поведение по умолчанию применяется для публикаций слиянием, созданных с помощью мастера создания публикаций.

### <a name="snapshot-is-applied-to-subscriber"></a>Моментальный снимок применяется к подписчику

Новый моментальный снимок применяется к подписчикам с помощью агента. Применение происходит во время начальной синхронизации подписки. Применяемый агент зависит от типа публикации:

- Для публикаций _транзакций_ и _моментальных снимков_:
  - Агент распространителя.

- Для публикаций _слиянием_:
  - Агент слияния.

### <a name="type-of-publication"></a>Тип публикации

В следующей таблице показано содержимое моментального снимка для каждого типа публикации.

&nbsp;

| Тип публикации, для которой предназначен моментальный снимок | Содержимое снимка |
| :---------------------------------------- | :----------------------- |
| <ul> <li>Публикация моментальных снимков</li> <li>Публикация транзакций</li> <li>Публикация слиянием, которая не использует параметризованные фильтры</li> </ul> | <ul> <li>схема</li> <li>Данные в файлах для программы массового копирования (BCP)</li> <li>Ограничения</li> <li>Расширенные свойства</li> <li>Индексы</li> <li>Триггеры</li> <li>Системные таблицы, необходимые для репликации</li> </ul> <br/>См. [Создание и применение моментального снимка](../../relational-databases/replication/create-and-apply-the-initial-snapshot.md). |
| <ul> <li>Публикация слиянием, которая использует параметризованные фильтры</li> </ul> | <ul> <li>Моментальный снимок схемы (скрипты репликации, опубликованные объекты, но не данные)</li> <li>Данные, принадлежащие секции подписки</li> </ul> <br/>См. [Моментальные снимки для публикаций слиянием с параметризованными фильтрами](../../relational-databases/replication/create-a-snapshot-for-a-merge-publication-with-parameterized-filters.md). |
| | |

#### <a name="two-part-process-with-merge-publication-that-uses-parameterized-filters"></a>Двухэтапный процесс с публикацией слиянием, использующий параметризованные фильтры

Для публикации слиянием, в которой используются параметризованные фильтры, процесс создания моментального снимка происходит в два этапа:

1. Создается моментальный снимок схемы, который содержит следующие элементы:
   - Скрипты репликации.
   - Схема опубликованных объектов.
   - _(Но не данные.)_

2. Затем каждая подписка инициализируется моментальным снимком. Моментальный снимок содержит следующие элементы:
   - Скрипты и схемы, скопированные из моментального снимка схемы.
   - Данные, принадлежащие секции подписки.

## <a name="type-of-replication"></a>Тип репликации

Типы файлов в моментальном снимке зависят от типа репликации и статей в публикации.

&nbsp;

| Тип репликации | Общие файлы моментальных снимков |
| :------------------ | :-------------------- |
| Репликация моментального снимка или<br/>репликация транзакций | &bullet; схема (SCH); <br/>&bullet; данные (BCP); <br/>&bullet; ограничения и индексы (DRI); <br/>&bullet; сжатые файлы моментальных снимков (CAB); <br/>&bullet; триггеры (TAG), только для обновления подписчика; <br/><br/>&bullet; ограничения (IDX). |
| Репликация слиянием                                      | &bullet; схема (SCH); <br/>&bullet; данные (BCP); <br/>&bullet; ограничения и индексы (DRI); <br/>&bullet; сжатые файлы моментальных снимков (CAB); <br/>&bullet; триггеры (TRG); <br/><br/>&bullet; данные системной таблицы (SYS); <br/>&bullet; таблицы конфликтов (CFT). |
| | |

### <a name="snapshot-folder"></a>Папка моментальных снимков

Файлы передаются путем копирования в _папку моментальных снимков_ по умолчанию или в _альтернативную папку_ для моментальных снимков.

Папка моментальных снимков указывается при настройке распространителя. Альтернативная папка указывается при создании публикации.

### <a name="resume-transfer-after-interruption"></a>Возобновление переноса после прерывания

Перемещение файлов в папку моментальных снимков автоматически возобновляется, если перемещение прервано ненадежным подключением.

Для повышения эффективности возобновление не отправляет повторно файлы, которые уже были полностью переданы до прерывания.

## <a name="snapshot-options"></a>Параметры моментального снимка

При инициализации подписки с помощью моментального снимка есть несколько возможностей. Вы можете:

- Указать другое расположение папки моментальных снимков вместо или дополнительно к папке по умолчанию. Дополнительные сведения см. в разделе [Изменение параметров моментального снимка](../../relational-databases/replication/snapshot-options.md).

- Сжать моментальные снимки для хранения на съемном носителе или для передачи по медленной сети. Дополнительные сведения см. в разделе [Compressed Snapshots](../../relational-databases/replication/snapshot-options.md#compressed-snapshots).

- Выполнить скрипты Transact-SQL до или после применения моментального снимка. Дополнительные сведения см. в статье [Выполнение скриптов до и после применения моментального снимка](../../relational-databases/replication/snapshot-options.md#execute-scripts-before-and-after-snapshot-is-applied).

- Передать файлы моментальных снимков с помощью протокола передачи файлов (FTP). Дополнительные сведения см. в статье [Передача моментальных снимков через FTP](../../relational-databases/replication/publish/deliver-a-snapshot-through-ftp.md).

## <a name="see-also"></a>См. также:

[Инициализация подписки](../../relational-databases/replication/initialize-a-subscription.md)

[Защита папки моментальных снимков](../../relational-databases/replication/security/secure-the-snapshot-folder.md)
