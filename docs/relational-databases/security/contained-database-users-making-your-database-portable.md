---
title: Автономный доступ пользователей к автономным базам данных
description: Сведения о настройке автономного доступа пользователей для автономных баз данных и отличиях от традиционной модели "имя для входа/пользователь".
ms.custom: seo-lt-2019
ms.date: 01/28/2019
ms.prod: sql
ms.prod_service: database-engine, sql-database, sql-data-warehouse, pdw
ms.reviewer: ''
ms.technology: security
ms.topic: conceptual
helpviewer_keywords:
- contained database, users
- user [SQL Server], about contained database users
ms.assetid: e57519bb-e7f4-459b-ba2f-fd42865ca91d
author: VanMSFT
ms.author: vanto
monikerRange: =azuresqldb-current||>=sql-server-2016||=azure-sqldw-latest||=sqlallproducts-allversions||>=sql-server-linux-2017||=azuresqldb-mi-current
ms.openlocfilehash: decbd12174f6000a44a3cfd95b145c70de10740c
ms.sourcegitcommit: a5398f107599102af7c8cda815d8e5e9a367ce7e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/13/2020
ms.locfileid: "92004666"
---
# <a name="contained-database-users---making-your-database-portable"></a>Пользователи автономной базы данных — создание переносимой базы данных

[!INCLUDE [SQL Server ASDB, ASDBMI, ASDW ](../../includes/applies-to-version/sql-asdb-asdbmi-asa.md)]

  Используйте пользователей автономной базы данных для проверки подлинности подключений [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и [!INCLUDE[ssSDS](../../includes/sssds-md.md)] на уровне базы данных. Автономная база данных — это база данных, изолированная от других баз данных и от экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]/ [!INCLUDE[ssSDS](../../includes/sssds-md.md)] (и базы данных master), на котором размещена эта база данных. [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] поддерживает пользователей автономной базы данных для проверки подлинности Windows и [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . При использовании [!INCLUDE[ssSDS](../../includes/sssds-md.md)]объединяйте пользователей автономной базы данных с правилами брандмауэра уровня базы данных. В этом разделе рассматриваются различия и преимущества использования модели автономной базы данных по сравнению с традиционной моделью имя для входа/ пользователь и правилами брандмауэра в Windows или на уровне сервера. Конкретные сценарии, управляемость или приложение бизнес-логики могут по-прежнему требовать использования традиционной модели имя для входа/ пользователь и правила брандмауэра на уровне сервера.  
  
> [!NOTE]  
> Поскольку [!INCLUDE[msCoName](../../includes/msconame-md.md)] развивает службу [!INCLUDE[ssSDS](../../includes/sssds-md.md)] и переходит к более высокому гарантированному соглашению об уровне обслуживания, может потребоваться переключиться на модель пользователя автономной базы данных и правила брандмауэра уровня базы данных для достижения более высокой доступности соглашения об уровне обслуживания и более высокой максимальной частоты команд Login для конкретной базы данных. [!INCLUDE[msCoName](../../includes/msconame-md.md)] рекомендуется рассмотреть такие изменения сегодня.  
  
## <a name="traditional-login-and-user-model"></a>Традиционная модель имени для входа и пользователя

 В традиционной модели подключения пользователи Windows или участники групп Windows подключаются к [!INCLUDE[ssDE](../../includes/ssde-md.md)] , указывая учетные данные пользователей или групп, прошедших проверку подлинности в Windows. Или же можно указать имя и пароль и подключиться с помощью проверки подлинности [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . В обоих случаях у базы данных master должно быть имя, которое соответствует учетным данным подключения. Когда [!INCLUDE[ssDE](../../includes/ssde-md.md)] подтвердит учетные данные для проверки подлинности Windows или выполнит проверку подлинности учетных данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , соединение обычно пытается подключиться к пользовательской базе данных. Для подключения к пользовательской базе данных имя для входа должно быть сопоставлено (то есть, связано) с пользователем в базе данных. Строка подключения также может указывать на подключение к конкретной базе данных, что не является обязательным в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , но требуется в [!INCLUDE[ssSDS](../../includes/sssds-md.md)].  
  
 Важно, чтобы имя для входа (в базе данных master) и пользователь (в базе данных пользователей) существовали и были связаны друг с другом. Это означает, что подключение к пользовательской базе данных зависит от имени для входа в базе данных master, а это ограничивает возможность перемещения базы данных на другой сервер [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] или [!INCLUDE[ssSDSFull](../../includes/sssdsfull-md.md)] . Если по какой-либо причине подключение к базе данных master недоступно (например, идет отработка отказа), общее время соединения может увеличиться или истечь. Следовательно, это может снизить масштабируемость подключений.  
  
## <a name="contained-database-user-model"></a>Модель пользователя автономной базы данных

 В модели пользователей автономной базы данных отсутствует имя входа в базе данных master. Вместо этого процесс проверки подлинности происходит в пользовательской базе данных, а у пользователя нет связанного имени для входа в базе данных master. Модель пользователей автономной базы данных поддерживает проверку подлинности Windows и [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и может использоваться как в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , так и в [!INCLUDE[ssSDS](../../includes/sssds-md.md)]. Чтобы подключиться как пользователь автономной базы данных, строка подключения должна всегда содержать параметр для пользовательской базы данных, чтобы [!INCLUDE[ssDE](../../includes/ssde-md.md)] было известно, какая база данных отвечает за управление проверкой подлинности. Область действий пользователя автономной базы данных ограничена базой данных проверки подлинности, поэтому при подключении пользователя автономной базы данных учетная запись пользователя необходимо создавать отдельно в каждой базе данных, которая потребуется пользователю. Для смены базы данных пользователю [!INCLUDE[ssSDS](../../includes/sssds-md.md)] необходимо создать новое соединение. Пользователи автономной базы данных в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] могут менять базы данных, если идентичный пользователь имеется в другой базе данных.  
  
**Azure:** [!INCLUDE[sqldbesa](../../includes/sqldbesa-md.md)] и [!INCLUDE[ssSDW_md](../../includes/sssdw-md.md)] поддерживают удостоверения Azure Active Directory в качестве пользователей автономной базы данных. [!INCLUDE[ssSDS_md](../../includes/sssds-md.md)] поддерживает пользователей автономной базы данных, использующих проверку подлинности [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] , а [!INCLUDE[ssSDW_md](../../includes/sssdw-md.md)] — нет. См. дополнительные сведения об [использовании аутентификации Azure Active Directory для аутентификации с помощью SQL](/azure/azure-sql/database/authentication-aad-overview). При использовании проверки подлинности Azure Active Directory подключения из SSMS могут выполняться с помощью универсальной проверки подлинности Active Directory.  Администраторы могут настроить универсальную проверку подлинности для обязательного использования Многофакторной Идентификации, которая проверяет удостоверение с помощью телефонного звонка, текстового сообщения, смарт-карты с ПИН-кодом или уведомления мобильного приложения. Дополнительные сведения см. в разделе [Поддержка SSMS для Azure AD MFA с использованием Базы данных SQL и Azure Synapse Analytics](/azure/azure-sql/database/authentication-mfa-ssms-overview).  
  
 Поскольку строка подключения должна всегда содержать имя базы данных, в [!INCLUDE[ssSDS](../../includes/sssds-md.md)] и [!INCLUDE[ssSDW_md](../../includes/sssdw-md.md)]при переходе с традиционной модели на модель пользователей автономной базы данных менять строку подключения не требуется. Для подключений [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] имя базы данных необходимо добавить в строку подключения, если оно там отсутствует.  
  
> [!IMPORTANT]  
> При использовании традиционной модели роли и разрешения на уровне сервера могут ограничить доступ ко всем базам данных. При использовании модель автономной базы данных владельцы и пользователи баз данных с разрешением ALTER ANY USER могут предоставлять к ней доступ. Это сокращает контроль доступа серверных имен с высоким уровнем разрешений и позволяет включить пользователей базы данных с высоким уровнем разрешений.  
  
## <a name="firewalls"></a>Брандмауэры  
  
### [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]

 Правила брандмауэра Windows применяются для всех подключений и влияют на имена для входа (традиционной модели подключений) так же, как и на пользователей автономной базы данных. Дополнительные сведения о брандмауэре Windows см. в статье [Настройка брандмауэра Windows для доступа к компоненту Database Engine](../../database-engine/configure-windows/configure-a-windows-firewall-for-database-engine-access.md).  
  
### <a name="sssds-firewalls"></a>[!INCLUDE[ssSDS](../../includes/sssds-md.md)] Брандмауэры

 [!INCLUDE[ssSDS](../../includes/sssds-md.md)] позволяет задавать отдельные правила брандмауэров для подключений на уровне сервера (имен для входа) и подключений уровня базы данных (пользователей автономной базы данных). При подключении к базе данных пользователя сначала проверяются правила брандмауэра базы данных. Если нет правил, разрешающих доступ к базе данных, проверяются правила брандмауэра на уровне сервера, что требует доступа к базе данных master сервера Базы данных SQL. Правила брандмауэра уровня базы данных в сочетании с пользователями автономной базы данных могут исключить необходимость доступа к базе данных master сервера во время подключения, повышая масштабируемость подключений.  
  
 Дополнительные сведения о правилах брандмауэра [!INCLUDE[ssSDS](../../includes/sssds-md.md)] см. в следующих статьях:  
  
- [Брандмауэр Базы данных SQL Azure](/previous-versions/azure/ee621782(v=azure.100))  
- [Руководство. Настройка параметров брандмауэра (база данных SQL Microsoft Azure)](/previous-versions/azure/jj553530(v=azure.100))  
- [sp_set_firewall_rule (база данных Azure SQL)](../../relational-databases/system-stored-procedures/sp-set-firewall-rule-azure-sql-database.md)  
- [sp_set_database_firewall_rule (база данных Azure SQL)](../../relational-databases/system-stored-procedures/sp-set-database-firewall-rule-azure-sql-database.md)  
  
## <a name="syntax-differences"></a>Синтаксические отличия  
  
|Традиционная модель|Модель пользователя автономной базы данных|  
|-----------------------|-----------------------------------|  
|При подключении к базе данных master:<br /><br /> `CREATE LOGIN login_name  WITH PASSWORD = 'strong_password';`<br /><br /> Затем при подключении к базе данных пользователя:<br /><br /> `CREATE USER 'user_name' FOR LOGIN 'login_name';`|При подключении к базе данных пользователя:<br /><br /> `CREATE USER user_name  WITH PASSWORD = 'strong_password';`|  
  
|Традиционная модель|Модель пользователя автономной базы данных|  
|-----------------------|-----------------------------------|  
|Изменение пароля в контексте базы данных master.<br /><br /> `ALTER LOGIN login_name  WITH PASSWORD = 'strong_password';`|Изменение пароля в контексте базы данных пользователя.<br /><br /> `ALTER USER user_name  WITH PASSWORD = 'strong_password';`|  

### <a name="managed-instance"></a>Базы данных SQL

Управляемый экземпляр SQL Azure ведет себя как локальный сервер SQL Server в контексте автономных баз данных. При создании автономного пользователя не забудьте изменить контекст базы данных из базы данных master на пользовательскую базу данных. Кроме того, при настройке параметра автономности не должно быть активных подключений к пользовательской базе данных. 


Пример:

> [!WARNING]
> Перед выполнением следующего скрипта убедитесь, что в базе данных управляемого экземпляра нет других активных подключений. Этот сценарий может привести к нарушению работы других процессов, запущенных в базе данных.

```sql
Use MASTER;
GO 

ALTER DATABASE Test
SET RESTRICTED_USER
WITH ROLLBACK IMMEDIATE;

ALTER DATABASE Test
SET containment=partial;

ALTER DATABASE Test
SET MULTI_USER;

USE Test;  
GO 

CREATE USER Carlo  
WITH PASSWORD='Enterpwdhere*'  

SELECT containment_desc FROM sys.databases
WHERE name='Test'
```

  
## <a name="remarks"></a>Remarks  
  
- В [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]пользователи автономной базы данных должны быть включены для экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Дополнительные сведения см. в статье [Параметр конфигурации сервера contained database authentication](../../database-engine/configure-windows/contained-database-authentication-server-configuration-option.md).  
- Пользователи автономной базы данных и имена для входа с неперекрывающимися именами могут сосуществовать в приложениях.  
- Если имеется имя для входа в базе данных master с именем **name1** и создается пользователь автономной базы данных с именем **name1**, то при указании имени базы данных в строке подключения будет избираться контекст пользователя базы данных, а не контекст имени для входа при подключении к базе данных. То есть, пользователи автономной базы данных имеют приоритет над именами для входа с тем же именем  
- В [!INCLUDE[ssSDS](../../includes/sssds-md.md)] имя пользователя автономной базы данных не может быть таким же, как имя учетной записи администратора сервера.  
- Учетная запись администратора сервера [!INCLUDE[ssSDS](../../includes/sssds-md.md)] не может быть пользователем автономной базы данных. Администратор сервера имеет достаточные разрешения для создания пользователей автономной базы данных и управления ими. Администратор сервера может предоставлять разрешения пользователям автономной базы данных для пользовательских баз данных.  
- Поскольку пользователи автономной базы данных являются участниками уровня базы данных, необходимо создать пользователей автономной базы данных в каждой базе данных, которая их использует. Удостоверение сводится к базе данных и не зависит во всех аспектах от пользователя с тем же именем и паролем в другой базе данных на том же сервере.  
- Использование паролей одинаковой сложности с теми, которые обыкновенно используются для имен входа.  
  
## <a name="see-also"></a>См. также:

 [Автономные базы данных](../../relational-databases/databases/contained-databases.md)   
 [Рекомендации по обеспечению безопасности автономных баз данных](../../relational-databases/databases/security-best-practices-with-contained-databases.md)   
 [CREATE USER (Transact-SQL)](../../t-sql/statements/create-user-transact-sql.md)   
 [Подключение к базе данных SQL с использованием аутентификации Azure Active Directory](/azure/azure-sql/database/authentication-aad-overview)  
