---
title: Запись событий подсистемы аудита SQL Server в журнал безопасности | Документация Майкрософт
description: Узнайте, как записывать события подсистемы аудита SQL Server в журнал безопасности Windows. Узнайте об ограничениях, касающихся использования этого журнала.
ms.custom: ''
ms.date: 09/21/2017
ms.prod: sql
ms.prod_service: security
ms.reviewer: ''
ms.technology: security
ms.topic: conceptual
helpviewer_keywords:
- logs [SQL Server], Security Log
- server audit [SQL Server]
- audits [SQL Server], writing to Security Log
- security logs [SQL Server]
ms.assetid: 6fabeea3-7a42-4769-a0f3-7e04daada314
author: VanMSFT
ms.author: vanto
ms.openlocfilehash: abdd25c6166b40436584a1260d4b1b09d40900c4
ms.sourcegitcommit: ca81fc9e45fccb26934580f6d299feb0b8ec44b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2021
ms.locfileid: "102186091"
---
# <a name="write-sql-server-audit-events-to-the-security-log"></a>Запись событий подсистемы аудита SQL Server в журнал безопасности  
[!INCLUDE [SQL Server](../../../includes/applies-to-version/sqlserver.md)]

В среде с повышенной безопасностью подходящим местом для записи событий доступа к объектам является журнал безопасности Windows. Другие местонахождения аудита поддерживаются, но они более уязвимы для вторжения злоумышленников.  
  
 Для записи событий аудита сервера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] в журнал безопасности Windows существует три основных требования.  
  
-   Параметр аудита доступа к объектам должен быть настроен для записи событий. Программа политики аудита (`auditpol.exe`) предоставляет доступ к ряду внутренних параметров политик в категории **Аудит доступа к объектам** . Чтобы позволить [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] проводить аудит доступа к объектам, нужно настроить параметр **формируется приложением** .  
-   Для записи в журнал безопасности Windows учетная запись, из-под которой выполняется служба [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , должна иметь разрешение **Создание аудитов безопасности** . По умолчанию этим разрешением обладают учетные записи и Locale Service и Network Service. Если служба [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] выполняется от имени одной из этих учетных записей, данный шаг не требуется.  
-   Предоставьте учетной записи службы [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] полные права для куста реестра `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\EventLog\Security`.  

  > [!IMPORTANT]  
  > [!INCLUDE[ssnoteregistry-md](../../../includes/ssnoteregistry-md.md)]   
  
Политика аудита Windows может повлиять на аудит [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , если включена запись в журнал безопасности Windows, при этом существует опасность потери событий, если политика аудита настроена неправильно. Обычно журнал безопасности Windows перезаписывает более старые события. В результате сохраняются самые последние события. Однако, если журнал безопасности Windows не настроен на перезапись более старых событий, при заполнении журнала безопасности система создаст событие Windows 1104 (журнал заполнен). После этого:  
-   Последующие события безопасности не будут регистрироваться  
-   [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] не сможет установить, что система не регистрирует события в журнале безопасности, в результате чего возможна потеря событий аудита  
-   После того как администратор настроит журнал безопасности, режим записи в журнал вернется в нормальное состояние.  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> Перед началом  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> Ограничения  
 Администраторы компьютера с [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] должны учитывать, что локальные параметры журнала безопасности могут быть переопределены политикой домена. В этом случае политика домена может перезаписывать параметр подкатегории (**auditpol /get /subcategory:"application generated"** ). Это может повлиять на способность [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] регистрировать события, причем будет невозможно определить, что события, для которых [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] пытается провести аудит, не регистрируются.  
  
###  <a name="security"></a><a name="Security"></a> безопасность  
  
####  <a name="permissions"></a><a name="Permissions"></a> Permissions  
 Для настройки этих параметров необходимо быть администратором Windows.  
  
##  <a name="to-configure-the-audit-object-access-setting-in-windows-using-auditpol"></a><a name="auditpolAccess"></a> Настройка параметра аудита доступа к объектам в Windows с помощью средства auditpol  
  
1.  Откройте командную строку с правами администратора.  
  
    1.  В меню **Пуск** последовательно укажите пункты **Все программы**, **Стандартные**, щелкните правой кнопкой мыши пункт **Командная строка** и выберите пункт **Запуск от имени администратора**.  
  
    2.  В диалоговом окне **Контроль учетных записей** нажмите кнопку **Продолжить**.  
  
2.  Выполните следующую инструкцию для включения аудита из [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].  
  
    ```  
    auditpol /set /subcategory:"application generated" /success:enable /failure:enable  
    ```  
  
3.  Закройте окно командной строки.  
  
##  <a name="to-grant-the-generate-security-audits-permission-to-an-account-using-secpol"></a><a name="secpolAccess"></a> Предоставление разрешения на создание аудитов безопасности конкретной учетной записи с помощью средства secpol  
  
1.  В любой версии операционной системы Windows в меню **Пуск** выберите пункт **Выполнить**.  
  
2.  Введите **secpol.msc** , а затем нажмите кнопку **ОК**. В диалоговом окне **Управление доступом на уровне пользователей** нажмите кнопку **Продолжить**.  
  
3.  В средстве «Локальная политика безопасности» разверните узел **Настройки безопасности**, разверните узел **Локальные политики**, а затем щелкните **Назначение прав пользователя**.  
  
4.  На панели результатов дважды щелкните **Создание аудитов безопасности**.  
  
5.  На вкладке **Параметр локальной безопасности** нажмите кнопку **Добавить пользователя или группу**.  
  
6.  В диалоговом окне **Выбор: пользователи, компьютеры или группы** либо введите имя учетной записи, например **домен1\пользователь1** , а затем нажмите кнопку **ОК**, либо нажмите кнопку **Дополнительно...** и найдите нужную учетную запись.  
  
7.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
8.  Закройте средство политики безопасности.  
  
9. Перезапустите [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , чтобы включить этот параметр.  
  
##  <a name="to-configure-the-audit-object-access-setting-in-windows-using-secpol"></a><a name="secpolPermission"></a> Настройка параметра аудита доступа к объектам в Windows с помощью средства secpol  
  
1.  Если операционная система имеет более раннюю версию, чем [!INCLUDE[wiprlhext](../../../includes/wiprlhext-md.md)] или Windows Server 2008, в меню **Пуск** выберите пункт **Выполнить**.  
  
2.  Введите **secpol.msc** , а затем нажмите кнопку **ОК**. В диалоговом окне **Управление доступом на уровне пользователей** нажмите кнопку **Продолжить**.  
  
3.  В средстве «Локальная политика безопасности» разверните узел **Настройки безопасности**, разверните узел **Локальные политики**, а затем **Политика аудита**.  
  
4.  На панели результатов дважды щелкните **Аудит доступа к объектам**.  
  
5.  На вкладке **Параметр локальной безопасности** в области **Вести аудит следующих попыток доступа** выберите оба параметра: **Успешно** и **Ошибка**.  
  
6.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
7.  Закройте средство политики безопасности.  
  
## <a name="see-also"></a>См. также:  
 [Подсистема аудита SQL Server (компонент Database Engine)](../../../relational-databases/security/auditing/sql-server-audit-database-engine.md)  
  
  
