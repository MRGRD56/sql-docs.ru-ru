---
title: Настройка производительности для R
description: Эта статья описывает оптимизацию производительности для служб R Services.
ms.prod: sql
ms.technology: machine-learning-services
ms.date: 04/15/2018
ms.topic: how-to
author: dphansen
ms.author: davidph
ms.custom: seo-lt-2019
monikerRange: '>=sql-server-2016||>=sql-server-linux-ver15||=sqlallproducts-allversions'
ms.openlocfilehash: cedb8cd13db6c8d27b987c60881093caa91af50a
ms.sourcegitcommit: 9b41725d6db9957dd7928a3620fe4db41eb51c6e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/13/2020
ms.locfileid: "88180467"
---
# <a name="performance-tuning-for-r-in-sql-server"></a>Настройка производительности для R в SQL Server
[!INCLUDE [SQL Server 2016 and later](../../includes/applies-to-version/sqlserver2016.md)]

Эта статья является первой в серии из четырех частей, описывающих оптимизацию производительности для служб R Services на примере двух случаев:

- Тесты производительности, проведенные командой разработчиков продукта для проверки профиля производительности решений R

- Клиенты часто просят команду обработки и анализа данных Майкрософт оптимизировать производительность под конкретный сценарий машинного обучения.

Задача этой серии учебников заключается в предоставлении рекомендации по типам методов настройки производительности, которые лучше сего подходят для выполнения заданий R в SQL Server.

+ Эта (первая) статья содержит обзор архитектуры и некоторые распространенные проблемы, возникающие при оптимизации под задачи обработки и анализа данных.
+ Вторая статья описывает определенные оптимизации оборудования и SQL Server.
+ Третья статья описывает оптимизации кода R и ресурсов для практического использования.
+ Четвертая статья подробно описывает методы тестирования, а также результаты и выводы.

**Применимо к:** Службы SQL Server 2016 R Services, Службы машинного обучения SQL Server

## <a name="performance-goals-and-targeted-scenarios"></a>Задачи по обеспечению производительности и целевые сценарии

Компонент R Services появился в SQL Server 2016 для поддержки выполнения скриптов R системой SQL Server. При использовании этого компонента среда выполнения R работает в отдельном процессе из ядра СУБД, но обеспечивает безопасный обмен данными с ядром СУБД, используя ресурсы сервера и службы, которые взаимодействуют с SQL Server, например доверенную панелью запуска.

В SQL Server 2017 была анонсирована поддержка для выполнения скриптов Python с использованием той же архитектуры с возможностью добавления дополнительных языков в будущем.

По мере увеличения числа поддерживаемых версий и языков важно, чтобы администратор базы данных и архитектор базы данных имели представление о потенциальном состязании за ресурсы из-за заданий машинного обучения и могли настроить сервер для поддержки новых рабочих нагрузок. Хотя размещение функций аналитики близко к данным устраняет небезопасные перемещения данных, это также выносит аналитические рабочие нагрузки за пределы ноутбука специалиста по обработке и анализу данных и возвращает их на сервер, где размещены данные.

Оптимизация производительности для машинного обучения определенно не является универсальным решением. Следующие типовые задачи могут иметь очень разные профили производительности:

- Задачи обучения: создание и обучение модели регрессии и обучение нейронной сети
- Формирование признаков с помощью R и извлечение признаков с помощью T-SQL
- Оценка отдельных строк или небольших пакетов и массовая оценка с помощью табличных входных данных
- Выполнение оценки в R и развертывание моделей в рабочей среде на SQL Server в хранимых процедурах
- Изменение кода R для минимизации перемещения данных и удаление дорогостоящих преобразований данных
- Включение автоматического тестирования и повторное обучение моделей

Так как выбор методов оптимизации зависит от того, какая именно задача наиболее критична для вашего приложения или варианта использования, в примерах рассматриваются как общие советы по производительности, так и рекомендации по оптимизации под конкретный сценарий, а также оптимизация для пакетной оценки.

+ **Отдельные варианты оптимизации в SQL Server**

    В первом примере производительности было выполнено несколько тестов для одного набора данных с использованием модели одного типа. Алгоритм rxLinMod в RevoscaleR использовался для создания модели и формирования оценок из нее, но код и базовые таблицы данных систематически изменялись для проверки влияния каждого изменения.

    Например, в одном тестовом запуске код R был изменен, чтобы можно было сравнить формирование признаков с помощью функции преобразования и предварительное вычисление признаков с последующей загрузкой признаков из таблицы. В другом тестовом запуске эффективность обучения модели сравнивалась между использованием стандартной индексированной таблицы и данных в таблице с различными типами сжатия или новыми типами индексов.

+ **Оптимизация под конкретный сценарий крупномасштабной оценки**

    Задача машинного обучения во втором примере включает в себя обработку множества резюме, отправленных на несколько должностей, и поиск лучшего кандидата для каждой должности. Сама модель машинного обучения определяется как задача двоичной классификации: она принимает резюме и описание должности в качестве входных данных и определяет вероятность для каждой пары из резюме и должности. Так как целью является поиск наилучшего соответствия, для дальнейшей фильтрации и получения только удачных совпадений используется пороговое значение вероятности, определяемое пользователем.

    Для этого решения основной целью было достижение низкой задержки при оценке. Однако эта задача потребляет значительные вычислительные ресурсы даже на этапе оценки, так как каждую новую должность нужно сопоставить с миллионами резюме в течение разумного интервала времени. Более того, на этапе формирования признаков создается более 2000 признаков для каждого резюме или каждой должности, и это серьезное узкое место с точки зрения производительности.

Мы рекомендуем просмотреть все результаты из первого примера, чтобы определить, какие методы применимы к вашему решению, и оценить их потенциальное влияние.

Затем изучите результаты примера оптимизации оценки, чтобы определить, как автор применил различные методы и оптимизировал сервер для поддержки определенной рабочей нагрузки.

## <a name="performance-optimization-process"></a>Процесс оптимизации производительности

Для настройки производительности требуется обеспечить надежное основание для размещения оптимизаций под конкретные рабочие нагрузки.

- Выберите подходящий сервер для размещения аналитики. Как правило, предпочтительнее использовать сервер-получатель отчетов, хранилище данных или другой сервер, которые уже используются для других задач по ведению отчетов или аналитики. Однако в решении гибридной транзакционно-аналитической обработки (HTAP) операционные данные можно использовать в качестве входных данных R для быстрой оценки.

- Настройте экземпляр SQL Server для балансировки операций ядра СУБД, выполнения скриптов R или Python на соответствующих уровнях. Это может подразумевать изменение значений по умолчанию SQL Server для использования памяти и ЦП, параметров сходства процессоров и NUMA, а также создания групп ресурсов.

- Оптимизируйте серверный компьютер для поддержки эффективного использования внешних скриптов. Сюда может входить увеличение числа учетных записей, используемых для выполнения внешних скриптов, включение управления пакетами и назначение пользователей соответствующим ролям безопасности.

- Применение оптимизаций, относящихся к хранению и переносу данных в SQL Server, включая стратегии индексирования и сбора статистики, оптимизацию проектирования и выполнения запросов, а также проектирование таблиц, используемых для машинного обучения. Вы также можете проанализировать источники данных и методы передачи данных или изменить процессы извлечения, преобразования и загрузки (ETL), чтобы оптимизировать извлечение признаков.

- Настройте аналитическую модель, чтобы избежать неэффективной работы. Область действия возможных оптимизаций зависит от сложности кода R и используемых пакетов и данных. Основные задачи включают устранение дорогостоящих преобразований данных или разгрузку подготовки данных или задач формирования признаков из R или Python в процессы ETL или SQL. Вы также можете выполнить рефакторинг скриптов, исключить встроенные установки пакетов, разделить код R на отдельные процедуры для обучения, оценки и вычисления или упростить код для более эффективной работы в качестве хранимой процедуры.

## <a name="articles-in-this-series"></a>Статьи в этой серии

+ [Настройка производительности для R в SQL Server — оборудование](../r/sql-server-configuration-r-services.md)

    Содержит рекомендации по настройке оборудования, на котором установлен [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)], а также по настройке экземпляра SQL Server для улучшения поддержки внешних скриптов. Эти сведения особенно полезны **администраторам базы данных**.

+ [Настройка производительности для R в SQL Server — код R и оптимизация данных](../r/r-and-data-optimization-r-services.md)

    Содержит конкретные советы по оптимизации внешнего скрипта для предотвращения известных проблем. Эти сведения особенно полезны **специалистам по обработке и анализу данных**.

    > [!NOTE]
    > Хотя большая часть информации посвящена R, вы также найдете здесь некоторые сведения об аналитических функциях RevoScaleR. Подробные рекомендации по производительности для **revoscalepy** и других поддерживаемых библиотек Python недоступны.
    >

+ [Настройка производительности для R в SQL Server — методы и результаты](../r/performance-case-study-r-services.md)

    Содержит сводные сведения о данных, использованных в двух примерах, проверке производительности и влиянии оптимизации на результаты.
