---
title: Известные проблемы с Python и R
description: В этой статье описаны известные проблемы или ограничения для компонентов Python и R, предоставляемых в Службах машинного обучения SQL Server и службах SQL Server 2016 R Services.
ms.prod: sql
ms.technology: machine-learning-services
ms.date: 10/13/2020
ms.topic: troubleshooting
author: dphansen
ms.author: davidph
ms.custom: contperf-fy20q4
monikerRange: '>=sql-server-2016||>=sql-server-linux-ver15'
ms.openlocfilehash: 51d729bcdb25900af855e7429e953ee44dc1388b
ms.sourcegitcommit: 108bc8e576a116b261c1cc8e4f55d0e0713d402c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/25/2021
ms.locfileid: "98766305"
---
# <a name="known-issues-in-sql-server-machine-learning-services"></a>Известные проблемы служб машинного обучения SQL Server
[!INCLUDE [SQL Server 2016 and later](../../includes/applies-to-version/sqlserver2016.md)]

В этой статье описаны известные проблемы или ограничения для компонентов Python и R, предоставляемых в [Службах машинного обучения SQL Server](../sql-server-machine-learning-services.md) и службах [SQL Server 2016 R Services](../r/sql-server-r-services.md).

## <a name="setup-and-configuration-issues"></a>Проблемы с установкой и настройкой

Описание процессов, связанных с начальной настройкой и конфигурацией, см. в статье [Установка служб машинного обучения SQL Server](../install/sql-machine-learning-services-windows-install.md). Он содержит сведения об обновлениях, параллельной установке и установке новых компонентов R или Python.

### <a name="1-inconsistent-results-in-mkl-computations-due-to-missing-environment-variable"></a>1. Непоследовательные результаты в вычислениях MKL из-за отсутствия переменной среды

**Применимо к:** Двоичные файлы R_SERVER 9.0, 9.1, 9.2 или 9.3.

R_SERVER использует библиотеку Intel Math Kernel Library (MKL). Для вычислений, включающих MKL, непоследовательные результаты могут возникать, если в системе отсутствует переменная среды. 

Задайте переменную среды `'MKL_CBWR'=AUTO`, чтобы обеспечить условную числовую воспроизводимость в R_SERVER. Дополнительные сведения см. в разделе [Введение в условную числовую воспроизводимость (CNR)](https://software.intel.com/articles/introduction-to-the-conditional-numerical-reproducibility-cnr).

**Обходное решение**

1. На панели управления щелкните **Система и безопасность** > **Система** > **Расширенные параметры системы** > **Переменные среды**.

2. Создайте новую пользовательскую или системную переменную. 

   + Задайте имя переменной MKL_CBWR.
   + Задайте значение переменной AUTO.

3. Перезапустите R_SERVER. На SQL Server можно перезапустить службу панели запуска SQL Server.

> [!NOTE]
> Если вы используете SQL Server 2019 в Linux, измените или создайте *.bash_profile* в домашнем каталоге пользователя, добавив строку `export MKL_CBWR="AUTO"`. Выполните этот файл, введя команду `source .bash_profile` в командной строке bash. Перезапустите R_SERVER, введя `Sys.getenv()` в командной строке R.

### <a name="2-r-script-runtime-error-sql-server-2017-cu5-cu7-regression"></a>2. Ошибка времени выполнения скрипта R (SQL Server 2017 с накопительными пакетами обновлений 5–7 (регрессия))

Для SQL Server 2017 в накопительных пакетах обновлений от 5 до 7 существует регрессия в файле **rlauncher. config**, где путь к файлу временной папки содержит пробел. Эта регрессия исправлена в накопительном пакете обновлений 8.

Ошибка, которую вы увидите при выполнении скрипта R, включает следующие сообщения:

> *Не удалось связаться со средой выполнения для скрипта R. Проверьте требования среды выполнения R.*
>
> Сообщения STDERR из внешнего скрипта: 
>
> *Неустранимая ошибка: не удается создать "R_TempDir"*

**Обходное решение**

Примените накопительный пакет обновлений 8, когда он будет доступен. Кроме того, можно повторно создать **rlauncher. config**, запустив **registerrext** с удалением или установкой в командной строке с повышенными привилегиями. 

```cmd
<SQLInstancePath>\R_SERVICES\library\RevoScaleR\rxLibs\x64\RegisterRExt.exe /uninstall /sqlbinnpath:<SQLInstanceBinnPath> /userpoolsize:0 /instance:<SQLInstanceName>

<SQLInstancePath>\R_SERVICES\library\RevoScaleR\rxLibs\x64\RegisterRExt.exe /install /sqlbinnpath:<SQLInstanceBinnPath> /userpoolsize:0 /instance:<SQLInstanceName>
```

В следующем примере показаны команды с экземпляром MSSQL14.MSSQLSERVER по умолчанию, установленным в "C:\Program Files\Microsoft SQL Server\":

```cmd
"C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\R_SERVICES\library\RevoScaleR\rxLibs\x64\RegisterRext.exe" /uninstall /sqlbinnpath:"C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\Binn" /userpoolsize:0 /instance:MSSQLSERVER

"C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\R_SERVICES\library\RevoScaleR\rxLibs\x64\RegisterRext.exe" /install /sqlbinnpath:"C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\Binn" /userpoolsize:0 /instance:MSSQLSERVER
```

### <a name="3-unable-to-install-sql-server-machine-learning-features-on-a-domain-controller"></a>3. Не удается установить компоненты машинного обучения SQL Server на контроллере домена

При попытке установить службы SQL Server 2016 R или службы машинного обучения SQL Server на контроллере домена происходит сбой программы установки со следующими ошибками:

> *Произошла ошибка во время процесса установки компонента*
>
> *Не удается найти группу с удостоверением*
>
> *Код ошибки компонента: 0x80131509*

Сбой происходит из-за того, что на контроллере домена служба не может создать 20 локальных учетных записей, необходимых для запуска машинного обучения. В общем случае не рекомендуется устанавливать SQL Server на контроллере домена. Дополнительные сведения см. в [бюллетене поддержки 2032911](https://support.microsoft.com/help/2032911/you-may-encounter-problems-when-installing-sql-server-on-a-domain-cont).

### <a name="4-install-the-latest-service-release-to-ensure-compatibility-with-microsoft-r-client"></a>4. Чтобы обеспечить совместимость с Microsoft R Client, установите последний набор исправлений

Если вы установили последнюю версию Microsoft R Client и используете ее для выполнения R в SQL Server с помощью удаленного контекста вычисления, может возникнуть следующая ошибка:

> *На компьютере используется версия 9.x.x Microsoft R Client, которая несовместима с Microsoft R Server версии 8.x.x. Скачайте и установите совместимую версию*.

SQL Server 2016 требует, чтобы библиотеки R на клиенте точно совпадали с библиотеками R на сервере. Ограничение было удалено для выпусков более поздней версии, чем R Server 9.0.1. Однако при возникновении этой ошибки проверьте версию библиотек R, используемых клиентом и сервером, и при необходимости обновите клиент в соответствии с версией сервера.

Как правило, версия R, устанавливаемая с SQL Server R Services, обновляется при установке набора исправлений SQL Server. Чтобы обеспечить наличие самых актуальных версий компонентов R, установите все пакеты обновления.

Для совместимости с Microsoft R Client 9.0.0 необходимо установить обновления, которые описываются в этой [статье службы поддержки](https://support.microsoft.com/kb/3210262).

Чтобы избежать проблем с пакетами R, можно также обновить версии библиотек R, установленных на сервере, изменив соглашение об обслуживании на использование современной политики поддержки жизненного цикла, как описано в [следующем разделе](#bkmk_sqlbindr). При этом версия R, установленная с SQL Server, обновляется по тому же расписанию, которое использовалось для обновления сервера машинного обучения (ранее Microsoft R Server).

**Применимо к:** SQL Server 2016 R Services с R Server версии 9.0.0 или более ранней

### <a name="5-r-components-missing-from-cu3-setup"></a>5. Компоненты R, отсутствующие в накопительном пакете обновления 3

Некоторое количество виртуальных машин Azure подготавливалось без файлов установки R, которые должны быть добавлены в SQL Server. Эта ошибка относится к виртуальным машинам, подготовленным в период с 5.01.2018 по 23.01.2018. Эта проблема также может повлиять на локальные установки, если вы применили накопительный пакет обновления 3 для SQL Server 2017 в течение периода с 5.01.2018 по 23.01.2018.

Предоставлен набор исправлений, который включает в себя правильную версию файлов установки R.

+ [Накопительный пакет обновления 3 для SQL Server 2017 — KB4052987](https://www.microsoft.com/download/details.aspx?id=56128).

Чтобы установить компоненты и восстановить накопительный пакет обновления 3 (CU3) SQL Server 2017, необходимо удалить накопительный пакет обновления 3 и переустановить обновленную версию:

1. Скачайте обновленный файл установки CU3, содержащий установщики R.
2. Удалите CU3. На панели управления найдите **Удалить обновление**, а затем выберите "Исправление 3015 для SQL Server 2017 (KB4052987) (64-разрядный)". Выполните действия по удалению.
3. Переустановите обновление CU3, дважды щелкнув обновление для KB4052987, которое вы только что загрузили: `SQLServer2017-KB4052987-x64.exe`. Следуйте инструкциям по установке.

### <a name="6-unable-to-install-python-components-in-offline-installations-of-sql-server-2017-ctp-20-or-later"></a>6. Не удается установить компоненты Python в автономных установках SQL Server 2017 CTP 2.0 или более поздней версии

Если установить предварительную версию SQL Server 2017 на компьютере без доступа к Интернету, установщик может не отобразить страницу с запросом расположения загруженных компонентов Python. В таком случае можно установить компонент Службы машинного обучения, но не компоненты Python.

Эта проблема исправлена в этом выпуске. Кроме того, это ограничение неприменимо к компонентам R.

**Применимо к:** SQL Server 2017 с Python

### <a name="warning-of-incompatible-version-when-you-connect-to-an-older-version-of-sql-server-r-services-from-a-client-by-using-sssqlv14_md"></a><a name="bkmk_sqlbindr"></a> Предупреждение о несовместимости версии при подключении к более старой версии SQL Server R Services из клиента с помощью [!INCLUDE[ssSQLv14_md](../../includes/sssqlv14-md.md)]

При выполнении кода R в контексте вычислений SQL Server 2016 может появиться следующее сообщение об ошибке:

> *На компьютере используется версия 9.0.0 клиента Microsoft R, которая несовместима с Microsoft R Server версии 8.0.3. Скачайте и установите совместимую версию*.

Это сообщение отображается, если верно одно из следующих утверждений:

+ Сервер R Server (отдельный) установлен на клиентском компьютере с помощью мастера установки для [!INCLUDE[ssSQLv14_md](../../includes/sssqlv14-md.md)].
+ Microsoft R Server установлен с помощью [отдельного установщика Windows](/machine-learning-server/install/r-server-install-windows).

Чтобы убедиться, что сервер и клиент используют одну и ту же версию, может потребоваться использовать _привязки_, поддерживаемые для Microsoft R Server 9.0 и более поздних версий, для обновления компонентов R в экземплярах SQL Server 2016. Чтобы определить, доступна ли поддержка обновлений для вашей версии служб R, см. статью [Обновление экземпляра служб R с помощью SqlBindR.exe](../install/upgrade-r-and-python.md).

**Применимо к:** SQL Server 2016 R Services с R Server версии 9.0.0 или более ранней

### <a name="7-setup-for-sql-server-2016-service-releases-might-fail-to-install-newer-versions-of-r-components"></a>7. При установке выпусков служб SQL Server 2016 могут не установиться более новые версии компонентов R.

При установке накопительного пакета обновления или пакета обновления для SQL Server 2016 на компьютере, не подключенном к Интернету, мастер установки может не вывести запрос, позволяющий обновить компоненты R с помощью скачанных файлов CAB. Обычно это происходит, если несколько компонентов устанавливаются вместе с ядром СУБД.

В качестве обходного решения можно установить набор исправлений из командной строки, указав аргумент `MRCACHEDIRECTORY`, как показано в этом примере для накопительного пакета обновления 1:

`C:\<path to installation media>\SQLServer2016-KB3164674-x64.exe /Action=Patch /IACCEPTROPENLICENSETERMS /MRCACHEDIRECTORY=<path to CU1 CAB files>`

Чтобы получить последние установщики, ознакомьтесь со статьей [Установка компонентов машинного обучения без доступа к Интернету](../install/sql-ml-component-install-without-internet-access.md).

**Применимо к:** SQL Server 2016 R Services с R Server версии 9.0.0 или более ранней

### <a name="8-launchpad-services-fails-to-start-if-the-version-is-different-from-the-r-version"></a>8. Службы панели запуска не запускаются, если их версия отличается от версии R

Если SQL Server R Services устанавливается отдельно от ядра СУБД, а версии сборки отличаются, в журнале системных событий может появиться следующее сообщение об ошибке:

> *Службе панели запуска SQL Server не удалось запуститься из-за следующей ошибки: служба не ответила на запрос запуска или контроля за отведенное время.*

Эта ошибка может возникнуть, например, если вы установили ядро СУБД с использованием набора исправлений, применили исправление для обновления ядра СУБД, а затем добавили компонент службы R с использованием набора исправлений.

Чтобы избежать этой проблемы, используйте служебную программу, например диспетчер файлов, для сравнения версий файла Launchpad.exe с версией двоичных файлов SQL, например sqldk.dll. Все компоненты должны иметь одинаковый номер версии. Если вы обновляете один компонент, обязательно примените это же обновление ко всем остальным установленным компонентам.

Найдите панель запуска в папке `Binn` экземпляра. Например, при установке по умолчанию SQL Server 2016 путь может быть `C:\Program Files\Microsoft SQL Server\MSSQL.13.InstanceNameMSSQL\Binn`. 

### <a name="9-remote-compute-contexts-are-blocked-by-a-firewall-in-sql-server-instances-that-are-running-on-azure-virtual-machines"></a>9. Контексты удаленных вычислений блокируются брандмауэром в экземплярах SQL Server, работающих на виртуальных машинах Azure

Если вы установили [!INCLUDE[ssnoversion](../../includes/ssnoversion-md.md)] на виртуальной машине Azure, возможно, вы не сможете использовать контексты вычислений, для которых требуется рабочее пространство виртуальной машины. Объясняется это тем, что по умолчанию брандмауэр на виртуальной машине Azure использует правило, которое блокирует сетевой доступ для локальных учетных записей пользователя R.

Чтобы этого избежать, откройте **брандмауэр Windows в режиме повышенной безопасности** на виртуальной машине Azure, выберите **Правила для исходящих подключений** и отключите следующее правило: **Блокировать сетевой доступ для учетных записей локальных пользователей R в экземпляре SQL Server MSSQLSERVER**. Можно также оставить правило включенным, но изменить свойство безопасности на **Разрешить, если безопасно**.

### <a name="10-implied-authentication-in-sqlexpress"></a>10. Неявная проверка подлинности в SQLEXPRESS

При выполнении заданий R с удаленной рабочей станции обработки и анализа данных с применением встроенной проверки подлинности Windows сервер SQL Server использует *неявную проверку подлинности* для создания локальных вызовов ODBC, которые могут потребоваться скрипту. Но эта функция не работала в сборке RTM экспресс-выпуска SQL Server.

Чтобы устранить эту проблему, рекомендуем произвести обновление до более позднего выпуска службы.

Если обновление невозможно, вы можете использовать имя входа SQL для выполнения удаленных заданий R, которым могут потребоваться внедренные вызовы ODBC.

**Применимо к:** SQL Server 2016 R Services Express Edition

### <a name="11-performance-limits-when-libraries-used-by-sql-server-are-called-from-other-tools"></a>11. Ограничения производительности при вызове библиотек, используемых SQL Server, из других средств

Библиотеки машинного обучения, установленные для SQL Server, можно вызывать из внешнего приложения, например RGui. Это может быть наиболее удобным способом выполнения определенных задач, таких как установка новых пакетов или выполнение специальных тестов на очень коротких примерах кода. Однако за пределами SQL Server производительность может быть ограничена.

Например, даже если вы используете выпуск Enterprise Edition SQL Server, R будет работать в однопотоковом режиме при выполнении кода R с помощью внешних средств. Чтобы получить преимущества производительности в SQL Server, инициируйте подключение SQL Server и используйте [sp_execute_external_script](../../relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql.md) для вызова внешней среды выполнения скрипта.

Как правило, следует избегать вызова библиотек машинного обучения, используемых SQL Server, из внешних средств. Если вам нужно выполнить отладку кода R или Python, это проще всего сделать за пределами SQL Server. Чтобы получить те же библиотеки, которые находятся в SQL Server, можно установить Microsoft R Client или [SQL Server 2017 Machine Learning Server (отдельный)](../install/sql-machine-learning-standalone-windows-install.md).

### <a name="12-sql-server-data-tools-does-not-support-permissions-required-by-external-scripts"></a>12. SQL Server Data Tools не поддерживает разрешения, необходимые для внешних скриптов

При использовании Visual Studio или SQL Server Data Tools для публикации проекта базы данных, если какой-либо участник имеет разрешения, относящиеся к выполнению внешнего скрипта, может появиться сообщение об ошибке следующего вида:

> *Модель TSQL: обнаружена ошибка при реконструировании базы данных. Разрешение не было распознано и не было импортировано.*

В настоящее время модель DACPAC не поддерживает разрешения, используемые службами R или службами машинного обучения, например GRANT ANY EXTERNAL SCRIPT или EXECUTE ANY EXTERNAL SCRIPT. Эта проблема будет исправлена в будущем выпуске.

В качестве обходного решения выполните дополнительные инструкции GRANT в сценарии, выполняемом после развертывания.

### <a name="13-external-script-execution-is-throttled-due-to-resource-governance-default-values"></a>13. Выполнение внешнего скрипта регулируется из-за значений по умолчанию для управления ресурсами

В выпуске Enterprise Edition можно использовать пулы ресурсов для управления внешними процессами скриптов. В некоторых сборках максимальный размер памяти, который можно было выделять процессам R, был ограничен на уровне 20 %. Поэтому, если сервер имел 32 ГБ ОЗУ, исполняемые файлы R (RTerm.exe и BxlServer.exe) могли использовать не более 6,4 ГБ для одного запроса.

Если возникли ограничения ресурсов, проверьте текущее значение по умолчанию. Если 20 % недостаточно, изучите документацию для [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], чтобы узнать, как изменить это значение.

**Применимо к:** SQL Server 2016 R Services Enterprise Edition

### <a name="14-error-when-using-sp_execute_external_script-without-libcso-on-linux"></a>14. Ошибка при использовании `sp_execute_external_script` без `libc++.so` в Linux

На чистом компьютере Linux, на котором не установлен `libc++.so`, выполнение запроса `sp_execute_external_script` (SPEES) с использованием Java или внешнего языка завершится сбоем, так как `commonlauncher.so` не может загрузить `libc++.so`.

Пример:

```sql
EXECUTE sp_execute_external_script @language = N'Java'
    , @script = N'JavaTestPackage.PassThrough'
    , @parallel = 0
    , @input_data_1 = N'select 1'
WITH RESULT SETS((col1 INT NOT NULL))
GO
```

Происходит сбой с сообщением следующего вида:

```text
Msg 39012, Level 16, State 14, Line 0

Unable to communicate with the runtime for 'Java' script for request id: 94257840-1704-45E8-83D2-2F74AEB46CF7. Please check the requirements of 'Java' runtime.
```

В журнале `mssql-launchpadd` появится примерно следующее сообщение об ошибке:

```text
Oct 18 14:03:21 sqlextmls launchpadd[57471]: [launchpad] 2019/10/18 14:03:21 WARNING: PopulateLauncher failed: Library /opt/mssql-extensibility/lib/commonlauncher.so not loaded. Error: libc++.so.1: cannot open shared object file: No such file or directory
```

**Обходное решение**

Используйте одно из следующих обходных решений:

1. Скопируйте `libc++*` из `/opt/mssql/lib` в системный путь по умолчанию `/lib64`

1. Добавьте следующие записи в `/var/opt/mssql/mssql.conf`, чтобы предоставить путь:

   ```text
   [extensibility]
   readabledirectories = /opt/mssql
   ```

**Применимо к:** SQL Server 2019 в Linux

### <a name="15-installation-or-upgrade-error-on-fips-enabled-servers"></a>15. Ошибка установки или обновления на серверах с поддержкой FIPS

Если вы устанавливаете SQL Server 2019 с компонентом **Службы машинного обучения и расширения языка** или обновляете экземпляр SQL Server на сервере с поддержкой [федерального стандарта обработки информации (FIPS)](/windows/security/threat-protection/security-policy-settings/system-cryptography-use-fips-compliant-algorithms-for-encryption-hashing-and-signing), возникнет следующая ошибка:

> *Произошла ошибка при установке функции расширяемости. Сообщение об ошибке: Сбой создания AppContainer с сообщением об ошибке NONE. Эта реализация не входит в состав проверенных криптографических алгоритмов FIPS для платформы Windows.*

**Обходное решение**

Отключите FIPS перед установкой SQL Server 2019 с компонентом **Службы машинного обучения и расширения языка** или обновлением экземпляра SQL Server. После завершения установки или обновления можно снова включить FIPS.

**Применимо к:** SQL Server 2019

## <a name="r-script-execution-issues"></a>Проблемы с выполнением скриптов R

В этом разделе содержатся известные проблемы, характерные для запуска R на SQL Server, а также некоторые проблемы, связанные с библиотеками R и инструментами, опубликованными корпорацией Майкрософт, включая RevoScaleR.

Дополнительные известные проблемы, которые могут повлиять на решения R, см. на сайте [Machine Learning Server](/machine-learning-server/resources-known-issues).

### <a name="1-access-denied-warning-when-executing-r-scripts-on-sql-server-in-a-non-default-location"></a>1. Предупреждение о запрете доступа при выполнении скриптов R для SQL Server в расположении, отличном от расположения по умолчанию

Если экземпляр SQL Server был установлен не в расположении по умолчанию, например за пределами папки `Program Files`, возникает предупреждение ACCESS_DENIED при попытке запустить скрипты, устанавливающие пакет. Пример:

> *В `normalizePath(path.expand(path), winslash, mustWork)` : path[2]="~ExternalLibraries/R/8/1": доступ запрещен*

Причина заключается в том, что функция R пытается прочитать путь и завершается ошибкой, если встроенная группа пользователей **SQLRUserGroup** не имеет доступа на чтение. Вызываемое предупреждение не блокирует выполнение текущего скрипта R, но предупреждение может повторяться каждый раз, когда пользователь запускает любой другой скрипт R.

Если вы установили SQL Server в расположении по умолчанию, эта ошибка не возникает, так как все пользователи Windows имеют разрешения на чтение для папки `Program Files`.

Эта проблема решена в предстоящем наборе исправлений. В качестве обходного решения предоставьте группе **SQLRUserGroup** доступ на чтение для всех родительских папок `ExternalLibraries`.

### <a name="2-serialization-error-between-old-and-new-versions-of-revoscaler"></a>2. Ошибка сериализации между старыми и новыми версиями RevoScaleR

При передаче модели с использованием сериализованного формата в удаленный экземпляр SQL Server может возникнуть ошибка: 

> *Ошибка в memDecompress(data, type = decompress) internal error -3 in memDecompress(2).*

Эта ошибка возникает, если модель сохранена с помощью последней версии функции сериализации, [rxSerializeModel](/machine-learning-server/r-reference/revoscaler/rxserializemodel), но экземпляр SQL Server, в котором выполняется десериализация модели, имеет более раннюю версию API RevoScaleR из SQL Server 2017 с накопительным пакетом обновления 2 или более ранней версии.

В качестве обходного решения можно обновить экземпляр SQL Server 2017 до накопительного пакета обновления 3 (CU3) или более поздней версии.

Ошибка не отображается, если версия API совпадает или вы перемещаете модель, сохраненную с помощью более старой функции сериализации, на сервер, использующий более новую версию API сериализации.

Иными словами, используйте одну и ту же версию RevoScaleR для операций сериализации и десериализации.

### <a name="3-real-time-scoring-does-not-correctly-handle-the-_learningrate_-parameter-in-tree-and-forest-models"></a>3. Оценка в режиме реального времени неправильно обрабатывает параметр _learningRate_ в моделях дерева и леса.

Если вы создаете модель с помощью дерева принятия решений или леса принятия решений и указываете скорость обучения, то при использовании `sp_rxpredict` или функции SQL `PREDICT` вы можете получить непоследовательные результаты по сравнению с применением `rxPredict`.

Причиной является ошибка в API, который обрабатывает сериализованные модели и ограничен параметром `learningRate`: например, в [rxBTrees](/machine-learning-server/r-reference/revoscaler/rxbtrees) или

Эта проблема решена в предстоящем наборе исправлений.

### <a name="4-limitations-on-processor-affinity-for-r-jobs"></a>4. Ограничения на соответствие процессоров для заданий R

В исходной сборке SQL Server 2016 соответствие процессоров можно было задать только для ЦП в первой k-группе. Например, если сервер представляет собой компьютер с двумя сокетами и двумя k-группами, для процессов R используются только процессоры из первой k-группы. Это же ограничение действует при настройке регулирования ресурсов для заданий скриптов R.

Проблема исправлена в SQL Server 2016 с пакетом обновления 1 (SP1). Рекомендуем произвести обновление до более позднего набора исправлений.

**Применимо к:** SQL Server 2016 R Services версии RTM

### <a name="5-changes-to-column-types-cannot-be-performed-when-reading-data-in-a-sql-server-compute-context"></a>5. Изменение типов столбцов невозможно при считывании данных в контексте вычисления SQL Server.

Если в качестве контекста вычисления задан экземпляр SQL Server, вы не можете использовать аргумент _colClasses_ (или иные подобные аргументы) для изменения типа данных столбцов в коде R.

Например, следующая инструкция приведет к ошибке, если столбец CRSDepTimeStr уже не является целочисленным:

```R
data <- RxSqlServerData(
  sqlQuery = "SELECT CRSDepTimeStr, ArrDelay  FROM AirlineDemoSmall", 
  connectionString = connectionString, 
  colClasses = c(CRSDepTimeStr = "integer"))
```

В качестве обходного решения можно переписать SQL-запрос так, чтобы в нем использовалась функция CAST или CONVERT, и предоставить данные среде R с правильным типом данных. Как правило, оптимальнее в плане производительности работать с данными с помощью SQL, а не изменять данные в коде R.

**Применимо к:** SQL Server 2016 R Services

### <a name="6-limits-on-size-of-serialized-models"></a>6. Ограничения на размер сериализованных моделей

При сохранении модели в таблице SQL Server необходимо сериализовать модель и сохранить ее в двоичном формате. Теоретически максимальный размер модели, который может храниться с помощью этого метода, составляет 2 ГБ, что является максимальным размером столбцов varbinary в SQL Server.

Если необходимо использовать более крупные модели, доступны следующие обходные пути:

+ Попробуйте уменьшить размер модели. Некоторые пакеты R с открытым исходным кодом содержат большой объем информации в объекте модели, и большую часть этой информации можно удалить для развертывания. 
+ Используйте выбор признаков для удаления ненужных столбцов.
+ При использовании алгоритма с открытым исходным кодом рассмотрите аналогичную реализацию, используя соответствующий алгоритм в MicrosoftML или RevoScaleR. Эти пакеты были оптимизированы для сценариев развертывания.
+ После того как модель будет рационализирована и уменьшена в размерах, подумайте, можно ли использовать функцию [memCompress](https://www.rdocumentation.org/packages/base/versions/3.4.1/topics/memCompress) в базовом коде R, чтобы уменьшить размер модели, прежде чем передать ее в SQL Server. Это лучший вариант, если модель близка к ограничению в 2 ГБ.
+ Для больших моделей можно использовать функцию SQL Server [FileTable](../../relational-databases/blob/filetables-sql-server.md), чтобы сохранить модели, вместо использования столбца типа varbinary.

    Чтобы использовать FileTable, необходимо добавить исключение брандмауэра, так как данные, хранящиеся в таблицах FileTable, управляются драйвером файловой системы Filestream в SQL Server, а правила брандмауэра по умолчанию блокируют доступ к сетевым файлам. Дополнительные сведения см. в разделе [Обеспечение необходимых компонентов для FileTable](../../relational-databases/blob/enable-the-prerequisites-for-filetable.md).

    После включения таблицы FileTable для записи модели вы получаете путь из SQL с помощью API FileTable, а затем записываете модель в это расположение из кода. При необходимости чтения модели вы получаете путь из SQL, а затем вызываете модель, используя путь из скрипта. Дополнительные сведения см. в разделе [Доступ к таблицам FileTable с помощью API-интерфейсов ввода-вывода файлов](../../relational-databases/blob/access-filetables-with-file-input-output-apis.md).

### <a name="7-avoid-clearing-workspaces-when-you-execute-r-code-in-a-ssnoversion-compute-context"></a>7. Старайтесь не очищать рабочие области при выполнении кода R в контексте вычисления [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].

Если вы используете команду R для очистки рабочей области объектов при выполнении кода R в контексте вычисления [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] или очищаете рабочую область в рамках скрипта R, вызываемого с помощью [sp_execute_external_script](../../relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql.md), может возникнуть следующая ошибка: *объект рабочей области revoScriptConnection не найден*.

`revoScriptConnection` — это объект в рабочей области R, который содержит информацию о сеансе R, вызываемом из [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Но если код R содержит команду для очистки рабочей области (например, `rm(list=ls()))`), вся информация о сеансе и других объектах в рабочей области R также очищается.

Чтобы избежать этой проблемы, старайтесь не очищать переменные и другие объекты без особой надобности при выполнении кода R в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Хотя очистка рабочих областей является обычным действием при работе в консоли R, она может иметь непредвиденные последствия.

+ Для удаления конкретных переменных используйте функцию R `remove`, например `remove('name1', 'name2', ...)`
+ Если нужно удалить несколько переменных, сохраните имена временных переменных в списке и периодически выполняйте сборку мусора.

### <a name="8-restrictions-on-data-that-can-be-provided-as-input-to-an-r-script"></a>8. Ограничения для данных, которые могут быть предоставлены как входные данные в сценарии R

Следующие типы результатов запросов невозможно использовать в сценарии R:

- данные из запроса [!INCLUDE[tsql](../../includes/tsql-md.md)] , который ссылается на столбцы AlwaysEncrypted;
  
- данные из запроса [!INCLUDE[tsql](../../includes/tsql-md.md)] , который ссылается на маскированные столбцы.
  
     Если вам необходимо использовать скрытые данные в сценарии R, при необходимости можно создать копию данных во временной таблице и использовать эти данные.

### <a name="9-use-of-strings-as-factors-can-lead-to-performance-degradation"></a>9. Использование строк в качестве факторов может привести к снижению производительности

Использование переменных строкового типа в качестве факторов может значительно увеличить объем памяти, используемый для операций R. Это известная проблема с R в целом, и на эту тему есть множество статей. Например, см. статьи ["Факторы, которые не являются привилегированными гражданами в R", автор Джон Маунт (John Mount), в R-bloggers](https://www.r-bloggers.com/factors-are-not-first-class-citizens-in-r/) или ["stringsAsFactors: несанкционированная биография", автор Роджер Пенг (Roger Peng)](https://simplystatistics.org/2015/07/24/stringsasfactors-an-unauthorized-biography/). 

Хотя эта проблема не связана с SQL Server, она может значительно повлиять на производительность выполнения кода R в SQL Server. Строки обычно хранятся в виде varchar или nvarchar, а если столбец строковых данных имеет много уникальных значений, процесс внутреннего преобразования их в целые числа и обратно в строки с помощью R может даже привести к ошибкам выделения памяти.

Если для других операций не требуется строковый тип данных, сопоставление строковых значений с числовым (целочисленным) типом данных в рамках подготовки данных будет выгодно с точки зрения производительности и масштаба.

Обсуждение этой проблемы и другие советы см. в статье [Производительность служб R: оптимизация данных](../r/r-and-data-optimization-r-services.md).

### <a name="10-arguments-varstokeep-and-varstodrop-are-not-supported-for-sql-server-data-sources"></a>10. Аргументы *varsToKeep* и *varsToDrop* не поддерживаются для источников данных SQL Server

При использовании функции rxDataStep для записи результатов в таблицу применение *varsToKeep* и *varsToDrop* является удобным способом указания столбцов для включения или исключения в рамках операции. Но эти аргументы не поддерживаются для источников данных SQL Server.

### <a name="11-limited-support-for-sql-data-types-in-sp_execute_external_script"></a>11. Не все типы данных SQL поддерживаются в sp\_execute\_external\_script

Не все типы данных, поддерживаемые в SQL, можно использовать в R. В качестве обходного решения можно привести неподдерживаемый тип данных к поддерживаемому перед передачей данных в процедуру sp\_execute\_external\_script.

Дополнительные сведения см. в разделе [Библиотеки R и типы данных](../r/r-libraries-and-data-types.md).

### <a name="12-possible-string-corruption-using-unicode-strings-in-varchar-columns"></a>12. Возможное повреждение строки при использовании строк Юникода в столбцах varchar

Передача данных Юникода в столбцы varchar из [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] в R/Python может привести к повреждению строки. Это происходит из-за того, что кодировка этих строк Юникода в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] может не совпадать с кодировкой UTF-8 по умолчанию, используемой в R/Python. 

Чтобы отправить любые строковые данные, не относящиеся к ASCII, из [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] в R/Python, используйте кодировку UTF-8 (доступно в [!INCLUDE[sql-server-2019](../../includes/sssqlv15-md.md)]) или тип nvarchar.

### <a name="13-only-one-value-of-type-raw-can-be-returned-from-sp_execute_external_script"></a>13. Только одно значение типа `raw` может быть возвращено из `sp_execute_external_script`

Если двоичный тип данных (тип данных **raw** R) возвращается из R, значение должно быть отправлено из блока выходных данных.

Если тип данных отличается от **raw**, получить значения параметров можно вместе с результатами выполнения хранимой процедуры, добавив ключевое слово OUTPUT. Дополнительные сведения см. в разделе [Параметры](../../relational-databases/stored-procedures/parameters.md).

Если вы хотите использовать несколько выходных наборов, которые включают значения типа **raw**, можно выполнить несколько вызовов хранимой процедуры или отправить результирующие наборы обратно в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] с использованием ODBC.

### <a name="14-loss-of-precision"></a>14. Потеря точности

[!INCLUDE[tsql](../../includes/tsql-md.md)] и R поддерживают различные типы данных, поэтому во время преобразования возможна потеря точности числовых типов данных.

Дополнительные сведения о неявном преобразовании типов данных см. в разделе [Библиотеки R и типы данных](../r/r-libraries-and-data-types.md).

### <a name="15-variable-scoping-error-when-you-use-the-transformfunc-parameter"></a>15. Ошибка определения области переменной при использовании параметра transformFunc

Чтобы преобразовать данные во время моделирования, вы можете передать аргумент *transformFunc* в такой функции, как `rxLinmod` или `rxLogit`. Тем не менее вложенные вызовы функций могут привести к ошибкам области применения в контексте вычислений SQL Server, даже если вызовы правильно работают в локальном контексте.

> *Образец набора данных для анализа не имеет переменных*

Например, предположим, что в глобальной локальной среде определены две функции, `f` и `g`, и `g` вызывает `f`. В распределенных или удаленных вызовах с использованием `g` вызов `g` может привести к этой ошибке, поскольку не удается найти `f`, даже если вы передали удаленному вызову `f` и `g`.

При возникновении этой проблемы можно внедрить определение `f` в ваше определение `g`в любом месте перед тем, где `g` обычно вызывает `f`.

Пример:

```R
f <- function(x) { 2*x * 3 }
g <- function(y) {
              a <- 10 * y
               f(a)
}
```

Чтобы избежать этой ошибки, перепишите определение следующим образом:

```R
g <- function(y){
              f <- function(x) { 2*x +3}
              a <- 10 * y
              f(a)
}
```

### <a name="16-data-import-and-manipulation-using-revoscaler"></a>16. Импорт и обработка данных с помощью RevoScaleR

При чтении столбцов **varchar** из базы данных пробелы обрезаются. Чтобы избежать этого, добавьте перед и после строк символы, отличные от пробелов.

При использовании таких функций, как `rxDataStep`, для создания таблиц баз данных со столбцами **varchar** ширина столбца вычисляется на основе образца данных. Если ширина может быть различной, может потребоваться дополнить все строки до одинаковой длины.

Использование преобразования для изменения типа данных переменной не поддерживается при повторном вызове `rxImport` или `rxTextToXdf` для импорта и дополнения строк с объединением нескольких входных файлов в один XDF-файл.

### <a name="17-limited-support-for-rxexec"></a>17. Ограниченная поддержка для rxExec

В SQL Server 2016 функция `rxExec`, предоставляемая пакетом RevoScaleR, может использоваться только в однопотоковом режиме.

### <a name="18-increase-the-maximum-parameter-size-to-support-rxgetvarinfo"></a>18. Увеличение максимального размера параметра для поддержки rxGetVarInfo

При использовании наборов данных с очень большим количеством переменных (например, более 40 000) следует задать флаг `max-ppsize` при запуске R для использования функций, таких как `rxGetVarInfo`. Флаг `max-ppsize` указывает максимальный размер стека защиты указателей.

Если вы используете консоль R (например, в RGui.exe или RTerm.exe), можно задать значение _max-ppsize_ 500000, введя:

```R
R --max-ppsize=500000
```

### <a name="19-issues-with-the-rxdtree-function"></a>19. Проблемы с функцией rxDTree

Функция `rxDTree` в настоящее время не поддерживает преобразование в формулах. В частности, использование синтаксиса `F()` для создания факторов в режиме реального времени не поддерживается. Однако числовые данные будут автоматически собираться.

Упорядоченные факторы обрабатываются так же, как факторы, во всех функциях анализа RevoScaleR, за исключением `rxDTree`.

### <a name="20-datatable-as-an-outputdataset-in-r"></a>20. Data.table как OutputDataSet в R

Использование `data.table` в качестве `OutputDataSet` в R не поддерживается в накопительных пакетах обновления 13 (CU13) и более ранних версиях SQL Server 2017. Может появиться следующее сообщение:

``` text
Msg 39004, Level 16, State 20, Line 2
A 'R' script error occurred during execution of 
'sp_execute_external_script' with HRESULT 0x80004004.
Msg 39019, Level 16, State 2, Line 2
An external script error occurred: 
Error in alloc.col(newx) : 
  Internal error: length of names (0) is not length of dt (11)
Calls: data.frame ... as.data.frame -> as.data.frame.data.table -> copy -> alloc.col

Error in execution.  Check the output for more information.
Error in eval(expr, envir, enclos) : 
  Error in execution.  Check the output for more information.
Calls: source -> withVisible -> eval -> eval -> .Call
Execution halted
```

`data.table` в качестве `OutputDataSet` в R поддерживается в накопительных пакетах обновления 14 (CU14) и более ранних версиях SQL Server 2017.

### <a name="21-running-a-long-script-fails-while-installing-a-library"></a>21. Сбой выполнения длительного сценария при установке библиотеки

Когда выполняется длительный сеанс внешнего скрипта и одновременно dbo пытается установить библиотеку в другой базе данных, скрипт может завершиться.

Например, выполнение этого внешнего скрипта для главного сервера:

```sql
USE MASTER
DECLARE @language nvarchar(1) = N'R'
DECLARE @script nvarchar(max) = N'Sys.sleep(100)'
DECLARE @input_data_1 nvarchar(max) = N'select 1'
EXEC sp_execute_external_script @language = @language, @script = @script, @input_data_1 = @input_data_1 with result sets none
go
```

Пока dbo параллельно устанавливает библиотеку в LibraryManagementFunctional:

```sql
USE [LibraryManagementFunctional]
go

CREATE EXTERNAL LIBRARY [RODBC] FROM (CONTENT = N'/home/ani/var/opt/mssql/data/RODBC_1.3-16.tar.gz') WITH (LANGUAGE = 'R')
go

DECLARE @language nvarchar(1) = N'R'
DECLARE @script nvarchar(14) = N'library(RODBC)'
DECLARE @input_data_1 nvarchar(8) = N'select 1'
EXEC sp_execute_external_script @language = @language, @script = @script, @input_data_1 = @input_data_1
go
```

Предыдущий длительный внешний скрипт на главном сервере завершится следующим сообщением об ошибке:

> *Во время выполнения sp_execute_external_script произошла ошибка в скрипте R с HRESULT 0x800704d4.*

**Обходное решение**

Не запускайте установку библиотеки параллельно с длительным запросом. Или повторно запустите длительный запрос после завершения установки.

**Применимо к:** Только SQL Server 2019 в Linux и кластерах больших данных.

### <a name="22-sql-server-stops-responding-when-executing-r-scripts-containing-parallel-execution"></a>22. SQL Server перестает отвечать на запросы при выполнении скриптов R, включающих параллельное выполнение

В SQL Server 2019 наблюдается регрессия, которая влияет на скрипты R, использующие параллельное выполнение. Примеры включают использование `rxExec` с контекстом вычислений `RxLocalPar` и скрипты, которые используют пакет параллельного выполнения. Эта проблема вызвана ошибками, возникающими в пакете параллельного выполнения, если при записи на устройство для него задано значение NULL во время выполнения в SQL Server.

**Применимо к:** SQL Server 2019.

### <a name="23-precision-loss-for-moneynumericdecimalbigint-data-types"></a>23. Потеря точности для типов данных money/numeric/decimal/bigint

Выполнение скрипта R с `sp_execute_external_script` допускает использование типов данных money, numeric, decimal и bigint в качестве входных данных. Однако, поскольку они преобразуются в числовой тип R, это приводит к ухудшению точности в случае очень высоких значений или значений с десятичным разделителем.

+ **money**. Иногда значения центов будут неточными, и будет выдано предупреждение: *Внимание! Не удается точно представить значения центов*.  
+ **numeric/decimal**. `sp_execute_external_script` со скриптом R не поддерживает полный диапазон типов данных и изменяет несколько последних десятичных знаков, особенно у чисел с дробной частью.
+ **bigint**. R поддерживает только максимум 53-разрядные целые числа, после чего начнется потеря точности.

## <a name="python-script-execution-issues"></a>Проблемы с выполнением скриптов Python

В этом разделе содержатся известные проблемы, характерные для запуска Python на SQL Server, а также некоторые проблемы, связанные с пакетами Python, опубликованными корпорацией Майкрософт, включая [revoscalepy](/r-server/python-reference/revoscalepy/revoscalepy-package) и [microsoftml](/r-server/python-reference/microsoftml/microsoftml-package).

### <a name="1-call-to-pretrained-model-fails-if-path-to-model-is-too-long"></a>1. Вызов предварительно обученной модели завершается ошибкой, если путь к модели слишком длинный

Если предварительно обученные модели установлены в раннем выпуске SQL Server 2017, полный путь к файлу обученной модели может оказаться слишком длинным для чтения в Python. Это ограничение исправлено в более позднем наборе исправлений.

Существует несколько возможных обходных путей:

+ При установке предварительно обученных моделей выберите пользовательское расположение.
+ Если это возможно, установите экземпляр SQL Server в пользовательском пути установки с более коротким путем, например C:\SQL\MSSQL14.MSSQLSERVER.
+ Используйте служебную программу Windows [Fsutil](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/cc788097(v=ws.11)), чтобы создать жесткую связь, которая сопоставляет файл модели с более коротким путем.
+ Выполните обновление до последнего набора исправлений.

### <a name="2-error-when-saving-serialized-model-to-sql-server"></a>2. Ошибка при сохранении сериализованной модели в SQL Server

При передаче модели в удаленный экземпляр SQL Server и попытке чтения двоичной модели с помощью функции `rx_unserialize` в [revoscalepy](/machine-learning-server/python-reference/revoscalepy/revoscalepy-package) может возникнуть ошибка: 

> *NameError: имя rx_unserialize_model не определено*

Эта ошибка возникает, если модель сохранена с помощью последней версии функции сериализации, но экземпляр SQL Server, в котором выполняется десериализация модели, не распознает API сериализации.

Чтобы решить эту проблему, можно обновить экземпляр SQL Server 2017 до накопительного пакета обновления 3 (CU3) или более поздней версии.

### <a name="3-failure-to-initialize-a-varbinary-variable-causes-an-error-in-bxlserver"></a>3. Сбой инициализации переменной типа varbinary приводит к ошибке в BxlServer

Если вы запускаете код Python в SQL Server с помощью `sp_execute_external_script`, а код содержит выходные переменные типов varbinary(max), varchar(max) или аналогичных типов, переменная должна быть инициализирована или задана в составе скрипта. В противном случае компонент обмена данными BxlServer вызывает ошибку и прекращает работу.

Это ограничение будет исправлено в предстоящем наборе исправлений. В качестве обходного решения убедитесь, что переменная инициализируется в скрипте Python. Можно использовать любое допустимое значение, как показано в следующих примерах:

```sql
declare @b varbinary(max);
exec sp_execute_external_script
  @language = N'Python'
  , @script = N'b = 0x0'
  , @params = N'@b varbinary(max) OUTPUT'
  , @b = @b OUTPUT;
go
```

```sql
declare @b varchar(30);
exec sp_execute_external_script
  @language = N'Python'
  , @script = N' b = ""  '
  , @params = N'@b varchar(30) OUTPUT'
  , @b = @b OUTPUT;
go
```

### <a name="4-telemetry-warning-on-successful-execution-of-python-code"></a>4. Предупреждение телеметрии об успешном выполнении кода Python

Начиная с SQL Server 2017 с накопительным пакетом обновления 2 (CU2) может появиться следующее сообщение, даже если код Python выполняется успешно:

> *Сообщения STDERR из внешнего скрипта:* 
>  *~PYTHON_SERVICES\lib\site-packages\revoscalepy\utils\RxTelemetryLogger*
> *SyntaxWarning: telemetry_state используется до глобального объявления*

Эта проблема исправлена в SQL Server 2017 с накопительным пакетом обновления 3 (CU3). 

### <a name="5-numeric-decimal-and-money-data-types-not-supported"></a>5. Числовые, десятичные и денежные типы данных не поддерживаются

Начиная с SQL Server 2017 с накопительным пакетом обновления 12 (CU12) числовые, десятичные и денежные типы данных в WITH RESULT SETS не поддерживаются при использовании Python с `sp_execute_external_script`. Может появиться следующее сообщение:

> *[Code: 39004, SQL State: S1000]  Во время выполнения sp_execute_external_script произошла ошибка в скрипте Python с HRESULT 0x80004004.*
>
> *[Code: 39019, SQL State: S1000] Возникла ошибка во внешнем скрипте:*
>
> *Ошибка SqlSatelliteCall: неподдерживаемый тип в выходной схеме. Поддерживаемые типы: bit, smallint, int, datetime, smallmoney, real и float. char, varchar поддерживаются частично.*

Эта проблема исправлена в SQL Server 2017 с накопительным пакетом обновления 14 (CU14).

### <a name="6-bad-interpreter-error-when-installing-python-packages-with-pip-on-linux"></a>6. Ошибка интерпретатора при установке пакетов Python с pip в Linux 

В SQL Server 2019 при попытке использовать **pip**. Пример:

```bash
/opt/mssql/mlservices/runtime/python/bin/pip -h
```

Вы получите следующее сообщение об ошибке:

> *bash: /opt/mssql/mlservices/runtime/python/bin/pip: /opt/microsoft/mlserver/9.4.7/bin/python/python: bad interpreter: нет такого файла или каталога*

**Обходное решение**

Установите **pip** из [Центра пакетов Python (PyPA)](https://www.pypa.io):

```bash
wget 'https://bootstrap.pypa.io/get-pip.py' 
/opt/mssql/mlservices/bin/python/python ./get-pip.py 
```

**Рекомендация**

См. раздел [Установка пакетов Python с sqlmlutils](../package-management/install-additional-python-packages-on-sql-server.md).

**Применимо к:** SQL Server 2019 в Linux

### <a name="7-unable-to-install-python-packages-using-pip-after-installing-sql-server-2019-on-windows"></a>7. Не удается установить пакеты Python с помощью pip после установки SQL Server 2019 в Windows

После установки SQL Server 2019 в Windows попытка установить пакет Python с помощью **pip** из командной строки DOS завершается ошибкой. Пример:

```bash
pip install quantfolio
```

Возвращается следующая ошибка:

> *pip настраивается с местоположениями, требующими TLS/SSL, однако модуль SSL в Python недоступен.*

Это проблема, характерная для пакета Anaconda. Это будет исправлено в предстоящем наборе исправлений.

**Обходное решение**

Скопируйте следующие файлы:

+ `libssl-1_1-x64.dll`
+ `libcrypto-1_1-x64.dll`

из папки <br>
`C:\Program Files\Microsoft SQL Server\MSSSQL15.MSSQLSERVER\PYTHON_SERVICES\Library\bin`

в папку <br>
`C:\Program Files\Microsoft SQL Server\MSSSQL15.MSSQLSERVER\PYTHON_SERVICES\DLLs`

Затем откройте новую командную оболочку DOS.

**Применимо к:** SQL Server 2019 в Windows

### <a name="8-error-when-using-sp_execute_external_script-without-libcaboso-on-linux"></a>8. Ошибка при использовании `sp_execute_external_script` без `libc++abo.so` в Linux

На чистом компьютере Linux, на котором не установлен `libc++abi.so`, выполнение запроса `sp_execute_external_script` (SPEES) завершается сбоем с ошибкой: "Нет такого файла или каталога".

Пример:

```text
EXEC sp_execute_external_script
    @language = N'Python'
    , @script = N'
OutputDataSet = InputDataSet'
    , @input_data_1 = N'select 1'
    , @input_data_1_name = N'InputDataSet'
    , @output_data_1_name = N'OutputDataSet'
    WITH RESULT SETS (([output] int not null));
Msg 39012, Level 16, State 14, Line 0
Unable to communicate with the runtime for 'Python' script for request id: 94257840-1704-45E8-83D2-2F74AEB46CF7. Please check the requirements of 'Python' runtime.
STDERR message(s) from external script:

Failed to load library /opt/mssql-extensibility/lib/sqlsatellite.so with error libc++abi.so.1: cannot open shared object file: No such file or directory.

SqlSatelliteCall error: Failed to load library /opt/mssql-extensibility/lib/sqlsatellite.so with error libc++abi.so.1: cannot open shared object file: No such file or directory.
STDOUT message(s) from external script:
SqlSatelliteCall function failed. Please see the console output for more information.
Traceback (most recent call last):
  File "/opt/mssql/mlservices/libraries/PythonServer/revoscalepy/computecontext/RxInSqlServer.py", line 605, in rx_sql_satellite_call
    rx_native_call("SqlSatelliteCall", params)
  File "/opt/mssql/mlservices/libraries/PythonServer/revoscalepy/RxSerializable.py", line 375, in rx_native_call
    ret = px_call(functionname, params)
RuntimeError: revoscalepy function failed.
Total execution time: 00:01:00.387
```

**Обходное решение**

Выполните следующую команду:

```bash
sudo cp /opt/mssql/lib/libc++abi.so.1 /opt/mssql-extensibility/lib/
```

**Применимо к:** SQL Server 2019 в Linux

### <a name="9-cannot-install-tensorflow-package-using-sqlmlutils"></a>9. Не удается установить пакет **tensorflow** с использованием **sqlmlutils**

[Пакет sqlmlutils](../package-management/install-additional-python-packages-on-sql-server.md) используется для установки пакетов Python в SQL Server 2019. Необходимо загрузить, установить и обновить [Распространяемый компонент Microsoft Visual C++ 2015-2019 (x64)](https://visualstudio.microsoft.com/downloads/). Однако пакет **tensorflow** невозможно установить с использованием sqlmlutils. Пакет tensorflow зависит от более новой версии numpy, чем версия, установленная в SQL Server. Однако numpy — это предварительно установленный системный пакет, который sqlmlutils не может обновить при попытке установить tensorflow.

**Обходное решение**

Используя командную строку в режиме администратора, выполните следующую команду, заменив "MSSQLSERVER" именем своего экземпляра SQL:

   ```cmd
   "C:\Program Files\Microsoft SQL Server\MSSQL15.MSSQLSERVER\PYTHON_SERVICES\python.exe" -m pip install --upgrade tensorflow
   ```

   При возникновении ошибки "TLS/SSL" см. раздел [7. Не удается установить пакеты Python с помощью pip](#7-unable-to-install-python-packages-using-pip-after-installing-sql-server-2019-on-windows) выше в этой статье.

**Применимо к:** SQL Server 2019 в Windows

## <a name="revolution-r-enterprise-and-microsoft-r-open"></a>Revolution R Enterprise и Microsoft R Open

В этом разделе перечислены проблемы, связанные со средствами подключения, разработки и оценки производительности R, предоставляемыми Revolution Analytics. Эти средства предоставлялись в предварительных версиях [!INCLUDE[ssnoversion](../../includes/ssnoversion-md.md)].

Как правило, рекомендуется удалить эти предыдущие версии и установить последнюю версию SQL Server или Microsoft R Server.

### <a name="1-revolution-r-enterprise-is-not-supported"></a>1. Revolution R Enterprise не поддерживается

Параллельная установка Revolution R Enterprise с любой другой версией [!INCLUDE[rsql_productname_md](../../includes/rsql-productname-md.md)] не поддерживается.

Если у вас есть лицензия на Revolution R Enterprise, вам необходимо поместить ее на отдельном компьютере, где нет экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], и не на рабочей станции, которая будет использоваться для подключения к экземпляру [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].

Некоторые предварительные версии [!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)] включали в себя среду разработки R для Windows, которая была создана с помощью Revolution Analytics. Это средство больше не предоставляется и не поддерживается.

Для совместимости с [!INCLUDE[rsql_productname](../../includes/rsql-productname-md.md)] рекомендуется установить Microsoft R Client. [Инструменты R для Visual Studio](https://marketplace.visualstudio.com/items?itemName=MikhailArkhipov007.RTVS2019) и [Visual Studio Code](https://code.visualstudio.com/) также поддерживают решения Microsoft R.

### <a name="2-compatibility-issues-with-sqlite-odbc-driver-and-revoscaler"></a>2. Проблемы совместимости с драйвером SQLite ODBC и RevoScaleR

Версия 0.92 драйвера SQLite ODBC несовместима с RevoScaleR. Версии 0.88–0.91 и 0.93 и более поздние совместимы.

## <a name="next-steps"></a>Дальнейшие действия

[Устранение неполадок с машинным обучением в SQL Server 2017](machine-learning-troubleshooting-overview.md)