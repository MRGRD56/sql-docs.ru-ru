---
title: Распространенные ошибки скриптов R
description: В этой статье описываются некоторые распространенные ошибки, возникающие при выполнении скриптов R в SQL Server.
ms.prod: sql
ms.technology: machine-learning-services
ms.date: 05/31/2018
ms.topic: troubleshooting
author: dphansen
ms.author: davidph
ms.custom: seo-lt-2019
monikerRange: '>=sql-server-2016||>=sql-server-linux-ver15'
ms.openlocfilehash: 28dcbe177f5bc91ea73170978e2da9022154976f
ms.sourcegitcommit: 1a544cf4dd2720b124c3697d1e62ae7741db757c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/14/2020
ms.locfileid: "97470665"
---
# <a name="common-r-scripting-errors-in-sql-server"></a>Распространенные ошибки скриптов R в SQL Server
[!INCLUDE [SQL Server 2016 and later](../../includes/applies-to-version/sqlserver2016.md)]

В этой статье описываются некоторые распространенные ошибки, возникающие при выполнении скриптов R в SQL Server. Этот список не является исчерпывающим. Существует множество пакетов, и ошибки в разных версиях одного пакета могут различаться.

## <a name="valid-script-fails-in-t-sql-or-in-stored-procedures"></a>Сбой допустимого скрипта в T-SQL или хранимых процедурах

Перед заключением кода R в хранимую процедуру рекомендуется запустить его во внешней интегрированной среде разработки или в одном из средств R, например RTerm или RGui. Таким образом можно протестировать и отладить код с помощью подробных сообщений об ошибках, возвращаемых средой R.

Однако иногда код, который прекрасно работает во внешней интегрированной среде разработки или служебной программе, может не запускаться в хранимой процедуре или в контексте вычисления SQL Server. В этом случае следует обратить внимание на ряд возможных проблем, прежде чем делать вывод о том, что пакет не работает в SQL Server.

1. Проверьте, работает ли панель запуска.

2. Просмотрите сообщения, чтобы узнать, есть ли во входных или выходных данных столбцы с несовместимыми или неподдерживаемыми типами данных. Например, запросы к базе данных SQL часто возвращают идентификаторы GUID или RowGUID, которые не поддерживаются. Дополнительные сведения см. в разделе [Библиотеки R и типы данных](../r/r-libraries-and-data-types.md).

3. Просмотрите страницы справки по отдельным функциям R, чтобы определить, все ли параметры поддерживаются для контекста вычисления SQL Server. Для получения справки по ScaleR используйте встроенные команды справки R или обратитесь к [справочнику по пакету](/r-server/r-reference/revoscaler/revoscaler).

Если среда выполнения R работает, но скрипт возвращает ошибки, рекомендуем попробовать отладить скрипт в выделенной среде разработки R, такой как Инструменты R для Visual Studio.

Также рекомендуется проверить и немного переписать скрипт, чтобы устранить проблемы с типами данных, которые могут возникнуть при переносе данных между средой R и ядром СУБД. Дополнительные сведения см. в разделе [Библиотеки R и типы данных](../r/r-libraries-and-data-types.md).

Кроме того, с помощью пакета sqlrutils можно упаковать скрипт R в формате, который проще использовать в качестве хранимой процедуры. Дополнительные сведения см. в разделе:
* [Пакет sqlrutils](../r/ref-r-sqlrutils.md)
* [Создание хранимой процедуры с помощью sqlrutils](../r/how-to-create-a-stored-procedure-using-sqlrutils.md)

## <a name="script-returns-inconsistent-results"></a>Скрипт возвращает несогласованные результаты

Скрипты R могут возвращать разные значения в контексте SQL Server по ряду причин.

- При передаче данных между SQL Server и средой R для некоторых типов данных автоматически выполняется неявное преобразование типов. Дополнительные сведения см. в статье [Библиотеки R и типы данных](../r/r-libraries-and-data-types.md).

- Определите, может ли разрядность оказывать влияние. Например, результаты математических операций с плавающей запятой, выполняемых 32-разрядными и 64-разрядными библиотеками, часто различаются.

- Определите, не было ли получено значение "не число" в результате какой-либо операции. Оно может сделать результаты недействительными.

- При вычислении обратной величины к числу, близкому к нулю, отклонения могут возрастать.

- Накопление ошибок округления может приводить к тому, что вместо нуля будет получено значение меньше нуля.

## <a name="implied-authentication-for-remote-execution-via-odbc"></a>Неявная проверка подлинности при удаленном выполнении посредством ODBC

Если вы подключаетесь к компьютеру [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для выполнения команд R с помощью функций **RevoScaleR**, при использовании вызовов ODBC, записывающих данные на сервер, может возникнуть ошибка. Она происходит только при использовании проверки подлинности Windows.

Причина заключается в том, что рабочие учетные записи, создаваемые для служб R Services, не имеют разрешения на подключение к серверу. Поэтому выполнение вызовов ODBC от вашего имени невозможно. Эта проблема не возникает при использовании имен входа SQL, так как учетные данные имен входа SQL передаются в явной форме из клиента R в экземпляр SQL Server, а затем в ODBC. Однако использовать имена входа SQL не так безопасно, как проверку подлинности Windows.

Чтобы обеспечить безопасную передачу учетных данных Windows из скрипта, который инициируется удаленно, сервер SQL Server должен эмулировать учетные данные. Этот процесс называется _неявной проверкой подлинности_. Для этого рабочие учетные записи, с помощью которых скрипты R или Python выполняются на компьютере SQL Server, должны иметь соответствующие разрешения.

1. Откройте [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] с правами администратора в экземпляре, в котором будет выполняться код R.

2. Выполните следующий сценарий. Измените имя группы пользователей, если вы изменили имя по умолчанию, а также имена компьютера и экземпляра.

    ```sql
    USE [master]
    GO
    
    CREATE LOGIN [computername\\SQLRUserGroup] FROM WINDOWS WITH
    DEFAULT_DATABASE=[master], DEFAULT_LANGUAGE=[language]
    GO
    ```

## <a name="avoid-clearing-the-workspace-while-youre-running-r-in-a-sql-compute-context"></a>Старайтесь не очищать рабочую область при выполнении кода R в контексте вычисления SQL.

Хотя очистка рабочей области является обычным действием при работе в консоли R, она может иметь непредвиденные последствия в контексте вычисления SQL.

`revoScriptConnection` — это объект в рабочей области R, который содержит информацию о сеансе R, вызываемом из SQL Server. Однако если код R содержит команду для очистки рабочей области (например, `rm(list=ls())`), вся информация о сеансе и других объектах в рабочей области R также очищается.

Чтобы избежать этой проблемы, старайтесь не очищать переменные и другие объекты без особой надобности при выполнении кода R в SQL Server. Удалить конкретные переменные можно с помощью функции **remove**:

```R
remove('name1', 'name2', ...)
```

Если нужно удалить несколько переменных, мы рекомендуем сохранить имена временных переменных в списке, а затем периодически выполнять сборку мусора в нем.



## <a name="next-steps"></a>Дальнейшие действия

[Устранение неполадок и известные проблемы Служб машинного обучения](machine-learning-troubleshooting-overview.md)

[Сбор данных для устранения неполадок машинного обучения](data-collection-ml-troubleshooting-process.md)

[Установка служб машинного обучения SQL Server](../install/sql-machine-learning-services-windows-install.md)

[Устранение неполадок подключений к ядру СУБД](../../database-engine/configure-windows/troubleshoot-connecting-to-the-sql-server-database-engine.md)