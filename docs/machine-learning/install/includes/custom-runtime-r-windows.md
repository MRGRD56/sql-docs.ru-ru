---
ms.prod: sql
ms.technology: machine-learning-services
ms.date: 02/08/2021
ms.topic: include
author: dphansen
ms.author: davidph
ms.openlocfilehash: 2a156ab122f0eadce71da9f4fcaf9e99584c8e32
ms.sourcegitcommit: 917df4ffd22e4a229af7dc481dcce3ebba0aa4d7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/10/2021
ms.locfileid: "100072771"
---
## <a name="prerequisites"></a>Предварительные требования

Перед установкой настраиваемой среды выполнения R установите следующие компоненты.

+ Если вы используете существующий экземпляр SQL Server, установите [накопительный пакет обновления (CU) 3 или более поздней версии](../../../database-engine/install-windows/latest-updates-for-microsoft-sql-server.md) для SQL Server 2019.

## <a name="install-language-extensions"></a>Установка расширений языка

> [!NOTE]
> Если в SQL Server 2019 установлены [Службы машинного обучения](../../sql-server-machine-learning-services.md), значит, расширения языка уже установлены и этот шаг можно пропустить.

Выполните описанные ниже действия, чтобы установить [расширения языка SQL Server](../../../language-extensions/language-extensions-overview.md), которые используются для настраиваемой среды выполнения R.

1. Запустите мастер установки SQL Server 2019.
  
1. На вкладке **Установка** выберите параметр **Новая установка изолированного экземпляра SQL Server или добавление компонентов к существующей установке**.

1. На странице **Выбор компонентов** выберите следующие компоненты:
  
    + **Службы ядра СУБД**
  
        Чтобы использовать расширения языка с SQL Server, необходимо установить экземпляр ядра СУБД. Можно использовать новый или уже существующий экземпляр.
  
    + **Службы машинного обучения и расширения языка**

        Выберите **Службы машинного обучения и расширения языка**. Не выбирайте R, так как настраиваемую среду выполнения R вы установите позже.

        :::image type="content" source="../media/2019-setup-language-extensions.png" alt-text="Установка расширений языка для SQL Server 2019.":::

1. На странице **Все готово для установки** проверьте, включены ли указанные ниже компоненты, и нажмите **Установить**.
  
    + Службы ядра СУБД
    + Службы машинного обучения и расширения языка

1. Когда установка завершится, перезагрузите компьютер, если появится соответствующее предложение.

> [!IMPORTANT]
> Если вы устанавливаете новый экземпляр SQL Server 2019 с расширениями языка, обязательно установите [накопительный пакет обновления 3 или более поздней версии](../../../database-engine/install-windows/latest-updates-for-microsoft-sql-server.md), прежде чем перейти к следующему шагу.

## <a name="install-r"></a>Установка R

Скачайте и установите версию R, которая будет использоваться в качестве настраиваемой среды выполнения. Поддерживаются версии R 3.3 и более поздние.

1. Скачайте [R версии 3.3 или более поздней](https://cran.r-project.org/bin/windows/base/).

1. Запустите программу установки R.

1. Запомните путь установки R. Например, в данной статье это `C:\Program Files\R\R-4.0.3`.

    :::image type="content" source="../media/r-setup-path.png" alt-text="Установка R":::

## <a name="update-system-environment-variable"></a>Обновление системной переменной среды

Чтобы изменить системную переменную среды **PATH**, выполните указанные ниже действия.

1. В поле поиска Windows введите слово **Изменение системных переменных среды** и выберите результат поиска.

1. На вкладке **Дополнительно** нажмите кнопку **Переменные среды**.

1. Измените системную переменную среды **PATH**.

    Выберите пункт **PATH** и нажмите кнопку **Изменить**.

    Нажмите кнопку **Создать** и добавьте путь к папке `\bin\x64` по пути установки R. Например, `C:\Program Files\R\R-4.0.3\bin\x64`.

## <a name="install-rcpp-package"></a>Установка пакета Rcpp

Чтобы установить пакет **Rcpp**, выполните указанные ниже действия.

1. Запустите командную строку с *повышенными привилегиями* (запуск от имени администратора).

1. Запустите R из командной строки. Выполните `\bin\R.exe` в папке по пути установки R. Например, `C:\Program Files\R\R-4.0.3\bin\R.exe`.

    ```CMD
    "C:\Program Files\R\R-4.0.3\bin\R.exe"
    ```

1. Чтобы установить пакет Rcpp в папке `\library` по пути установки R, выполните приведенный ниже скрипт. Например, `C:\Program Files\R\R-4.0.3\library`.

    ```R
    install.packages("Rcpp", lib="C:\Program Files\R\R-4.0.3\library");
    ```

## <a name="grant-access-to-r-folder"></a>Предоставление доступа к папке R

> [!NOTE]
> Если выбрана установка R в папку по умолчанию `C:\Program Files\R\R-version` (например, `C:\Program Files\R\R-4.0.3`), этот шаг можно пропустить.

Выполните приведенные ниже команды **icacls** из новой командной строки *с повышенными привилегиями*, чтобы предоставить разрешение на **чтение и выполнение** для **имени пользователя службы панели запуска SQL Server** и идентификатора безопасности **S-1-15-2-1** (**ВСЕ ПАКЕТЫ ПРИЛОЖЕНИЙ**). Имя пользователя службы панели запуска имеет вид `NT Service\MSSQLLAUNCHPAD$INSTANCENAME`, где `INSTANCENAME` — имя экземпляра SQL Server.

Эти команды будут рекурсивно предоставлять доступ ко всем файлам и папкам в указанном каталоге.

1. Предоставьте **имени пользователя службы панели запуска SQL Server** разрешения на доступ к пути установки R. Например, `C:\Program Files\R\R-4.0.3`.

    ```cmd
    icacls "C:\Program Files\R\R-4.0.3" /grant "NT Service\MSSQLLAUNCHPAD":(OI)(CI)RX /T
    ```

    Для именованного экземпляра с именем **SQL01** используется команда `icacls "C:\Program Files\R\R-4.0.3" /grant "NT Service\MSSQLLAUNCHPAD$SQL01":(OI)(CI)RX /T`.

2. Предоставьте **идентификатору безопасности S-1-15-2-1** разрешения на доступ к пути установки R. Например, `C:\Program Files\R\R-4.0.3`.

    ```cmd
    icacls "C:\Program Files\R\R-4.0.3" /grant *S-1-15-2-1:(OI)(CI)RX /T
    ```

    Приведенная выше команда предоставляет разрешения идентификатору безопасности компьютера **S-1-15-2-1**, что эквивалентно разрешению **ALL APPLICATION PACKAGES** (Все пакеты приложений) в английской версии Windows. Кроме того, можно использовать `icacls "C:\Program Files\R\R-4.0.3" /grant "ALL APPLICATION PACKAGES":(OI)(CI)RX /T` в английской версии Windows.

## <a name="restart-sql-server-launchpad"></a>Перезапуск панели запуска SQL Server

Выполните описанные ниже действия, чтобы перезапустить службу "Панель запуска SQL Server".

1. Откройте [Диспетчер конфигурации SQL Server](../../../relational-databases/sql-server-configuration-manager.md).

1. В разделе **Службы SQL Server** щелкните элемент **Панель запуска SQL Server (MSSQLSERVER)** правой кнопкой мыши и выберите действие **Перезапустить**. Если используется именованный экземпляр, вместо **(MSSQLSERVER)** будет отображаться имя этого экземпляра.

## <a name="register-language-extension"></a>Регистрация расширения языка

Выполните описанные ниже действия, чтобы скачать и зарегистрировать расширение языка R, которое используется для настраиваемой среды выполнения R.

1. Скачайте файл **R-lang-extension-windows-release.zip** из [репозитория GitHub для расширений языка SQL Server](https://github.com/microsoft/sql-server-language-extensions/releases).

    Для среды разработки или тестирования также можно использовать отладочную версию (**R-lang-extension-windows-debug.zip**). Отладочная версия сохраняет в журнал подробные сведения, которые помогают изучать ошибки, и не рекомендуется для рабочих сред.

1. С помощью [Azure Data Studio](../../../azure-data-studio/what-is-azure-data-studio.md) подключитесь к экземпляру SQL Server и выполните приведенную ниже команду T-SQL, чтобы зарегистрировать расширение языка R с помощью инструкции [CREATE EXTERNAL LANGUAGE](../../../t-sql/statements/create-external-language-transact-sql.md).

    Измените путь в этой инструкции таким образом, чтобы он указывал расположение скачанного ZIP-файла с расширением языка (**R-lang-extension-windows-release.zip**) и место установки R (`C:\\Program Files\\R\\R-4.0.3`).

    ```sql
    CREATE EXTERNAL LANGUAGE [myR]
    FROM (CONTENT = N'C:\path\to\R-lang-extension-windows-release.zip', 
        FILE_NAME = 'libRExtension.dll',
        ENVIRONMENT_VARIABLES = N'{"R_HOME": "C:\\Program Files\\R\\R-4.0.3"}'););
    GO
    ```

    Выполните эту инструкцию для каждой базы данных, в которой вы намерены использовать расширение языка R.

    > [!NOTE]
    > **R** является зарезервированным словом, то есть вы не сможете указать такое имя для нового внешнего языка. Выберите другое имя. Например, в приведенной выше инструкции это имя **myR**.
