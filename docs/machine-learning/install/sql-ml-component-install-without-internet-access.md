---
title: Автономная установка без доступа к Интернету
description: Автономная установка компонентов Python и R SQL Server для Служб машинного обучения на изолированных компьютерах, защищенных брандмауэром.
ms.prod: sql
ms.technology: machine-learning-services
ms.date: 10/01/2020
ms.topic: how-to
author: dphansen
ms.author: davidph
ms.custom: seo-lt-2019
monikerRange: '>=sql-server-2016||>=sql-server-linux-ver15||=sqlallproducts-allversions'
ms.openlocfilehash: f891511b5c3547dbeecf35f27b3a56682a7b6749
ms.sourcegitcommit: 71d2389cf27156fa0404a6e6f65fb7a61c40789a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/01/2020
ms.locfileid: "91636164"
---
# <a name="offline-install-sql-server-machine-learning-services-python-and-r-on-computers-with-no-internet-access"></a>Автономная установка компонентов Python и R SQL Server для Служб машинного обучения на компьютерах без доступа к Интернету
[!INCLUDE [SQL Server 2016 and later](../../includes/applies-to-version/sqlserver2016.md)]

В этой статье описывается, как установить Службы машинного обучения SQL Server в автономном режиме на компьютерах без доступа к Интернету, изолированных и защищенных брандмауэром.

По умолчанию установщики подключаются к сайтам загрузки Майкрософт, чтобы получить необходимые и обновленные компоненты для машинного обучения на SQL Server. Если ограничения брандмауэра не позволяют установщику обратиться к этим сайтам, можно использовать устройство, подключенное к Интернету, для загрузки файлов, пересылки файлов на автономный сервер, а затем запустить программу установки.

Аналитика в базе данных состоит из экземпляра ядра СУБД, а также дополнительных компонентов для интеграции R и Python в зависимости от версии SQL Server. 

+ SQL Server 2019 включает R, Python и Java
+ SQL Server 2017 включает R и Python
+ SQL Server 2016 — только R

На изолированном сервере функции машинного обучения и языка R/Python добавляются через CAB-файлы. 

::: moniker range="=sql-server-ver15||=sqlallproducts-allversions"
## <a name="sql-server-2019-offline-install"></a>Автономная установка SQL Server 2019

Чтобы установить службы машинного обучения SQL Server (R и Python) на изолированном сервере, сначала скачайте первоначальный выпуск SQL Server и соответствующие CAB-файлы для поддержки R и Python. Даже если планируется немедленно обновить сервер для использования последнего накопительного обновления, сначала необходимо установить первоначальный выпуск.

> [!Note]
> SQL Server 2019 не содержит пакетов обновления. Первоначальный выпуск — это единственная базовая модель, которую можно обслуживать с помощью накопительных пакетов обновления.

### <a name="1---download-2019-cabs"></a>1\. Загрузка CAB-файлов 2019

На компьютере с подключением к Интернету скачайте CAB-файлы, предоставляющие функции R и Python, для первоначального выпуска и установочный носитель для SQL Server 2019.

Release  |Ссылка на скачивание  |
---------|---------------|
Microsoft R Open        | [SRO_3.5.2.125_1033.cab](https://go.microsoft.com/fwlink/?linkid=2085686) |
Microsoft R Server      | [SRS_9.4.7.25_1033.cab](https://go.microsoft.com/fwlink/?linkid=2085792) |
Microsoft Python Open   | [SPO_4.5.12.120_1033.cab](https://go.microsoft.com/fwlink/?linkid=2085793) |
Microsoft Python Server | [SPS_9.4.7.25_1033.cab](https://go.microsoft.com/fwlink/?linkid=2085685) |

> [!NOTE]
> Компонент Java входит в состав установочного носителя SQL Server и не требует отдельного CAB-файла.

###  <a name="2---get-sql-server-2019-installation-media"></a>2\. Получите установочный носитель SQL Server 2019

1. На компьютере с подключением к Интернету скачайте [программу установки SQL Server 2019](https://www.microsoft.com/sql-server/sql-server-downloads). 

2. Дважды щелкните "Настройка" и выберите тип установки **Загрузить носитель**. При использовании этого параметра программа установки создает локальный ISO-файл (или. cab), содержащий установочный носитель.

   ![Выбор типа установки для скачивания носителя](media/2019offline-download-tile.png "Скачать носитель")

::: moniker-end

::: moniker range="=sql-server-2017||=sqlallproducts-allversions"
## <a name="sql-server-2017-offline-install"></a>Автономная установка SQL Server 2017

Чтобы установить службы машинного обучения SQL Server (R и Python) на изолированном сервере, сначала скачайте первоначальный выпуск SQL Server и соответствующие CAB-файлы для поддержки R и Python. Даже если планируется немедленно обновить сервер для использования последнего накопительного обновления, сначала необходимо установить первоначальный выпуск.

> [!Note]
> SQL Server 2017 не содержит пакетов обновления. Это первый выпуск SQL Server, который использует первоначальный выпуск как единственную базовую модель, которую можно обслуживать с помощью накопительных пакетов обновления. 

### <a name="1---download-2017-cabs"></a>1\. Загрузка CAB-файлов 2017

На компьютере с подключением к Интернету скачайте CAB-файлы, предоставляющие функции R и Python, для первоначального выпуска и установочный носитель для SQL Server 2017. 

Release  |Ссылка на скачивание  |
---------|---------------|
Microsoft R Open     |[SRO_3.3.3.24_1033.cab](https://go.microsoft.com/fwlink/?LinkId=851496)|
Microsoft R Server      |[SRS_9.2.0.24_1033.cab](https://go.microsoft.com/fwlink/?LinkId=851507)|
Microsoft Python Open     |[SPO_9.2.0.24_1033.cab](https://go.microsoft.com/fwlink/?LinkId=851502) |
Microsoft Python Server    |[SPS_9.2.0.24_1033.cab](https://go.microsoft.com/fwlink/?LinkId=851508) |

###  <a name="2---get-sql-server-2017-installation-media"></a>2\. Получите установочный носитель SQL Server 2017

1. На компьютере с подключением к Интернету скачайте [программу установки SQL Server 2017](https://www.microsoft.com/sql-server/sql-server-downloads). 

2. Дважды щелкните "Настройка" и выберите тип установки **Загрузить носитель**. При использовании этого параметра программа установки создает локальный ISO-файл (или. cab), содержащий установочный носитель.

   ![Выбор типа установки для скачивания носителя](media/offline-download-tile.png "Скачать носитель")

::: moniker-end

::: moniker range="=sql-server-2016||=sqlallproducts-allversions"

## <a name="sql-server-2016-offline-install"></a>Автономная установка SQL Server 2016

SQL Server 2016 с аналитикой в базе данных поддерживает только R, с двумя CAB-файлами для пакетов продуктов и дистрибутива Майкрософт компонента R с открытым кодом, соответственно. Начните с установки одного из следующих выпусков: RTM, SP 1, SP 2. После выполнения базовой установки можно переходить к накопительным пакетам обновления.

На компьютере с подключением к Интернету скачайте CAB-файлы, используемые программой установки для установки аналитики в базе данных на SQL Server 2016. 

### <a name="1---download-2016-cabs"></a>1\. Загрузка CAB-файлов 2016

Release  | Microsoft R Open | Microsoft R Server |
---------|-----------------|---------------------|
**SQL Server 2016 RTM**     | [SRO_3.2.2.803_1033.cab](https://go.microsoft.com/fwlink/?LinkId=761266) |[SRS_8.0.3.0_1033.cab](https://go.microsoft.com/fwlink/?LinkId=735051) |
**SQL Server 2016 с пакетом обновления 1 (SP1)**     | [SRO_3.2.2.15000_1033.cab](https://go.microsoft.com/fwlink/?LinkId=824879) |[SRS_8.0.3.15000_1033.cab](https://go.microsoft.com/fwlink/?LinkId=824881) | 
**SQL Server 2016 с пакетом обновления 2 (SP2)**  |[SRO_3.2.2.16000_1033.cab](https://go.microsoft.com/fwlink/?LinkId=866039) |[SRS_8.0.3.17000_1033.cab](https://go.microsoft.com/fwlink/?LinkId=850317) |

### <a name="2---get-sql-server-2016-installation-media"></a>2\. Получите установочный носитель SQL Server 2016.

Вы можете установить SQL Server 2016 RTM, SP 1 или SP 2 в качестве первой установки на целевом компьютере. Любая из этих версий может принимать накопительное обновление.

Один из способов получить ISO-файл с установочным носителем — с помощью [Visual Studio Dev Essentials](https://visualstudio.microsoft.com/dev-essentials/). Войдите, а затем воспользуйтесь ссылкой **downloads**, чтобы найти выпуск SQL Server 2016, который требуется установить. Загрузка выполняется в формате ISO-файла, который можно скопировать на целевой компьютер для автономной установки.

::: moniker-end

## <a name="transfer-files"></a>Перенос файлов

Скопируйте установочный носитель SQL Server (ISO или CAB) и CAB-файлы аналитики в базе данных на целевой компьютер. Поместите CAB-файлы и файл установочного носителя в одну и ту же папку на целевом компьютере, например в папку% TEMP% пользователя программы установки.

Папка %TEMP% требуется для CAB-файлов Python. Для R можно использовать% TEMP% или задать для параметра `myrcachedirectory` путь к CAB-файлу.

## <a name="run-setup"></a>Запуск программы установки

При запуске установки SQL Server на компьютере, отключенном от Интернета, программа установки добавляет страницу **автономной установки** в мастер, чтобы можно было указать расположение CAB-файлов, скопированных на предыдущем шаге.

1. Чтобы начать установку, дважды щелкните файл ISO или CAB, чтобы получить доступ к установочному носителю. Вы должны увидеть файл **Setup.exe**.

2. Щелкните правой кнопкой мыши файл **setup.exe** и запустите от имени администратора.

3. Когда мастер установки отобразит страницу лицензирования для компонентов R или Python с открытым исходным кодом, нажмите кнопку **Принять**. Принятие условий лицензионного соглашения позволяет перейти к следующему шагу.

4. При получении доступа к странице **автономной установки** в **Путь установки**укажите папку, содержащую CAB-файлы, скопированные ранее.

5. Продолжайте работу, следуя инструкциям на экране, чтобы завершить установку.

<a name="apply-cu"></a>

## <a name="apply-cumulative-updates"></a>Применение накопительных пакетов обновления.

Мы рекомендуем применить последнее накопительное обновление к компонентам ядра СУБД и машинного обучения. Накопительные обновления устанавливаются с помощью программы установки. 

::: moniker range="=sql-server-ver15||=sqlallproducts-allversions"
1. Начните с базового экземпляра. Накопительные обновления можно применять только к существующим установкам изначального выпуска SQL Server.

2. На подключенном к Интернету устройстве щелкните ссылку пакета накопительного обновления для вашей версии SQL Server:

   + Обновления SQL Server 2019 *(обновления еще не доступны для 2019)*
::: moniker-end

::: moniker range="=sql-server-2017||=sqlallproducts-allversions"
1. Начните с базового экземпляра. Накопительные обновления можно применять только к существующим установкам изначального выпуска SQL Server.

2. На подключенном к Интернету устройстве щелкните ссылку пакета накопительного обновления для вашей версии SQL Server:

   + [Обновления SQL Server 2017](https://sqlserverupdates.com/sql-server-2017-updates/)
::: moniker-end

::: moniker range="=sql-server-2016||=sqlallproducts-allversions"
1. Начните с базового экземпляра. Накопительные обновления можно применять только к существующим установкам изначального выпуска SQL Server 2016, SQL Server 2016 SP 1 или SQL Server 2016 SP 2.

2. На подключенном к Интернету устройстве щелкните ссылку пакета накопительного обновления для вашей версии SQL Server:

   + [Обновления SQL Server 2016](https://sqlserverupdates.com/sql-server-2016-updates/)
::: moniker-end

3. Выберите последнее накопительное обновление, чтобы скачать исполняемый файл.

4. Получите соответствующие CAB-файлы для R и Python. Ссылки для загрузки см. в разделе [CAB-загрузки для накопительных обновлений в экземплярах SQL Server с аналитикой в базе данных](sql-ml-cab-downloads.md).

5. Перенесите все файлы, исполняемые и CAB-файлы, в ту же папку на автономном компьютере.

6. Запустите программу установки. Примите условия лицензионного соглашения и на странице "Выбор компонентов" проверьте компоненты, для которых применяются накопительные пакеты обновления. Вы должны увидеть все компоненты, установленные для текущего экземпляра, включая функции машинного обучения.

   ![Выбор компонентов из дерева компонентов](media/cumulative-update-feature-selection.png "Список функций")

5. Продолжайте работу с мастером, принимая условия лицензионного соглашения для дистрибутивов R и Python. Во время установки вам будет предложено выбрать расположение папки с обновленными CAB-файлами.

## <a name="set-environment-variables"></a>Настройка переменных среды

Только для интеграции с R присвойте переменной среды **MKL_CBWR** значение [ensure consistent output](https://software.intel.com/articles/introduction-to-the-conditional-numerical-reproducibility-cnr) из вычислений Intel Math Kernel Library (MKL).

1. На панели управления щелкните **Система и безопасность** > **Система** > **Расширенные параметры системы** > **Переменные среды**.

2. Создайте новую пользовательскую или системную переменную. 

   + Задайте имя переменной как `MKL_CBWR`.
   + Задайте значение переменной как `AUTO`.

Для этого шага требуется перезагрузка сервера. Если вы собираетесь включить выполнение сценариев, можно удерживать его при перезапуске до тех пор, пока не будет выполнена вся настройка.

## <a name="post-install-configuration"></a>Настройка после установки

::: moniker range=">=sql-server-2017||=sqlallproducts-allversions"
После завершения установки перезапустите службу, а затем настройте сервер, чтобы включить выполнение сценария:

+ [Включение выполнения внешнего сценария](sql-machine-learning-services-windows-install.md#bkmk_enableFeature)

Для начальной автономной установки SQL Server службы машинного обучения требуется та же конфигурация, что и в сети.

+ [Проверка установки](sql-machine-learning-services-windows-install.md#verify-installation)
+ [Требуется дополнительная настройка](sql-machine-learning-services-windows-install.md#additional-configuration)
::: moniker-end

::: moniker range="=sql-server-2016||=sqlallproducts-allversions"
После завершения установки перезапустите службу, а затем настройте сервер, чтобы включить выполнение сценария:

+ [Включение выполнения внешнего сценария](sql-r-services-windows-install.md#bkmk_enableFeature)

Для начальной автономной установки SQL Server R Services требуется та же конфигурация, что и в оперативной установке:

+ [Проверка установки](sql-r-services-windows-install.md#verify-installation)
+ [Требуется дополнительная настройка](sql-r-services-windows-install.md#bkmk_FollowUp)
::: moniker-end

## <a name="next-steps"></a>Дальнейшие действия

Сведения о том, как использовать службы машинного обучения для выполнения скриптов R или Python в базе данных, см. в статье [Установка Служб машинного обучения SQL Server](../install/sql-machine-learning-services-windows-install.md).
