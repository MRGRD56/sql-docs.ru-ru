---
description: Настройка TLS-соединений на сервере отчетов, работающем в собственном режиме
title: Настройка TLS-соединений на сервере отчетов в собственном режиме | Документация Майкрософт
ms.date: 09/27/2020
ms.prod: reporting-services
ms.prod_service: reporting-services-native
ms.technology: security
ms.topic: conceptual
helpviewer_keywords:
- Secure Sockets Layer (SSL)
ms.assetid: 212f2042-456a-4c0a-8d76-480b18f02431
author: maggiesMSFT
ms.author: maggies
ms.openlocfilehash: 0532c42a5bd080b7f686c1663c6f88d8066bc9ff
ms.sourcegitcommit: f30b5f61c514437ea58acc5769359c33255b85b5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2021
ms.locfileid: "99076266"
---
# <a name="configure-tls-connections-on-a-native-mode-report-server"></a>Настройка TLS-соединений на сервере отчетов, работающем в собственном режиме

[!INCLUDE[ssrs-appliesto](../../includes/ssrs-appliesto.md)] [!INCLUDE[ssrs-appliesto-2016-and-later](../../includes/ssrs-appliesto-2016-and-later.md)] [!INCLUDE[ssrs-appliesto-pbirsi](../../includes/ssrs-appliesto-pbirs.md)]

[!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] В собственном режиме используется HTTP-служба протокола SSL для установления зашифрованного соединения с сервером отчетов. Протокол TLS ранее назывался SSL. Если в локальном хранилище сертификатов на компьютере сервера отчетов установлен CER-файл сертификата, можно связать его с резервированием URL-адресов служб [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] для поддержки соединений сервера отчетов через зашифрованный канал.  
  
> [!TIP]  
>  Если используется режим интеграции служб [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] с SharePoint, см. дополнительные сведения в документации по SharePoint. Например, руководство по [включению TLS в веб-приложении SharePoint 2010](/archive/blogs/sowmyancs/how-to-enable-ssl-on-a-sharepoint-2010-web-application).  
  
 Поскольку службы IIS также используют HTTP-службу SSL, возникает ряд важных проблем взаимодействия, которые необходимо учитывать при запуске служб IIS и служб [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] на одном компьютере. Ознакомьтесь с разделом «Проблемы взаимодействия со службами IIS», где приводятся рекомендации по решению данных проблем.  
  
## <a name="server-certificate-requirements"></a>Требования к сертификату сервера  
 Сертификат сервера должен быть установлен на компьютере (клиентские сертификаты не поддерживаются). Службы Reporting Services не содержат функций запроса, формирования, загрузки или установки сертификата. В Windows Server, начиная с версии 2012, доступна оснастка "Сертификаты", с помощью которой можно запрашивать сертификаты из доверенного центра сертификации.  
  
 Для тестовых целей можно сформировать локальный сертификат. Если используется программа **MakeCert** и пример команды в качестве шаблона, то перед выполнением команды задайте в качестве узла имя сервера и удалите все разрывы строки. Если команда выполняется в DOS-окне, то может понадобиться увеличить размер оконного буфера, чтобы в него вошла вся команда.  
  
 Если службы IIS и [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] работают вместе на одном компьютере, для установки сертификата на компьютер можно использовать консольное приложение "Диспетчер IIS". Оно включает возможности создания и упаковки запроса файла сертификата (CRT) для последующей обработки надежным центром сертификации. Центр сертификации создаст файл сертификата (CER) и вышлет его обратно. Установку файла сертификата в локальное хранилище можно выполнить при помощи консоли управления службами IIS. Дополнительные сведения см. в разделе [Использование SSL для шифрования конфиденциальных данных](/previous-versions/windows/it-pro/windows-server-2003/cc738495(v=ws.10)) на веб-узле TechNet.  
  
## <a name="interoperability-issues-with-iis"></a>Проблемы взаимодействия со службами IIS  
 Присутствие на одном компьютере служб IIS и служб [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] оказывает значительное влияние на TLS-соединения с сервером отчетов:  
  
-   Если установлены службы IIS, то должна быть постоянно запущена служба W3SVC. HTTP-служба SSL создает зависимость от служб IIS, если обнаружит, что они запущены. Это означает, что если службы IIS и [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] установлены на одном компьютере и URL-адреса серверов отчетов настроены на TLS-соединения, то должна быть запущена служба W3SVC.  
  
-   Удаление службы IIS может временно нарушить работу службы по привязанному к TLS-соединению URL-адресу сервера отчетов. По этой причине рекомендуется перезапустить компьютер после удаления служб IIS.  
  
     Это необходимо, чтобы удалить из кэша все TLS-сеансы. В некоторых операционных системах время кэширования TLS-сеансов составляет до 10 часов, в результате чего URL-адрес https:// продолжает работать даже после удаления привязки TLS из резервирования URL-адресов в компоненте HTTP.SYS. Перезагрузка компьютера позволит закрыть все открытые соединения, использующие этот канал.  
  
## <a name="bind-tls-to-a-reporting-services-url-reservation"></a>Привязка TLS к резервированию URL-адресов служб Reporting Services  
 Следующие шаги не содержат инструкций для запроса формирования, загрузки или установки сертификата. Сертификат должен быть установлен и доступен для использования. Главное, что при этом требуется, — правильно задать свойства сертификата, получить его из центра сертификации и пользоваться средствами и программами для запроса и установки сертификата.  
  
 Привязку сертификата можно выполнить при помощи программы настройки служб [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] . Если сертификат установлен в хранилище локального компьютера правильно, программа настройки служб [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] обнаружит его и отобразит в списке **Сертификаты SSL** на страницах **URL-адрес веб-службы** и **URL-адрес веб-портала**.  
  
### <a name="to-configure-a-report-server-url-for-tls"></a>Настройка URL-адреса сервера отчетов для TLS  
  
1.  Запустите программу настройки служб Reporting Services и подключитесь к серверу отчетов.  
  
2.  Щелкните **URL-адрес веб-службы**.  
  
3.  Разверните список TLS/SSL-сертификатов. [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] производят в локальном хранилище поиск сертификатов проверки подлинности сервера. Если сертификат установлен, но его нет в списке, то может понадобиться перезапустить службу. Это можно сделать с помощью кнопок **Стоп** и **Пуск** на странице **Состояние сервера отчетов** в программе настройки служб Reporting Services (верхняя страница).  
  
4.  Выберите сертификат.  
  
5.  Нажмите кнопку **Применить**.  
  
6.  Щелкните URL-адрес, чтобы проверить работоспособность.  
  
 Для тестирования URL-адреса необходима настройка базы данных сервера отчетов. Если база данных сервера отчетов еще не создана, то это необходимо сделать до начала тестирования URL-адреса.  
  
 Резервирования URL-адресов для веб-портала и веб-служб сервера отчетов настраиваются независимо. Вы также можете настроить доступ к веб-порталу через канал с TLS-шифрованием, сделав следующее.  
  
1.  Перейдите по **URL-адресу веб-портала**.
  
2.  Выберите **Дополнительно**.  
  
3.  В разделе **Несколько HTTPS-удостоверений для выбранного сейчас компонента Reporting Services** выберите **Добавить**.  
  
4.  Выберите сертификат, а затем щелкните **ОК** и **Применить**.  
  
5.  Проверьте URL-адрес.  
  
## <a name="how-certificate-bindings-are-stored"></a>Хранение привязок к сертификату  
 Привязки к сертификату хранятся в файле HTTP.SYS. Представление определенных пользователем привязок также сохраняется в разделе **URLReservations** файла RSReportServer.config. Настройки в файле конфигурации являются только представлением фактических значений, указанных в другом месте. Изменять значения непосредственно в файле конфигурации нельзя. Параметры настройки появятся в файле только в результате использования программы настройки служб [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] или поставщика инструментария управления Windows (WMI) для привязки сертификата.  
  
> [!NOTE]  
>  Если настройка привязки выполняется при помощи TLS/SSL-сертификата в службах [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)], а в дальнейшем потребуется удалить сертификат из компьютера, обеспечьте удаление привязки из служб [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] перед удалением сертификата из компьютера. В противном случае будет невозможно удалить привязку при помощи программы настройки служб [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] или WMI и появится уведомление об ошибке «Недопустимый параметр». Если сертификат уже удален из компьютера, можно использовать средство Httpcfg.exe для удаления привязки из компонента HTTP.SYS. Дополнительные сведения о Httpcfg.exe см. в документации по продукту Windows.  
  
 Привязки TLS являются общими ресурсами в Microsoft Windows. Изменения, проведенные в диспетчере конфигурации служб [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] или других программах наподобие диспетчера IIS, могут отразиться на работе других приложений, работающих на этом же компьютере. Рекомендуется пользоваться для изменения привязок тем же средством, которое использовалось для их создания.  Например, если привязки TLS создавались с помощью Configuration Manager, рекомендуется работать с ними в той же программе в течение всего срока их службы. Если же для создания привязок использовался диспетчер IIS, рекомендуется выполнять все дальнейшие операции с этими привязками с помощью диспетчера IIS. Если службы IIS установлены на компьютере до установки служб [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)], рекомендуется проверить конфигурацию TLS в IIS перед настройкой служб [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)].  
  
 Если удаление привязок TLS для служб [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] выполняется с помощью диспетчера конфигурации сервера отчетов, то может перестать работать TLS для веб-сайтов на сервере, где работают службы IIS, или на другом сервере HTTP.SYS. [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] Configuration Manager удаляет следующий раздел реестра: **HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\HTTP\Parameters\SslBindingInfo\0.0.0.0:443** Если этот раздел реестра удаляется, привязка TLS для IIS также удаляется. Без этой привязки TLS для протокола HTTPS не поддерживается. Чтобы определить проблему, используйте диспетчер IIS или программу командной строки HTTPCFG.exe. Чтобы устранить проблему, восстановите привязку TLS для веб-сайтов с помощью диспетчера IIS. Чтобы предотвратить возникновение этой проблемы в будущем, с помощью диспетчера IIS удалите привязки TLS, а затем восстановите привязку для нужных веб-сайтов. Дополнительные сведения см. в статье базы знаний [SSL перестает работать после удаления привязки SSL (https://support.microsoft.com/kb/956209/n)](https://web.archive.org/web/20150215042139/http://support.microsoft.com:80/kb/956209).  
  
## <a name="see-also"></a>См. также раздел  
 [Проверка подлинности с использованием сервера отчетов](../../reporting-services/security/authentication-with-the-report-server.md)   
 [Настройка и администрирование сервера отчетов (службы Reporting Services в собственном режиме)](../../reporting-services/report-server/configure-and-administer-a-report-server-ssrs-native-mode.md)   
 [RsReportServer.config Configuration File](../../reporting-services/report-server/rsreportserver-config-configuration-file.md)   
 [Настройка URL-адресов сервера отчетов (диспетчер конфигурации сервера отчетов)](../../reporting-services/install-windows/configure-report-server-urls-ssrs-configuration-manager.md)  
  
