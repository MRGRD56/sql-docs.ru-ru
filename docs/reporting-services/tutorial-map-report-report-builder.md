---
title: Учебник. Отчет-карта (построитель отчетов) | Документация Майкрософт
description: Сведения о функциях карты, которые можно использовать для отображения данных отчета Reporting Services с разбивкой на страницы в географическом контексте.
ms.date: 08/31/2016
ms.prod: reporting-services
ms.prod_service: reporting-services-native
ms.technology: reporting-services
ms.topic: conceptual
ms.assetid: 8d831356-7efa-40cc-ae95-383b3eecf833
author: maggiesMSFT
ms.author: maggies
ms.openlocfilehash: 0b2778023aaa884849d174e27a4e81d0ebd48490
ms.sourcegitcommit: a41e1f4199785a2b8019a419a1f3dcdc15571044
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/13/2020
ms.locfileid: "91988409"
---
# <a name="tutorial-map-report-report-builder"></a>Руководство по Отчет-карта (построитель отчетов)
Этот учебник по [!INCLUDE[ssRBnoversion_md](../includes/ssrbnoversion.md)] позволяет изучить функции карты, которые можно использовать для отображения данных отчета [!INCLUDE[ssRSnoversion_md](../includes/ssrsnoversion-md.md)] с разбивкой на страницы в географическом контексте. 
  
Карты строятся по пространственным данным, которые обычно представляют собой набор точек, линий и многоугольников. Например, многоугольник может представлять очертания страны, линия — дорогу, а точка может обозначать местоположение города. Все типы пространственных данных отображаются на отдельном слое карты в виде набора элементов карты.  
  
Чтобы изменить внешний вид элементов карты, необходимо указать поле со значениями, сопоставляющими элементы карты с аналитическими данными из набора данных. Также можно определять на основе диапазонов данных правила, с помощью которых задается цвет, размер и другие свойства.  

![report-builder-map-final-map-only](../reporting-services/media/report-builder-map-final-map-only.png)
  
В этом учебнике вы создадите отчет-карту, где отображается местоположение магазинов в округах штата Нью-Йорк.  
   
> [!NOTE]  
> В данном учебнике стадии работы мастера объединены в две процедуры: для создания набора данных и для создания таблиц. Пошаговые инструкции по переходу к серверу отчетов, выбору источника данных, созданию набора данных и запуску мастера см. в первом учебнике этой серии: [Учебник. Создание простого табличного отчета &#40;построитель отчетов&#41;](../reporting-services/tutorial-creating-a-basic-table-report-report-builder.md).  
  
На изучение этого руководства потребуется примерно 30 минут.  
  
## <a name="requirements"></a>Требования  
Для работы с учебником сервер отчетов необходимо настроить для поддержки карт Bing в качестве фона. Дополнительные сведения см. в разделе [План поддержки отчетов-карт](./report-design/plan-a-map-report-report-builder-and-ssrs.md). 

Дополнительные сведения о требованиях см. в разделе [Предварительные условия для использования учебников (построитель отчетов)](../reporting-services/prerequisites-for-tutorials-report-builder.md).  
  
## <a name="1-create-a-map-with-a-polygon-layer-from-the-map-wizard"></a><a name="Map"></a>1. Создание карты со слоем многоугольника с помощью мастера карт  
В этом разделе вы добавите карту к отчету из коллекции карт. На карте имеется один слой, на котором отображаются округи штата Нью-Йорк. Все округи имеют одну форму — форму многоугольника, заданную на основе пространственных данных, внедряемых в карту из галереи карт.  
  
### <a name="to-add-a-map-with-the-map-wizard-in-a-new-report"></a>Добавление в новый отчет карты с помощью мастера карт  
  
1.  [Запустите построитель отчетов](../reporting-services/report-builder/start-report-builder.md) с компьютера, веб-портала [!INCLUDE[ssRSnoversion_md](../includes/ssrsnoversion-md.md)] или сервера в режиме интеграции с SharePoint.  
  
    Откроется диалоговое окно **Создать отчет или набор данных** .  
  
    Если диалоговое окно **Новый отчет или набор данных** не появилось, в меню **Файл** выберите команду **Создать**.  
  
2.  Убедитесь, что на левой панели выбран **Новый отчет** .  
  
3.  На правой панели щелкните **Мастер карт**.  
  
4.  На странице **Выбрать источник пространственных данных** проверьте, выбран ли параметр **Галерея карт** .  
  
6.  В поле "Галерея карт" разверните узел **Штаты по округам** в узле **США**и выберите **Нью-Йорк**.  
  
    На панели «Предварительный просмотр карты» отобразится карта округов штата Нью-Йорк.  
    
    ![report-builder-map-ny-counties](../reporting-services/media/report-builder-map-ny-counties.png)
  
7.  Щелкните **Далее**.  
  
8.  На странице **Выберите пространственные данные и параметры просмотра карты** примите значения по умолчанию и нажмите кнопку **Далее**. 
 
    По умолчанию все элементы карты из галереи карт автоматически внедряются в определение отчета.  
  
9. На странице **Выбор визуализации карты** выберите параметр **Простая карта** и нажмите кнопку **Далее**.  
  
11. На странице **Выбор цветовой схемы и визуализации данных** выберите параметр **Отображать метки** .  
  
12. Если флажок **Одноцветная карта** установлен, снимите его.  
  
13. Из раскрывающегося списка **Поле данных** выберите **#COUNTYNAME**. На панели «Предварительный просмотр карты» в мастере отображаются следующие элементы:  
  
    -   Заголовок с текстом **Заголовок карты**.  
  
    -   На карте отображаются округи, входящие в штат Нью-Йорк, причем каждый из округов окрашен в собственный цвет, а его название выведено в наиболее подходящем месте площади этого округа.  
  
    -   Условные обозначения, содержащие заголовок и перечень элементов от 1 до 5.  
  
    -   Цветовая шкала, содержащая значения от 0 до 160 и отсутствие цвета.  
  
    -   Шкала расстояний, отображающая расстояния в километрах и милях.  
    
    ![report-builder-map-choose-color-theme](../reporting-services/media/report-builder-map-choose-color-theme.png)
  
14. Нажмите кнопку **Готово**.  
  
    Карта добавляется в область конструктора.  
  
13. Выберите текст "Заголовок карты" и введите **Продажи по магазинам**, после чего нажмите клавишу ВВОД.  

15. Дважды щелкните карту, чтобы отобразить панель **Слои карты**. На панели **Слои карты** показан один слой многоугольников PolygonLayer1 типа **Внедренный**. Каждый округ представляет собой элемент карты, внедренный в этот слой.  
  
    > [!NOTE]  
    > Если панель **Слои карты** не видна, она может отображаться за пределами текущего представления. Используйте полосу прокрутки в нижней части окна в режиме конструктора для перемещения представления. Также можно снять флажок **Данные отчета** на вкладке **Вид** , чтобы освободить дополнительную область конструктора.   

15. Щелкните стрелку рядом со слоем PolygonLayer1 и выберите пункт **Свойства многоугольника**.

16. На вкладке **Шрифт** измените цвет на **Бледно-серый**.

17. На вкладке **Главная** нажмите кнопку **Выполнить** для предварительного просмотра отчета.  
  
    ![report-builder-map-first-preview](../reporting-services/media/report-builder-map-first-preview.png)
  
В готовом к просмотру отчете отображается заголовок карты, карта и шкала расстояний. Округи находятся на слое многоугольников карты. Каждый округ представляет собой многоугольник, окрашенный в определенный цвет цветовой палитры, однако цвета не связаны с данными. Шкала расстояний отображает расстояния в километрах и в милях.  
  
Условные обозначения и цветовая шкала не отображаются на этом этапе, поскольку отсутствуют аналитические данные, связанные с каждым из округов. Добавление аналитических данных описано в этом учебнике ниже.  
  
## <a name="2-add-a-map-point-layer-to-display-store-locations"></a><a name="PointLayer"></a>2. Добавление слоя точек карты для отображения местоположения магазинов  
В этом разделе вы используете мастер слоев карты, чтобы добавить слой точек, в котором отображается местоположение магазинов.  
  
> [!NOTE]  
> В этом учебнике запрос уже содержит значения данных, поэтому внешний источник данных не требуется. В связи с этим запрос получается весьма длинным. В рабочей среде запрос не будет содержать данные. Этот запрос содержит данные только в учебных целях.  
  
### <a name="to-add-a-point-layer-based-on-a-sql-server-spatial-query"></a>Добавление слоя точек на основе пространственного запроса SQL Server  
  
1.  На вкладке **Запуск** выберите **Конструктор**, чтобы вернуться в представление конструктора.  
  
2.  Дважды щелкните карту, чтобы отобразить панель **Слои карты** . На панели инструментов нажмите кнопку **Мастер создания слоя**![rs_IconMapLayerWizard](../reporting-services/media/rs-iconmaplayerwizard.gif "rs_IconMapLayerWizard"). 

    ![report-builder-map-new-layer-wizard-icon](../reporting-services/media/report-builder-map-new-layer-wizard-icon.png) 
  
3.  На странице **Выбор источника пространственных данных** выберите параметр **Пространственный запрос SQL Server**и нажмите кнопку **Далее**.  
  
4.  На странице **Выберите набор данных с пространственными данными SQL Server** нажмите **Добавить новый набор данных с пространственными данными SQL Server** > **Далее**.  
  
5.  На странице **Выбор соединения с источником пространственных данных SQL Server** выберите существующий источник данных или перейдите к серверу отчетов и выберите источник данных.  

    > [!NOTE]  
    > При наличии необходимых разрешений выбор источника данных не имеет существенного значения. Этот источник данных не будет использоваться для получения данных. Дополнительные сведения см. в разделе [Альтернативные способы создания подключения к данным &#40;построитель отчетов&#41;](../reporting-services/alternative-ways-to-get-a-data-connection-report-builder.md).  
  
6.  Щелкните **Далее**.  
  
7.  На странице **Проектирование запроса** нажмите кнопку **Изменить как текст**.  
  
8.  Скопируйте следующий текст и вставьте его на панель запроса:  
  
    ```  
    Select 114 as StoreKey, 'Contoso Albany Store' as StoreName, 1125 as SellingArea, 'Albany' as City, 'Albany' as County,   
     CAST(1000000 as money) as Sales, CAST('POINT(-73.7472924218681 42.6564617079878)' as geography) AS SpatialLocation  
    UNION ALL SELECT 115 AS StoreKey, 'Contoso New York No.1 Store' AS  StoreName, 500 as SellingArea, 'New York' AS City, 'New York City' as County,  
     CAST('2000000' as money) as Sales, CAST('POINT(-73.9922069374483 40.7549638237402)' as geography) AS SpatialLocation  
    UNION ALL Select 116 as StoreKey, 'Contoso Rochester No.1 Store' as StoreName, 462 as SellingArea, 'Rochester' as City,  'Monroe' as County,    
     CAST(3000000 as money) as Sales, CAST('POINT(-77.624041566786 43.1547066024338)' as geography)  AS SpatialLocation  
    UNION ALL Select 117 as StoreKey, 'Contoso New York No.2 Store' as StoreName, 700 as SellingArea, 'New York' as City,'New York City' as County,    
      CAST(4000000 as money) as Sales, CAST('POINT(-73.9712488 40.7830603)' as geography) AS SpatialLocation  
    UNION ALL Select 118 as StoreKey, 'Contoso Syracuse Store' as StoreName, 680 as SellingArea, 'Syracuse' as City, 'Onondaga' as County,  
     CAST(5000000 as money) as Sales, CAST('POINT(-76.1349120532546 43.0610223535974)' as geography) AS SpatialLocation  
    UNION ALL Select 120 as StoreKey, 'Contoso Plattsburgh Store' as StoreName, 560 as SellingArea, 'Plattsburgh' as City,  'Clinton' as County,  
     CAST(6000000 as money) as Sales, CAST('POINT(-73.4728622833178 44.7028831413324)' as geography) AS SpatialLocation  
    UNION ALL Select 121 as StoreKey, 'Contoso Brooklyn Store' as StoreName, 1125 as SellingArea, 'Brooklyn' as City, 'New York City' as County,  
     CAST(7000000 as money) as Sales, CAST('POINT (-73.9638533447143 40.6785123489351)' as geography) AS SpatialLocation  
    UNION ALL Select 122 as StoreKey, 'Contoso Oswego Store' as StoreName, 500 as SellingArea, 'Oswego' as City, 'Oswego' as County,    
     CAST(8000000 as money) as Sales, CAST('POINT(-76.4602850815536 43.4353224527794)' as geography) AS SpatialLocation  
    UNION ALL Select 123 as StoreKey, 'Contoso Ithaca Store' as StoreName, 460 as SellingArea, 'Ithaca' as City, 'Tompkins' as County,  
     CAST(9000000 as money) as Sales, CAST('POINT(-76.5001866085881 42.4310489934743)' as geography) AS SpatialLocation  
    UNION ALL Select 124 as StoreKey, 'Contoso Buffalo Store' as StoreName, 700 as SellingArea, 'Buffalo' as City, 'Erie' as County,    
     CAST(100000 as money) as Sales, CAST('POINT(-78.8784 42.8864)' as geography) AS SpatialLocation  
    UNION ALL Select 125 as StoreKey, 'Contoso Queens Store' as StoreName, 700 as SellingArea,'Queens' as City, 'New York City' as County,  
     CAST(500000 as money) as Sales, CAST('POINT(-73.7930979029883 40.7152781765927)' as geography) AS SpatialLocation  
    UNION ALL Select 126 as StoreKey, 'Contoso Elmira Store' as StoreName, 680 as SellingArea, 'Elmira' as City, 'Chemung' as County,  
     CAST(800000 as money) as Sales, CAST('POINT(-76.7397414783301 42.0736492742663)' as geography) AS SpatialLocation  
    UNION ALL Select 127 as StoreKey, 'Contoso Poestenkill Store' as StoreName, 455 as SellingArea, 'Poestenkill' as City, 'Rensselaer' as County,    
    CAST(1500000 as money) as Sales, CAST('POINT(-73.5626737425063 42.6940551238618)' as geography) AS SpatialLocation  
    ```  
  
9. На панели инструментов конструктора запросов нажмите кнопку **Выполнить** ( **!** ).  
  
    Результирующий набор содержит семь столбцов, представляющих набор магазинов в штате Нью-Йорк, торгующих потребительскими товарами. Ниже приведен список с описанием столбцов, назначение которых может быть неочевидным. 
    *   **StoreKey**: идентификатор магазина.  
    *   **StoreName**.
    *   **SellingArea**: площадь, доступная для выставления товаров, размером от 42 до 105 квадратных метров.
    *   **City**.
    *   **County**.
    *   **Продажи.** общий объем продаж. 
    *   **SpatialLocation**: местоположение, представленное в виде широты и долготы. 

    ![report-builder-map-design-query](../reporting-services/media/report-builder-map-design-query.png) 
  
10. Щелкните **Далее**.  
  
    Будет создан набор данных отчета с именем DataSet1. После завершения работы с мастером можно просмотреть коллекцию полей отчета в области "Данные отчета".  
  
11. На странице **Выбор пространственных данных и параметров просмотра карты** установите для параметра **Пространственное поле** значение **SpatialLocation** , а для параметра **Тип слоя** — значение **Точечный**. Примите другие значения по умолчанию на этой странице.  
  
    На представлении карты будут отображены окружности, отмечающие местоположения магазинов.  
  
12. Щелкните **Далее**.  
  
13. На странице "Выбор параметров отображения карты" щелкните **Пузырьковая карта** , чтобы выбрать тип карты, на которой маркеры имеют разный размер в соответствии с данными. Щелкните **Далее**.  
  
14. На странице **Выберите набор аналитических данных** щелкните DataSet1, а затем нажмите кнопку **Далее**. На новом слое точек будет отображен набор данных, содержащий аналитические и пространственные данные.   
  
16. На странице **Выбор цветовой темы и параметров отображения данных** выберите параметр **Использовать размеры пузырьков для отображения данных**.  
  
17. В **поле данных**выберите `[Sum(SellingArea)]` , чтобы размеры пузырьков соответствовали площади, используемой в магазине для демонстрации товаров.  
  
18. Выберите **Отображать метки**и задайте значение **Поля данных**, равное `[City]`.

18. Нажмите кнопку **Готово**.  
  
    В отчет будет добавлен слой карты. В условном обозначении будут показаны размеры пузырьков в зависимости от значения SellingArea.  
  
 19. Дважды щелкните карту, чтобы отобразить панель **Слой карты** . На панели **Слой карты** отображается новый слой PointLayer1 с источником пространственных данных типа **DataRegion**.  
  
19. Добавьте заголовок условных обозначений. В условных обозначениях выделите текст **Заголовок**, введите **Торговая площадь (кв. м)** и нажмите клавишу ВВОД.  
  
21. В области **Слои карты**щелкните стрелку рядом со слоем PointLayer1 и выберите пункт **Свойства точки**.  

    ![report-builder-map-point-properties](../reporting-services/media/report-builder-map-point-properties.png)
  
22. На вкладке **Шрифт** выберите стиль **Полужирный** и размер **10 пт**.

    ![report-builder-map-point-properties-font](../reporting-services/media/report-builder-map-point-properties-font.png)
  
23. На вкладке **Общие** выберите для параметра **Размещение** значение **Внизу**.

24. [!INCLUDE[clickOK](../includes/clickok-md.md)]  
  
24. Нажмите кнопку **Выполнить** для предварительного просмотра отчета.  

    ![report-builder-map-city-names](../reporting-services/media/report-builder-map-city-names.png)
  
    На карте отображаются местоположения магазинов в штате Нью-Йорк. Размер маркера для каждого магазина зависит от торговой площади. Пять диапазонов площади рассчитаны автоматически.


  
## <a name="3-add-a-map-line-layer-to-display-a-route"></a><a name="LineLayer"></a>3. Добавление слоя линий карты для отображения маршрута  
С помощью мастера слоя карты добавьте слой карты, который будет показывать маршрут между двумя магазинами. В этом учебнике создается путь от трех местоположений магазинов. В бизнес-приложениях путь может представлять оптимальный маршрут между магазинами.  
  
### <a name="to-add-a-line-layer-to-map"></a>Добавление на карту слоя линий  
  
1.  Переключитесь в режим конструктора.  
  
2.  Дважды щелкните карту, чтобы отобразить панель **Слой карты** . На панели инструментов нажмите кнопку **Мастер создания слоя**![rs_IconMapLayerWizard](../reporting-services/media/rs-iconmaplayerwizard.gif "rs_IconMapLayerWizard").  
  
3.  На странице **Выбор источника пространственных данных** выберите параметр **Пространственный запрос SQL Server** и нажмите кнопку **Далее**.  
  
4.  На странице **Выбор набора данных с пространственными данными SQL Server** нажмите **Добавить новый набор данных с пространственными данными SQL Server** , затем нажмите кнопку **Далее**.  
  
5.  На странице **Выбрать соединение с источником пространственных данных SQL Server**выберите источник данных, который использовался в первой процедуре.  
  
6.  Щелкните **Далее**.  
  
7.  На странице **Проектирование запроса** нажмите кнопку **Изменить как текст**. Конструктор запросов переключается в текстовый режим.  
  
8.  Вставьте на панель запроса следующий текст:  
  
    ```  
    SELECT N'Path' AS Name, CAST('LINESTRING(  
       -76.5001866085881 42.4310489934743,  
       -76.4602850815536 43.4353224527794,  
       -73.4728622833178 44.7028831413324)' AS geography) as Route  
    ```  
  
9. Щелкните **Далее**.  
  
    На карте отображается путь, соединяющий три магазина.  
  
10. На странице **Выбор пространственных данных и параметров просмотра карты** установите для параметра **Пространственное поле** значение **Маршрут** , а для параметра **Тип слоя** — значение **Линейный**. Остальные значения примите по умолчанию.  
  
    На карте отображается путь от магазина в северной части штата Нью-Йорк к магазину в южной части штата Нью-Йорк.  
  
11. Щелкните **Далее**.  
  
12. На странице **Выбор визуализации карты** нажмите **Базовая карта линий**и нажмите кнопку **Далее**.  
  
13. На странице **Выбор цветовой схемы и визуализации данных**выберите параметр **Одноцветная карта**. Путь отображается одним цветом, в соответствии с выбранной темой.  
  
14. Нажмите кнопку **Готово**.  

    ![report-builder-map-line](../reporting-services/media/report-builder-map-line.png)
  
     На карте отображается новый слой линий с источником пространственных данных типа **DataRegion**. В этом примере пространственные данные поступают из набора данных, но нет никаких аналитических данных, связанных с этой линией.  

## <a name="adjust-the-zoom"></a>Настройка масштаба
1. Если виден не весь штат Нью-Йорк, можно настроить масштаб. Если выбрать карту, на панели "Свойства" будут отображаться свойства **MapViewport** . 

15. Разверните раздел **Вид** , а затем узел **Вид** , чтобы получить доступ к свойству **Масштаб** . Присвойте ему значение **125**. 

    ![report-builder-map-zoom](../reporting-services/media/report-builder-map-zoom.png)

      Это процентное значение масштаба. При значении 125 % должен быть виден весь штат.
  
## <a name="4-add-a-bing-maps-tile-background"></a><a name="TileLayer"></a>4. Добавление мозаичного фона Bing Maps  
В этом разделе вы добавите слой карты, который используется для отображения карт Bing в виде мозаичного фона.  
  
1.  Переключитесь в режим конструктора.  
  
2.  Дважды щелкните карту, чтобы отобразить панель **Слой карты** . На панели инструментов нажмите кнопку **Добавить слой**![rs_IconMapAddLayer](../reporting-services/media/rs-iconmapaddlayer.gif "rs_IconMapAddLayer").  
  
3.  Из раскрывающегося списка выберите пункт **Слой мозаики**.  
  
    Последним слоем на панели **Слой карты** является слой TileLayer1. По умолчанию мозаичный слой отображается в стиле дорожной карты.  
  
    > [!NOTE]  
    > В мастере также можно добавить мозаичный слой на странице **Выбор пространственных данных и параметров отображения карты** . Для этого выберите **Добавить фон Bing Maps для данного представления карты**. В подготовленном к просмотру отчете мозаичный фон Bing Maps отображается в соответствии с текущими параметрами центрирования и масштабирования карты.  
  
4.  Щелкните стрелку рядом со слоем TileLayer1 и выберите пункт **Свойства плитки**.  
  
5.  На вкладке **Общие** в поле **Тип**выберите значение **Вид с воздуха**. Воздушное представление не содержит текста.  

    ![report-builder-map-bing-aerial](../reporting-services/media/report-builder-map-bing-aerial.png)
  
6.  [!INCLUDE[clickOK](../includes/clickok-md.md)]  
  
## <a name="5-make-a-layer-transparent"></a><a name="Transparent"></a>5. Преобразование слоя в прозрачный  
Чтобы настроить отображение элементов в одном слое сквозь другой слой, в этом разделе вы измените порядок слоев и прозрачность каждого из слоев, пока не будет достигнут необходимый эффект. Начните с первого созданного слоя PolygonLayer1. 
  
1.  Дважды щелкните карту, чтобы отобразить панель **Слой карты** .  
  
3.  Щелкните стрелку рядом со слоем PolygonLayer1 и выберите пункт **Данные слоя**. Открывается диалоговое окно **Свойства слоя многоугольников карты** .  
  
4.  На вкладке **Видимость** в поле **Прозрачность (в процентах)** введите значение **30**.  
  
6.  [!INCLUDE[clickOK](../includes/clickok-md.md)]  
  
     В области конструктора округа отображаются полупрозрачными.  

    ![report-builder-map-transparency](../reporting-services/media/report-builder-map-transparency.png)
  
## <a name="6-vary-county-color-based-on-sales"></a><a name="Vary"></a>6. Задание различных цветов для округов в зависимости от уровня продаж  
Все округа на слое многоугольников имеют разные цвета, поскольку обработчик отчетов автоматически назначает им значения цветов из цветовой палитры темы, которую можно выбрать на последней странице шаге мастера создания карты.  
  
В этом разделе вы укажете правило выбора цвета для связывания цветов с диапазонами значений продаж магазинов по каждому из округов. Красный, желтый и зеленый цвета обозначают относительные значения уровня продаж. Отформатируйте цветовую шкалу для отображения валюты. Отобразите диапазоны значений годовых продаж в новых условных обозначениях. Округа, в которых нет магазинов, не будут выделены цветом, чтобы показать, что для них нет связанных данных.  
  
### <a name="6a-build-a-relationship-between-spatial-and-analytical-data"></a><a name="Relationship"></a>6a. Построение связей между пространственными и аналитическими данными  
Чтобы при окраске фигур округов в соответствии с аналитическими данными границы между ними были различимы, необходимо сначала связать аналитические данные с пространственными. В этом учебнике для сопоставления используются имена округов. 
  
1.  Переключитесь в режим конструктора.  
  
2.  Дважды щелкните карту, чтобы отобразить панель **Слои карты** .  
  
3.  Щелкните стрелку рядом со слоем PolygonLayer1 и выберите пункт **Данные слоя**. Открывается диалоговое окно **Свойства слоя многоугольников карты** .  
  
4.  На вкладке **Аналитические данные** в поле **Набор аналитических данных**выберите DataSet1. Этот набор данных был создан мастером, когда был создан запрос пространственных данных для округов.  
  
6.  В списке **Поля для соответствия**нажмите кнопку **Добавить**. Добавляется новая строка.  
  
7.  В списке **Из набора пространственных данных**выберите COUNTYNAME.  
  
8.  В списке **Из набора аналитических данных**выберите [County].  

    ![report-builder-map-county-colors](../reporting-services/media/report-builder-map-county-colors.png)
  
9. [!INCLUDE[clickOK](../includes/clickok-md.md)]  
  
10. Просмотрите отчет.  

    ![report-builder-map-county-highlight](../reporting-services/media/report-builder-map-county-highlight.png)
  
После выбора поля соответствия в источнике пространственных данных и аналитическом наборе данных обработчик отчета получает возможность группировать аналитические данные на основе элементов карты. У элемента карты, привязанного к данным, имеется совпадение с указанными значениями.  
  
У всех округов, в которых имеются магазины, имеется цвет, определяемый на основе цветовой палитры стиля, выбранного в мастере. Другие округа отображаются серым цветом.  
  
### <a name="6b-specify-color-rules-for-polygons"></a><a name="ColorRules"></a>6б. Указание правил цвета для многоугольников  
Чтобы создать правило, управляющее выбором различных цветов для округов в зависимости от объема продаж магазина в этом округе, необходимо указать значения диапазона, количество интервалов в отображаемом диапазоне, а также используемые цвета.  
  
#### <a name="to-specify-color-rules-for-all-polygons-that-have-associated-data"></a>Указание цветовых правил для всех многоугольников, с которыми связаны данные  
  
1.  Переключитесь в режим конструктора.  
  
2.  Щелкните стрелку рядом со слоем PolygonLayer1 и выберите пункт **Правило для цвета многоугольника**. Открывается диалоговое окно **Свойства цветовых правил карты** . Обратите внимание, что выбран параметр цветового правила **Визуализировать данные с помощью цветовой палитры** . Этот параметр был установлен мастером.  
  
3.  Выберите **Визуализировать данные с помощью цветовых диапазонов**. Вместо палитры появляются параметры выбора начального, среднего и конечного цветов.  
  
4.  Определите значения диапазонов для продаж в округах. Из раскрывающегося списка **Поле данных**выберите элемент `[Sum(Sales)]`.  
  
5.  Чтобы валюта отображалась в тысячах, измените выражение на следующее: `=Sum(Fields!Sales.Value)/1000`  
  
6.  Измените **Начальный цвет** на **Красный**.  
  
7.  Измените **Конечный цвет** на **Зеленый**.  
  
    **Красный** представляет значения низкого уровня продаж, **Желтый** — средние, а **Зеленый** — значения высокого уровня продаж. Обработчик отчета вычисляет цветовой диапазон исходя из этих значений и параметров, выбранных на странице **Распределение** .  
    
    ![report-builder-map-county-color-rules](../reporting-services/media/report-builder-map-county-color-rules.png)
  
8.  Щелкните **Распределение**.  
  
9. Выберите тип распределения **Оптимальный**. Для выражения, заданного на шаге 5, оптимальное распределение сортирует значения по поддиапазонам, обеспечивая равномерность распределения элементов по диапазонам и длин диапазонов.  
  
10. Для остальных параметров на этой странице примите значения по умолчанию. В случае выбора оптимального типа распределения, число поддиапазонов рассчитывается при выполнении отчета.  
  
11. Выберите **Условные обозначения**.  
  
12. В разделе **Параметры цветовой шкалы**выберите параметр **Показать на цветовой шкале** .  
  
13. В раскрывающемся списке **Показать в этих условных обозначениях**выберите пустую строку. Пока цветовые диапазоны будут показаны только на цветовой шкале.  
  
14. [!INCLUDE[clickOK](../includes/clickok-md.md)]  

15. Просмотрите отчет.

    ![report-builder-map-county-color-rule-preview](../reporting-services/media/report-builder-map-county-color-rule-preview.png)
  
    Цветовая шкала содержит четыре цвета: красный, оранжевый, желтый и зеленый. Каждый цвет представляет диапазон объемов продаж, рассчитанный автоматически на основе объемов продаж по округам.  
  
### <a name="6c-format-the-data-in-the-color-scale-as-currency"></a><a name="ColorScale"></a>6в. Форматирование данных в цветовой шкале как различных валют  
По умолчанию для данных задается общий формат. В этом разделе вы примените пользовательские форматы.  
  
1. Переключитесь в режим конструктора.  

2. Выберите цветовую шкалу. На вкладке **Главная** в разделе **Число** выберите пункт **Валюта**.  
  
4.  Не покидая раздел **Число** , нажмите кнопку **Уменьшить разрядность** два раза.  
  
    Цветовая шкала отображает годовой объем продаж в формате денежной суммы для каждого из диапазонов.  
  
### <a name="6d-add-a-legend-title"></a><a name="NewLegend"></a>6г. Добавление заголовка условных обозначений   
  
1.  Не снимая выделение с цветовой шкалы, обратите внимание на свойства **MapColorScale**в области "Свойства". 
  
2. Разверните раздел "Заголовок", а затем в поле свойства "Подпись" введите **Объем продаж (в тысячах)** .

3. Измените значение свойства TextColor на **Белый**.  

    ![report-builder-map-color-scale-title](../reporting-services/media/report-builder-map-color-scale-title.png)
  
8.  Просмотрите отчет.  
  
Округи, в которых имеются связанные магазины и данные о продажах, отображаются в соответствии с правилами цвета. Округи, в которых отсутствуют продажи, отображаются без цвета.  
  
### <a name="6f-change-color-for-counties-with-no-data"></a><a name="NoData"></a>6е. Изменение цветов округов, не содержащих данных  
Можно настроить параметры отображения по умолчанию для всех элементов карты на слое. Правила цвета имеют больший приоритет, чем эти параметры отображения.  
  
#### <a name="to-set-the-display-properties-for-all-elements-on-a-layer"></a>Задание свойств отображения для всех элементов слоя  
  
1.  Переключитесь в режим конструктора.  
  
2.  Дважды щелкните карту, чтобы отобразить панель **Слой карты** .  
  
3.  Щелкните на PolygonLayer1 стрелку вниз и выберите **Свойства многоугольника**. 

     ![report-builder-map-polygon-layer-properties](../reporting-services/media/report-builder-map-polygon-layer-properties.png)

     Открывается диалоговое окно **Свойства многоугольников карты** . Параметры отображения, заданные в этом диалоговом окне, применяются ко всем многоугольникам на слое до применения параметров отображения, заданных на основе правил.  
  
4.  Убедитесь в том, что на вкладке **Заливка** выбран стиль заливки **Сплошная**. Градиенты и узоры применяются ко всем цветам.  
  
6.  В поле **Цвет**выберите значение **Светло-голубоватый, стальной**.  
  
7.  [!INCLUDE[clickOK](../includes/clickok-md.md)]  
  
8.  Просмотрите отчет.  
  
Округи, с которыми не связаны данные, отображаются серо-голубым цветом. Цвета в диапазоне от **Красного** по **Зеленый** в соответствии с заданными правилами цвета используются для отображения только тех округов, для которых имеются связанные аналитические данные.  
  
## <a name="7-add-a-custom-point"></a><a name="CustomPoint"></a>7. Добавление пользовательской точки  
Чтобы создать представление нового магазина, который еще не построен, в этом разделе вы укажете точку и воспользуетесь типом маркера **Звезда** .  
  
1.  Переключитесь в режим конструктора.  
  
2.  Дважды щелкните карту, чтобы отобразить панель **Слой карты** . На панели инструментов нажмите кнопку **Добавить слой**![rs_IconMapAddLayer](../reporting-services/media/rs-iconmapaddlayer.gif "rs_IconMapAddLayer"), а затем щелкните **Слой точек**.  
  
    На карту добавляется новый слой точек. По умолчанию он имеет тип пространственных данных **Внедренный**.  
  
3.  Щелкните стрелку рядом со слоем PointLayer2 и выберите команду **Добавить точку**.  
  
4.  Переместите указатель над окном просмотра карты. Курсор превращается в перекрестье.  
  
5.  Щелкните место на карте, где нужно добавить точку. В этом учебнике необходимо щелкнуть расположение в округе Онайда. Точка, помеченная окружностью, добавляется на слой в месте щелчка. По умолчанию точка будет выбрана.  

    ![report-builder-map-custom-point](../reporting-services/media/report-builder-map-custom-point.png)
  
6.  Щелкните правой кнопкой мыши добавленную точку и выберите пункт **Свойства внедренной точки**.  
  
7.  Установите флажок **Переопределять параметры точек для этого слоя**. В диалоговом окне появляются дополнительные страницы. Значения, заданные на этих страницах, имеют более высокий приоритет, чем параметры отображения, заданные для слоя или цветовых правил.  

    ![report-builder-map-custom-point-general](../reporting-services/media/report-builder-map-custom-point-general.png)
  
8.  На вкладке **Маркер** в поле **Тип маркера**выберите значение **Звезда**.  

10. Измените значение параметра **Размер маркера** на **18 пт**.
  
3.  На вкладке **Метки** в поле **Текст метки**введите **Новый магазин**.  
  
5.  В поле **Размещение**выберите **Сверху**.  

13. На вкладке **Шрифт** измените размер шрифта на **10 пт** , а тип на **Полужирный**.

    ![report-builder-map-custom-point-font](../reporting-services/media/report-builder-map-custom-point-font.png)
  
6.  [!INCLUDE[clickOK](../includes/clickok-md.md)]  
  
7.  Просмотрите отчет.  
  
Метка помещается над местоположением магазина.  

![report-builder-map-custom-point-new-store](../reporting-services/media/report-builder-map-custom-point-new-store.png)
  
## <a name="8-center-and-resize-the-map"></a><a name="CenterView"></a>8. Центрирование карты и изменение ее размера   
В этом разделе вы узнаете, как изменить положение центра карты, а также ознакомитесь с еще одним способом изменения масштаба.  
 
1.  Переключитесь в режим конструктора.  

1.  Выберите карту, а затем щелкните ее правой кнопкой мыши и выберите пункт **Свойства окна просмотра**.  
  
2.  На вкладке **Центрирование и масштаб** убедитесь в том, что выбран параметр **Задать центр просмотра и уровень масштабирования** .  

4. Присвойте параметру **Уровень масштаба (в процентах)** значение **125**.
  
4.  [!INCLUDE[clickOK](../includes/clickok-md.md)]  
  
5.  Щелкните и перетащите карту, чтобы отцентрировать ее нужным образом.  
  
6.  Также можно использовать колесо прокрутки мыши, чтобы изменить масштаб.  
  
7.  Просмотрите отчет.  
  
В режиме конструктора при отображении карты в отображаемой области и в представлении будут использоваться образцы данных. В подготовленном для просмотру отчете представление карты будет центрировано по выбранному представлению.  
  
## <a name="9-add-a-report-title"></a><a name="Title"></a>9. Добавление заголовка отчета  
  
1.  Переключитесь в режим конструктора.
  
1.  В области конструктора щелкните ссылку **Щелкните, чтобы добавить заголовок**.  
  
2.  Введите фразу **Продажи в магазинах Нью-Йорка** и щелкните вне текстового поля.  
  
Данный заголовок появится в верхней части отчета. Элементы, расположенные в верхней части текста отчета, при отсутствии определенного верхнего колонтитула страницы служат заголовком отчета.  
  
## <a name="10-save-the-report"></a><a name="Save"></a>10. Сохранение отчета  
  
1.  В режиме конструктора или предварительного просмотра в меню **Файл** выберите команду **Сохранить как**.
 
3.  В поле **Имя**введите **Продажи магазинов в Нью-Йорке**.  

3. Сохраните отчет на компьютере или на сервере [!INCLUDE[ssRSnoversion_md](../includes/ssrsnoversion-md.md)] .
  
4. Выберите команду **Сохранить**. 

Если отчет сохранен на сервере отчетов, его можно просмотреть там.

![report-builder-map-in-portal](../reporting-services/media/report-builder-map-in-portal.png) 
  
## <a name="next-steps"></a>Next Steps  
На этом пошаговое руководство по добавлению карты в отчет завершается.  
  
Дополнительные сведения см. в разделе [Карты (построитель отчетов и службы SSRS)](../reporting-services/report-design/maps-report-builder-and-ssrs.md).  
  
## <a name="see-also"></a>См. также:  
[Учебники по построителю отчетов](../reporting-services/report-builder-tutorials.md)  
[Построитель отчетов в SQL Server](../reporting-services/report-builder/report-builder-in-sql-server-2016.md)  
[Мастер карт и мастер слоев карт (построитель отчетов и службы SSRS)](../reporting-services/report-design/map-wizard-and-map-layer-wizard-report-builder-and-ssrs.md)  
[Изменение параметров отображения многоугольников, линий и точек с помощью правил и аналитических данных (построитель отчетов и службы SSRS)](../reporting-services/report-design/vary-polygon-line-and-point-display-by-rules-and-analytical-data.md)  
